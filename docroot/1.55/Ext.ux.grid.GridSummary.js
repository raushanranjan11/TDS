Ext.ns("Ext.ux.grid");Ext.ux.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.onLayout=this.onLayout;a.afterMethod("render",this.refreshSummary,this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("syncScroll",this.syncSummaryScroll,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);b.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(c,l){var e={},h=l.config;for(var f=0,k=h.length;f<k;f++){var b=h[f],g=b.dataIndex;e[g]=0;if(b.summaryType){for(var d=0,m=c.length;d<m;d++){var a=c[d];e[g]=Ext.ux.grid.GridSummary.Calculations[b.summaryType](a.get(g),a,g,e,d)}}}return e},onLayout:function(a,b){if(Ext.type(b)!="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-this.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft},doWidth:function(c,a,b){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a},doAllWidths:function(a,b){var e=this.view.summary.dom,f=a.length;e.firstChild.style.width=b;var d=e.firstChild.rows[0].childNodes;for(var c=0;c<f;c++){d[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom,e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},renderSummary:function(d,g,l){g=g||this.view.getColumnData();var h=l.config,e=[],m=g.length-1;for(var f=0,j=g.length;f<j;f++){var k=g[f],b=h[f],a={};a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==m?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){if(typeof this.processSummaryData=="function"){d=this.processSummaryData(d)}a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a,d)}else{if(b.summaryLabel){a.value=b.summaryLabel}else{a.value=""}}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},refreshSummary:function(){var e=this.grid,h=e.store,d=this.view.getColumnData(),a=this.cm,b=h.getRange(),f=this.calculate(b,a),c=this.renderSummary({data:f},d,a);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(c).first()},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",Ext.ux.grid.GridSummary);Ext.ux.grid.GridSummary.Calculations={sum:function(b,a,c,e,d){return e[c]+Ext.num(b,0)},count:function(b,a,c,e,d){return d+1},max:function(b,a,c,e,d){return Math.max(Ext.num(b,0),e[c])},min:function(b,a,c,e,d){return Math.min(Ext.num(b,0),e[c])},average:function(b,a,d,g,f){var c=g[d]+Ext.num(b,0),e=a.store.getCount();return f==e-1?(c/e):c}};