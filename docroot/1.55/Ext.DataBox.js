Ext.DataBox=Ext.extend(Ext.BoxComponent,{eliminateDuplicates:function(b){var d,a=b.length,c=[],e={};for(d=0;d<a;d++){e[b[d]]=0}for(d in e){c.push(d)}return c},initComponent:function(){Ext.apply(this,{templateData:[],formFields:[],saveDateParent:[],saveDateParentnew:[],firstDate:new Date().add(Date.DAY,7),parentWidth:0,length:7,isReady:false,hideCheckBoxAndButtons:false,buttons:new Ext.util.MixedCollection()});this.addEvents("go");this.boxTpl=new Ext.XTemplate('<tpl for=".">','<div class="databox-item">','<div class="databox-content"></div>','<div id="'+this.id+'-gobtn-{[xindex]}"></div>',"</div>","</tpl>");this.boxContentTpl=new Ext.Template('<div class="date-text">{date}</div>','<div class="status-text">{statusAvailable}</div>','<div class="status-text">{statusRequestable}</div>');if(!this.store){this.store=new Ext.data.JsonStore({url:"",fields:["date","prominentStatus","statusTextOK","statusTextOKClass","statusTextRQ","statusTextRQClass","reservedAvailable","unreservedAvailable","reservedRequestable","unreservedRequestable","reservedWaitable","unreservedWaitable","displayWaitList"]})}this.store.on("load",this.onStoreLoad,this);Ext.DataBox.superclass.initComponent.apply(this,arguments)},onRender:function(c,b){var a=['<a href="#" class="left" hidefocus="on" style="width: 18px;"><em><span unselectable="on">&lt;</span></em></a>','<div class="x-data-box-mask">','<div class="x-data-box-wrap"></div>',"</div>",'<a href="#" class="right" hidefocus="on" style="width: 18px;"><em><span unselectable="on">&gt;</span></em></a>'];var d=document.createElement("div");d.className="x-data-box";d.innerHTML=a.join("");c.dom.insertBefore(d,b);this.backButtonEl=Ext.get(d.firstChild);this.maskEl=Ext.get(d.childNodes[1]);this.templateEl=Ext.get(d.childNodes[1].firstChild);this.forwardButtonEl=Ext.get(d.lastChild);this.el=Ext.get(d);this.calendarPanel=new Ext.Panel({renderTo:c,border:false,items:{xtype:"calendar",date:this.firstDate.add(Date.DAY,-7),length:this.length,format:"dMy",parentWidth:this.width,databox:this,setData:function(e){if(e){this.databox.firstDate=e}else{this.databox.firstDate=this.getDate().add(Date.DAY,-1)}this.databox.updateData(this.databox.getData())},listeners:{dragend:function(){this.setData();this.databox.updateCalendarStatus()},change:function(){if(this.databox.isReady){this.setData();this.databox.updateCalendarStatus()}}}}});this.initBoxes();this.initEvents();this.lm=new Ext.LoadMask(this.maskEl.id,{msg:""})},initBoxes:function(){this.boxTpl.overwrite(this.templateEl,[0,1,2,3,4,5,6]);for(var a=0;a<this.templateEl.dom.childNodes.length;a++){this.createButton(a+1)}this.updateData(this.getData());this.isReady=true},setDate:function(a){var b=this.calendarPanel.items.itemAt(0);b.setData(a);b.moveInTime(false,a.add(Date.DAY,-7))},getStore:function(){return this.store},createButton:function(d){var e="";if(this.multidays){var c=new Ext.form.Checkbox({disabled:true,databox:this,hidden:this.checkBoxNotRequired,dbIndex:d,id:this.id+"-gochk-"+d,listeners:{check:function(g,h,j){var b=this.databox,f=b.firstDate.add(Date.DAY,d-1);if(h){var i=this.id;Array.prototype.checkIfExist=function(l){for(var k=0;k<this.length;k++){if(this[k]+""==l+""){return true}}return false};if(this.focus){if(!this.databox.saveDateParentnew.checkIfExist(f)){this.databox.saveDateParentnew.push(f)}}this.databox.saveDateParentnew.sort()}else{Array.prototype.removeByValue=function(l){for(var k=0;k<this.length;k++){if(this[k]+""==l+""){this.splice(k,1);break}}};this.databox.saveDateParentnew.removeByValue(f)}}},renderTo:this.id+"-gobtn-"+d})}else{var a=new Ext.Button({text:"GO",minWidth:76,databox:this,dbIndex:d,handler:function(){var b=this.databox,f=b.firstDate.add(Date.DAY,d-1);b.fireEvent("go",b,this.dbIndex,f)},renderTo:this.id+"-gobtn-"+d});this.buttons.add(a)}},getData:function(){var c=[];Array.prototype.checkIfExist=function(e){for(var d=0;d<this.length;d++){if(this[d]+""==e+""){return true}}return false};var b=new Array(7);for(var a=0;a<b.length;a++){if(this.multidays){if(this.checkBoxNotRequired){Ext.getCmp(this.id+"-gochk-"+(a+1)).disable(true)}if(this.isReady){b[a]=this.firstDate.add(Date.DAY,a).clearTime()}else{b[a]=this.ownerCt.firstDate.add(Date.DAY,a).clearTime()}if(!this.saveDateParentnew.checkIfExist(b[a])){Ext.getCmp(this.id+"-gochk-"+(a+1)).setValue(false)}}else{b[a]=this.firstDate.add(Date.DAY,a).clearTime()}if(a==0){this.firstDate=b[a]}c.push({date:b[a].format("D dM"),statusAvailable:"?"})}return c},initEvents:function(){this.backButtonEl.on("click",function(){this.moveInTime(true)},this);this.forwardButtonEl.on("click",function(){this.moveInTime(false)},this)},moveInTime:function(d){var f=this.calendarPanel.items.itemAt(0);var b=f.getValue();if(d){var e=-this.length;var a=b-this.templateData.length}else{var e=this.length;var a=b+this.templateData.length}this.firstDate=this.firstDate.add(Date.DAY,e);this.updateData(this.getData());this.removeBoxClasses();f.removeBoxClasses();this.updateCalendarStatus();if(d){if(a<=f.minValue||!f.thumb.isVisible()||f.thumb.hasActiveFx()){f.moveInTime(true,this.firstDate.add(Date.DAY,-this.length));return}}else{if(a>=f.maxValue||!f.thumb.isVisible()||f.thumb.hasActiveFx()){f.moveInTime(true,this.firstDate.add(Date.DAY,-this.length));return}}f.setValue(a,true,true)},updateData:function(b){var d=this.calendarPanel.items.itemAt(0);d.labelWrap.dom.innerHTML='<table border=0 style="padding-left:22px; padding-top:0px;"  height="16px" width="550px"><tr "><td align="left"  style="padding-top:2px;" ><b><font size="2px" color="#663300">'+d.labelOne.dom.innerHTML+((d.labelOne.dom.innerHTML!=""&&d.labelOne.dom.innerHTML!="&nbsp;"&&typeof d.labelOne.dom.innerHTML!="undefined"&&d.labelTwo.dom.innerHTML!=""&&d.labelTwo.dom.innerHTML!="&nbsp;"&&typeof d.labelTwo.dom.innerHTML!="undefined")?" / ":"")+d.labelTwo.dom.innerHTML+'</font></b></td><td bgcolor="#9af28a" width="15px" style=" border-radius:2px;"> </td><td >Departure Date &nbsp;&nbsp;&nbsp;&nbsp;</td><td bgcolor="#ff9966" width="15px" style=" border-radius:2px;"> </td><td >Weekends</td></tr></table>';this.templateData=b;for(var a=0;a<b.length;a++){this.boxContentTpl.overwrite(Ext.fly(this.templateEl.dom.childNodes[a]).child("div.databox-content"),b[a])}},updateCalendarStatus:function(){this.calendarPanel.items.itemAt(0).updateStatus();this.updateStatus()},updateCalendarStatuschk:function(){this.calendarPanel.items.itemAt(0).updateStatus();this.updateStatus()},removeBoxClasses:function(b){if(!Ext.isArray(b)){b=["status-ok","status-rq","status-na","prominent-status-text"]}for(var a=0;a<this.templateEl.dom.childNodes.length;a++){if(this.multidays){Ext.getCmp(this.id+"-gochk-"+(a+1)).setValue(false)}Ext.fly(this.templateEl.dom.childNodes[a].childNodes[0].childNodes[1]).removeClass(b);Ext.fly(this.templateEl.dom.childNodes[a].childNodes[0].childNodes[2]).removeClass(b)}},disableBoxButtons:function(){var a=function(c){c.disable()};this.buttons.each(a)},enableButton:function(c){var a=this.buttons.get(c);a.enable()},updateStatus:function(){var e;function c(g,f){for(var h=0;h<g.length;h++){if(g[h]+""===f+""){return true}}return false}this.removeBoxClasses();var d=this.calendarPanel;for(var b=0;b<7;b++){var a=d.container.dom.childNodes[0].childNodes[1].childNodes[0].childNodes[b];Ext.fly(a).removeClass("databox-item-available");Ext.fly(a).addClass("databox-item")}this.store.each(function(l,m,h){var i=0;var p=Date.parseDate(l.get("date"),TDS.env.dateFormat);p.clearTime();while(this.firstDate.add(Date.DAY,i).getTime()<p.getTime()&&!e){if(this.firstDate.add(Date.DAY,this.length).getTime()<p.getTime()){var o=true;break}else{if(this.firstDate.add(Date.DAY,i).getTime()==p.getTime()){e=true;break}}i++;if(i>100){break}}Array.prototype.checkIfExist=function(r){for(var q=0;q<this.length;q++){if(this[q]+""==r+""){return true}}return false};var n=1,k=2;if(this.firstDate.add(Date.DAY,i).clearTime().getTime()==p.getTime()){var g=Ext.get(this.templateEl.dom.childNodes[i]);if(g){var f=g.dom.childNodes[0];var j=this.processRecord(l);if(l.get("prominentStatus")=="OK"||l.get("prominentStatus")=="NA"||l.get("prominentStatus")=="FS"){Ext.fly(f.childNodes[n]).addClass("prominent-status-text");if(l.get("prominentStatus")=="OK"||l.get("prominentStatus")=="FS"){if(g!=null){Ext.fly(g).removeClass("databox-item");Ext.fly(g).addClass("databox-item-available")}if(this.saveDateParentnew.checkIfExist(p)){Ext.getCmp(this.id+"-gochk-"+(i+1)).setValue(true)}if(this.checkBoxNotRequired){Ext.getCmp(this.id+"-gochk-"+(i+1)).setValue(true)}}}else{if(l.get("prominentStatus")=="RQ"){if(this.saveDateParentnew.checkIfExist(p)){Ext.getCmp(this.id+"-gochk-"+(i+1)).setValue(true)}Ext.fly(f.childNodes[k]).addClass("prominent-status-text")}}if(this.multidays){if(l.get("prominentStatus")=="NA"){Ext.getCmp(this.id+"-gochk-"+(i+1)).disable(true)}else{Ext.getCmp(this.id+"-gochk-"+(i+1)).enable(true)}if(this.saveDateParentnew.checkIfExist(p)){Ext.getCmp(this.id+"-gochk-"+(i+1)).setValue(true)}}Ext.fly(f.childNodes[n]).addClass(l.get("statusTextOKClass"));Ext.fly(f.childNodes[k]).addClass(l.get("statusTextRQClass"));f.childNodes[n].innerHTML=l.get("statusTextOK");f.childNodes[k].innerHTML=l.get("statusTextRQ")}}if(o){return false}},this)},onStoreLoad:function(c,b){for(var d=0;d<b.length;d++){var e=false;var a=b[d];if(a.get("reservedAvailable")==0&&a.get("unreservedAvailable")==0&&a.get("reservedWaitable")==0&&a.get("unreservedWaitable")==0&&a.get("reservedRequestable")==0&&a.get("unreservedRequestable")==0){a.set("prominentStatus","NA");a.set("statusTextOK","NA");a.set("statusTextOKClass","status-na")}else{if(a.get("reservedAvailable")==TDS.data.reservationType.FREESALE){a.set("prominentStatus","OK");a.set("statusTextOK","FS");a.set("statusTextOKClass","status-ok");if(this.checkBoxNotRequired){if(d>6){Ext.getCmp(this.id+"-gochk-"+((d-6)+1)).setValue(true)}else{Ext.getCmp(this.id+"-gochk-"+(d+1)).setValue(true)}}}else{if(a.get("reservedAvailable")>0){a.set("prominentStatus","OK");a.set("statusTextOK","OK"+a.get("reservedAvailable"));a.set("statusTextOKClass","status-ok");if(this.checkBoxNotRequired){if(d>6){Ext.getCmp(this.id+"-gochk-"+((d-6)+1)).setValue(true)}else{Ext.getCmp(this.id+"-gochk-"+(d+1)).setValue(true)}}}else{if(a.get("unreservedAvailable")>0){e=true;a.set("statusTextOK","OK"+a.get("unreservedAvailable"));a.set("statusTextOKClass","status-na")}else{e=true;a.set("statusTextOK","");a.set("statusTextOKClass","status-na")}}}if(a.get("displayWaitList")){if(a.get("reservedWaitable")==TDS.data.reservationType.UNLIMITED){if(a.get("prominentStatus")==""){a.set("prominentStatus","WL")}a.set("statusTextRQ","WL");a.set("statusTextRQClass","status-rq")}else{if(a.get("reservedWaitable")>0){if(a.get("prominentStatus")==""){a.set("prominentStatus","WL")}a.set("statusTextRQ","WL"+a.get("reservedWaitable"));a.set("statusTextRQClass","status-rq")}else{if(a.get("unreservedWaitable")>0){a.set("statusTextRQ","WL"+a.get("unreservedWaitable"));a.set("statusTextRQClass","status-rq")}else{a.set("statusTextRQ","");a.set("statusTextRQClass","status-na")}}}}else{if(e){if(a.get("reservedRequestable")==TDS.data.reservationType.UNLIMITED){if(a.get("prominentStatus")==""){a.set("prominentStatus","RQ")}a.set("statusTextRQ","RQ");a.set("statusTextRQClass","status-rq")}else{if(a.get("reservedRequestable")>0){if(a.get("prominentStatus")==""){a.set("prominentStatus","RQ")}a.set("statusTextRQ","RQ");a.set("statusTextRQClass","status-rq")}else{if(a.get("unreservedRequestable")>0){a.set("statusTextRQ","RQ");a.set("statusTextRQClass","status-na")}else{a.set("statusTextRQ","");a.set("statusTextRQClass","status-na")}}}}else{a.set("statusTextRQ","");a.set("statusTextRQClass","status-na")}}}}},processRecord:function(a){return a.data},getRecordByDate:function(b){b=b.format(TDS.env.dateFormat);var a=this.getStore().findBy(function(c,d){if(c.get("date")==b){return true}},this,0);if(a!=-1){return this.getStore().getAt(a)}return -1},getDaysFromDate:function(c){c=c.clearTime().format(TDS.env.dateFormat);var f=false;var a=0;var d=false;var e=0;var b=false;this.getStore().each(function(h){var g=d;if(h.get("date")==c){f=true}if(f){if(!d&&(h.get("reservedAvailable")>0||h.get("reservedAvailable")==TDS.data.reservationType.FREESALE||h.get("reservedWaitable")>0||h.get("reservedWaitable")==TDS.data.reservationType.UNLIMITED)){a++}else{d=true}if(!b&&(h.get("reservedRequestable")>0||h.get("reservedRequestable")==TDS.data.reservationType.UNLIMITED)){e++}else{b=true}if(d&&b){return false}}},this);return{availableDays:a,requestableDays:e}},GetSmallestDate:function(b){var a=new Date(Math.max.apply(null,b));var c=new Date(Math.min.apply(null,b));return c+"$"+a},invalidCheck:function(d){var a=[];a=d;for(var e=0;e<a.length;e++){var b=destroyArray[e].format(TDS.env.dateFormatDisplay);var c=date.format(TDS.env.dateFormatDisplay);a.splice(e,1);break}}});Ext.reg("databox",Ext.DataBox);