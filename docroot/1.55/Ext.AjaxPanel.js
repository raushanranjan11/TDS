Ext.AjaxPanel=Ext.extend(Ext.Panel,{border:false,layout:"fit",interfacePathURI:TDS.env.interfacePath,interfaceURI:"",dataPathURI:TDS.env.dataPath,dataURI:"",sessionURI:"",registerItemsToSaveOnSubmit:[],hasLoadedData:false,autoLoadPanel:true,initiatedLoad:false,groupURI:"",hasRequiredStores:false,requiredStoresRemaining:0,initComponent:function(){this.addEvents("ready","reloaddata");Ext.AjaxPanel.superclass.initComponent.apply(this,arguments)},afterRender:function(){Ext.AjaxPanel.superclass.afterRender.apply(this,arguments);this.loadMask=new Ext.LoadMask(this.id,{msg:""});if(this.autoLoadPanel){this.initLoad()}},initLoad:function(){this.fetchInterfaceURI();this.fetchDataURI();this.fetchSessionURI();this.fetchGroupURI();this.initiatedLoad=true},isReady:function(){if(this.interfaceURI&&typeof this.interfaceObj=="undefined"){return false}if(this.dataURI&&typeof this.dataObj=="undefined"){return false}if(this.sessionURI&&typeof this.sessionObj=="undefined"){return false}if(this.groupURI&&typeof this.groupObj=="undefined"){return false}if(this.hasRequiredStores&&this.requiredStoresRemaining>0){return false}this.fireEvent("ready",this);return true},reload:function(b){if(typeof this.interfaceObj=="object"){this.remove(this.interfaceObj)}this.interfaceObj={};this.dataObj={};this.sessionObj={};this.groupObj={};this.initLoad()},reloadData:function(b){this.loadMask.show();Ext.Ajax.request({url:this.dataPathURI+this.dataURI,method:"GET",callback:function(e,a,f){if(a){this.dataObj={};this.dataObj=Ext.util.JSON.decode(f.responseText);if(this.interfaceObj.xtype=="form"){this.interfaceObj.getForm().items.each(function(c){if(typeof this.dataObj[c.name]!="undefined"){c.setValue(this.dataObj[c.name])}},this)}}this.fireEvent("reloaddata",this,a,this.dataObj);this.loadMask.hide();if(b){Ext.callback(b.callback,b.scope||this,[a,f,this.dataObj])}},scope:this,disableCaching:TDS.env.disableCaching})},getData:function(b){if(!this.isReady()){return}if(b){return this.dataObj[b]}return this.dataObj},getSession:function(b){if(!this.isReady()){return}if(b){return this.sessionObj[b]}return this.sessionObj},findFieldItemsRecursive:function(b){if(b.isFormField){}if(b.xtype=="editorgrid"){}if(b.xtype=="ajaxpanel"||b.xtype=="form"||b.xtype=="tabpanel"||b.ownerCt.xtype=="tabpanel"||b.xtype=="panel"){if(b.items){b.items.each(this.findFieldItemsRecursive,this)}}},fetchInterfaceURI:function(){if(!this.interfaceURI){return}Ext.Ajax.request({url:this.interfacePathURI+this.interfaceURI+"?v="+TDS.env.version,method:"GET",callback:this.fetchInterfaceResponse,scope:this,disableCaching:TDS.env.disableCaching})},fetchDataURI:function(){if(!this.dataURI){return}Ext.Ajax.request({url:this.dataPathURI+this.dataURI,method:"GET",callback:this.fetchDataResponse,scope:this,disableCaching:TDS.env.disableCaching})},fetchSessionURI:function(){if(!this.sessionURI){return}var b=TDS.session.get({path:this.sessionURI,scope:this,callback:this.fetchSessionResponse});if(b!==-1){this.fetchSessionResponse(b)}},fetchGroupURI:function(){if(!this.groupURI){return}var b=TDS.env.user.getChildGroups({groupURI:this.groupURI,scope:this,callback:this.fetchGroupResponse});if(b!==-1){this.fetchGroupResponse(b)}},fetchInterfaceResponse:function(f,e,d){if(e){this.interfaceObj=Ext.util.JSON.decode(d.responseText);if(typeof this.interfaceObj.requireStores!="undefined"){this.hasRequiredStores=true;this.fetchRequiredStores(this.interfaceObj.requireStores)}if(this.isReady()){this.renderInterface()}}},fetchDataResponse:function(f,e,d){if(e){this.dataObj=Ext.util.JSON.decode(d.responseText);if(this.isReady()){this.renderInterface()}}},fetchSessionResponse:function(b){if(b){this.sessionObj=b;if(this.isReady()){this.renderInterface()}}},fetchGroupResponse:function(b){if(b){this.groupObj=b;if(this.isReady()){this.renderInterface()}}},fetchRequiredStores:function(b){this.requiredStoresRemaining=b.length;Ext.each(b,function(a){a.callback={fn:this.fetchRequiredStoreResponse,scope:this};var d=TDS.data.getStore(a);if(d!=-1){this.requiredStoresRemaining--;if(this.isReady()){this.renderInterface()}}},this)},fetchRequiredStoreResponse:function(){this.requiredStoresRemaining--;if(this.isReady()){this.renderInterface()}},renderInterface:function(){this.interfaceObj=this.add(this.interfaceObj);this.doLayout();this.insertData()},insertData:function(){if(this.dataObjFrom){if(Ext.getCmp(this.dataObjFrom).dataObj){this.dataObj=Ext.getCmp(this.dataObjFrom).dataObj}else{var b=new Ext.util.DelayedTask();b.delay(20,this.insertData,this);return}}if(this.dataObj){if(this.interfaceObj.xtype=="grid"){this.interfaceObj.store.loadData(this.dataObj)}if(this.interfaceObj.xtype=="form"){this.interfaceObj.getForm().setValues(this.dataObj)}}this.hasLoadedData=true;this.el.unmask()},sendDataURI:function(){for(var m=0;m<this.registerItemsToSaveOnSubmit.length;m++){if(this.registerItemsToSaveOnSubmit[m].xtype=="editorgrid"||this.registerItemsToSaveOnSubmit[m].xtype=="grid"){var k=this.registerItemsToSaveOnSubmit[m].store.getModifiedRecords();for(var n=0;n<k.length;n++){}}}if(this.interfaceObj.xtype=="form"){var h=this.interfaceObj.getForm().getValues(false);var l=false;var i={};for(var m in h){if(!this.interfaceObj.getForm().findField(m)){continue}if(h[m]!==this.dataObj[m]){i[m]=h[m];l=true}}if(l==false){return}if(this.edit){var j="PUT"}else{var j="POST"}Ext.Ajax.request({url:this.dataPathURI+this.dataURI,method:j,callback:this.sendDataResponse,jsonData:i})}},sendDataResponse:function(f,e,d){if(e){}TDS.errorMessage("sendDataResponse error..")}});Ext.reg("ajaxpanel",Ext.AjaxPanel);