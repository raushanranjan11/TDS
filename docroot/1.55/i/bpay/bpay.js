{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 8px;",autoScroll:true,getDataURI:function(){if(this.ownerCt.ownerCt.title=="Announcements "){return null}else{return this.ownerCt.ownerCt.getDataURI()}},items:{xtype:"awesomegrid",searchURI:"",enableRowExpander:false,tbar:[{xtype:"tbspecialtext",text:"Date Filter: "},{xtype:"datefield",name:"tranxDate",format:"dMy",enableKeyEvents:true,value:new Date(),width:80},"  ",{xtype:"tbspecialtext",text:"Agency: "},{xtype:"combo",name:"agencyURI",mode:"local",width:280,triggerAction:"all",editable:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"agencies/collection",identifier:"agencies",fields:["name","dataURI"]})},"->",{xtype:"button",text:"Cancel",handler:function(){;var e=this.ownerCt.ownerCt;var d=e.getSelections();var c=d[0].data;var b=d[0].data.dataURI;c.archived=true;Ext.Ajax.request({url:TDS.env.dataPath+b,jsonData:c,method:"PUT",scope:this,callback:function(g,a,f){e.submitQuery(true)}})}}," ",{xtype:"redbutton",text:"Send to Ozforex",handler:function(){;var b="/GraphicsImg/bankPay/";var a=this.ownerCt.items.itemAt(1).getValue();Ext.Ajax.request({url:TDS.env.dataPath+"pnr/sendtoOzforex",jsonData:{currentDomain:TDS.env.currentDomain,dateFor:new Date()},method:"PUT",scope:this,callback:function(f,d,e){if(e.responseText!=""){b=b+e.responseText+".xls";var c=window.open(b,"Information Priview","height=500,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes");c.focus()}else{Ext.Msg.alert("Information","No Approval's for the day..")}}})}}],id:"bpay-grid",store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","BPAYDate","PNRCode","dateStart","agencyId","agencyName","approved","netPayAmount","primaryPassngerName","sent","supplierId","supplierName","transactionMethodString","sentDate","currency","consultantName","archived","recivedAmount","numericCode"]}),updateBpayInfo:function(a){Ext.Ajax.request({url:TDS.env.dataPath+a.dataURI,jsonData:a,method:"PUT",scope:this})},summaryCurrency:undefined,processCollectionData:function(c){var b=c[this.getCollectionIdentifier()];if(typeof b!="undefined"){for(var a=0;a<b.length;a++){var d=c[b[a]].currency;if(typeof this.summaryCurrency=="undefined"){this.summaryCurrency=d}if(this.summaryCurrency!=d){this.summaryCurrency=false}}}return c},sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel(),{header:"Date",dataIndex:"BPAYDate",width:70,fixed:true,sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateFormatDisplay)},{header:"Agent",dataIndex:"agencyName",sortable:true},{header:"Agent ID",dataIndex:"agencyId",sortable:true,width:60,fixed:true},{header:"PNR No",dataIndex:"PNRCode",sortable:true,width:90},{header:"Alt PNR No",dataIndex:"numericCode",sortable:true,width:90},{header:"Consultant",dataIndex:"consultantName",sortable:true,width:90},{header:"Lead Pax",dataIndex:"primaryPassngerName",sortable:true,width:90},{header:"Supplier",dataIndex:"supplierName",width:90,sortable:true},{header:"Supplier ID",dataIndex:"supplierId",sortable:true,width:65,fixed:true},{header:"Pay Net Amount",dataIndex:"netPayAmount",width:90,summaryType:"sum",sortable:true,renderer:TDS.util.Price.amountRenderer},{header:"Method",dataIndex:"transactionMethodString",width:50,fixed:true,sortable:true},{header:"Recived",dataIndex:"recivedAmount",width:120,fixed:true,summaryType:"sum",sortable:true,renderer:function(d,e,b){var c=b.data.PNRCode;if(typeof d=="undefined"){d=0}var f=0;if(typeof d!="undefined"){f=d}var a=0;if(typeof b.data.netPayAmount!="undefined"){a=b.data.netPayAmount}var g="";if(a==f||b.data.sent){g="readOnly"}if(typeof d=="undefined"||d==null||d==""){d=0}if(typeof c!="undefined"&&c!=null&&c!=""&&c!=0){return TDS.util.Price.formatCurrency(b.data.currency)+' <input type="text" '+g+' size="8" value="'+parseFloat(d).toFixed(2)+"\" onKeyup=\"var g = Ext.getCmp('bpay-grid'); var s = g.store;for(var t =0;t<s.data.length;t++){ if(s.data.items[t].id == '"+b.id+"'){   var www = document.getElementById('"+b.id+"Approve'); s.data.items[t].data.recivedAmount =parseFloat(this.value);   if(s.data.items[t].data.netPayAmount!=this.value){s.data.items[t].data.approved=false;s.data.items[t].data.sent=false;   www.checked = false;www.disabled  = true;}else{ www.disabled  = false;}g.updateBpayInfo(s.data.items[t].data);}}\">"}else{return TDS.util.Price.formatCurrency(b.data.currency)+" "+parseFloat(d).toFixed(2)}}},{header:"Approve",dataIndex:"approved",width:65,sortable:true,fixed:true,renderer:function(d,e,b){var g=0;if(typeof b.get("recivedAmount")!="undefined"){g=b.get("recivedAmount")}var a=0;if(typeof b.get("netPayAmount")!="undefined"){a=b.get("netPayAmount")}var c="";var f="var g = Ext.getCmp('bpay-grid'); var s = g.store;for(var t =0;t<s.data.length;t++){ if(s.data.items[t].id == '"+b.id+"'){  s.data.items[t].data.approved =(this.value=='on')?true:false; g.updateBpayInfo(s.data.items[t].data);}}";if(d){c="checked=checked ";f="return false;"}if(a!=g){c="disabled=true"}return'<center><input type="checkbox" '+c+' id="'+b.id+'Approve" onclick="'+f+'"></center>'}},{header:"Send",dataIndex:"sent",width:40,sortable:true,fixed:true,renderer:function(c,d,a){var b="";if(c){b="checked"}return'<center><input type="checkbox" onclick="return false" '+b+" ></center>"}},{header:"Sent",dataIndex:"sentDate",width:90,sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Status",dataIndex:"archived",width:90,sortable:true,renderer:function(b,c,a){if(b){return"Cancelled"}else{return""}}}]),plugins:new Ext.ux.grid.GridSummary({processSummaryData:function(c){var a=this;if(typeof this.grid!="undefined"&&this.grid.summaryCurrency){c.data.currency=this.grid.summaryCurrency;return c}return{data:{}}}}),viewConfig:{forceFit:true},listeners:{sessioninit:function(){var b=this.ownerCt.findParentByType("panel");var a=b.initialConfig.dataURI;this.searchURI=TDS.env.dataPath+"pnr/bpay"}}}}