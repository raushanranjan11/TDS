{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 8px;",autoScroll:true,listeners:{render:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]})}else{if(TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/currentUser/collection/concise",identifier:"currentUserCreatedsuppliers",fields:["name","dataURI"]})}}}},items:{xtype:"awesomegrid",searchURI:"",pinnable:true,enableRowExpander:false,iconCls:"icon-grid",getDataURI:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")||TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){var c=this.getTopToolbar();var a=c.items.itemAt(1);var b=a.getValue();if(!b){return false}return a.getValue()}else{if(TDS.env.user.hasGroupPermission("INVENTORY_MANAGEMENT_RAIL")){return TDS.env.user.getSupplierURI()}}},tbar:[{xtype:"tbspecialtext",text:"Supplier: ",hidden:true},{xtype:"combo",hidden:true,name:"supplierURI",mode:"local",width:180,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:new Ext.data.Store(),appendData:[{name:"All",dataURI:""}],toggleButtons:function(){var a=this.ownerCt.items.itemAt(3);var b=this.ownerCt.items.itemAt(5);if(!this.getValue()){a.disable();b.disable()}else{a.enable();b.enable()}},listeners:{select:function(){this.toggleButtons()}}},"Service:",{xtype:"textfield",name:"nameLike",enableKeyEvents:true,width:120}," ","From: ",{xtype:"combo",name:"countryFromCode",emptyText:"Type a country...",excludeSubmit:true,excludeFromSession:true,minChars:1,enableKeyEvents:true,mode:"local",width:120,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]})}," ",{xtype:"clearablecombo",name:"locationFromURI",excludeFromSession:true,minChars:3,store:new Ext.data.CollectionStore({url:"",fields:["dataURI","name","provinceName"]}),tpl:'<tpl for="."><div class="x-combo-list-item">{name}, <span style="font-style: italic; font-size: 10px; color: #999;">{provinceName}</span></div></tpl>',displayField:"name",valueField:"dataURI",queryParam:"nameLike",queryDelay:500,emptyText:"Type a city name...",enableKeyEvents:true,width:120,hideTrigger:true,getSelectedRecord:function(){return this.selectedRecord||-1},listeners:{beforequery:function(qe){var tb=this.ownerCt;var countryFromField=tb.items.itemAt(6);var countryCode=countryFromField.getValue();if(countryCode==""){countryFromField.markInvalid("Please select a country.");return false}var store=this.getStore();with(store){proxy.conn.url=TDS.env.dataPath+"country/"+countryCode+"/locations/collection";reader.meta.identifier="country/"+countryCode+"/locations?"+this.queryParam+"="+qe.query;proxy.conn.method="GET"}}}}," ",{xtype:"button",icon:"images/arrow-black.gif",cls:"x-btn-icon",tooltip:"Click here to swap the departure and arrival locations",handler:function(){var c=this.ownerCt;var h=c.items.itemAt(6);var a=c.items.itemAt(8);var d=c.items.itemAt(13);var f=c.items.itemAt(15);var i=h.getValue();var b=a.getValue();var e=d.getValue();var g=f.getValue();h.setValue(e);a.setValue(g);d.setValue(i);f.setValue(b)}}," ","To:",{xtype:"combo",name:"countryToCode",emptyText:"Type a country...",excludeSubmit:true,excludeFromSession:true,minChars:1,enableKeyEvents:true,mode:"local",width:120,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]})}," ",{xtype:"clearablecombo",name:"locationToURI",excludeFromSession:true,minChars:3,store:new Ext.data.CollectionStore({url:"",fields:["dataURI","name","provinceName"]}),tpl:'<tpl for="."><div class="x-combo-list-item">{name}, <span style="font-style: italic; font-size: 10px; color: #999;">{provinceName}</span></div></tpl>',displayField:"name",valueField:"dataURI",queryParam:"nameLike",queryDelay:500,emptyText:"Type a city name...",enableKeyEvents:true,width:130,hideTrigger:true,getSelectedRecord:function(){return this.selectedRecord||-1},listeners:{beforequery:function(qe){var tb=this.ownerCt;var countryToField=tb.items.itemAt(13);var countryCode=countryToField.getValue();if(countryCode==""){countryToField.markInvalid("Please select a country.");return false}var store=this.getStore();with(store){proxy.conn.url=TDS.env.dataPath+"country/"+countryCode+"/locations/collection";reader.meta.identifier="country/"+countryCode+"/locations?"+this.queryParam+"="+qe.query;proxy.conn.method="GET"}}}},"&nbsp;&nbsp;",{xtype:"checkbox",boxLabel:"Show only Archived",name:"showUnArchivedOnly",excludeFromSession:true,handler:function(){var a=this.ownerCt.ownerCt.topToolbar;a.items.itemAt(25).disable(true);a.items.itemAt(19).disable(true);if(this.checked){a.items.itemAt(25).setText("Restore")}else{a.items.itemAt(25).setText("Archive")}}},"  ",{xtype:"button",name:"delete",text:"Delete",disabled:true,handler:function(){var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");var e=this.getText();if(!a){return}Ext.Msg.show({title:"Alert",msg:"Are you sure you want to "+e,buttons:Ext.Msg.YESNO,fn:b,animEl:"elId",icon:Ext.MessageBox.QUESTION});function b(g,f,h){if(g=="yes"){Ext.Ajax.request({url:TDS.env.dataPath+a,method:"DELETE",callback:function(){d.submitQuery(true)},scope:this,disableCaching:true})}}}},"->",{xtype:"redbutton",text:"Create",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getDataURI();if(!a){return}TDS.window.setWindow({title:"Rail details",information:"Please enter details of a new rail.",interfaceURI:"rail/offering/create.js",postDataURI:a+"/railOfferings",requiredData:[{id:"supplier",dataURI:a}],callback:{fn:function(c){if(c){b.submitQuery(true)}},scope:b}})}}," ",{xtype:"button",text:"Copy",handler:function(){var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");var b=c.get("supplierURI");if(!a&&!b){return}TDS.window.setWindow({title:"Copy rail offering",information:"This interface will create a new rail offering with the following details, you may edit these details before you submit.",interfaceURI:"rail/offering/create.js",sourceDataURI:a,postDataURI:b+"/railOfferings",buttonOK:"Submit",requiredData:[{id:"supplier",dataURI:b}],callback:{fn:function(e){if(e){d.submitQuery(true)}},scope:d}})}}," ",{text:"Archive",handler:function(){var e=this.buttonContainer.ownerCt;var d=e.selModel.getSelected();if(!d){return}var c=d.get("dataURI");if(!c){return}var b=this.buttonContainer.items.itemAt(17).getValue();var f=this.getText();TDS.window.setWindow({title:"Archive rail offering",message:"Are you sure you want to archive this rail offering?",destinationDataURI:c,data:{archived:!b},callback:{fn:function(a){if(a){e.submitQuery(true)}},scope:e}})}}],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["published","pinned","dataURI","supplierURI","name","codeSupplier","homeCurrency","rackRatePriceSell","locationFromString","locationToString","stopOversString","departureTime","arrivalTime","duration","stopOvers","createdDate","updatedDate","pricingPriceIsNett"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Published",width:40,dataIndex:"published",renderer:function(c,b,a){if(a.get("published")){return'<input type="password" name="" style="border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none; div {text-align: lert; }; color:#ff0000" disabled value = "a">'}else{return""}}},{header:"Supplier",dataIndex:"supplierURI",hidden:true,renderer:TDS.util.Format.displayResourceConciseNameRenderer()},{header:"Service",dataIndex:"name",sortable:true},{header:"Service No.",dataIndex:"codeSupplier",sortable:true},{header:"From",dataIndex:"locationFromString",sortable:true},{header:"To",dataIndex:"locationToString",sortable:true},{header:"Departs",dataIndex:"departureTime",sortable:true},{header:"Arrives",dataIndex:"arrivalTime",sortable:true},{header:"Trip time",dataIndex:"duration",sortable:true},{header:"Stops",dataIndex:"stopOvers",sortable:true},{header:"Advertised rate",dataIndex:"rackRatePriceSell",width:120,fixed:true,sortable:true,renderer:function(c,b,a){return TDS.util.Price.formatPrice(c,a.data.homeCurrency)+" ("+(a.data.pricingPriceIsNett?"Nett":"Gross")+")"}},{header:"Published",dataIndex:"createdDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Last modified",dataIndex:"updatedDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)}]),viewConfig:{forceFit:true},listeners:{beforerender:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){var b=this.getTopToolbar();b[0].hidden=false;b[1].hidden=false;b[1].store=TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]});b[2].hidden=false;var a=this.getColumnModel();a.setHidden(0,false)}else{if(!TDS.env.user.hasGroupPermission("ADMINISTRATION")&&TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){var b=this.getTopToolbar();b[0].hidden=false;b[1].hidden=false;b[1].store=TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/currentUser/collection/concise",identifier:"currentUserCreatedsuppliers",fields:["name","dataURI"]});b[2].hidden=false;var a=this.getColumnModel();a.setHidden(0,false)}}},sessioninit:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")||TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){this.searchURI=TDS.env.dataPath+"rail/offerings"}else{if(TDS.env.user.hasGroupPermission("INVENTORY_MANAGEMENT_RAIL")){this.searchURI=TDS.env.dataPath+TDS.env.user.getSupplierURI()+"/railOfferings"}}},rowdblclick:function(d,h,f){var c=d.getStore().getAt(h);if(!c){return}var a=c.get("dataURI");var b=c.get("name");TDS.workArea.openTab(b,"rail/offering/view.js",a,TDS.env.sessionPath+a)},render:function(){this.getSelectionModel().on("rowselect",function(){var a=this.items.itemAt(17).checked;if(!a){this.items.itemAt(19).setDisabled(true)}else{this.items.itemAt(19).setDisabled(false)}this.items.itemAt(25).setDisabled(false)},this.getTopToolbar());this.getSelectionModel().on("rowdeselect",function(){this.items.itemAt(25).setDisabled(true)},this.getTopToolbar())}}}}