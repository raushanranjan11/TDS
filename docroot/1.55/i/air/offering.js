{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 8px;",autoScroll:true,listeners:{render:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]})}else{if(TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/currentUser/collection/concise",identifier:"currentUserCreatedsuppliers",fields:["name","dataURI"]})}}}},items:{xtype:"awesomegrid",searchURI:"",pinnable:true,enableRowExpander:false,iconCls:"icon-grid",getDataURI:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")||TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){var c=this.getTopToolbar();var a=c.items.itemAt(1);var b=a.getValue();if(!b){return false}return a.getValue()}else{if(TDS.env.user.hasGroupPermission("INVENTORY_MANAGEMENT_FLIGHT")){return TDS.env.user.getSupplierURI()}}},tbar:[{xtype:"tbspecialtext",text:"Supplier: ",hidden:true},{xtype:"combo",hidden:true,name:"supplierURI",mode:"local",width:200,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:new Ext.data.Store(),appendData:[{name:"All",dataURI:""}],toggleButtons:function(){var a=this.ownerCt.items.itemAt(3);var b=this.ownerCt.items.itemAt(5);if(!this.getValue()){a.disable();b.disable()}else{a.enable();b.enable()}},listeners:{select:function(){this.toggleButtons()}}},"Flight No:",{xtype:"textfield",name:"nameLike",enableKeyEvents:true,width:120}," ","From: ",{xtype:"airportcombo",name:"airportFromURI",excludeFromSession:true,enableKeyEvents:true,hideTrigger:false,width:200}," ",{xtype:"button",icon:"images/arrow-black.gif",cls:"x-btn-icon",tooltip:"Click here to swap the departure and arrival airports",handler:function(){var a=this.ownerCt;var e=a.items.itemAt(6);var d=a.items.itemAt(11);var c=e.getValue();var b=d.getValue();e.setValue(b);d.setValue(c)}}," ","To:",{xtype:"airportcombo",name:"airportToURI",excludeFromSession:true,enableKeyEvents:true,hideTrigger:false,width:200},"&nbsp;&nbsp;",{xtype:"checkbox",boxLabel:"Show only Archived",name:"showUnArchivedOnly",excludeFromSession:true,handler:function(){var a=this.ownerCt.ownerCt.topToolbar;a.items.itemAt(21).disable(true);a.items.itemAt(15).disable(true);if(this.checked){a.items.itemAt(21).setText("Restore")}else{a.items.itemAt(21).setText("Archive")}}},"  ",{xtype:"button",name:"delete",text:"Delete",disabled:true,handler:function(){var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");var e=this.getText();if(!a){return}Ext.Msg.show({title:"Alert",msg:"Are you sure you want to "+e,buttons:Ext.Msg.YESNO,fn:b,animEl:"elId",icon:Ext.MessageBox.QUESTION});function b(g,f,h){if(g=="yes"){Ext.Ajax.request({url:TDS.env.dataPath+a,method:"DELETE",callback:function(){d.submitQuery(true)},scope:this,disableCaching:true})}}}},"->",{xtype:"redbutton",text:"Create",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getDataURI();if(!a){return}TDS.window.setWindow({title:"Flight details",information:"Please enter details of a new flight.",interfaceURI:"air/offering/create.js",postDataURI:a+"/airOfferings",requiredData:[{id:"supplier",dataURI:a}],callback:{fn:function(c){if(c){b.submitQuery(true)}},scope:b}})}}," ",{xtype:"button",text:"Copy",handler:function(){var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");var b=c.get("supplierURI");if(!a&&!b){return}TDS.window.setWindow({title:"Copy flight offering",information:"This interface will create a new flight offering with the following details, you may edit these details before you submit.",interfaceURI:"air/offering/create.js",sourceDataURI:a,postDataURI:b+"/airOfferings",buttonOK:"Submit",requiredData:[{id:"supplier",dataURI:b}],callback:{fn:function(e){if(e){d.submitQuery(true)}},scope:d}})}}," ",{text:"Archive",handler:function(){var e=this.buttonContainer.ownerCt;var d=e.selModel.getSelected();if(!d){return}var c=d.get("dataURI");if(!c){return}var b=this.buttonContainer.items.itemAt(13).getValue();var f=this.getText();TDS.window.setWindow({title:"Archive flight offering",message:"Are you sure you want to archive this flight offering?",destinationDataURI:c,data:{archived:!b},callback:{fn:function(a){if(a){e.submitQuery(true)}},scope:e}})}}],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["published","pinned","dataURI","supplierURI","name","homeCurrency","rackRatePriceSell","airportFromString","airportToString","stopOversString","departureTime","arrivalTime","duration","stopOvers","direct","aircraft","createdDate","updatedDate","departureDate","airSupplierName"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Published",width:40,dataIndex:"published",renderer:function(c,b,a){if(a.get("published")){return'<input type="password" name="" style="border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none; div {text-align: lert; }; color:#ff0000" disabled value = "a">'}else{return""}}},{header:"Supplier",id:"supl",dataIndex:"supplierURI",hidden:true,renderer:TDS.util.Format.displayResourceConciseNameRenderer()},{header:"Airline",width:200,dataIndex:"",sortable:true,renderer:function(c,b,a){if(a.json.remoteSource=="Travelport"){return a.json.airSupplierName}else{return""}}},{header:"Flight No.",dataIndex:"name",sortable:true},{header:"From",dataIndex:"airportFromString",sortable:true},{header:"To",dataIndex:"airportToString",sortable:true},{header:"Departure Date",dataIndex:"departureDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateFormatDisplay)},{header:"Departs",dataIndex:"departureTime",sortable:true},{header:"Arrives",dataIndex:"arrivalTime",sortable:true},{header:"Flight time",dataIndex:"duration",sortable:true},{header:"Stops",dataIndex:"stopOvers",sortable:true},{header:"Aircraft",dataIndex:"aircraft",sortable:true},{header:"Published",dataIndex:"createdDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Last modified",dataIndex:"updatedDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)}]),viewConfig:{forceFit:true},listeners:{beforerender:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){var b=this.getTopToolbar();b[0].hidden=false;b[1].hidden=false;b[1].store=TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]});b[2].hidden=false;var a=this.getColumnModel();a.setHidden(0,false)}else{if(!TDS.env.user.hasGroupPermission("ADMINISTRATION")&&TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){var b=this.getTopToolbar();b[0].hidden=false;b[1].hidden=false;b[1].store=TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/currentUser/collection/concise",identifier:"currentUserCreatedsuppliers",fields:["name","dataURI"]});b[2].hidden=false;var a=this.getColumnModel();a.setHidden(0,false)}}},sessioninit:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")||TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){this.searchURI=TDS.env.dataPath+"air/offerings"}else{if(TDS.env.user.hasGroupPermission("INVENTORY_MANAGEMENT_FLIGHT")){this.searchURI=TDS.env.dataPath+TDS.env.user.getSupplierURI()+"/airOfferings"}}},rowdblclick:function(d,h,f){var c=d.getStore().getAt(h);if(!c){return}var a=c.get("dataURI");var b=c.get("name");TDS.workArea.openTab(b,"air/offering/view.js",a,TDS.env.sessionPath+a)},render:function(){this.getSelectionModel().on("rowselect",function(){console.log(this.items);var a=this.items.itemAt(13).checked;if(!a){this.items.itemAt(15).setDisabled(true)}else{this.items.itemAt(15).setDisabled(false)}this.items.itemAt(21).setDisabled(false)},this.getTopToolbar());this.getSelectionModel().on("rowdeselect",function(){this.items.itemAt(21).setDisabled(true)},this.getTopToolbar())}}}}