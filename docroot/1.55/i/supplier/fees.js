{xtype:"panel",layout:Ext.isIE?"fit":"fit",autoScroll:true,bodyStyle:"padding: 8px;",border:false,updateFee:function(e){var j=this.ownerCt.findParentByType("stdpanel");var c={};c.feeIds=[];c.paidStatus=e;var g=this.items.itemAt(0);var h=g.getSelections();for(var f=0;f<h.length;f++){var d=h[f].data.dataURI;var b=d.substring(d.lastIndexOf("/")+1);c.feeIds[f]=b}Ext.Ajax.request({url:TDS.env.dataPath+j.getDataURI()+"/fees/update",method:"POST",jsonData:c,callback:function(a){if(a){g.submitQuery(true)}},scope:this})},items:{xtype:"awesomegrid",alwaysUseCollection:true,enableRowExpander:true,bbar:[" ","->","Paid amount: ",{xtype:"label",listeners:{render:function(){}}}," ","Balance amount: ",{xtype:"label",listeners:{render:function(){}}}],tbar:["Date from: ",{xtype:"datefield",name:"dateStart",enableKeyEvents:true,showToday:false,width:80,format:"dMy",maxValue:new Date()}," ","Date to: ",{xtype:"datefield",name:"dateEnd",enableKeyEvents:true,showToday:false,width:80,format:"dMy"}," ","Payment status: ",{xtype:"combo",name:"paidStatus",forceSubmit:true,mode:"local",width:100,fieldLabel:"paidStatus",triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:new Ext.data.SimpleStore({fields:["dataURI","name"],data:[["","All"],["1","Paid"],["0","Un Paid"]]}),style:"margin-left: 5px;"},"->",{xtype:"button",text:"Mark as Paid",disabled:true,handler:function(){this.ownerCt.ownerCt.ownerCt.updateFee(true)}},{xtype:"button",text:"Mark as Un Paid",disabled:true,handler:function(){this.ownerCt.ownerCt.ownerCt.updateFee(false)}},{xtype:"button",text:"Export",handler:function(){var c=this.ownerCt.findParentByType("stdpanel");var d=this.ownerCt.items.itemAt(1);var b=this.ownerCt.items.itemAt(4);if(!d.getValue()&&!b.getValue()){return}var a=TDS.env.dataPath+c.getDataURI()+"/fees/collection.csv?";a+="dateStart="+d.getValue().format(TDS.env.dateFormat)+"&dateEnd="+b.getValue().format(TDS.env.dateFormat);externalLink(a,"arenaExportLink")}}],store:new Ext.data.JsonStore({id:"dataURI",fields:["dataURI","passengerNameRecordCodeString","passengerNameRecordComponentCount","amountAud","amountUsd","createdDate","primaryPassengerName","paidStatus"]}),sm:new Ext.grid.CheckboxSelectionModel(),cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel(),{header:"Date",dataIndex:"createdDate",sortable:true,width:140,fixed:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"PNR",dataIndex:"passengerNameRecordCodeString",renderer:function(c,b,a){var d="{0} ({1} components)";d=String.format(d,c,a.get("passengerNameRecordComponentCount"));return d}},{header:"Name",width:350,dataIndex:"primaryPassengerName",sortable:true,fixed:true},{header:"No. of Passengers",dataIndex:"passengerNameRecordComponentCount",sortable:true,width:200,fixed:true},{header:"Amount",dataIndex:"amountAud",width:120,fixed:true,renderer:function(c,b,a){if(c){return TDS.util.Price.formatPrice(c,"USD")}return TDS.util.Price.formatPrice(a.get("amountUsd"),"USD")}},{header:"Payment Status",width:150,dataIndex:"paidStauts",sortable:true,fixed:true,renderer:function(c,b,a){if(a.json.paidStatus){return"Paid"}else{return"Un Paid"}}}]),viewConfig:{forceFit:true},getRowInterface:function(){return"supplier/fees/layout.js"},listeners:{sessioninit:function(){var a=this.ownerCt.findParentByType("stdpanel");if(!a.getDataURI()){return}this.searchURI=TDS.env.dataPath+a.getDataURI()+"/fees"},render:function(){var c=this.bottomToolbar;var b=c.items.itemAt(6);var a=c.items.itemAt(3);this.getStore().on("load",function(f,e){var d=0;var h=0;for(var g=0;g<e.length;g++){if(e[g].json.paidStatus){h+=e[g].data.amountUsd}else{d+=e[g].data.amountUsd}}b.setText("US$ "+(d.toFixed(2)));a.setText("US$ "+(h.toFixed(2)))});this.getSelectionModel().on("rowselect",function(){var e=this.ownerCt;var d=e.getSelections();if(d.length<=0){this.items.itemAt(9).setDisabled(true);this.items.itemAt(10).setDisabled(true)}else{this.items.itemAt(9).setDisabled(false);this.items.itemAt(10).setDisabled(false)}},this.getTopToolbar());this.getSelectionModel().on("rowdeselect",function(){var e=this.ownerCt;var d=e.getSelections();if(d.length<=0){this.items.itemAt(9).setDisabled(true);this.items.itemAt(10).setDisabled(true)}else{this.items.itemAt(9).setDisabled(false);this.items.itemAt(10).setDisabled(false)}},this.getTopToolbar())}}}}