{xtype:"form",border:false,autoScroll:true,bodyStyle:"padding: 4px;",id:"form",getDataURI:function(){return this.ownerCt.ownerCt.getDataURI()},getSessionURI:function(){return this.ownerCt.ownerCt.getSessionURI()},getSessionValue:function(a){return this.ownerCt.ownerCt.getSession(a)},reloadData:function(){var a=this.ownerCt.findParentByType("stdpanel");a.getAjaxPanel().reloadData({callback:function(b,c,d){this.getForm().setValues(d)},scope:this});this.getForm().setValues(a.getAjaxPanel().getData())},getHomeCurrency:function(){var a=this.ownerCt.findParentByType("stdpanel");return a.getAjaxPanel().getData("homeCurrency")},listeners:{render:function(){var a=this.ownerCt.findParentByType("stdpanel");this.getForm().setValues(a.getAjaxPanel().getData())}},items:[{xtype:"panel",border:false,hideBorders:true,layout:"column",height:340,items:[{columnWidth:0.6,layout:"fit",bodyStyle:"padding-right: 6px;",items:{xtype:"fieldset",title:"Details",collapsible:true,cls:"x-tds-offering",layout:"table",border:false,hideBorders:true,layoutConfig:{columns:4},autoHeight:true,defaults:{border:false,height:24,hideBorders:true,isFormField:true,getName:function(){return this.name},setValue:function(c){if(this.renderer&&typeof this.renderer=="function"){c=this.renderer(c)}else{if(this.name.substring(this.name.length-3)=="URI"){var d=TDS.data.getStoreNameByResourceDataURI(c);var a=TDS.data.findRecordBy(d,"dataURI",c);if(a!=-1){c=a.get("name")}}}var b=this.allowHTML?false:true;this.setText(c,b)},getValue:Ext.emptyFn},bbar:[{xtype:"redbutton",text:"Edit",handler:function(){var b=this.ownerCt.findParentByType("form");var a=b.getDataURI();if(!a){return}TDS.window.setWindow({title:"Edit supplier",interfaceURI:"supplier/edit.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",callback:{fn:function(c){if(c){this.reloadData()}},scope:b}})}},{xtype:"button",text:"Default Terms & Conditions",handler:function(){var b=this.ownerCt.findParentByType("form");var a=b.getDataURI();if(!a){return}var e=this.ownerCt.findParentByType("stdpanel");var f=e.getAjaxPanel().getData();var g=f.suplierOwnTC;if(g){TDS.window.setWindow({title:"Edit default terms and conditions",interfaceURI:"supplier/terms.js",sourceDataURI:a+"/supplier",destinationDataURI:a+"/supplier",helpTitel:"Default Terms & Conditions Help",helpId:"8",buttonOK:"Submit"})}else{TDS.window.setWindow({title:"Default terms and conditions",interfaceURI:"supplier/adminDefaultTermsAndCondition.js",sourceDataURI:"supplier/defaultTC",buttonOK:false})}}},{xtype:"button",text:"About us",handler:function(){var b=this.ownerCt.findParentByType("form");var a=b.getDataURI();if(!a){return}TDS.window.setWindow({title:"Edit About us",interfaceURI:"supplier/aboutUs.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",helpTitel:"About us Help",helpId:"13"})}}],items:[{html:"Name:",width:115},{xtype:"label",name:"name",width:260,fieldLabel:"Name"},{html:"Abbreviated Name for System:",width:155},{xtype:"label",name:"additionalInfoAbbreviatedName",width:260,fieldLabel:"Abbreviated Name for System"},{html:"ARENA code:",width:115},{xtype:"label",name:"supplierArenaCode",width:260,fieldLabel:"ARENA code"},{html:"CEO/General Manager:",width:155},{xtype:"label",name:"additionalInfoCeoGeneralManager",width:260,fieldLabel:"CEO/General Manager"},{html:"Home currency:",width:115},{xtype:"label",name:"homeCurrency",width:260,fieldLabel:"Home currency",renderer:function(b){var a=TDS.data.currencies.getById(b);if(typeof a!="undefined"){return a.get("text")}return b}},{html:"Email:",width:155},{xtype:"label",name:"additionalInfoCeoGeneralManagerEmail",width:260,fieldLabel:"Email"},{html:"Address:",width:115},{xtype:"label",name:"addressString",width:260,fieldLabel:"Address",autoWidth:true},{html:"Finance Manager/CFO:",width:155},{xtype:"label",name:"additionalInfoFinanceManagerCfo",width:260,fieldLabel:"Finance Manager/CFO"},{html:"Email:",width:115},{xtype:"label",name:"email",width:260,fieldLabel:"Email"},{html:"Email:",width:155},{xtype:"label",name:"additionalInfoFinanceManagerCfoEmail",width:260,fieldLabel:"Email"},{html:"Phone number:",width:115},{xtype:"label",name:"phoneNumber",width:260,fieldLabel:"Phone number"},{html:"Reservation Manager:",width:155},{xtype:"label",name:"additionalInfoReservationManager",width:260,fieldLabel:"Reservation Manager"},{html:"Fax:",width:115},{xtype:"label",name:"fax",width:260,fieldLabel:"Fax"},{html:"Email:",width:155},{xtype:"label",name:"additionalInfoReservationManagerEmail",width:260,fieldLabel:"Email"},{html:"Available on mobile:",width:115},{xtype:"label",name:"onMobile",width:260,fieldLabel:"Available on mobile",renderer:TDS.util.Format.booleanRenderer},{html:"",width:155},{html:'<table width="260" border="0"><tr><td></td></tr></table>',name:"",width:160,fieldLabel:""},{html:"Website address:",width:115},{xtype:"label",name:"websiteURL",width:260,fieldLabel:"Website address"},{html:"",width:155},{html:'<table width="260" border="0"><tr><td></td></tr></table>',name:"",width:160,fieldLabel:""},{html:"Permitted components:",width:115},{xtype:"label",name:"permittedComponentString",width:260,fieldLabel:"Permitted components"},{html:"",width:155},{html:'<table width="260" border="0"><tr><td></td></tr></table>',name:"",width:160,fieldLabel:""},{html:"Related Countries:",width:115},{xtype:"label",name:"countriesURIswithName",width:260,fieldLabel:"Permitted countries"}]}},{columnWidth:0.4,layout:"fit",bodyStyle:"padding-right: 6px;",items:{xtype:"fieldset",title:"Bank Deposit Details",collapsible:true,cls:"x-tds-offering",autoHeight:true,bodyStyle:"padding:6px;",labelWidth:120,defaults:{isFormField:true,getName:function(){return this.name},setValue:function(c){if(this.renderer&&typeof this.renderer=="function"){c=this.renderer(c)}else{if(this.name.substring(this.name.length-3)=="URI"){var d=TDS.data.getStoreNameByResourceDataURI(c);var a=TDS.data.findRecordBy(d,"dataURI",c);if(a!=-1){c=a.get("name")}}}var b=this.allowHTML?false:true;this.setText(c,b)},getValue:Ext.emptyFn},getCreditCards:function(){var c=this.items.itemAt(9);var d=this.ownerCt.findParentByType("form");var b=d.getDataURI();if(!b){return}Ext.Ajax.request({url:TDS.env.dataPath+b+"/creditCards/collection",method:"GET",callback:function(j,f,g){if(f){var a=b+"/creditCards";var i=Ext.decode(g.responseText);var h=i[a];if(!h){return}var e=TDS.util.collectionToEnglishSentenceList({collection:h,data:i,fieldName:"displayName"});if(e){c.setText(e)}}},scope:c})},bbar:[{xtype:"redbutton",text:"Edit",handler:function(){var c=this.ownerCt.findParentByType("form");var a=this.ownerCt.findParentByType("fieldset");var b=c.getDataURI();TDS.data.supplierURI=b;if(!b){return}TDS.window.setWindow({title:"Edit financials",interfaceURI:"supplier/financial.js",sourceDataURI:b,destinationDataURI:b,buttonOK:"Submit",helpTitel:"Bank details Help",helpId:"9",callback:{fn:function(d){if(d){this.reloadData();a.getCreditCards()}},scope:c}})}}],items:[{xtype:"label",name:"financialContactName",fieldLabel:"Contact name"},{xtype:"label",name:"financialContactPhoneNumber",fieldLabel:"Contact phone number"},{xtype:"label",name:"financialInstitution",fieldLabel:"Bank name"},{xtype:"label",name:"financialAccountName",fieldLabel:"Account name"},{xtype:"label",name:"financialAccountBSB",fieldLabel:"BSB/Bank Code",width:80},{xtype:"label",name:"financialAccountIBAN",fieldLabel:"IBAN Code",width:80},{xtype:"label",name:"financialAccountNumber",fieldLabel:"Account number",width:200},{xtype:"label",name:"financialSwiftCode",fieldLabel:"SWIFT code",width:200},{xtype:"label",name:"financialCountryURI",fieldLabel:"Country",renderer:TDS.util.Format.displayResourceNameRenderer(),width:200},{xtype:"label",name:"creditCardPaymentAllowed",fieldLabel:"Credit Cards Accepted",renderer:TDS.util.Format.booleanRenderer,width:200},{xtype:"label",border:true,fieldLabel:"Credit Card Type",width:200,listeners:{render:function(){this.ownerCt.getCreditCards()}}},{xtype:"label",name:"paymentGatewayAllowed",fieldLabel:"Payment Gateway Available",renderer:TDS.util.Format.booleanRenderer,width:200},{xtype:"label",name:"financialBitcoinAddress",fieldLabel:"BITCOIN Address",width:200}]}}]},{xtype:"panel",border:false,hideBorders:true,layout:"column",height:285,items:[{columnWidth:0.6,layout:"fit",bodyStyle:"padding-right: 6px;",items:{xtype:"fieldset",title:"Staff",border:false,collapsible:true,height:255,autoScroll:true,items:{xtype:"awesomegrid",searchURI:"",pinnable:true,enableRowExpander:false,tbar:["Name: ",{xtype:"textfield",name:"nameLike",enableKeyEvents:true,width:120}," ","Email: ",{xtype:"textfield",name:"emailLike",enableKeyEvents:true,width:120},{xtype:"tbfill"},{xtype:"redbutton",text:"Create",handler:function(){var b=this.ownerCt.ownerCt;var a=this.ownerCt.findParentByType("form");TDS.window.setWindow({title:"Supplier user",information:"Please enter details of a new supplier user.",interfaceURI:"supplier/user/create.js",postDataURI:a.getDataURI()+"/users",helpTitel:"Add staff Help",helpId:"10",callback:{fn:function(c){if(c){b.submitQuery(true)}},scope:b}})}}," ",{xtype:"button",text:"Copy",hidden:true,handler:function(){var d=this.ownerCt.ownerCt;var b=this.ownerCt.findParentByType("form");var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");TDS.window.setWindow({title:"Copy supplier user",information:"This interface will create a new supplier user with the following details, you may edit these details before you submit.",interfaceURI:"supplier/user/create.js",sourceDataURI:a,postDataURI:b.getDataURI()+"/users",data:{email:""},buttonOK:"Submit",callback:{fn:function(e){if(e){d.submitQuery(true)}},scope:d}})}}," ",{xtype:"button",text:"Archive",handler:function(){var c=this.ownerCt.ownerCt;var b=c.selModel.getSelected();if(!b){return}var a=b.get("dataURI");TDS.window.setWindow({title:"Archive supplier user",message:"Are you sure you want to archive this supplier user?",destinationDataURI:a,data:{archived:true},callback:{fn:function(d){if(d){c.submitQuery(true)}},scope:c}})}}],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","pinned","salutation","nameFirst","nameLast","emailAddress"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Title",dataIndex:"salutation",width:60,fixed:true,sortable:true},{header:"Name",dataIndex:"nameFull",sortable:true,renderer:function(c,b,a){return a.get("nameFirst")+" "+a.get("nameLast")}},{header:"Email",dataIndex:"emailAddress",sortable:true}]),viewConfig:{forceFit:true},listeners:{sessioninit:function(){var a=this.ownerCt.findParentByType("form");this.searchURI=TDS.env.dataPath+a.getDataURI()+"/users";this.sessionURI=a.getSessionURI()+"/users"},rowdblclick:function(c,f,d){var b=c.getStore().getAt(f);if(!b){return}var a=b.get("dataURI");TDS.window.setWindow({title:"Edit supplier user",interfaceURI:"supplier/user/edit.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",callback:{fn:function(e){if(e){this.submitQuery(true)}},scope:c}})}}}}},{columnWidth:0.4,layout:"fit",bodyStyle:"padding-right: 6px;",items:{xtype:"fieldset",height:255,title:"Currency Conversion System",border:false,collapsible:true,listeners:{render:function(){var a=this.findParentByType("stdpanel").ownerCt.dataObj.adminMaintainedExcRate;if(!a){this.hide()}}},items:{xtype:"editorgrid",height:240,tbar:[{xtype:"button",text:"Rate Alert",handler:function(){TDS.window.setWindow({title:"Rate Alert",interfaceURI:"widgets/rateAlert.js",buttonOK:false})}}," ",{xtype:"button",text:"Rate Calculator",handler:function(){TDS.window.setWindow({title:"Rate Calcculator",interfaceURI:"widgets/rateCalculator.js",buttonOK:false})}},"-",{xtype:"numberfield",width:60,decimalPrecision:2,setValue:function(a){a=typeof a=="number"?a:String(a).replace(this.decimalSeparator,".");a=isNaN(a)?"":String(a).replace(".",this.decimalSeparator);return Ext.form.NumberField.superclass.setValue.call(this,a)},fixPrecision:function(b){var a=isNaN(b);if(!this.allowDecimals||this.decimalPrecision==-1||a||!b){return a?"":b}return parseFloat(b).toFixed(this.decimalPrecision)},emptyText:"Default %"}," ",{xtype:"button",text:"Adjustment Default",handler:function(){if(this.ownerCt.items.itemAt(4).getValue()!=""&&this.ownerCt.items.itemAt(4).getValue()!=null){this.ownerCt.ownerCt.setDefaultModifer(this.ownerCt.items.itemAt(4).getValue())}}},{xtype:"tbfill"},{xtype:"redbutton",text:"Save",handler:function(){;var h=this.ownerCt.ownerCt;var k=this.ownerCt.findParentByType("form");var n=k.getDataURI()+"/exchangeRates";var c=h.getStore().getModifiedRecords();var d=h.getSelections();var j=[];var m={};if(this.ownerCt.items.itemAt(4).getValue()!=""&&this.ownerCt.items.itemAt(4).getValue()!=null){var a={};a.defaultExcCurrPercentage=this.ownerCt.items.itemAt(4).getValue();Ext.Ajax.request({url:TDS.env.dataPath+k.getDataURI(),method:"PUT",headers:{"Content-Type":"application/json"},callback:function(p,g,i){if(g){k.reloadData()}},jsonData:a,scope:this})}for(var e=0;e<c.length;e++){var f=c[e];var l=f.get("dataURI");var b=f.get("modifierDifference");m[l]={modifier:f.get("modifier"),active:f.get("active"),maxCutOff:f.get("maxCutOff"),minCutOff:f.get("minCutOff"),modified:b};j.push(l)}m[n]=j;Ext.Ajax.request({url:TDS.env.dataPath+k.getDataURI()+"/exchangeRates/collection",method:"PUT",headers:{"Content-Type":"application/json"},callback:function(p,g,i){if(g){h.getStore().reload()}},jsonData:m,scope:this})}}],sm:new Ext.grid.CheckboxSelectionModel({listeners:{rowselect:function(c,b,a){a.set("active",true)},rowdeselect:function(c,b,a){a.set("active",false)}}}),cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel(),{header:"Currency",dataIndex:"toCurrency",sortable:true,renderer:function(b){var a=TDS.data.currencies.getById(b);var c;if(typeof a!="undefined"){c='<div title="'+a.get("text")+'">'+b+"</div>"}else{c=b}return c}},{header:"Current",dataIndex:"modifier",sortable:true,width:80,fixed:true,renderer:function(c,a,b){return c}},{header:"Adjustment (%)",dataIndex:"modifierDifference",sortable:true,editor:new Ext.form.TextField()},{header:"Today",dataIndex:"modifierToday",sortable:true},{header:"Max. Cut Off",dataIndex:"maxCutOff",sortable:true,editor:new Ext.form.TextField({vtype:"numeric"})},{header:"Min. Cut Off",dataIndex:"minCutOff",sortable:true,editor:new Ext.form.TextField({vtype:"numeric"})}]),viewConfig:{forceFit:true},selectRecords:function(){var a=[];this.getStore().each(function(b){if(b.get("active")==true){a.push(b)}});if(a.length>0){this.selModel.selectRecords(a,true)}},setDefaultModifer:function(a){;var b=this.ownerCt.findParentByType("stdpanel");var e=b.getAjaxPanel().getData();var f=e.homeCurrency;this.store.each(function(d){if(f!=d.get("toCurrency")&&(d.get("modifierToday")!="undefined"&&d.get("modifierToday")!=null&&d.get("modifierToday")!="")){var c=(parseFloat(parseFloat(d.get("modifierToday"))*parseFloat(a).toFixed(2)))/100;var g=parseFloat(d.get("modifierToday"))-parseFloat(c);var h=g.toFixed(2);d.set("modifier",h);d.set("modifierDifference",parseFloat(a).toFixed(2))}else{}},this)},storeExchangeRates:undefined,exchangeRatesLoaded:false,supplierExchangeRatesLoaded:false,isReady:function(){if(this.exchangeRatesLoaded&&this.supplierExchangeRatesLoaded){return true}return false},loadExchangeRates:function(){this.exchangeRatesLoaded=true;if(this.isReady()){this.initExchangeRates()}},CalculatePercentageDifference:function(){var b;var a;var g;;var e=this.ownerCt.ownerCt.findParentByType("stdpanel");var d=e.getAjaxPanel().getData();var f=d.homeCurrency;this.store.each(function(h){;if(typeof d.defaultExcCurrPercentage!="undefined"&&d.defaultExcCurrPercentage!=null&&d.defaultExcCurrPercentage!=""&&d.defaultExcCurrPercentage==h.get("modified")){if(f!=h.get("toCurrency")){h.set("modifierDifference",parseFloat(d.defaultExcCurrPercentage).toFixed(2))}else{h.set("modifierDifference",parseFloat(0).toFixed(2))}}else{if((h.get("modifier")!="undefined"&&h.get("modifier")!=null&&h.get("modifier")!="")&&(h.get("modifierToday")!="undefined"&&h.get("modifierToday")!=null&&h.get("modifierToday")!="")){a=(parseFloat(h.get("modifierToday"))-parseFloat(h.get("modifier")));if(parseFloat(h.get("modifierToday"))>0){b=100*(parseFloat(a)/parseFloat(h.get("modifierToday")));var c=b.toFixed(2);h.set("modifierDifference",c)}}else{h.set("modifier",h.get("modifierToday"));h.set("modifierDifference",b)}}},this)},loadSupplierExchangeRates:function(){var f=0;var d=this.ownerCt.ownerCt.findParentByType("stdpanel");var b=d.getAjaxPanel().getData();var e=b.homeCurrency;this.store.each(function(c){if(parseInt(f)>8){return false}if(c.get("toCurrency")=="USD"){f=parseInt(f)+1;c.set("sortOrderNumber",1)}else{if(c.get("toCurrency")=="AUD"){f=parseInt(f)+1;c.set("sortOrderNumber",2)}else{if(c.get("toCurrency")=="GBP"){f=parseInt(f)+1;c.set("sortOrderNumber",3)}else{if(c.get("toCurrency")=="EUR"){f=parseInt(f)+1;c.set("sortOrderNumber",4)}else{if(c.get("toCurrency")=="CAD"){f=parseInt(f)+1;c.set("sortOrderNumber",5)}else{if(c.get("toCurrency")=="CYN"){f=parseInt(f)+1;c.set("sortOrderNumber",6)}else{if(c.get("toCurrency")=="INR"){f=parseInt(f)+1;c.set("sortOrderNumber",7)}else{if(c.get("toCurrency")=="JPY"){f=parseInt(f)+1;c.set("sortOrderNumber",8)}}}}}}}}},this);this.store.sort("toCurrency","ASC");var a=8;this.store.each(function(c){if(c.get("sortOrderNumber")=="undefined"||c.get("sortOrderNumber")==null){a=parseInt(a)+1;c.set("sortOrderNumber",a)}},this);this.store.sort("sortOrderNumber","ASC");this.supplierExchangeRatesLoaded=true;if(this.isReady()){this.initExchangeRates()}},initExchangeRates:function(){var b=this.ownerCt.ownerCt.findParentByType("stdpanel");var a=b.getAjaxPanel().getData();var d=a.homeCurrency;this.getStore().each(function(e){var c=this.storeExchangeRates.find("counterCurrency",e.get("toCurrency"));if(c!=-1){var f=this.storeExchangeRates.getAt(c);e.set("modifierToday",f.get("convertedModifier"))}},this);this.CalculatePercentageDifference();this.selectRecords()},listeners:{render:function(){;var a=this.ownerCt.findParentByType("stdpanel");var b=a.getAjaxPanel().getData();var e=b.homeCurrency;this.colModel.setColumnHeader(2,"Current/"+e);if(b.adminMaintainedExcRate){this.topToolbar.items.itemAt(4).hide(true);this.topToolbar.items.itemAt(6).hide(true);this.topToolbar.items.itemAt(8).hide(true)}},validateedit:function(n,h,k,j){var g=n.record;if(n.field=="modifier"){var f=n.value;var b=g.get("modifierToday");var d;var l;var p;if((f!="undefined"&&f!=null&&f!="")&&(b!="undefined"&&b!=null&&b!="")){l=(parseFloat(b)-parseFloat(f));if(parseFloat(b)>0){d=100*(parseFloat(l)/parseFloat(b));var a=d.toFixed(2);g.set("modifierDifference",a)}}}else{if(n.field=="modifierDifference"){var f=g.get("modifier");var b=g.get("modifierToday");var l=n.value;if((f!="undefined"&&f!=null&&f!="")&&(b!="undefined"&&b!=null&&b!="")){var c=(parseFloat(parseFloat(b)*parseFloat(l)))/100;var o=parseFloat(b)-parseFloat(c);var i=o;g.set("modifier",i)}}}},beforerender:function(){var a=this.ownerCt.findParentByType("form");this.storeExchangeRates=new Ext.data.CollectionStore({autoLoad:true,url:TDS.env.dataPath+"exchangeRates/collection?currency="+a.getHomeCurrency(),identifier:"exchangeRates?currency="+a.getHomeCurrency(),id:"counterCurrency",fields:["dataURI","convertedBaseCurrency","convertedModifier","counterCurrency"]});this.store=new Ext.data.CollectionStore({autoLoad:true,url:TDS.env.dataPath+a.getDataURI()+"/exchangeRates/collection",identifier:a.getDataURI()+"/exchangeRates",id:"dataURI",fields:["dataURI","fromCurrency","toCurrency","modifier","active","modifierToday","sortOrderNumber","modifierDifference"]});this.storeExchangeRates.on("load",this.loadExchangeRates,this);this.store.on("load",this.loadSupplierExchangeRates,this)}}}}}]}]}