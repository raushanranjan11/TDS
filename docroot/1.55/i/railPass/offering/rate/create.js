{xtype:"form",border:false,markDataDirtyOnLoad:true,fieldMap:{rateClass:"rateClassURI",ratePer:"ratePerURI",rateOccupancy:"rateOccupancyURI",defaultMaxHoldTimeSeconds:["defaultMaxHoldTimeHours","defaultMaxHoldTimeMinutes"]},beforeSubmit:function(b){b.defaultMaxHoldTimeSeconds=0;if(typeof b.defaultMaxHoldTimeHours==="number"){b.defaultMaxHoldTimeSeconds+=parseInt(b.defaultMaxHoldTimeHours)*60*60}if(typeof b.defaultMaxHoldTimeMinutes==="number"){b.defaultMaxHoldTimeSeconds+=parseInt(b.defaultMaxHoldTimeMinutes)*60}if(isNaN(b.defaultMaxHoldTimeSeconds)||b.defaultMaxHoldTimeSeconds==0){delete b.defaultMaxHoldTimeSeconds}return b},beforeDataLoad:function(f,g){var e=f.defaultMaxHoldTimeSeconds;f.defaultMaxHoldTimeHours=Math.floor(parseInt(f.defaultMaxHoldTimeSeconds)/60/60);if(f.defaultMaxHoldTimeHours>0){e-=f.defaultMaxHoldTimeHours*60*60}f.defaultMaxHoldTimeMinutes=e/60;if(f.agencyURI){f.rateAvailableForAgencyOnly=true}var h=g.getRequiredData("supplier");f.restrictions=h.data.defaultRateTermsAndConditions;return f},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:330,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Details",items:[{xtype:"panel",layout:"form",border:false,labelWidth:105,buildRateName:function(m){var j=this.ownerCt.findParentByType("awesomewindow");var l=j.aw.data.offeringName;var n=this.items.itemAt(0);var d=this.items.itemAt(4).items.itemAt(1).getValue();var a=this.items.itemAt(4).items.itemAt(3).getValue();if(d>0&&d!=""&&d!=null){d=" "+d+" Days"}else{d=""}if(a>0&&a!=""&&a!=null){a=" "+a+" Months"}else{a=""}var k="";if(d!=""&&a!=""){k=" in "}n.setValue(l+" "+d+k+a)},items:[{xtype:"textfield",name:"name",readOnly:true,style:"border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none;",fieldLabel:"Name",width:260},{xtype:"panel",style:"padding: 0; margin-top:10px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"Pax Type:",width:Ext.isIE?110:110},{xtype:"combo",name:"passType",fieldLabel:"Pax Type",mode:"local",width:110,triggerAction:"all",editable:false,displayField:"text",valueField:"value",store:TDS.data.passType},{html:"&nbsp;&nbsp;&nbsp;Age:",width:Ext.isIE?35:35},{xtype:"textfield",name:"ageRange",forceSubmit:true,width:140}]},{xtype:"panel",style:"padding: 0; margin-top: 6px; margin-bottom: 6px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"Saver Min:",width:Ext.isIE?110:110},{xtype:"omnicrementer",name:"saverMin",fieldLabel:"Saver Min",forceSubmit:true,maxValue:30},{html:"&nbsp;&nbsp;&nbsp;Max:",width:Ext.isIE?65:65},{xtype:"omnicrementer",name:"saverMax",fieldLabel:"Saver Min",forceSubmit:true,maxValue:30}]},{xtype:"combo",name:"passClass",forceSubmit:true,fieldLabel:"Class",mode:"local",width:110,triggerAction:"all",editable:false,displayField:"text",valueField:"value",store:TDS.data.railPassClass},{xtype:"panel",style:"padding: 0; margin-bottom: 6px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"Validity:",width:Ext.isIE?110:110},{xtype:"omnicrementer",name:"validityDays",forceSubmit:true,minValue:1,maxValue:31,listeners:{trigger:function(){if(this.getValue()){this.ownerCt.ownerCt.buildRateName(true)}},change:function(){if(this.getValue()){this.ownerCt.ownerCt.buildRateName(true)}}}},{html:"&nbsp;&nbsp;&nbsp;Days in",width:Ext.isIE?65:65},{xtype:"omnicrementer",name:"validityMonths",forceSubmit:true,minValue:1,maxValue:12,listeners:{trigger:function(){if(this.getValue()){this.ownerCt.ownerCt.buildRateName(true)}},change:function(){if(this.getValue()){this.ownerCt.ownerCt.buildRateName(true)}}}},{html:"&nbsp;months",width:Ext.isIE?65:65}]},{xtype:"panel",style:"padding: 0; margin-bottom: 6px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"Days:",width:Ext.isIE?110:110},{xtype:"omnicrementer",name:"days",forceSubmit:true,minValue:1,maxValue:31},{html:"&nbsp;&nbsp;&nbsp;Months:",width:Ext.isIE?65:65},{xtype:"omnicrementer",name:"months",forceSubmit:true,minValue:1,maxValue:12}]},{xtype:"checkbox",name:"active",fieldLabel:"Active",inputValue:true},{xtype:"panel",style:"padding: 0; margin-bottom: 6px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"Inventory Max. hold time:",width:Ext.isIE?110:110},{xtype:"omnicrementer",name:"defaultMaxHoldTimeHours",maxValue:23},{html:"hours",bodyStyle:"padding: 0 4px;"},{xtype:"omnicrementer",name:"defaultMaxHoldTimeMinutes",maxValue:59},{html:"minutes",bodyStyle:"padding: 0 4px;"}]},{xtype:"panel",style:"padding: 0; margin-top: 6px;",border:false,layout:"table",hidden:true,layoutConfig:{columns:3},defaults:{border:false},items:[{html:"Inventory Cut-off time:",width:Ext.isIE?110:110},{xtype:"omnicrementer",name:"defaultCutoffTimeDays",value:0,forceSubmit:true,maxValue:30},{html:"days",bodyStyle:"padding: 0 4px;"}]}]}]},{title:"Pricing",items:[{xtype:"panel",border:false,items:[{xtype:"panel",anchor:"100%",border:false,height:350,items:[{xtype:"panel",border:false,items:[{xtype:"panel",layout:"table",style:" padding-left: 35px;padding-top:5px; ",border:false,hideBorders:true,layoutConfig:{columns:5},items:[{xtype:"radio",name:"cruiseLink",boxLabel:"Pricing",inputValue:false,listeners:{render:function(){},check:function(b,a){if(a){this.ownerCt.ownerCt.ownerCt.items.itemAt(2).disable();this.ownerCt.ownerCt.ownerCt.items.itemAt(1).enable()}}}},{width:50},{xtype:"radio",name:"cruiseLink",boxLabel:"Package Pricing",inputValue:true,listeners:{render:function(){},check:function(b,a){if(a){this.ownerCt.ownerCt.ownerCt.items.itemAt(1).disable();this.ownerCt.ownerCt.ownerCt.items.itemAt(2).enable()}}}}]}]},{xtype:"pricepanel"},{xtype:"packagepricepanel"}]}]}]},{title:"CUG",items:{xtype:"panel",layout:"table",border:false,hideBorders:true,showLoadMask:false,layoutConfig:{columns:5},initAgency:function(){var b=this.getAgencyURIField().getValue();if(b){this.showLoadMask=true;this.lookupAgencyByURI(b)}},lookupAgencyByURI:function(b){this.lookupAgency(false,b)},lookupAgencyByAgencyArenaCode:function(b){this.lookupAgency(b,false)},lookupAgency:function(e,f){if(this.showLoadMask){this.el.mask("","x-mask-loading")}var d={};if(e){d.agencyArenaCode=e}if(f){d.agencyURI=f}Ext.Ajax.request({url:TDS.env.dataPath+"search/agencies/collection",disableCaching:false,method:"GET",params:d,callback:function(b,m,k){if(this.showLoadMask){this.showLoadMask=false;this.el.unmask()}this.getLookupButton().enable();if(m){try{var l=Ext.decode(k.responseText);var a=l["search/agencies?"+Ext.urlEncode(d)][0];if(!a){this.setAgencyLabel("No agent found.");return}this.setAgencyLabel(l[a]["name"]);this.setAgencyArenaCodeField(l[a]["agencyArenaCode"]);this.setAgencyAddressLabel(l[a]["addressString"]);this.setAgencyURIField(a)}catch(c){}}else{this.setAgencyLabel('<span style="color: red;">Unknown error occured.</span>')}},scope:this})},getLookupButton:function(){return this.items.itemAt(5)},getRateAvailableForAgencyField:function(){return this.items.itemAt(0)},getAgencyURIField:function(){return this.items.itemAt(7)},getAgencyArenaCodeField:function(){return this.items.itemAt(4)},setAgencyArenaCodeField:function(b){this.getAgencyArenaCodeField().setValue(b)},setAgencyURIField:function(b){this.getAgencyURIField().setValue(b)},setAgencyLabel:function(b){this.items.itemAt(9).setText(b)},setAgencyAddressLabel:function(b){this.items.itemAt(11).setText('<span style="font-size: 9px; color: #999;">'+b+"</span>")},clearAllFields:function(){this.setAgencyLabel("");this.setAgencyAddressLabel("");this.setAgencyURIField("")},items:[{xtype:"checkbox",name:"rateAvailableForAgencyOnly",forceSubmit:true,width:20},{colspan:4,html:"Rate is only available to specific agent only.",width:320},{width:20},{html:"Agent code:",width:80},{xtype:"textfield",name:"agencyArenaCode",width:60},{xtype:"button",text:"Lookup",width:60,handler:function(){var b=this.ownerCt;this.disable();b.clearAllFields();b.setAgencyLabel("Lookup in progress...");b.lookupAgencyByAgencyArenaCode(b.getAgencyArenaCodeField().getValue())}},{width:120},{xtype:"hidden",name:"agencyURI",forceSubmit:true,width:20},{html:"Agent:",width:80},{colspan:3,xtype:"labelpanel",html:"Not set",width:240},{colspan:2,width:100},{colspan:3,xtype:"labelpanel",width:240}],listeners:{render:function(){this.initAgency()}}}},{title:"Notes",layout:"form",items:{xtype:"htmleditor",name:"restrictions",height:200,hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}}]}]}