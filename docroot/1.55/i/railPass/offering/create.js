{xtype:"form",border:false,markDataDirtyOnLoad:true,beforeSubmit:function(c){var d=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(2);c.name=d.getRawValue();var b=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(6).items.itemAt(2);c.global=false;if(b.checked){c.global=true}if(c.passCategory!="Europe Passes"){c.passSubCategory=""}delete c.passCategory;delete c.passSubCategory;return c},fieldMap:{rateClass:"rateClassURI",ratePer:"ratePerURI",rateOccupancy:"rateOccupancyURI",defaultMaxHoldTimeSeconds:["defaultMaxHoldTimeHours","defaultMaxHoldTimeMinutes"]},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:410,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Details",items:[{xtype:"panel",layout:"form",border:false,labelWidth:105,loadCombo:function(c,a,b){this.items.itemAt(3).setValue("");this.items.itemAt(7).items.itemAt(0).setValue("");Ext.Ajax.request({url:b,disableCaching:false,method:"GET",callback:function(l,e,g){var f=Ext.util.JSON.decode(g.responseText);var k=f[a];if(typeof k=="undefined"){return}var h=[];for(var d=0;d<k.length;d++){f[k[d]].dataURI=k[d];var j=new Ext.data.Record(f[k[d]]);h.push(j)}c.store.add(h);c.enable(true)}})},items:[{xtype:"combo",name:"passCategory",fieldLabel:"Pass Category",mode:"local",width:110,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"railPass/category/collection",identifier:"railPass/category",fields:["name","dataURI","railPassSubCaregoryExist"]}),listeners:{select:function(f,c){var b=this.getValue();var d=this.ownerCt.items.itemAt(1);d.disable(true);d.store.removeAll();d.setValue("");var a=this.ownerCt.items.itemAt(2);a.disable(true);a.store.removeAll();a.setValue("");if(c.get("railPassSubCaregoryExist")){var g=d.store;var e=TDS.env.dataPath+b+"/collection";this.ownerCt.loadCombo(d,b,e)}else{b+="/names/collection";var g=a.store;var e=TDS.env.dataPath+b;this.ownerCt.loadCombo(a,b,e)}}}},{xtype:"combo",name:"passSubCategory",fieldLabel:"Sub Category",mode:"local",width:160,triggerAction:"all",editable:false,disabled:true,displayField:"name",valueField:"dataURI",store:new Ext.data.Store(),listeners:{select:function(e,c){var b=this.getValue();var a=this.ownerCt.items.itemAt(2);a.disable(true);a.store.removeAll();a.setValue("");var d=TDS.env.dataPath+b+"/names/collection";b+="/names/collection";this.ownerCt.loadCombo(a,b,d)}}},{xtype:"combo",name:"railPassName",fieldLabel:"Name",mode:"local",width:220,triggerAction:"all",editable:false,disabled:true,displayField:"name",valueField:"dataURI",store:new Ext.data.Store(),listeners:{select:function(b,a){if(a.get("description")){this.ownerCt.items.itemAt(3).setValue(a.get("description"))}if(a.get("detailedDescription")){this.ownerCt.items.itemAt(7).items.itemAt(0).setValue(a.get("detailedDescription"))}}}},{xtype:"textarea",name:"passDescription",height:40,fieldLabel:"Description",readOnly:true,style:"border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none;",width:260},{xtype:"textarea",name:"countries",fieldLabel:"Countries",height:60,width:260},{xtype:"omnicrementer",name:"noOfCountries",fieldLabel:"No Of Countries",maxValue:5,width:60},{xtype:"panel",style:"padding: 0; margin-bottom: 4px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"&nbsp;",width:Ext.isIE?110:110},{xtype:"radio",name:"global",checked:true,boxLabel:"Multi",width:Ext.isIE?65:65},{xtype:"radio",name:"global",boxLabel:"Global",value:true,width:Ext.isIE?110:110}]},{xtype:"panel",style:"padding: 0; margin-bottom: 4px; margin-left: 20px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{xtype:"textarea",labelSeparator:"",readOnly:true,name:"detailedDescription",height:120,labelWidth:5,width:360}]}]}]},{title:"Description",layout:"fit",items:{xtype:"htmleditor",name:"description",hideLabel:true,labelSeparator:"",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}},{title:"Notes",layout:"fit",items:{xtype:"htmleditor",name:"notes",hideLabel:true,labelSeparator:"",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}},{title:"Localisation",layout:"form",items:[{html:"<p>Name:</p>",style:"margin-bottom: 2px;",border:false},{xtype:"textfield",name:"nameLocale",hideLabel:true,labelSeparator:"",anchor:"100%"},{html:"<p>Description:</p>",style:"margin-bottom: 2px;",border:false},{xtype:"htmleditor",name:"descriptionLocale",height:"auto",hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}]},{title:"Links",layout:"fit",items:{xtype:"editorgrid",loadMask:{msg:""},viewConfig:{forceFit:true},store:new Ext.data.JsonStore({url:"",pruneModifiedRecords:true,fields:["dataURI","href","description"]}),getData:function(){var c=this.getStore().getModifiedRecords();for(var b=0,e=[];b<c.length;b++){var a=c[b].get("dataURI");e.push({method:a?"PUT":"POST",destinationDataURI:a?TDS.env.dataPath+a:this.baseDataURI,data:{href:c[b].get("href"),description:c[b].get("description")}})}return{data:e}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{header:"URL",dataIndex:"href",editor:new Ext.form.TextField({allowBlank:false})},{header:"Description",dataIndex:"description",editor:new Ext.form.TextField({allowBlank:false})}]),bbar:[{xtype:"button",text:"Add",tooltip:"Click here to add a new link",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({href:"",description:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",tooltip:"Select a link and click here to remove",handler:function(){var b=this.ownerCt.ownerCt;b.loadMask.show();var a=b.selModel.getSelected();if(a.get("dataURI")){Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+a.get("dataURI"),callback:function(e,c,d){b.loadMask.hide();if(c){b.store.remove(a);return}}})}else{b.loadMask.hide();b.store.remove(a)}}}],removeLink:function(){},listeners:{render:function(){var b=this.ownerCt.findParentByType("awesomewindow");if(!b){b.registerItem(this.id);this.baseDataURI=TDS.env.dataPath+b.aw.baseDataURI;var g=this.getStore().recordType;var d=b.aw.data[b.aw.baseDataURI];var c=[];for(var e=0;e<d.length;e++){var a=d[e];var f=b.aw.data[a];f.dataURI=a;c[e]=new g(f)}this.getStore().add(c)}}}}}]}]}