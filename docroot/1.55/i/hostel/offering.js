{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 8px;",autoScroll:true,requireStores:[{dataURI:TDS.env.dataPath+"hostel/ratings/collection",identifier:"hostel/ratings",fields:["rating","dataURI"]}],listeners:{render:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]})}else{if(TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/currentUser/collection/concise",identifier:"currentUserCreatedsuppliers",fields:["name","dataURI"]})}}}},items:{xtype:"awesomegrid",searchURI:"",pinnable:true,enableRowExpander:false,iconCls:"icon-grid",getDataURI:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")||TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){var c=this.getTopToolbar();var a=c.items.itemAt(1);var b=a.getValue();if(!b){return false}return a.getValue()}else{if(TDS.env.user.hasGroupPermission("INVENTORY_MANAGEMENT_HOSTEL")){return TDS.env.user.getSupplierURI()}}},tbar:[{xtype:"tbspecialtext",text:"Supplier: ",hidden:true},{xtype:"combo",hidden:true,name:"supplierURI",mode:"local",width:180,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:new Ext.data.Store(),appendData:[{name:"All",dataURI:""}],toggleButtons:function(){var a=this.ownerCt.items.itemAt(12);var b=this.ownerCt.items.itemAt(14);if(!this.getValue()){a.disable();b.disable()}else{a.enable();b.enable()}},listeners:{select:function(){this.toggleButtons()}}},{xtype:"tbspecialspacer",hidden:true},"Location: ",{xtype:"combo",name:"countryFromCode",emptyText:"Type a country...",excludeSubmit:true,excludeFromSession:true,minChars:1,enableKeyEvents:true,mode:"local",width:100,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]})}," ",{xtype:"locationcombo",width:100,name:"locationURI",excludeFromSession:true,hideTrigger:false,listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(4);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}}," ","Name: ",{xtype:"textfield",name:"nameLike",enableKeyEvents:true,width:100}," ","ARENA Code: ",{xtype:"textfield",name:"codeLike",enableKeyEvents:true,width:100}," ","Cruise Code: ",{xtype:"textfield",name:"cruiseCode",enableKeyEvents:true,width:90},"&nbsp;&nbsp;",{xtype:"checkbox",boxLabel:"Show only Archived",name:"showUnArchivedOnly",excludeFromSession:true,handler:function(){var a=this.ownerCt.ownerCt.topToolbar;a.items.itemAt(22).disable(true);a.items.itemAt(16).setDisabled(true);if(this.checked){a.items.itemAt(22).setText("Restore")}else{a.items.itemAt(22).setText("Archive")}}},"  ",{xtype:"button",name:"delete",text:"Delete",disabled:true,handler:function(){var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");var e=this.getText();if(!a){return}Ext.Msg.show({title:"Alert",msg:"Are you sure you want to "+e,buttons:Ext.Msg.YESNO,fn:b,animEl:"elId",icon:Ext.MessageBox.QUESTION});function b(g,f,h){if(g=="yes"){Ext.Ajax.request({url:TDS.env.dataPath+a,method:"DELETE",callback:function(){d.submitQuery(true)},scope:this,disableCaching:true})}}}},"->",{xtype:"redbutton",text:"Create",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getDataURI();if(!a){return}TDS.window.setWindow({title:"Hostel details",information:"Please enter details of a new property.",interfaceURI:"hostel/offering/create.js",postDataURI:a+"/hostelOfferings",requiredData:[{id:"supplier",dataURI:a}],callback:{fn:function(c){if(c){b.submitQuery(true)}},scope:b}})}}," ",{xtype:"button",text:"Copy",handler:function(){var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");var b=c.get("supplierURI");if(!a&&!b){return}TDS.window.setWindow({title:"Copy hostel offering",information:"This interface will create a new hostel offering with the following details, you may edit these details before you submit.",interfaceURI:"hostel/offering/create.js",sourceDataURI:a,postDataURI:b+"/hostelOfferings",buttonOK:"Submit",requiredData:[{id:"supplier",dataURI:b}],callback:{fn:function(e){if(e){d.submitQuery(true)}},scope:d}})}}," ",{text:"Archive",handler:function(){var c=this.buttonContainer.ownerCt;var b=c.selModel.getSelected();if(!b){return}var a=b.get("dataURI");if(!a){return}TDS.window.setWindow({title:"Archive hostel offering",message:"Are you sure you want to archive this hostel offering?",destinationDataURI:a,data:{archived:true},callback:{fn:function(d){if(d){c.submitQuery(true)}},scope:c}})}}],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["published","dataURI","supplierURI","pinned","homeCurrency","rackRatePriceSell","name","locationToString","code","createdDate","updatedDate","pricingPriceIsNett"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Published",width:40,dataIndex:"published",renderer:function(c,b,a){if(a.get("published")){return'<input type="password" name="" style="border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none; div {text-align: lert; }; color:#ff0000" disabled value = "a">'}else{return""}}},{header:"Supplier",dataIndex:"supplierURI",hidden:true,renderer:TDS.util.Format.displayResourceConciseNameRenderer()},{header:"Location",dataIndex:"locationToString",sortable:true},{header:"Name",dataIndex:"name",sortable:true},{header:"Code",dataIndex:"code",sortable:true,menuDisabled:true,width:80,fixed:true},{header:"Advertised rate",dataIndex:"rackRatePriceSell",width:120,fixed:true,sortable:true,renderer:function(c,b,a){return TDS.util.Price.formatPrice(c,a.data.homeCurrency)+" ("+(a.data.pricingPriceIsNett?"Nett":"Gross")+")"}},{header:"Published",dataIndex:"createdDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Last modified",dataIndex:"updatedDate",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)}]),viewConfig:{forceFit:true},listeners:{render:function(){this.getSelectionModel().on("rowselect",function(){var a=this.items.itemAt(14).checked;if(!a){this.items.itemAt(16).setDisabled(true)}else{this.items.itemAt(16).setDisabled(false)}this.items.itemAt(22).setDisabled(false)},this.getTopToolbar());this.getSelectionModel().on("rowdeselect",function(){this.items.itemAt(22).setDisabled(true)},this.getTopToolbar())},beforerender:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){var b=this.getTopToolbar();b[0].hidden=false;b[1].hidden=false;b[1].store=TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]});b[2].hidden=false;var a=this.getColumnModel();a.setHidden(0,false)}else{if(!TDS.env.user.hasGroupPermission("ADMINISTRATION")&&TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){var b=this.getTopToolbar();b[0].hidden=false;b[1].hidden=false;b[1].store=TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/currentUser/collection/concise",identifier:"currentUserCreatedsuppliers",fields:["name","dataURI"]});b[2].hidden=false;var a=this.getColumnModel();a.setHidden(0,false)}}},sessioninit:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")||TDS.env.user.hasGroupPermission("SUB_ADMINISTRATION")){this.searchURI=TDS.env.dataPath+"hostel/offerings"}else{if(TDS.env.user.hasGroupPermission("INVENTORY_MANAGEMENT_HOSTEL")){this.searchURI=TDS.env.dataPath+TDS.env.user.getSupplierURI()+"/hostelOfferings"}}},rowdblclick:function(d,h,f){var c=d.getStore().getAt(h);if(!c){return}var a=c.get("dataURI");var b=c.get("name");TDS.workArea.openTab(b,"hostel/offering/view.js",a,TDS.env.sessionPath+a)}}}}