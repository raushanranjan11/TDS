{xtype:"form",border:false,layout:"fit",width:470,markDataDirtyOnLoad:true,beforeDataLoad:function(e){var c=this.getForm().findFieldAggressive("rateURI");if(c){var a=this.ownerCt;var b=Ext.StoreMgr.lookup(a.getConfigValue("baseDataURI")+"/rates");c.store=b}return e},beforeSubmit:function(c){var e=this.findByType("grid")[0];var d=e.getData();d=d.join(",");var b=this.findByType("grid")[1];var a=b.getData();a=a.join(",");if(a){c.excludeDatesRange=a}if(d){c.excludeDates=d}c.inventoryAction="consume";return{submitDataAsParams:true,paramData:c}},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:300,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Validity",items:[{xtype:"panel",layout:"auto",height:255,frame:true,items:[{xtype:"panel",layout:"form",border:false,labelWidth:40,defaults:{},items:[{xtype:"combo",name:"rateURI",forceSubmit:true,mode:"local",fieldLabel:"Rate",width:200,triggerAction:"all",editable:false,allowBlank:false,displayField:"nameString",valueField:"dataURI"},{xtype:"panel",layout:"table",border:false,layoutConfig:{columns:4},items:[{colspan:4,xtype:"panel",border:false,style:"margin-left: 16px; margin-top: 4px;",items:{xtype:"fieldset",title:"Block-out dates",collapsible:true,layout:"table",layoutConfig:{columns:2},height:190,width:430,defaults:{style:"margin-left: 5px; margin-right: 5px;"},items:[{xtype:"grid",hideHeaders:true,border:true,height:150,width:130,store:new Ext.data.JsonStore({url:"",fields:[{name:"date"}]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{dataIndex:"date",width:40}]),viewConfig:{forceFit:true},getData:function(){var a=[];this.store.each(function(b){a.push(Date.parseDate(b.data.date,TDS.env.dateFormatDisplay).format(TDS.env.dateFormat))});return a},bbar:[{xtype:"button",text:"+",handler:function(){if(this.menu==null){this.menu=new Ext.menu.DateMenu();Ext.apply(this.menu.picker,{format:TDS.env.dateFormatDisplay,showToday:false});this.menu.picker.setValue(new Date());this.menu.on("select",function(e,b){var d=this.getStore().recordType;var a=new d({date:b.format(TDS.env.dateFormatDisplay)});this.getStore().add([a])},this.ownerCt.ownerCt)}this.menu.show(this.el,"tl-bl?")}},{xtype:"button",text:"-",handler:function(){var b=this.ownerCt.ownerCt;var a=b.selModel.getSelected();b.store.remove(a)}}]},{xtype:"editorgrid",height:150,width:260,store:new Ext.data.JsonStore({fields:["startDate","endDate"]}),getData:function(){var a=[];this.store.each(function(b){if(b.data.startDate&&b.data.endDate){a.push(b.data.startDate.format(TDS.env.dateFormat)+"&&"+b.data.endDate.format(TDS.env.dateFormat))}});return a},sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"From",dataIndex:"startDate",flex:1,editor:new Ext.form.DateField({showToday:false,format:"dMy",minValue:"01/01/06"})},{header:"To",dataIndex:"endDate",flex:1,editor:new Ext.form.DateField({showToday:false,format:"dMy",minValue:"01/01/06"})}]),viewConfig:{forceFit:true},tbar:["Enter the date range to be blocked"],bbar:[{xtype:"button",text:"Add",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({startDate:"",endDate:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",handler:function(){var b=this.ownerCt.ownerCt,a;while(a=b.selModel.getSelected()){b.store.remove(a)}}}]}]}}]}]}]}]}]}]}