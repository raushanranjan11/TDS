{xtype:"panel",border:false,bodyStyle:"padding: 8px;",autoScroll:true,items:{xtype:"awesomegrid",alwaysUseCollection:true,searchURI:TDS.env.dataPath+"users",pinnable:true,enableRowExpander:false,iconCls:"icon-grid",tbar:["Name: ",{xtype:"textfield",name:"nameLike",enableKeyEvents:true,width:120}," ","Email: ",{xtype:"textfield",name:"emailLike",enableKeyEvents:true,width:120},"->",{xtype:"redbutton",text:"Create",handler:function(){var a=this.ownerCt.ownerCt;TDS.window.setWindow({title:"User details",information:"Please enter details of a new user.",interfaceURI:"user/create.js",postDataURI:"user",callback:{fn:a.submitQuery,scope:a}})}}," ",{text:"Copy",handler:function(){var c=this.buttonContainer.ownerCt;var b=c.selModel.getSelected();if(!b){return}
var a=b.get("dataURI");TDS.window.setWindow({title:"Copy user",information:"This interface will create a new user with the following details, you may edit these details before you submit.",interfaceURI:"user/create.js",sourceDataURI:a,postDataURI:"user",data:{login:"",emailAddress:""},buttonOK:"Submit",callback:{fn:c.submitQuery,scope:c}})}}," ",{text:"Archive",disabled:true,handler:function(){var c=this.buttonContainer.ownerCt;var b=c.selModel.getSelected();console.log(c);console.log(c.topToolbar.items);var archiveOrUnarchive=!(c.topToolbar.items.itemAt(12).checked);var archived=!1;if(archiveOrUnarchive){archived=!0}else{archived=!1}
if(!b){return}
var a=b.get("dataURI");var header=this.getText();if(TDS.env.user.hasGroupPermission('ADMINISTRATION')){var userArray=[];var userName=[];c.getSelectionModel().getSelections().forEach(function(rec){var name=rec.data.nameFirst+" "+rec.data.nameLast;userArray.push(rec.id);userName.push(name)});TDS.window.setWindow({title:header,message:'Are you sure you want to '+header+' "'+userName.toString()+'" ?',destinationDataURI:'user/multipleArchive?archiveOrUnarchive='+archived,data:{archived:archiveOrUnarchive,userArray:userArray},callback:{fn:function(s){if(s)
c.submitQuery(!0)},scope:c}})}else{TDS.window.setWindow({title:"Archive user",message:"Are you sure you want to archive the user account for "+b.get("nameFirst")+" "+b.get("nameLast")+"?",destinationDataURI:a,data:{archived:archived},callback:{fn:function(d){if(d){c.submitQuery(true)}},scope:c}})}}},' ',{xtype:'checkbox',name:'showUnArchivedOnly',handler:function(){var tb=this.ownerCt.ownerCt.topToolbar;tb.items.itemAt(10).disable(!0);this.ownerCt.ownerCt.topToolbar.items.itemAt(15).setDisabled(!0);if(this.checked){tb.items.itemAt(10).setText("Restore")}else{tb.items.itemAt(10).setText("Archive")}}},'Show only Archived',' ',{xtype:'button',name:'delete',text:'Delete',disabled:!0,handler:function(){var g=this.ownerCt.ownerCt;var r=g.selModel.getSelected();if(!r)
return;var dataURI=r.get('dataURI');var header=this.getText();if(!dataURI)
return;Ext.Msg.show({title:'Alert',msg:'Are you sure you want to '+header,buttons:Ext.Msg.YESNO,fn:processResult,animEl:'elId',icon:Ext.MessageBox.QUESTION});function processResult(a,b,c){var me=this;if(a=='yes'){if(TDS.env.user.hasGroupPermission('ADMINISTRATION')){var userArray=[];g.getSelectionModel().getSelections().forEach(function(rec){userArray.push(rec.id)});Ext.Ajax.request({url:TDS.env.dataPath+'user/deleteMultiple',jsonData:{userArray:userArray},method:'PUT',headers:{'Content-Type':'application/json'},callback:function(){g.submitQuery(!0)},scope:me,disableCaching:!0})}else{Ext.Ajax.request({url:TDS.env.dataPath+dataURI,method:'DELETE',callback:function(){g.submitQuery(!0)},scope:this,disableCaching:!0})}}}}},],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","pinned","salutation","nameFirst","nameLast","emailAddress","isActive","lastHeartbeat","password","agencyURI","supplierURI","nameFull"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Title",dataIndex:"salutation",width:60,fixed:true,sortable:true},{header:"Name",dataIndex:"nameFull",sortable:true,renderer:function(c,b,a){return a.get("nameFirst")+" "+a.get("nameLast")}},{header:"Email",dataIndex:"emailAddress",sortable:true},{header:"Last activity",dataIndex:"lastHeartbeat",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Passwords",dataIndex:"password",sortable:true},{header:"User type",dataIndex:"userType",fixed:true,width:80,sortable:true,renderer:function(c,b,a){if(a.get("agencyURI")){return"Agent"}else{if(a.get("supplierURI")){return"Supplier"}else{return""}}}}]),viewConfig:{forceFit:true},listeners:{render:function(){this.getSelectionModel().on('rowselect',function(){console.log(this.ownerCt);this.items.itemAt(10).setDisabled(!1);var archive=this.ownerCt.topToolbar.items.itemAt(12).checked;if(archive){this.ownerCt.topToolbar.items.itemAt(15).setDisabled(!1)}},this.getTopToolbar());this.getSelectionModel().on('rowdeselect',function(){this.items.itemAt(10).setDisabled(!0)},this.getTopToolbar())},rowdblclick:function(c,f,d){var b=c.getStore().getAt(f);var a=b.get("dataURI");TDS.window.setWindow({title:"User details",interfaceURI:"user/edit.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",callback:{fn:c.submitQuery,scope:c}})}}}}