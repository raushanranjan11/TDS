{xtype:"form",width:850,border:false,beforeSubmit:function(c){var b=this.findByType("grid")[0].getSelectionModel().getSelections()[0].data;c.editCategory=b;var d=[];Ext.getCmp("pass").getStore().getModifiedRecords().forEach(function(a){d.push(a.data)});b.passengersData=d;return b},items:[{xtype:"tabpanel",activeTab:0,deferredRender:false,layoutOnTabChange:true,height:350,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},listeners:{render:function(){}},items:[{title:"Details",items:[{xtype:"panel",layout:"auto",border:false,labelWidth:120,defaults:{style:"padding: 2px 4px 2px 4px;"},listeners:{render:function(){this.findByType("label")[1].setText(this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").getDetail("supplierName"));this.findByType("label")[3].setText(TDS.util.Format.dateSpecial(this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").getDetail("dateFrom"),TDS.env.dateFormatDisplay));var a=this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").getDetail("cruisePackage");console.log(this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").initialConfig);this.findByType("label")[5].setText(this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").initialConfig.config.cruiseName);if(a==0){this.findByType("radio")[0].setValue(true)}else{this.findByType("radio")[1].setValue(true)}}},items:[{xtype:"panel",layout:"table",style:" padding-left: 34px;padding-top:5px; ",border:false,layoutConfig:{columns:4},items:[{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Supplier :"},{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Supplier Name"},{xtype:"label",text:"Date/Time : ",style:"padding-left:400px;font-size: 12px;font-weight: bold;"},{xtype:"label",text:""}]},{xtype:"panel",layout:"table",style:" padding-left: 34px;padding-top:5px; ",border:false,layoutConfig:{columns:4},items:[{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Cruise  :"},{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Cruise Name"}]},{xtype:"panel",layout:"table",style:" padding-left: 350px;padding-top:5px; ",border:false,hideBorders:true,layoutConfig:{columns:6},items:[{xtype:"radio",name:"isCruisePackage",boxLabel:"Cruise Only",inputValue:false},{width:50},{xtype:"radio",name:"isCruisePackage",boxLabel:"Cruise Package",inputValue:true}],listeners:{render:function(){}}},{xtype:"panel",layout:"form",style:" padding-left: 10px;padding-top:5px; ",height:150,items:[{xtype:"editorgrid",id:"fullfillmentGrid",height:150,border:false,enableHdMenu:false,viewConfig:{},stateful:true,stateId:"editorgrid",store:new Ext.data.JsonStore({url:"",fields:["nameString","maximumOccupancy","status","obstruct","dataURI","expireDate","position","totalPax","deckNo","price","name","deal","priceDouble","priceQuad","priceSingle","priceTriple","stateRoomType","stateRoomNumber","nameString","cRateDataURI","priceSell"]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{header:"Category",width:100,fixed:true,dataIndex:"nameString",editor:new Ext.form.ComboBox({mode:"remote",triggerAction:"all",displayField:"nameString",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath,identifier:"categories",fields:["name","nameString","dataURI"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"categories",fields:["name","nameString","dataURI"]})}),listeners:{beforequery:function(a){var b=Ext.getCmp("fullfillmentGrid").findParentByType("awesomewindow").initialConfig.scope.findByType("button")[0].config.offeringURI;this.getStore().proxy.conn.method="GET",this.getStore().proxy.conn.url=TDS.env.dataPath+b+"/categories",this.getStore().load({})},select:function(c,a,b){}}}),renderer:function(g,d,c,f,h,e){var b=c.get("nameString");return g}},{header:"  Stateroom Type",dataIndex:"stateRoomType",width:100,editor:new Ext.form.TextField({})},{header:"Stateroom No.",dataIndex:"stateRoomNumber",width:100,editor:new Ext.form.TextField({})},{header:"Deck",dataIndex:"deckNo",width:60,editor:new Ext.form.TextField({})},{header:"Position",dataIndex:"position",width:60,editor:new Ext.form.TextField({})},{header:"Obstruct",dataIndex:"obstruct",width:80,fixed:true,editor:new Ext.form.ComboBox({excludeSubmit:true,minChars:1,enableKeyEvents:true,mode:"local",width:85,typeAhead:true,excludeFromSession:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:new Ext.data.SimpleStore({fields:["name","dataURI"],data:[["Yes","true"],["No","false"]]})}),renderer:function(g,d,c,f,h,e){var b=c.get("obstruct");if(g==true){return"YES"}else{return"NO"}}},{header:"Pax",width:70,dataIndex:"maximumOccupancy",editor:new Ext.form.TextField({})},{header:"Total Price",width:80,dataIndex:"priceSell",editor:new Ext.form.TextField({}),renderer:function(e,d,a,f,c,b){return e}},{header:"Status",dataIndex:"status",width:80,fixed:true,editor:new Ext.form.ComboBox({excludeSubmit:true,minChars:1,enableKeyEvents:true,mode:"local",width:85,typeAhead:true,excludeFromSession:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:new Ext.data.SimpleStore({fields:["dataURI","name"],data:[["OK","OK"],["GTD","GTD"],["WL","WL"],["RQ","RQ"],["FS","FS"],["NA","NA"]]})}),renderer:function(e,d,a,f,c,b){return e}},{header:"Offer Expires",width:80,dataIndex:"expireDate",editor:new Ext.form.DateField({format:"dMy"}),renderer:Ext.util.Format.dateRenderer("dMy")}]),listeners:{beforerender:function(){},render:function(b){var c=[{nameString:"",maximumOccupancy:"",status:"",obstruct:"",dataURI:"",expireDate:"",position:"",totalPax:"",deckNo:"",priceSell:""}];console.log(this.findParentByType("awesomewindow").initialConfig.scope.findByType("button")[0].config.rateList);this.getStore().loadData(this.findParentByType("awesomewindow").initialConfig.scope.findByType("button")[0].config.rateList);var a=this.findParentByType("awesomewindow").initialConfig.scope.findByType("button")[0].config.offeringURI}}}]}]}]},{title:"Passengers",items:{xtype:"panel",layout:"form",border:false,labelWidth:120,defaults:{style:"padding: 2px 4px 2px 4px;"},listeners:{render:function(){this.findByType("label")[1].setText(this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").getDetail("supplierName"));this.findByType("label")[3].setText(TDS.util.Format.dateSpecial(this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").getDetail("updatedDate"),TDS.env.dateTimeFormatDisplay));var a=this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel").getDetail("cruisePackage");a?this.findByType("label")[5].setText("Cruise Package"):this.findByType("label")[5].setText("Cruise")}},items:[{xtype:"panel",layout:"table",style:" padding-left: 34px;padding-top:5px; ",border:false,layoutConfig:{columns:4},items:[{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Supplier :"},{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Supplier Name"},{xtype:"label",text:"Date/Time : ",style:"padding-left:400px;font-size: 12px;font-weight: bold;"},{xtype:"label",text:""}]},{xtype:"panel",layout:"table",style:" padding-left: 34px;padding-top:5px; ",border:false,layoutConfig:{columns:4},items:[{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Cruise :"},{xtype:"label",style:"font-size: 12px;font-weight: bold;",text:"Cruise Name"}]},{xtype:"panel",layout:"form",style:" padding-left: 10px;padding-top:5px; ",height:200,items:[{xtype:"editorgrid",id:"pass",height:200,border:false,enableHdMenu:false,viewConfig:{},stateful:true,stateId:"grid",store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","displayName","code","dateOfBirth","addressString","phoneNumber1","emailAddress","nameFirst","nameLast","gender","status","type"]}),getData:function(){var a=this.selModel.getSelections();var b=[];for(var c=0;c<a.length;c++){b[c]=a[c].get("dataURI")}return b},preselect:function(b,a){var c=[];this.getStore().each(function(d){if(c.length>=a){return false}if((!b||d.get("type")==b)&&d.get("nameFirst")&&d.get("nameLast")){c[c.length]=d}},this);if(c.length>0){this.getSelectionModel().selectRecords(c)}return c.length},validatePassenger:function(d,a,c,b){if(!b.get("nameFirst")&&!b.get("nameLast")){return false}},columns:[{header:"Last name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false}),renderer:function(e,b,a,d,f,c){return e.substr(0,1).toUpperCase()+e.substr(1)}},{header:"First name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false,fieldStyle:"text-transform:uppercase"}),renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"Type",dataIndex:"type",width:80,editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"Gender",dataIndex:"gender",renderer:TDS.util.Format.gender,width:100,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"DOB",dataIndex:"dateOfBirth",width:100,editor:new Ext.form.DateField({allowBlank:false}),renderer:function(a,d,c){if(typeof a!="undefined"){if(typeof a!="string"){var b=new Date();b.setTime(Ext.TimerMgr.getServerCalculatedTime());var e=Math.floor((b.getTime()-a.getTime())/(365.25*24*60*60*1000));c.set("paxAge",((e&&e>0)?e:""));return Ext.util.Format.date(a,TDS.env.dateBirthdayFormatDisplay)}else{if(c.get("paxAge")){var e=TDS.util.Format.age(a);c.set("paxAge",((e&&e>0)?e:""))}return TDS.util.Format.dateSpecial(a,TDS.env.dateBirthdayFormatDisplay)}}return TDS.util.Format.dateSpecial(a,TDS.env.dateBirthdayFormatDisplay)}},{header:"Age",dataIndex:"dateOfBirth",renderer:TDS.util.Format.age,width:80,editor:new Ext.form.TextField({allowBlank:false})},{header:"CR/PK",dataIndex:"cr",renderer:TDS.util.Format.age,width:80,editor:new Ext.form.TextField({allowBlank:false})},{header:"Price",dataIndex:"price",renderer:TDS.util.Format.age,width:80,editor:new Ext.form.TextField({allowBlank:false})},{header:"Status",dataIndex:"status",width:100,editor:new Ext.form.TextField({allowBlank:false})}],viewConfig:{forceFit:true},listeners:{beforerender:function(){},render:function(){var c=this.bottomToolbar;this.getSelectionModel().on("rowselect",function(){if(this.ownerCt.getSelections().length>0){c.items.itemAt(1).setDisabled(false)}},c);this.getSelectionModel().on("rowdeselect",function(){if(this.ownerCt.getSelections().length==0){c.items.itemAt(1).setDisabled(true)}},c);this.getEl().swallowEvent(["columnmove","columnresize","headerclick","click","mouseout","rowclick","rowmousedown","rowblclick","cellblclick","sortchange","mouseup","mousedown"]);var b=this.findParentByType("awesomewindow").initialConfig.scope.findParentByType("tabpanel");var a=b.getDetail("dataURI");Ext.Ajax.request({url:TDS.env.dataPath+a+"/passengers/collection/concise",method:"GET",callback:function(g,m,e){if(m){var k=Ext.util.JSON.decode(e.responseText);var j=k[a+"/passengers"];if(typeof j=="undefined"){return}var l=[];for(var h=0;h<j.length;h++){k[j[h]].dataURI=j[h];l.push(k[j[h]])}var f=this;var d=f.store;d.loadData(l);f.getView().refresh()}},scope:this})}}}]}]}},{title:"Extras",items:{xtype:"panel",layout:"form",border:false,labelWidth:140,items:[]}}]}]}