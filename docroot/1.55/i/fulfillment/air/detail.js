{xtype:"panel",border:false,layout:"column",bodyStyle:"padding: 8px;",items:[{columnWidth:1,xtype:"panel",layout:"column",border:false,getComponentPanel:function(){return this.items.itemAt(0).items.itemAt(0)},getPassengerPanel:function(){return this.items.itemAt(1).items.itemAt(0)},defaults:{columnWidth:0.5},items:[{xtype:"panel",layout:"column",bodyStyle:"padding: 4px;",defaults:{columnWidth:0.5},hideBorders:true,height:100,items:[{tpl:new Ext.XTemplate(["<p><b>Price:</b> {price}</p>","<p><b>Rate:</b> {quantity} x {rateName} ({rateCode})</p>","<p><b>Basis:</b> {groupName}</p>"])},{tpl:new Ext.XTemplate(["<p><b>Agent:</b> {agencyName}</p>","<p><b>Consultant:</b> {consultantName}</p>","<p><b>Date / Time:</b> {bookingDateTime}</p>"]),listeners:{render:function(){var a=this.ownerCt.findParentByType("tabpanel");var b=a.getComponentDetail("agencyURI");this.tpl.overwrite(this.body,{agencyName:TDS.util.Format.displayResourceName(b),consultantName:a.getComponentDetail("createdByUserFullNameString"),bookingDateTime:TDS.util.Format.dateSpecial(a.getComponentDetail("createdDate"),TDS.env.dateTimeFormatDisplay)})}}}]},{xtype:"panel",height:100,style:"padding-left: 4px; margin-left: 4px;",items:{border:false,tpl:new Ext.XTemplate(['<div style="padding: 4px;">','<table style="width: 100%;" cellspacing="0">','<tr style="background-color: #d0def0;">','<th style="padding: 2px;">Passenger</th>','<th style="padding: 2px;">Type</th>','<th style="padding: 2px;">DOB</th>','<th style="padding: 2px;">Age</th>',"</tr>",'<tpl for=".">',"<tr>",'<td style="padding: 2px;">{displayName}</td>','<td style="padding: 2px;">{code}</td>','<td style="padding: 2px;">{[TDS.util.Format.dateSpecial(values.dateOfBirth, TDS.env.dateBirthdayFormatDisplay)]}</td>','<td style="padding: 2px;">{[TDS.util.Format.age(values.dateOfBirth)]}</td>',"</tr>","</tpl>","</table>","</div>"])}}],hasInventory:false,hasPassengers:false,isReady:function(){if(this.hasPassengers&&this.hasInventory){return true}return false},initInventory:function(){var b=this.ownerCt.findParentByType("tabpanel");var a=b.getComponentDetail("dataURI");Ext.Ajax.request({url:TDS.env.dataPath+a+"/inventories/collection",method:"GET",callback:function(h,v,c){if(v){try{var l=Ext.decode(c.responseText)}catch(p){}if(l){var j=0,u,d=[];var q=l["component/inventory/collection"];var f=q[a+"/inventories"];if(f.length>0){for(var k=0;k<f.length;k++){var g=q[f[k]];if(!u){u=g.rateURI}j+=g.quantity;d[d.length]=TDS.util.Format.dateSpecial(g.date,TDS.env.dateFormatDisplay)}var t=l["component/rate/collection/"];var m=t["component/rate/collection/list"];var n=t[m[0]];b.inventoryData={quantity:j,rateURI:u,rateName:n.name,rateCode:n.code,groupName:n.groupName,dates:d,rateConditions:n.restrictions}}}this.hasInventory=true;if(this.isReady()){this.displayDetails()}}},scope:this})},initPassengers:function(){var c=this.ownerCt.findParentByType("tabpanel");var b=c.getComponentDetail("dataURI");var a=new Ext.data.CollectionStore({autoLoad:true,url:TDS.env.dataPath+b+"/passengers/collection/concise",identifier:b+"/passengers",fields:["type","code","nameFirst","nameLast","salutation","displayName","dateOfBirth"]});a.on("load",this.processPassengers,this)},processPassengers:function(b,a){var d=this.ownerCt.findParentByType("tabpanel");for(var c=0;c<a.length;c++){d.passengersData.add(a[c].data.dataURI,a[c].data)}delete b;this.hasPassengers=true;if(this.isReady()){this.displayDetails()}},displayDetails:function(){var b=this.ownerCt.findParentByType("tabpanel");var a=TDS.util.Price.calculateFixedGrossNettPrice({pricingPriceCurrency:b.getComponentDetail("pricingPriceCurrency"),pricingPriceSell:b.getComponentDetail("pricingPriceSell")});this.getComponentPanel().tpl.overwrite(this.getComponentPanel().body,Ext.apply({price:a.priceFormatted},b.getInventoryDetail()));this.getPassengerPanel().tpl.overwrite(this.getPassengerPanel().body,b.getPassengers());this.el.unmask()},listeners:{render:function(){this.el.mask("","x-mask-loading");this.initInventory();this.initPassengers()}}},{xtype:"panel",autoHeight:true,border:false,bodyStyle:"padding: 4px;",width:150,defaults:{minWidth:100},invokeWindow:function(b,c){if(!c){c={}}var e=this.ownerCt.findParentByType("tabpanel");var d=e.ownerCt;var a=e.getComponentDetail("dataURI");if(!a){return}Ext.apply(c,{title:"Edit",information:"You may edit the details of this component below.",interfaceURI:"fulfillment/air/edit.js",destinationDataURI:a,sourceDataURI:a,dataURI:{component:a,offering:e.getComponentDetail("offeringURI")},params:{status:b,priceCurrency:e.getComponentDetail("pricingPriceCurrency")},callback:{fn:function(f){if(f){d.refreshGrid()}},scope:this}});TDS.window.setWindow(c)},listeners:{render:function(){var c=this.items.itemAt(0);var g=this.items.itemAt(1);var d=this.items.itemAt(2);var b=this.items.itemAt(3);var e=this.items.itemAt(4);var f=this.ownerCt.findParentByType("tabpanel");var a=f.getComponentDetail("status");if(a.toLowerCase()==TDS.data.componentStatus.STATUS_HELD.toLowerCase()){g.show();d.show()}else{if(a.toLowerCase()==TDS.data.componentStatus.STATUS_REQUESTED.toLowerCase()){b.show();e.show()}else{if(a.toLowerCase()==TDS.data.componentStatus.STATUS_REJECTED.toLowerCase()){c.disable()}else{if(a.toLowerCase()==TDS.data.componentStatus.STATUS_CONFIRMED.toLowerCase()){d.show()}else{if(a.toLowerCase()==TDS.data.componentStatus.STATUS_CANCEL_REQUESTED.toLowerCase()){d.show()}else{if(a.toLowerCase()==TDS.data.componentStatus.STATUS_CANCELLED.toLowerCase()){c.disable()}}}}}}}},items:[{xtype:"button",text:"Edit",handler:function(){var a=this.ownerCt;a.invokeWindow("doNothing")}},{xtype:"button",text:"Confirm",hidden:true,handler:function(){var a=this.ownerCt;a.invokeWindow(TDS.data.componentStatus.STATUS_CONFIRMED)}},{xtype:"button",text:"Cancel",hidden:true,handler:function(){var a=this.ownerCt;a.invokeWindow(TDS.data.componentStatus.STATUS_CANCELLED)}},{xtype:"button",text:"Accept",hidden:true,handler:function(){var a=this.ownerCt;a.invokeWindow(TDS.data.componentStatus.STATUS_HELD)}},{xtype:"button",text:"Reject",hidden:true,handler:function(){var a=this.ownerCt;a.invokeWindow(TDS.data.componentStatus.STATUS_REJECTED)}},{xtype:"button",text:"Note",handler:function(){var b=this.ownerCt.findParentByType("tabpanel");var a=b.getComponentDetail("dataURI");TDS.window.setWindow({title:"Send a note",information:"Please enter your note below.",interfaceURI:"note.js",postDataURI:a+"/note",callback:{fn:function(c){},scope:this}})}}]}]}