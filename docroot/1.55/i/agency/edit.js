{xtype:"form",border:false,width:450,beforeSubmit:function(a){if(!this.ownerCt.initialConfig.isGroupAdmin){var d=this.items.itemAt(0).items.itemAt(4).items.itemAt(0);var f=d.getSelections();var b=d.mainStore;var e=[];for(var c=0;c<f.length;c++){e[c]=f[c].data.dataURI}var g=[];for(var c=0;c<b.length;c++){g[c]=b[c].data.dataURI}a.selectedGroupAgents=e;a.selectedGroupAgentsOldData=g}return a},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:545,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},listeners:{render:function(){if(!TDS.env.user.hasGroupPermission("ADMINISTRATION")){this.hideTabStripItem(2)}}},items:[{title:"Details",items:[{xtype:"panel",layout:"form",border:false,labelWidth:170,defaults:{style:"padding: 2px 4px 2px 4px;"},items:[{name:"name",width:280,border:false,listeners:{render:function(){var d=this.ownerCt.ownerCt.ownerCt.ownerCt;var c=d.ownerCt.aw.data.name;this.html="Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+c}}},{name:"agencyArenaCodeWithId",width:280,border:false,listeners:{render:function(){var d=this.ownerCt.ownerCt.ownerCt.ownerCt;var c=d.ownerCt.aw.data.agencyArenaCodeWithId;this.html="<br>ARENA code:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+(c?c:"")+"<br><br>"}}},{xtype:"combo",name:"homeCurrency",store:TDS.data.currencies,fieldLabel:"Home currency",width:180,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"value",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{value}</span></div></tpl>',value:"..."},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Accommodation:",width:175},{xtype:"textfield",name:"defaultCommissionAcco",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageAcco",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageAcc)}}},{xtype:"radio",name:"markUpAsPercentageAcc",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageAcc)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Services:",width:175},{xtype:"textfield",name:"defaultCommissionAttr",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageAttr",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageAttr)}}},{xtype:"radio",name:"markUpAsPercentageAttr",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageAttr)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Car:",width:175},{xtype:"textfield",name:"defaultCommissionCar",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageCar",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageCar)}}},{xtype:"radio",name:"markUpAsPercentageCar",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageCar)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Cruise:",width:175},{xtype:"textfield",name:"defaultCommissionCruise",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageCruise",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageCruise)}}},{xtype:"radio",name:"markUpAsPercentageCruise",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageCruise)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Air:",width:175},{xtype:"textfield",name:"defaultCommissionAir",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageAir",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageAir)}}},{xtype:"radio",name:"markUpAsPercentageAir",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageAir)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Rail:",width:175},{xtype:"textfield",name:"defaultCommissionRail",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageRail",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageRail)}}},{xtype:"radio",name:"markUpAsPercentageRail",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageRail)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Railpass:",width:175},{xtype:"textfield",name:"defaultCommissionRailpass",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageRailpass",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageRailpass)}}},{xtype:"radio",name:"markUpAsPercentageRailpass",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageRailpass)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Hostel:",width:175},{xtype:"textfield",name:"defaultCommissionHostel",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageHostel",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageHostel)}}},{xtype:"radio",name:"markUpAsPercentageHostel",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageHostel)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Day Tour:",width:175},{xtype:"textfield",name:"defaultCommissionSightseeing",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageSightseeing",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageSightseeing)}}},{xtype:"radio",name:"markUpAsPercentageSightseeing",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageSightseeing)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{border:false},items:[{html:"Commission Tour:",width:175},{xtype:"textfield",name:"defaultCommissionTour",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageTour",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageTour)}}},{xtype:"radio",name:"markUpAsPercentageTour",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageTour)}}}]},{xtype:"panel",style:"padding: 3px 0px 5px 0px;",border:false,layout:"table",layoutConfig:{columns:7},defaults:{border:false},items:[{html:"Commission Transfer:",width:175},{xtype:"textfield",name:"defaultCommissionTransfer",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{width:10},{xtype:"radio",name:"markUpAsPercentageTransfer",labelSeparator:"",boxLabel:"As Amount",inputValue:false,width:85,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.markUpAsPercentageTransfer)}}},{xtype:"radio",name:"markUpAsPercentageTransfer",labelSeparator:"",boxLabel:"As Percentage",inputValue:true,width:100,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.markUpAsPercentageTransfer)}}}]},{xtype:"textfield",name:"minimumCommissionPercent",fieldLabel:"Minimum commission %",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{xtype:"textfield",name:"defaultCommissionPercent",fieldLabel:"Default commission %",bodyStyle:"padding: 2px 4px 2px 4px;",width:40},{xtype:"textfield",name:"mobileCommissionPercent",fieldLabel:"Mobile Additional commission %",bodyStyle:"padding: 2px 4px 2px 4px;",width:40}]}]},{title:"Contact",layout:"form",items:[{xtype:"textfield",name:"addressLine1",fieldLabel:"Address",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textfield",name:"addressLine2",fieldLabel:"",labelSeparator:"",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textfield",name:"locality",fieldLabel:"Locality",bodyStyle:"padding: 2px 4px 2px 4px;",width:120},{xtype:"textfield",name:"state",fieldLabel:"State",bodyStyle:"padding: 2px 4px 2px 4px;",width:120},{xtype:"textfield",name:"postcode",fieldLabel:"Postcode",bodyStyle:"padding: 2px 4px 2px 4px;",width:60},{xtype:"combo",name:"countryURI",fieldLabel:"Country",emptyText:"Type a country...",minChars:1,enableKeyEvents:true,hideTrigger:true,mode:"local",width:160,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection/custom",identifier:"countries",fields:["name","dataURI"]})},{xtype:"textfield",name:"email",fieldLabel:"Email",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textfield",name:"phoneNumber",fieldLabel:"Phone number",bodyStyle:"padding: 2px 4px 2px 4px;",width:120},{xtype:"textfield",name:"fax",fieldLabel:"Fax",bodyStyle:"padding: 2px 4px 2px 4px;",width:120},{xtype:"textfield",name:"agentLicenceNo",fieldLabel:"Agent Licence No",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textfield",name:"licenceAuthority",fieldLabel:"Licence Authority",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textfield",name:"websiteTelephone",fieldLabel:"Licence Authority Website or Telephone No",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textarea",fieldLabel:"Industry Assoc. Membership",name:"associationMembership",height:45,width:185,labelSeparator:""}]},{title:"Components",items:{xtype:"panel",border:false,layout:"form",labelWidth:120,defaults:{xtype:"checkbox",labelSeparator:"",inputValue:"true"},items:[{name:"permittedComponentAccommodation",fieldLabel:"Permitted components",labelSeparator:":",boxLabel:"Accommodation",style:"overflow:auto;"},{name:"permittedComponentAttraction",boxLabel:"Services"},{name:"permittedComponentCar",boxLabel:"Car rental"},{name:"permittedComponentCruise",boxLabel:"Cruise"},{name:"permittedComponentFlight",boxLabel:"Air"},{name:"permittedComponentHostel",boxLabel:"Hostel"},{name:"permittedComponentRail",boxLabel:"Rail"},{name:"permittedComponentRailPass",boxLabel:"Rail Pass"},{name:"permittedComponentTour",boxLabel:"Tour"},{name:"permittedComponentTransfer",boxLabel:"Transfer"},{name:"permittedComponentSightseeing",boxLabel:"Day Tours"}]}},{title:"Itinerary",layout:"form",items:[{border:false,style:"padding-bottom: 2px;",html:"<p><b>Itinerary intro</b><br/>The intro appears as the first section on the itinerary.</p>"},{xtype:"textarea",name:"itineraryIntro",height:110,hideLabel:true,labelSeparator:"",anchor:"100%"},{border:false,style:"padding-bottom: 2px;",html:"<p><b>Itinerary outro</b><br/>The outro appears as the last section on the itinerary.</p>"},{xtype:"textarea",name:"itineraryOutro",height:110,hideLabel:true,labelSeparator:"",anchor:"100%"}]},{title:"Admin Groups",hidden:true,layout:"form",items:[{xtype:"grid",width:400,height:270,border:false,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,viewConfig:{forceFit:true},store:new Ext.data.JsonStore({id:"dataURI",fields:["dataURI","pinned","agencyArenaCode","name","locality","state","postcode","countryURI","homeCurrency","phoneNumber","email","createdDate","updatedDate","status","selected"]}),mainStore:new Ext.data.JsonStore({id:"dataURIOld",fields:["dataURI","pinned","agencyArenaCode","name","locality","state","postcode","countryURI","homeCurrency","phoneNumber","email","createdDate","updatedDate","status","selected"]}),sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Group name",dataIndex:"name",width:200},{header:"Status",dataIndex:"status",width:100,renderer:function(b,c,a){if(a.get("status")=="A"){return"Active"}else{if(a.get("status")=="C"){return"Canceled"}else{if(a.get("status")=="S"){return"Suspend"}else{if(!a.get("selected")){return""}else{return"In Active"}}}}}}],listeners:{beforerender:function(){if(!TDS.env.user.isAgencyGroupAdmin()||TDS.env.user.hasGroupPermission("ADMINISTRATION")){var c=this.ownerCt.ownerCt.ownerCt.ownerCt.initialConfig.sourceDataURI;var b=TDS.env.dataPath+c+"/adminAgency/collection";Ext.Ajax.request({url:b,method:"GET",callback:function a(l,e,g){var f=Ext.util.JSON.decode(g.responseText);var k=f.adminAgencies;if(typeof k=="undefined"){return}var j=[];for(var d=0;d<k.length;d++){f[k[d]].dataURI=k[d];j.push(f[k[d]])}var h=this.store;h.loadData(j);for(var d=0;d<h.data.items.length;d++){if(h.data.items[d].data.selected){this.getSelectionModel().selectRow(d,true,false)}}this.mainStore=this.getSelections()},scope:this});if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){this.selModel.locked=false}else{if(!TDS.env.user.isAgencyGroupAdmin()){this.selModel.locked=true;this.getColumnModel().setHidden(0,true)}}}}}}]}],listeners:{beforerender:function(){if(this.ownerCt.ownerCt.initialConfig.isGroupAdmin){this.remove(this.items.itemAt(4),true)}}}}]}