{xtype:"form",border:false,autoScroll:true,bodyStyle:"padding: 8px;",getDataURI:function(){return this.ownerCt.ownerCt.getDataURI()},getSessionURI:function(){return this.ownerCt.ownerCt.getSessionURI()},getSessionValue:function(a){return this.ownerCt.ownerCt.getSession(a)},getFormData:function(){var a=this.ownerCt.findParentByType("stdpanel");return a.getAjaxPanel().getData()},reloadData:function(){var a=this.ownerCt.findParentByType("stdpanel");a.getAjaxPanel().reloadData({callback:function(b,c,d){this.getForm().setValues(d)},scope:this});this.getForm().setValues(a.getAjaxPanel().getData())},listeners:{render:function(){var a=this.ownerCt.findParentByType("stdpanel");this.getForm().setValues(a.getAjaxPanel().getData())}},items:[{xtype:"panel",border:false,hideBorders:true,height:300,layout:"column",items:[{columnWidth:0.6,bodyStyle:"padding-right: 8px;",items:{xtype:"fieldset",title:"Details",collapsible:true,cls:"x-tds-offering",autoHeight:true,labelWidth:120,defaults:{autoWidth:true,height:21,isFormField:true,getName:function(){return this.name},setValue:function(c){if(this.renderer&&typeof this.renderer=="function"){c=this.renderer(c)}else{if(this.name.substring(this.name.length-3)=="URI"){var d=TDS.data.getStoreNameByResourceDataURI(c);var a=TDS.data.findRecordBy(d,"dataURI",c);if(a!=-1){c=a.get("name")}}}var b=this.allowHTML?false:true;this.setText(c,b)},getValue:Ext.emptyFn},bbar:[{xtype:"redbutton",text:"Edit",handler:function(){var e=this.ownerCt.findParentByType("form");var d=e.getDataURI();var c=e.getFormData();var b=c.groupAdministrator;if(!d){return}TDS.window.setWindow({title:"Edit agency",interfaceURI:"agency/edit.js",sourceDataURI:d,destinationDataURI:d,isGroupAdmin:b,buttonOK:"Submit",callback:{fn:function(a){if(a){this.reloadData()}},scope:e}})}}," ",{xtype:"redbutton",text:"Logos",handler:function(){var e=this.ownerCt.findParentByType("form");var d=e.getDataURI();var c=e.getFormData();var b=c.groupAdministrator;if(!d){return}TDS.window.setWindow({title:"Edit agency",interfaceURI:"agency/logos.js",sourceDataURI:d,destinationDataURI:d,isGroupAdmin:b,buttonOK:"Submit",callback:{fn:function(a){if(a){this.reloadData()}},scope:e}})}}],items:[{xtype:"label",name:"name",fieldLabel:"Name"},{xtype:"label",name:"agencyArenaCodeWithId",fieldLabel:"ARENA code"},{xtype:"label",name:"homeCurrency",fieldLabel:"Home currency",renderer:function(b){var a=TDS.data.currencies.getById(b);if(typeof a!="undefined"){return a.get("text")}return b}},{xtype:"label",name:"defaultCommissionPercent",fieldLabel:"Default commission",renderer:function(a){return a.toFixed(2)+"%"}},{xtype:"label",name:"minimumCommissionPercent",fieldLabel:"Minimum commission",renderer:function(a){return a.toFixed(2)+"%"}},{xtype:"label",name:"addressString",fieldLabel:"Address",autoWidth:true},{xtype:"label",name:"email",fieldLabel:"Email"},{xtype:"label",name:"phoneNumber",fieldLabel:"Phone number"},{xtype:"label",name:"fax",fieldLabel:"Fax"},{xtype:"label",name:"availablemobile",fieldLabel:"Available on mobile",renderer:TDS.util.Format.booleanRenderer},{xtype:"label",name:"permittedComponentString",fieldLabel:"Permitted components"}]}},{columnWidth:0.4,layout:"fit",bodyStyle:"padding-right: 6px;",items:{xtype:"fieldset",title:"Bank Deposit Details",collapsible:true,cls:"x-tds-offering",autoHeight:true,labelWidth:120,defaults:{isFormField:true,getName:function(){return this.name},setValue:function(c){if(this.renderer&&typeof this.renderer=="function"){c=this.renderer(c)}else{if(this.name.substring(this.name.length-3)=="URI"){var d=TDS.data.getStoreNameByResourceDataURI(c);var a=TDS.data.findRecordBy(d,"dataURI",c);if(a!=-1){c=a.get("name")}}}var b=this.allowHTML?false:true;this.setText(c,b)},getValue:Ext.emptyFn},getCreditCards:function(){var c=this.items.itemAt(9);var d=this.ownerCt.findParentByType("form");var b=d.getDataURI();if(!b){return}Ext.Ajax.request({url:TDS.env.dataPath+b+"/creditCards/collection",method:"GET",callback:function(j,f,g){if(f){var a=b+"/creditCards";var i=Ext.decode(g.responseText);var h=i[a];if(!h){return}var e=TDS.util.collectionToEnglishSentenceList({collection:h,data:i,fieldName:"displayName"});if(e){c.setText(e)}}},scope:c})},bbar:[{xtype:"redbutton",text:"Edit",handler:function(){var c=this.ownerCt.findParentByType("form");var a=this.ownerCt.findParentByType("fieldset");var b=c.getDataURI();TDS.data.supplierURI=b;if(!b){return}TDS.window.setWindow({title:"Edit financials",interfaceURI:"agency/financial.js",sourceDataURI:b,destinationDataURI:b,buttonOK:"Submit",helpTitel:"Bank details Help",helpId:"9",callback:{fn:function(d){if(d){this.reloadData()}},scope:c}})}}],items:[{xtype:"label",name:"financialContactName",fieldLabel:"Contact name"},{xtype:"label",name:"financialContactPhoneNumber",fieldLabel:"Contact phone number"},{xtype:"label",name:"financialInstitution",fieldLabel:"Bank name"},{xtype:"label",name:"financialAccountName",fieldLabel:"Account name"},{xtype:"label",name:"financialAccountBSB",fieldLabel:"BSB/Bank Code",width:80},{xtype:"label",name:"financialAccountIBAN",fieldLabel:"IBAN Code",width:80},{xtype:"label",name:"financialAccountNumber",fieldLabel:"Account number",width:200},{xtype:"label",name:"financialSwiftCode",fieldLabel:"SWIFT code",width:200},{xtype:"label",name:"financialCountryURI",fieldLabel:"Country",renderer:TDS.util.Format.displayResourceNameRenderer(),width:200},{xtype:"label",name:"bitcoinAddress",fieldLabel:"BITCOIN Address",width:200},{label:"",height:40,border:false,labelSeparator:"",width:200}]}}]},{xtype:"panel",border:false,hideBorders:true,layout:"column",height:300,items:[{columnWidth:0.6,bodyStyle:"padding-right: 8px;",items:{xtype:"panel",border:false,hideBorders:true,items:{xtype:"fieldset",title:"Staff",border:false,collapsible:true,cls:"x-tds-offering",layout:"fit",height:270,items:{xtype:"awesomegrid",width:290,pinnable:true,enableRowExpander:false,tbar:["Name: ",{xtype:"textfield",name:"nameLike",enableKeyEvents:true,width:120}," ","Email: ",{xtype:"textfield",name:"emailLike",enableKeyEvents:true,width:120},"-","  ","",{xtype:"tbfill"},{xtype:"redbutton",text:"Create",handler:function(){var d=this.ownerCt.ownerCt;var c=this.ownerCt.findParentByType("form");var b=c.getFormData();console.log("@@@@@@");console.log(b);console.log(b.noOfUserPermitted);console.log(b.noOfAgencyUsers);console.log(b.arenaOne);if((b.noOfUserPermitted<=b.noOfAgencyUsers)&&b.arenaOne){return}var c=this.ownerCt.findParentByType("form");TDS.window.setWindow({title:"Agency user",information:"Please enter details of a new agency user.",interfaceURI:"agency/user/create.js",helpTitel:"Add staff Help",helpId:"10",postDataURI:c.getDataURI()+"/users",callback:{fn:function(a){if(a){d.submitQuery(true);b.noOfAgencyUsers+=1}},scope:d}})}}," ",{xtype:"button",text:"Archive",handler:function(){var c=this.ownerCt.ownerCt;var b=c.selModel.getSelected();if(!b){return}var a=b.get("dataURI");TDS.window.setWindow({title:"Archive agency user",message:"Are you sure you want to archive this agency user?",destinationDataURI:a,data:{archived:true},callback:{fn:function(d){if(d){c.submitQuery(true)}},scope:c}})}}],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","pinned","salutation","nameFirst","nameLast","emailAddress"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Title",dataIndex:"salutation",width:60,fixed:true,sortable:true},{header:"Name",dataIndex:"nameFull",sortable:true,renderer:function(c,b,a){return a.get("nameFirst")+" "+a.get("nameLast")}},{header:"Email",dataIndex:"emailAddress",sortable:true}]),viewConfig:{forceFit:true},listeners:{render:function(){var c=this.ownerCt.findParentByType("form");var b=c.getFormData();if(b.arenaOne){if(b.noOfUserPermitted==""||b.noOfUserPermitted==null){b.noOfUserPermitted=0}this.topToolbar.items.itemAt(7).td.innerHTML="    Max "+b.noOfUserPermitted+" users.    "}},sessioninit:function(){var a=this.ownerCt.findParentByType("form");this.sessionURI=a.getSessionURI()+"/users";this.searchURI=TDS.env.dataPath+a.getDataURI()+"/users"},rowdblclick:function(c,f,d){var b=c.getStore().getAt(f);if(!b){return}var a=b.get("dataURI");TDS.window.setWindow({title:"Edit agency user",interfaceURI:"agency/user/edit.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",callback:{fn:function(e){if(e){this.submitQuery(true)}},scope:c}})}}}}}},{columnWidth:0.4,layout:"fit",items:{xtype:"fieldset",title:"Transaction types",collapsible:true,cls:"x-tds-offering",height:250,layout:"fit",items:{xtype:"awesomegrid",autoHeight:false,height:180,loadMask:{msg:""},bbar:[{xtype:"tbfill"},{xtype:"redbutton",text:"Add",handler:function(){var c=this.ownerCt.ownerCt;var b=this.ownerCt.findParentByType("form");var a=b.getDataURI();if(!a){return}TDS.window.setWindow({title:"Add transaction type",interfaceURI:"agency/transaction/create.js",postDataURI:a+"/transactionTypes",buttonOK:"Submit",callback:{fn:function(d){if(d){this.submitQuery(true)}},scope:c}})}},{xtype:"button",text:"Remove",disabled:true,handler:function(){var a=this;var d=this.ownerCt.ownerCt;var c=d.selModel.getSelected();if(!c){return}d.loadMask.show();Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+c.get("dataURI"),callback:function(f,b,e){d.loadMask.hide();if(b){d.store.remove(c);a.setDisabled(true)}}})}}],store:new Ext.data.JsonStore({id:"dataURI",fields:["dataURI","code","name","description","amount","credit","currency"]}),processCollectionData:function(c){var b=c[this.getCollectionIdentifier()];for(var a=0;a<b.length;a++){var d=c[b[a]];d.currency=this.homeCurrency}return c},cm:new Ext.grid.ColumnModel([{header:"Code",dataIndex:"code",sortable:true,width:50,fixed:true},{header:"Name",dataIndex:"name",sortable:true},{header:"Description",dataIndex:"description"},{header:"Amount",dataIndex:"amount",sortable:true,width:80,fixed:true,renderer:TDS.util.Price.amountRenderer}]),viewConfig:{forceFit:true,scrollOffset:19,emptyText:"No transaction types exist."},listeners:{render:function(){this.getSelectionModel().on("rowselect",function(){this.items.itemAt(2).setDisabled(false)},this.getBottomToolbar());this.getSelectionModel().on("rowdeselect",function(){this.items.itemAt(2).setDisabled(true)},this.getBottomToolbar())},beforerender:function(){var b=this.ownerCt.findParentByType("stdpanel");this.homeCurrency=b.getAjaxPanel().getData("homeCurrency");var a=this.ownerCt.findParentByType("form");this.searchURI=TDS.env.dataPath+a.getDataURI()+"/transactionTypes";this.overrideCollectionIdentifier=a.getDataURI()+"/transactionTypes"},rowdblclick:function(c,f,d){var b=c.getStore().getAt(f);if(!b){return}var a=b.get("dataURI");TDS.window.setWindow({title:"Edit transaction type",interfaceURI:"agency/transaction/edit.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",callback:{fn:function(e){if(e){this.submitQuery(true)}},scope:c}})}}}}},{columnWidth:0.4,items:{xtype:"panel",border:false,hidden:true,layout:"fit",hideBorders:true,items:{xtype:"fieldset",title:"Merchant details",border:false,collapsible:true,height:180}}}]}]}