{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 8px;",autoScroll:true,getDataURI:function(){return this.getAgencyDataURI()},getAgencyDataURI:function(){if(TDS.env.user.isAgencyUser()){return TDS.env.user.getAgencyURI()}},items:{xtype:"awesomegrid",pinnable:true,enableRowExpander:false,iconCls:"icon-grid",tbar:["Date Filters: ",{xtype:"datefield",name:"dateFromStart",enableKeyEvents:true,showToday:false,format:"dMy",width:120}," ",{xtype:"datefield",name:"dateFromEnd",enableKeyEvents:true,showToday:false,format:"dMy",width:120}," ","PNR: ",{xtype:"textfield",name:"pnrCode",enableKeyEvents:true,width:120}," ","Consultant: ",{xtype:"combo",name:"consultant",emptyText:"ALL",enableKeyEvents:true,mode:"local",width:195,triggerAction:"all",excludeFromSession:true,displayField:"fullNameString",valueField:"dataURI",store:new Ext.data.SimpleStore({storeId:"commonStore",fields:["fullNameString","dataURI"],data:[]}),appendData:[{fullNameString:"",dataURI:""}],listeners:{render:function(){;var a=this;setTimeout(function(){var b=a.ownerCt.ownerCt.ownerCt.getAgencyDataURI();var d=b;if(!b){return}a.store.removeAll();var c=TDS.data.getStore({dataURI:TDS.env.dataPath+d+"/users/collection",identifier:d+"/users",fields:["fullNameString","dataURI"]});a.bindStore(c)},300)}}}," ","Lead Name: ",{xtype:"textfield",name:"primaryPassnger",enableKeyEvents:true,width:120}," ","Hide Zero Balances",{xtype:"checkbox",name:"zeroBalance"},"->","Show only Archived",{xtype:"checkbox",name:"showUnArchivedOnly",handler:function(){;var a=this.ownerCt.ownerCt.topToolbar;a.items.itemAt(20).disable(true);if(this.checked){a.items.itemAt(20).setText("Restore PNR")}else{a.items.itemAt(20).setText("Archive PNR")}}}," ",{xtype:"button",text:"Archive PNR",disabled:true,handler:function(){;var f=this.ownerCt.findParentByType("ajaxpanel");var c=f.baseDataURI;var e=this.ownerCt.ownerCt;var b=e.getSelections();var g=b[0].data.dataURI;var h=this.getText();var d=!(e.topToolbar.items.itemAt(18).checked);TDS.window.setWindow({title:h,message:"Are you sure you want to "+h+' "'+g+'" ?',destinationDataURI:c+"/"+g+"/archive?archiveOrUnarchive="+d,data:{archived:true},callback:{fn:function(a){if(a){e.submitQuery(true)}},scope:e}})}}," ",{xtype:"button",text:"Print",winExist:false,a:"",handler:function(){;var o=this.ownerCt.ownerCt.getTopToolbar();var B=o.items.itemAt(1).getValue().format(TDS.env.dateFormat);var C=TDS.util.Format.dateSpecial(B,TDS.env.dateFormatDisplay);var A=o.items.itemAt(3).getValue().format(TDS.env.dateFormat);var q=TDS.util.Format.dateSpecial(A,TDS.env.dateFormatDisplay);var k=this.ownerCt.ownerCt.getStore();var E=k.data.items;if(!this.winExist){this.winExist=true;var J=window.open("","Terms Priview","height=500,width=1800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes");var K=this;var G="";var F="";var y="";var l=0;var n=0;var c=0;var x="";var e='<tr><th colspan="9" rowspan="1" width="100%"><b><u>BOOKING MARGINS REPORT<u><b></th></tr><tr><th colspan="9" width="100%"></th></tr>';var h='<tr><th align="left" colspan="3" width="100%">'+C+" to "+q+"</th></tr>";G='<tr bgcolor="#000000"><th width="7%"><font color="white" size="2">Dep Date</font><br></th><th width="6%"><font color="white" size="2">PNR <br>No</font></th><th width="20%"><font color="white" size="2">Lead Name</font></th><th width="5%"><font color="white" size="2">No  of <br>Pax</font></th><th width="10%"><font color="white" size="2"> Gross <br>Amount</font></th><th width="5%"><font color="white" size="2">Min <br> %</font></th><th width="10%"><font color="white" size="2">Margin <font><br></th><th width="2%"><font color="white" size="2">Actual <br> %</font></th><th width="10%"><font color="white" size="2">Outstanding <br> Balance</font></th><th width="25%"><font color="white" size="2">Consultant </font><br></th></tr>';for(var D=0;D<E.length;D++){x=E[D].data.currency;var f=E[D].data.currency;var H=E[D].data.grossTotal;var m=E[D].data.marginTotal;var w=E[D].data.owingAmount;var b=E[D].data.code;var z=E[D].data.departuresDate;var s=TDS.util.Format.dateSpecial(z,TDS.env.dateFormatDisplay);var j=E[D].data.passengersTotal;var v=E[D].data.primaryPassnger;var I=E[D].data.updatedByUserFullName;var p=E[D].data.mpercentage;var d=E[D].data.percentageCommision;if(typeof H=="undefined"||H==""){}if(typeof m=="undefined"||m==""){}if(typeof w=="undefined"||w==""){}if(typeof d=="undefined"||d==""){d=0}var H=E[D].data.grossTotal;var m=E[D].data.marginTotal;var w=E[D].data.owingAmount;if(typeof H!="undefined"&&H!=""){l+=H}else{H=0}if(typeof m!="undefined"&&m!=""){n+=m}else{m=0}if(typeof w!="undefined"&&w!=""){c+=w}else{w=0}F+='<tr><td width="7%" align="center"><font size="2">'+s+'</font></td><td width="6%" align="center"><font size="2">'+b+'</font></td><td width="20%"><font size="2">'+v+'</font></td><td width="5%" align="center"><font size="2">'+j+'</font></td><td width="10%"><font size="2">'+f+" "+H+'</font></td><td width="5%"><font size="2">'+p+'</font></td><td width="10%"><font size="2">'+f+" "+m+'</font></td><td width="2%" align="center"><font size="2">'+d+'</font></td><td width="10%"><font size="2">'+f+" "+w+'</font></td><td width="25%"><font size="2">'+I+"</font></td></tr>"}y='<tr><th width="7%">&nbsp;</th><th width="6%">&nbsp;</th><th width="20%">&nbsp;</th><th width="5%">&nbsp;</th><th width="10%" align="left"><font size="2">'+x+" "+l+'</font></th><th width="5%">&nbsp;</th><th width="10%" align="left"><font size="2">'+x+" "+n+'</font></th><th width="2%">&nbsp;</th><th width="10%" align="left"><font size="2">'+x+" "+c+'</font></th><th width="25%">&nbsp;</th></tr>';var r='<table style="width:100%;">'+e+h+"</table> ";var u='<table  cellspacing="0" border=1 style="width:100%;border-style:solid;">'+G+F+y+"</table> ";J.document.write(r+u);J.location.reload();J.focus();J.print();J.close();this.winExist=false}else{J.focus()}}}],summaryCurrency:undefined,processCollectionData:function(c){var b=c[this.getCollectionIdentifier()];if(typeof b!="undefined"){for(var a=0;a<b.length;a++){var d=c[b[a]].currency;if(typeof this.summaryCurrency=="undefined"&&this.summaryCurrency!=""){this.summaryCurrency=d}}return c}},store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","pinned","agencyURI","departuresDate","primaryPassnger","code","passengersTotal","mpercentage","marginTotal","percentageCommision","owingAmount","currency","grossTotal","updatedByUserFullName"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Dep Date",dataIndex:"departuresDate",sortable:true,width:60,fixed:true,renderer:function(c,b,a){var e=TDS.util.Format.dateSpecial(c,TDS.env.dateFormatDisplay);return e}},{header:"PNR No",dataIndex:"code"},{header:"Lead Name",dataIndex:"primaryPassnger"},{header:"No of Pax",dataIndex:"passengersTotal"},{header:"Gross Amount",dataIndex:"grossTotal",summaryType:"sum",renderer:TDS.util.Price.amountRenderer},{header:"Min %",dataIndex:"mpercentage"},{header:"Margin",dataIndex:"marginTotal",summaryType:"sum",renderer:TDS.util.Price.amountRenderer},{header:"Actual %",dataIndex:"percentageCommision"},{header:"Outstanding Balance",dataIndex:"owingAmount",summaryType:"sum",renderer:TDS.util.Price.amountRenderer},{header:"Consultant",dataIndex:"updatedByUserFullName"}]),plugins:new Ext.ux.grid.GridSummary({processSummaryData:function(f){;var e=f;var c=this;if(typeof this.grid!="undefined"&&this.grid.summaryCurrency){f.data.currency=this.grid.summaryCurrency;return f}return{data:{}}}}),viewConfig:{forceFit:true},listeners:{sessioninit:function(){var b=this.ownerCt.findParentByType("ajaxpanel");var a=b.baseDataURI;this.searchURI=TDS.env.dataPath+a+"/report"},render:function(){;this.getSelectionModel().on("rowselect",function(){this.items.itemAt(20).setDisabled(false);this.items.itemAt(20).setDisabled(false)},this.getTopToolbar());this.getSelectionModel().on("rowdeselect",function(){this.items.itemAt(20).setDisabled(true);this.items.itemAt(20).setDisabled(true)},this.getTopToolbar())}}}}