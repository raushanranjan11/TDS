{xtype:"panel",border:false,requireStores:[{dataURI:TDS.env.dataPath+"rate/classes/collection",identifier:"rate/classes",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"rate/occupancies/collection",identifier:"rate/occupancies",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"rate/pers/collection",identifier:"rate/pers",fields:["name","dataURI"]}],findField:function(b){var a=false;this.getRateToolbar().items.each(function(c){if(c.name==b){a=c;return true}});return a},getRateGrid:function(){return this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0)},getRateToolbar:function(){return this.items.itemAt(0).items.itemAt(0).items.itemAt(0).getTopToolbar()},getSelectedRateURI:function(){var a=this.getRateGrid().getSelectionModel().getSelected();if(typeof a!="undefined"){return a.get("dataURI")}return false},focusBookTab:function(){var g=this.findParentByType("tabpanel");var j=g.getTabField("Book","datePointer");var h=g.getTabField("Book","dateDays");var e=g.getTabField("Book","numberToReserve");var i=this.findField("datePointer");var f=this.findField("dateDays");var d=this.findField("minimumAvailable");if(j&&i){j.setValue(i.getValue())}if(h&&f){h.setValue(f.getValue())}if(e&&d){e.setValue(d.getValue())}var b=g.getTabField("Book","rateURI");var c=this.getSelectedRateURI();if(b&&c){b.setValue(c)}var a=g.getTab("Book");if(a){a.setNumberOfRatePerFieldByRateURI(c);a.submit()}g.setActiveTab(2)},items:{xtype:"panel",layout:"column",bodyStyle:"padding: 8px;",border:false,items:[{xtype:"panel",border:false,height:150,width:700,items:[{xtype:"awesomepanel",height:136,layout:"fit",searchURI:"",store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI","nameString","agencyURI","code","railSeat","railClass","maximumOccupancy","groupName","inventoryAvailable","queueRequestable","special","available","conversionCurrency","convertedPricingPriceSell","convertedPricingPriceIsNett","convertedPricingPriceCommission","rateClassURI","ratePerURI","rateOccupancyURI","minimumAvailable","suppierPricing","homeCurrency"]}),tbar:["Price from ",{xtype:"textfield",name:"amountLower",enableKeyEvents:true,width:60}," ","Class:",{xtype:"combo",name:"rateClassURI",mode:"local",width:110,triggerAction:"all",editable:false,displayField:"name",valueField:"name",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.railClasses,appendData:[{name:"All",dataURI:""}]}," ","No of Pax",{xtype:"omnicrementer",name:"minimumAvailable",width:60,value:1,minValue:1,maxValue:7}," ","Available"," ",{xtype:"datefield",name:"datePointer",enableKeyEvents:true,showToday:false,width:80,format:"dMy",minValue:Ext.TimerMgr.getServerCalculatedDate().clearTime()},"&plusmn;",{xtype:"omnicrementer",name:"dateDays",width:60,editable:false}," ","days"],items:[{xtype:"grid",width:500,border:false,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,viewConfig:{forceFit:true},sm:new Ext.grid.RowSelectionModel(),columns:[{header:"Rate",dataIndex:"nameString",width:90,fixed:true,renderer:function(c,b,a){if(a.get("special")){b.attr='style="color: red;"'}else{if(a.get("agencyURI")!=""){b.attr='style="color: blue;"'}}return c}},{header:"Code",dataIndex:"code",width:50,fixed:true},{header:"Basis",dataIndex:"groupName",width:100,fixed:true},{header:"Seat",dataIndex:"minimumAvailable",width:60,fixed:true,renderer:function(b,c,a){return b}},{header:"Cabin",dataIndex:"railSeat",width:60,fixed:true,renderer:function(b,c,a){;if(b==null||b=="0"){return""}return b}},{header:"Class",dataIndex:"railClass",width:70,fixed:true,renderer:function(b,c,a){return b}},{header:"Gross Price",dataIndex:"convertedPricingPriceSell",width:75,renderer:TDS.util.Price.conversionGrossNettPriceRenderer},{header:"Supplier's Curr",editable:false,dataIndex:"suppierPricing",width:75,fixed:true,renderer:function(e,d,a,f,c,b){return TDS.util.Price.formatPrice(a.get("suppierPricing"),a.get("homeCurrency"))}},{header:"Status",dataIndex:"available",width:80,fixed:true,renderer:function(b,c,a){return b}}],listeners:{beforerender:function(){this.store=this.ownerCt.store},render:function(){this.getEl().swallowEvent(["columnmove","columnresize","headerclick","click","mouseout","mouseover","rowclick","rowmousedown","sortchange","mouseup","mousedown"])},rowclick:function(k,i,g){g.stopPropagation();var d=this.getStore().getAt(i);if(d==-1){return}var c={rate:d.data};var b=this.ownerCt.findParentByType("ajaxpanel");var h=this.ownerCt.findParentByType("tabpanel");var f=h.getPNRCurrency();var a=this.ownerCt.ownerCt.ownerCt.items.itemAt(2);a.el.mask("","x-mask-loading");var j=new Ext.data.CollectionStore({autoLoad:true,url:TDS.env.dataPath+b.baseDataURI+"/searchExtras/collection?rateURI="+d.get("dataURI")+"&currency="+f,identifier:b.baseDataURI+"/searchExtras?rateURI="+d.get("dataURI")+"&currency="+f,fields:["dataURI","nameString","termsAndConditions","groupName","required","minimumInventoryRequired","conversionCurrency","convertedPricingPriceSell","convertedPricingPriceIsNett","convertedPricingPriceCommission"]});j.on("load",function(u,n){c.extras=[];TDS.data[d.get("dataURI")]=[];var s=d.get("dataURI");for(var p=0;p<n.length;p++){n[p].data.rateURI=s;n[p].data.doWork="if(this.checked){TDS.data['"+s+"'].push(this.value);}else{TDS.data['"+s+"'].pop(this.value);}";c.extras[p]=n[p].data;Ext.apply(c.extras[p],TDS.util.Price.calculateGrossNettPrice(c.extras[p]))}var r=a.items.itemAt(0);var o=a.items.itemAt(1);var q=a.items.itemAt(2);var e=q.items.itemAt(1);var m=q.items.itemAt(0);var l=a.items.itemAt(3);r.hide();if(c.extras.length>0){l.tpl.overwrite(l.body,c.extras)}e.extras=c.extras;e.show();m.show();a.el.unmask()},this)}}}],listeners:{toolbarinit:function(){var c=this.ownerCt.findParentByType("awesomegrid");var h=this.ownerCt.findParentByType("tabpanel");var e=c.findField("datePointer"),g=c.findField("dateDays");var a=this.getTopToolbar().items.itemAt(9);var d=this.getTopToolbar().items.itemAt(11);var f=this.getTopToolbar().items.itemAt(13);if(e){d.setValue(e.getValue())}if(g){f.setValue(g.getValue())}this.searchURI=TDS.env.dataPath+h.getDetail("offeringURI")+"/searchRates";this.appendQueryParams.currency=h.getPNRCurrency();var b=h.shared.stores.rates;this.getStore().on("load",function(j,i){b.removeAll();b.add(i)})}}},{border:false,html:'<p style="font-size: 9px; padding-top: 4px;">* Rates that appear highlighted red are <b style="color: red;">special</b> rates.</p>'}]},{xtype:"panel",height:300,width:200,border:false,layout:"table",layoutConfig:{columns:1},items:[{xtype:"panel",height:190,width:200,border:false,tpl:new Ext.XTemplate(["<div  >",'<table style="width:100%; cellpadding:5px;border: 1px solid grey; border-collapse: collapse;">',"<tr>",'<td style="border: 1px solid grey; border-collapse: collapse; height:15px "  >Fare</td><td style="border: 1px solid grey; border-collapse: collapse; " >{nameString} </td></tr>','<tr><td  style="border: 1px solid grey; border-collapse: collapse; height:15px">Booking Fare</td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px">Tax</td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px">Meals</td><td></td style="border: 1px solid grey; border-collapse: collapse; "></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px "> </td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px"> </td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px"> </td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px"> </td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px"> </td><td style="border: 1px solid grey; border-collapse: collapse; "></td></tr>','<tr><td style="border: 1px solid grey; border-collapse: collapse; height:15px ">Total</td><td style="border: 1px solid grey; border-collapse: collapse; ">{totalFare}</td></tr>',"</table></div>"]),listeners:{render:function(){this.tpl.overwrite(this.body,data)}}}]},{xtype:"panel",cls:"x-tds-rate-table",columnWidth:1,layout:"table",layoutConfig:{columns:2},height:150,bodyStyle:"padding-left: 8px;",hideBorders:true,border:false,items:[{html:"<p>Select a rate to view more details and available extras.</p>",colspan:2},{colspan:2,hidden:true,tpl:new Ext.XTemplate(["<p>{groupName}</p>"])},{xtype:"panel",layout:"table",width:160,colspan:2,layoutConfig:{columns:2},defaults:{style:"padding-left: 2px;",minWidth:80},items:[{xtype:"formredbutton",text:"Select",hidden:true,handler:function(){var a=this.ownerCt.ownerCt.ownerCt.ownerCt;a.focusBookTab()}},{xtype:"button",text:"Notes",extras:[],hidden:true,handler:function(){var c=this.ownerCt.ownerCt.ownerCt.ownerCt;var a=c.getSelectedRateURI();if(!a){return}var d=this.ownerCt.ownerCt.findParentByType("tabpanel");var b=d.getTabField("Rate","datePointer");TDS.window.setWindow({title:"Notes",interfaceURI:"popup/terms.js",sourceDataURI:a,extras:this.extras,data:{offeringData:d.ownerCt.ownerCt.rowRecordData,departureDate:b.getRawValue()},buttonOK:false,buttonCancel:"Close"})}}]},{colspan:2,tpl:new Ext.XTemplate(['<div style="height: 95px; overflow-x:hidden; margin-top: 8px;">','<table class="x-tds-dataview" style="width: 100%;">',"<thead>","<tr>",'<th style="width: 20px; padding-bottom: 2px;"></th>','<th style="padding-bottom: 2px;">Extra</th>','<th style="width: 30px; padding-bottom: 2px;">No.</th>','<th style="width: 120px; padding-bottom: 2px;">Pricing</th>',"</tr>","</thead>",'<tpl for=".">','<tr class="x-tds-dataview-extras-item">','<td ><input type="checkbox" id = "{rateURI}{dataURI}" value="{dataURI}" {[values.required ?  "disabled checked" : "" ]} onclick={doWork}></td>','<td style="width: 140px;{[values.required ? " color: gray;" : "" ]}">{nameString}</td>',"<td>{minimumInventoryRequired}</td>",'<td style="width: 140px;{[values.priceIsCredit ? " color: green;" : "" ]}">{priceFormatted}{[values.priceIsCredit ? " CR" : "" ]}</td>',"</tr>","</tpl>","</table>","</div>",'<hr style="height: 1px; border: none; border-top: 1px solid #eee;"/>','<p style="font-size: 9px;">* Extras that appear greyed out are <b>mandatory</b> extras on this rate.</p>'])}]}]}}