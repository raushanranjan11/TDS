{xtype:"form",border:false,height:450,width:650,markDataDirtyOnLoad:true,requireStores:[{dataURI:TDS.env.dataPath+"accommodation/ratings/collection",identifier:"accommodation/ratings",fields:["name","dataURI"]}],beforeSubmit:function(G){try{var r=this.ownerCt;var B=this.getPassengerGrid();var l=B.getSelectionModel().getCount();var q=0;var x=0;var u=0;var o=new Date();var v=x;var m=B.selModel.selections.items;var k=r.getParam("wholefinalDate");var D=r.getParam("priceCurrency");var n=new Array();for(var A=0;A<=k.length-1;A++){n[A]=k[A]}var p=k.length;r.clearValidation();var d=[];var c=false;var h=false;var t=0;var s=[];for(var A=0;A<G.rateMultipleSelectedRateURI.length;A++){c=false;d[A]=G.rateMultipleSelectedRateURI[A].id;var f=0;var E={};E.rateURI=G.rateMultipleSelectedRateURI[A].id;x+=parseInt(G.rateMultipleSelectedRateURI[A].data.selectedTotalGuest)*parseInt(document.getElementById("no"+G.rateMultipleSelectedRateURI[A].data.dataURI).value);E.noOfPass=parseInt(G.rateMultipleSelectedRateURI[A].data.selectedTotalGuest)*parseInt(document.getElementById("no"+G.rateMultipleSelectedRateURI[A].data.dataURI).value);q+=parseInt(document.getElementById("no"+G.rateMultipleSelectedRateURI[A].data.dataURI).value);s[A]=E;t=x;for(var y=0;y<m.length;y++){if(G.rateMultipleSelectedRateURI.length==1){c=true;m[y].data.rateURI=G.rateMultipleSelectedRateURI[A].id;f++}else{if(m[y].data.rateURI===G.rateMultipleSelectedRateURI[A].data.nameString||m[y].data.rateURI===G.rateMultipleSelectedRateURI[A].id){c=true;m[y].data.rateURI=G.rateMultipleSelectedRateURI[A].id;f++}}}if(!c||f>t){if(f>t){h=true}break}}if(c&&!h){var z=[];for(var y=0;y<m.length;y++){var F={};F.rateURI=m[y].data.rateURI;F.passengerURI=m[y].id;z[y]=F}this.validateBooking(G);if(x>=l){var G={submitDataAsParams:true,paramData:{action:G.action,currency:D},data:{rateMultipleSelectedRateURI:d,rateURI:G.rateURI,offeringURI:G.offeringURI,inventoryAmount:q,dateFrom:n[0].format(TDS.env.dateFormat),duration:p,bookedDate:n,noOfPassToWaiting:u,passengerURIs:z,selectedNonMandatoryExtras:TDS.data[r.getParam("rateId")],noOfPerPerRate:s,timeheldDate:o,releaseDate:G.action=="request"?G.releaseDate:""}};return G}else{Ext.Msg.alert("Alert","No.of person and Passenger should be match.")}}else{if(h){Ext.Msg.alert("Alert","select no. of passengers not matching against the rate.")}else{Ext.Msg.alert("Alert","select rate against the passenger")}}}catch(C){r.showValidation(C);return false}},validateBooking:function(a){var c=this.getPassengerGrid();var d=this.getDetail("numberOfPaxRequired");var b=c.getSelectionModel().getCount();if(b<d){throw"You must select "+(d-b)+" passengers to complete this booking."}if(!a.action){throw"You must select an available booking option to proceed."}},initBooking:function(){var a=this.ownerCt;var c=a.getParam("numberToReserveRequested");var d=a.getParam("priceCurrency");var b=a.getParam("priceSell");this.setDetail({inventoryAmount:c,numberOfPaxRequired:1,ratePriceUnit:b,ratePriceCurrency:d})},initPassengerSelection:function(){var a=this.ownerCt;var b=this.getPassengerGrid();var d=this.getDetail("paxType");var c=this.getDetail("numberOfPaxRequired");b.getStore().on("load",function(){var e=b.preselect(d,c)},this)},getPassengerTab:function(){return this.items.itemAt(1).items.itemAt(1)},getPassengerGrid:function(){return this.getPassengerTab().items.itemAt(1).items.itemAt(0)},shared:{details:{}},setDetail:function(b,c){if(typeof b=="object"){for(var a in b){this.shared.details[a]=b[a]}}else{this.shared.details[b]=c}},getDetail:function(a){return this.shared.details[a]},listeners:{render:function(){var b=this.ownerCt;var c=this.items.itemAt(0);var a=Ext.TimerMgr.lookup(b.getDataURI("offering")+"/availability");if(a){c.setTimer(a)}this.initBooking();this.initRadioButtons();this.initPassengerSelection()}},items:[{xtype:"timerlabel",text:"This availability will expire in...",listeners:{timerexpire:function(a){this.el.dom.innerHTML='<b><font color="#cc0000">Your availability has expired.</font></b>'},timerrefresh:function(a,b){this.el.dom.innerHTML='<b><font color="#cc0000">This availability will expire in... '+b+" .</font></b>"}}},{xtype:"tabpanel",border:false,activeTab:0,layoutOnTabChange:true,deferredRender:false,height:430,autoScroll:true,width:650,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Details",autoScroll:true,items:[{xtype:"panel",layout:"form",labelWidth:80,border:false,calculateTotalPrice:function(){var b=this.ownerCt.findParentByType("form");var a=this.ownerCt.findParentByType("awesomewindow");var c=a.getParam("numberOfNights");b.setDetail("ratePriceTotal",b.getDetail("inventoryAmount")*c*b.getDetail("ratePriceUnit"))},getRatePriceTotalPanel:function(){return this.items.itemAt(4).items.itemAt(1)},items:[{xtype:"panel",style:"padding: 0;",border:false,layout:"table",layoutConfig:{columns:6},defaults:{hight:30,border:false},items:[{html:"<b><u>Property:</u></b>",width:Ext.isIE?86:86},{width:Ext.isIE?122:122,xtype:"label",listeners:{render:function(){var a=this.ownerCt.findParentByType("awesomewindow");var b="<b>"+a.getParam("offeringName")+"&nbsp;&nbsp;&nbsp;<input type='image' alt='Hotel Address' title= 'Address: \n "+a.getParam("hotelAddressString")+" \n\n Phone No: \n "+a.getParam("phoneNumber")+"' src='images/Qmark.png'>";this.setText(b,false)}}},{width:Ext.isIE?120:120,listeners:{render:function(){var a=this.ownerCt.findParentByType("awesomewindow");this.html="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>"+a.getData("locationToString")}}},{html:"<b><u>Star rating:</u></b>",width:Ext.isIE?88:85},{width:30,listeners:{render:function(){var a=this.ownerCt.findParentByType("awesomewindow");var b=a.getParam("ratingURI");this.html="<b>"+TDS.util.Format.displayResourceName(b)}}}]},{xtype:"panel",style:"padding: 0; margin-top: 12px;",border:false,layout:"table",layoutConfig:{columns:8},defaults:{hight:30,border:false},items:[{html:" ",width:Ext.isIE?86:86},{html:"<b><u>In:</u></b>",width:Ext.isIE?35:35},{width:Ext.isIE?86:86,listeners:{render:function(b){var a=this.ownerCt.findParentByType("awesomewindow");var d=a.getParam("finalDateNew");var c=new Date(d[0]);this.html="<b>"+c.format(TDS.env.dateFormatDisplay)}}},{html:"<b><u>Out:</u></b>",width:Ext.isIE?35:35},{width:Ext.isIE?86:86,listeners:{render:function(){var b=this.ownerCt.findParentByType("awesomewindow");var a=b.getParam("finalDateNew");if(a[1]=="Invalid Date"){var c=new Date(a[0]);c.setDate(c.getDate()+1);var d=c.format(TDS.env.dateFormatDisplay);this.html="<b>"+d}else{var c=new Date(a[1]);c.setDate(c.getDate()+1);var d=c.format(TDS.env.dateFormatDisplay);this.html="<b>"+d}}}},{html:"<b><u>Nights:</u></b>",width:Ext.isIE?48:45},{id:"durationId",width:30,listeners:{render:function(){var b=this.ownerCt.findParentByType("awesomewindow");var a=b.getParam("numberOfNights");this.html="<b>"+a}}}]},{xtype:"panel",style:"padding: 0; margin-top: 10px;margin-bottom: 5px;",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{html:"<b><u>No of Guests:</u></b>",width:Ext.isIE?88:85},{xtype:"label",id:"noOfGuests",width:30}]},{xtype:"panel",style:"padding: 0; margin-top: 4px;",border:false,layout:"table",layoutConfig:{columns:1},defaults:{border:false},items:[{colspan:2,name:"EXTRA_RATE_DISP_AREA",tpl:new Ext.XTemplate(['<br><table class="x-tds-dataview" border=1; style="width: 90%; margin-left: 3px;">',"<thead>",'<tr style="background-color: #d0def0;">','<th style="padding-bottom: 2px; width: 325px;">Extra</th>','<th style="width: 85px; padding-bottom: 2px;">Min. required</th>','<th style="width: 70px; padding-bottom: 2px;">Pricing</th>','<th style="width: 30px; padding-bottom: 2px;">Comm</th>',"</tr>","</thead>",'<tpl for=".">',"<tr >",'<td style=" {[values.required ? " color: gray;" : "" ]}">&nbsp;{nameString}</td>',"<td ALIGN=CENTER >{minimumInventoryRequired}</td>","<td ALIGN=RIGHT >{priceCurrency} {[values.priceIsNett ? values.priceNett:values.priceGross]}</td>",'<td ALIGN=CENTER >{priceCommissionPercentage}{[(values.priceCommissionPercentage || values.priceCommissionPercentage == 0 )? "%":""]}</td>',"</tr>","</tpl>","</table>"])}]},{xtype:"panel",style:"padding: 0;",border:false,layout:"table",layoutConfig:{columns:1},defaults:{border:false},items:[{html:"<br><u><b>Booked Rates</b></u>",width:300}]},{xtype:"panel",style:"padding: 0; margin-top: 2px;",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{xtype:"numberfield",id:"noOfPassengesId",name:"noOfPassenges",hidden:true},{width:620,xtype:"grid",border:true,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,viewConfig:{forceFit:true},store:new Ext.data.JsonStore({id:"dataURI",fields:["dataURI","nameString","noOfGuests","roomTypeString","noOfRooms","convertedPricingPriceSell","markup","basis","priceIsNett"]}),sm:new Ext.grid.CheckboxSelectionModel(),columns:[{header:"Rate",dataIndex:"nameString",width:200},{header:"Room Type",dataIndex:"roomTypeString",width:120},{header:"Max in Room",dataIndex:"noOfGuests",width:100},{header:"No",dataIndex:"noOfRooms",width:80},{header:"Gross Price",dataIndex:"convertedPricingPriceSell",width:100}],listeners:{cellclick:function(a,p,n,m){;var k=this.getStore();if(n==7){var j=a.getStore().getAt(p);var f=j.store.data.length;var b=false;var l=1;for(var h=0;h<f;h++){var d=k.getAt(h);dataURI1=d.get("dataURI");if(document.getElementById("cb"+dataURI1)!=null&&document.getElementById("cb"+dataURI1).checked){l++;b=true}}var g=j.get("dataURI");if(l>4){document.getElementById("cb"+g).checked=false}var o=this.ownerCt.ownerCt.items.itemAt(9);if(b){o.show()}else{o.hide(true)}}},render:function(){var b="";var r=this.ownerCt.findParentByType("awesomewindow");var o=this.ownerCt.findParentByType("form");var f=r.getParam("rateMultipleSelectedRateURI");var k=r.getParam("noOfNights");var I=r.getParam("plainDate");var n=f.length-1;var C;var h;var g;var G="";var F=0;var l=0;var c="";var v=TDS.data.selectedRates;v.removeAll();v.data.addAll(f);var A=0;var B="";var a=[];for(var D=0;D<f.length;D++){var x={};if(r.getData("rateURI")==f[D].data.dataURI){B=f[D].data.restrictions}var p=document.getElementById("no"+f[D].data.dataURI).value;l=parseInt(l)+parseInt(p);A=f[D].data.selectedTotalGuest;var c=f[D].json.inventoryTypeURI;var u=f[D].json.nameString;var s=f[D].json.groupName;var H="";var u=f[D].json.nameString;var E=f[D].data.conversionCurrency;var e=f[D].data.convertedPricingPriceSell;var d=f[D].data.convertedPricingPriceCommission;var t=f[D].data.convertedPricingPriceIsNett;if(t){C="Nett"}else{C="Gross"}if(typeof e=="undefined"||e==""){e=0}if(E==""){E="AUD"}var z=TDS.util.Price.calculateFixedGrossNettPrice({pricingPriceCurrency:E,pricingPriceSell:e,pricingPriceCommission:d,pricingPriceIsNett:t});if(p!=""&&p!=0){var m=TDS.util.Format.displayResourceName(c);var j="- "+r.getParam("roomfacilities");j=j.replace(/\,/g," \n - ");x.dataURI=f[D].data.dataURI;x.nameString=u+'&nbsp;&nbsp;<input type="image" alt="Rate Info" title= "'+m+" \n Room Description: \n"+B+"\n\n Facilities: \n "+j+'" src="images/Qmark.png">';x.roomTypeString=m;x.noOfRooms=p;x.convertedPricingPriceSell=E+" "+e.toFixed(2);x.markup=(z.priceIsNett?(E+(e*TDS.env.user.agencyDefaultComm()/100).toFixed(2)):"");x.basis=C;x.noOfGuests=A;x.priceIsNett=(z.priceIsNett?"":z.priceCommissionPercentage);a.push(x)}}var y=this.store;y.loadData(a);this.getView().refresh();Ext.getCmp("noOfGuests").setText("<b>"+(A*p)+"</b>",false);Ext.getCmp("noOfPassengesId").setValue(l)}}}]},{xtype:"panel",style:"padding: 0; margin-top: 4px;",border:false,layout:"table",layoutConfig:{columns:2},defaults:{border:false},items:[{html:"<u><b>Total:</b></u>",width:Ext.isIE?88:40},{xtype:"textfield",readOnly:true,style:"border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none;  text-decoration: none; div {text-align: left; } ",listeners:{render:function(){;var o=this.ownerCt.findParentByType("awesomewindow");var m=this.ownerCt.findParentByType("form");var d=o.getParam("rateMultipleSelectedRateURI");var b=parseInt(o.getParam("numberOfNights"));var l=d.length-1;var r;var h;var g=0;var v="";var t=0;var y={};y.extras=[];var f=0;var q=1;for(var s=0;s<d.length;s++){var n=document.getElementById("no"+d[s].data.dataURI).value;if(o.getParam("calculatePerPerson")){q=d[s].data.selectedTotalGuest*parseInt(n)}var u=d[s].data.conversionCurrency;if(u==""||u==null){u="AUD"}var e=d[s].data.convertedPricingPriceSell;var c=d[s].data.convertedPricingPriceCommission;var p=d[s].data.convertedPricingPriceIsNett;if(p){r="Nett"}else{r="Gross"}if(typeof g=="undefined"||g==""){g=0}if(typeof e=="undefined"||e==""){e=0}t=t+parseInt(n)*parseFloat(e)*q*b;var k=new Ext.data.CollectionStore({autoLoad:true,url:TDS.env.dataPath+d[s].data.offeringURI+"/searchExtras/collection?rateURI="+d[s].data.dataURI+"&currency="+u,identifier:d[s].data.offeringURI+"/searchExtras?rateURI="+d[s].data.dataURI+"&currency="+u,fields:["dataURI","nameString","termsAndConditions","extraCategoryURI","required","minimumInventoryRequired","conversionCurrency","convertedPricingPriceSell","convertedPricingPriceIsNett","convertedPricingPriceCommission","rateClassURI","ratePerURI","rateOccupancyURI","shareAvailabilitywith","flagCount","offeringURI","childChbox","markUp"]});var x=this.html;k.on("load",function(F,w){var B=y.extras;var A=y.extras.length;var E=0;var i=TDS.data[o.getParam("rateId")];for(var z=A;z<(A+w.length);z++){if(w[(z-A)].data.required||i.indexOf(w[(z-A)].data.dataURI)!=-1){y.extras[(z-E)]=w[(z-A)].data;Ext.apply(y.extras[(z-E)],TDS.util.Price.calculateGrossNettPrice(y.extras[(z-E)]));var D=w[(z-A)].data.minimumInventoryRequired;f+=w[(z-A)].data.priceSell*D;if(y.extras[(z-E)].priceIsNett){y.extras[(z-E)].priceNett=y.extras[(z-E)].priceSell.toFixed(2);y.extras[(z-E)].markUp=(y.extras[(z-E)].priceSell*D).toFixed(2)}else{y.extras[(z-E)].priceGross=y.extras[(z-E)].priceGross.toFixed(2)}}else{E++;continue}}var a=this.ownerCt.ownerCt.items.itemAt(3).items.itemAt(0);if(y.extras.length>0){a.tpl.overwrite(a.body,y.extras)}var C=" "+u+" "+((f)+(t)).toFixed(2)+" ";this.setValue(C)},this);if(!d[s].data.convertedPricingPriceIsNett){}var j=" "+u+" "+(((f*parseInt(n))+(t))).toFixed(2)+" ";this.setValue(j)}}}}]},{xtype:"fieldset",style:"margin-top: 8px;",layout:"table",layoutConfig:{columns:2},autoHeight:true,defaults:{colspan:2,xtype:"radio",name:"action",forceSubmit:true,hideLabel:true},items:[{boxLabel:"Book available",inputValue:"book",hidden:true,handler:function(c,d){if(d){var e=this.ownerCt.ownerCt;var b=this.ownerCt.findParentByType("form");var a=b.ownerCt;e.calculateTotalPrice()}}},{colspan:1,boxLabel:"Request ",inputValue:"request",hidden:true,handler:function(c,d){var f=this.ownerCt.items.itemAt(2);if(d){var e=this.ownerCt.ownerCt;var b=this.ownerCt.findParentByType("form");var a=b.ownerCt;e.calculateTotalPrice();f.enable().focus()}else{f.disable()}}},{colspan:1,xtype:"datefield",name:"releaseDate",hidden:true,disabled:true,showToday:false,width:80,format:TDS.env.dateFormatDisplay,minValue:Ext.TimerMgr.getServerCalculatedDate().clearTime(),listeners:{render:function(){var a=Ext.TimerMgr.getServerCalculatedDate().add(Date.DAY,28);this.setValue(a)}}},{boxLabel:"Quote only",inputValue:"quote"}]},{xtype:"checkbox",name:"makeAnotherBooking",forceSubmit:true,hideLabel:true,checked:false,hidden:true,boxLabel:"Make another booking"},{xtype:"panel",style:"padding: 0; margin-top: 9px; margin-bottom: 9px;",hidden:true,border:false,height:155,id:"compairTable",layout:"table",layoutConfig:{columns:3},defaults:{width:210,border:false},items:[{html:"<div style='height:150px; width:200px; overflow-x:auto ; border: 1px solid #ccc; overflow-y: scroll; padding-left:0px;'>1</div>"},{html:"<div style='height:150px; width:200px;  overflow-x:auto ; border: 1px solid #ccc; overflow-y: scroll; padding-left:0px;'>2</div>"},{html:"<div style='height:150px; width:200px; overflow-x:auto ; border: 1px solid #ccc; overflow-y: scroll; padding-left:0px;'>3</div>"}]},{xtype:"panel",labelWidth:80,border:false,items:[{html:" ",height:120,width:640,listeners:{render:function(){var a=this.ownerCt.findParentByType("awesomewindow");this.html="<div style='height:110px; width:100%; overflow-x:auto ; overflow-y: scroll; padding-left:0px;'><center><u><b>Terms and Conditions</b></u></center><br>"+a.getParam("termsAndConditions")+"</div>"}}},{xtype:"checkbox",width:575,boxLabel:'<font  color="#cc0000"><b>I Accept listed terms and conditions for this booking.</b></font>',listeners:{check:function(a,c){var b=this.ownerCt.findParentByType("form");if(c){b.ownerCt.buttons[0].enable(true)}else{b.ownerCt.buttons[0].disable(true)}}}}]}]}]},{title:"Passengers",items:[{xtype:"panel",border:false,style:"margin-bottom: 6px;",html:"<p>Please select the passengers for this booking below.</p>",listeners:{beforerender:function(){var a=this.ownerCt.findParentByType("form");var b=a.getDetail("numberOfPaxRequired");if(b>0){this.html="<p>Please select the "+b+" passengers required for this booking below.</p>"}}}},{xtype:"panel",border:false,layout:"fit",items:[{xtype:"editorgrid",height:350,store:new Ext.data.CollectionStore({url:"",identifier:"",fields:["type","code","nameFirst","nameLast","salutation","displayName","dateOfBirth","rateURI","paxAge"]}),viewConfig:{forceFit:true},getData:function(){var b=this.selModel.getSelections();var c=[];for(var a=0;a<b.length;a++){c[a]=b[a].get("dataURI")}return c},preselect:function(c,b){var a=[];this.getStore().each(function(d){if(a.length>=b){return false}if((!c||d.get("type")==c)&&d.get("nameFirst")&&d.get("nameLast")){a[a.length]=d}},this);if(a.length>0){this.getSelectionModel().selectRecords(a)}return a.length},validatePassenger:function(d,a,c,b){if(!b.get("nameFirst")&&!b.get("nameLast")){return false}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Type",dataIndex:"type",width:40,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"text",valueField:"text",triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Last name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false}),renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"First name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false}),renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"Title",dataIndex:"salutation",width:40,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"DOB",dataIndex:"dateOfBirth",width:70,fixed:true,editor:new Ext.form.DateField({allowBlank:false}),renderer:function(e,c,b){;if(typeof e!="undefined"){if(typeof e!="string"){var a=new Date();a.setTime(Ext.TimerMgr.getServerCalculatedTime());var d=Math.floor((a.getTime()-e.getTime())/(365.25*24*60*60*1000));b.set("paxAge",((d&&d>0)?d:""));return Ext.util.Format.date(e,TDS.env.dateBirthdayFormatDisplay)}else{if(b.get("paxAge")){var d=TDS.util.Format.age(e);b.set("paxAge",((d&&d>0)?d:""))}return TDS.util.Format.dateSpecial(e,TDS.env.dateBirthdayFormatDisplay)}}return TDS.util.Format.dateSpecial(e,TDS.env.dateBirthdayFormatDisplay)}},{header:"Age",dataIndex:"paxAge",width:30,fixed:true,editor:new Ext.form.NumberField({allowBlank:false}),renderer:function(e,c,b){if(e){return e}else{if(typeof b.get("dateOfBirth")!="undefined"){if(typeof b.get("dateOfBirth")!="string"){var a=new Date();a.setTime(Ext.TimerMgr.getServerCalculatedTime());var d=Math.floor((a.getTime()-b.get("dateOfBirth").getTime())/(365.25*24*60*60*1000));return((d&&d>0)?d:"")}else{var d=TDS.util.Format.age(b.get("dateOfBirth"));return((d&&d>0)?d:"")}}return""}}},{header:"Rate",dataIndex:"rateURI",fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"nameString",valueField:"nameString",triggerAction:"all",store:TDS.data.selectedRates})}],bbar:[{xtype:"button",text:"Add",handler:function(){var b=this.ownerCt.items.itemAt(1);var a=this.ownerCt.items.itemAt(2);a.enable();b.enable();this.disable();var d=this.ownerCt.ownerCt;var c=d.getStore();c.add([new c.recordType({type:"AD",nameFirst:"",nameLast:""})]);d.newRecordIndex=c.getCount()-1;d.startEditing(d.newRecordIndex,2)}},{xtype:"button",text:"Cancel",disabled:true,handler:function(){var c=this.ownerCt.items.itemAt(0);var b=this.ownerCt.items.itemAt(2);c.enable();b.disable();var d=this.ownerCt.ownerCt;var a=d.getStore().getAt(d.newRecordIndex);if(a==-1||typeof a.get("dataURI")!="undefined"){return}d.getStore().remove(a);this.disable()}},{xtype:"button",text:"Save",disabled:true,handler:function(){var b=this.ownerCt.findParentByType("awesomewindow");var e=this.ownerCt.ownerCt;var d=this.ownerCt.items.itemAt(0);var c=this.ownerCt.items.itemAt(1);c.disable();this.disable();var a=e.getStore().getAt(e.newRecordIndex);if(a==-1||typeof a.get("dataURI")!="undefined"){return}Ext.Ajax.request({url:TDS.env.dataPath+b.getDataURI("pnr")+"/passengers",jsonData:a.data,method:"POST",callback:function(h,f,g){if(f){e.getStore().load();d.enable()}else{c.enable();this.enable()}},scope:this})}},{xtype:"button",text:"Addional Info",listeners:{render:function(){}},handler:function(f){;var d=this.ownerCt.ownerCt;var b=d.getStore().getAt(d.newRecordIndex);var a="";var c=this.ownerCt.ownerCt.getSelectionModel().selections;if(c.length==1){a=c.items[0].get("dataURI")}TDS.innerWindow.setWindow({height:300,width:200,autoDestroy:false,title:"Passenger Profile",interfaceURI:"pnr/passenger/passengerDetails.js",sourceDataURI:a,destinationDataURI:a,closeAction:"hide",buttonOK:"Submit",callback:{fn:function(g,h,e){},scope:this}})}}],listeners:{beforeedit:function(a){},rowdblclick:function(){},render:function(){var w=this.ownerCt.findParentByType("awesomewindow");this.getSelectionModel().on("beforerowselect",this.validatePassenger,this);with(this.store){reader.meta.identifier=w.getDataURI("pnr")+"/passengers";proxy.conn.url=TDS.env.dataPath+w.getDataURI("pnr")+"/passengers/concise";load()}}}}]}]}]}],initRadioButtons:function(c){var b=this.ownerCt;var d=b.getParam("daysAvailable");var h=b.getParam("daysRequestable");var a=this.items.itemAt(1).items.itemAt(0).items.itemAt(0).findByType("fieldset")[0];var f=a.items.itemAt(0);var e=a.items.itemAt(1);var g=a.items.itemAt(2);if(d>0){f.show()}if(h>0){e.show()}}}