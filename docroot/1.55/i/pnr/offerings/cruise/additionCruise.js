{height:385,frame:true,width:1020,closable:true,resizable:false,border:false,xtype:"panel",modal:true,layout:"table",layoutConfig:{columns:2},listeners:{render:function(a){a.findParentByType("awesomewindow").buttons[1].hide()}},items:[{xtype:"tabpanel",border:false,activeTab:0,layoutOnTabChange:true,deferredRender:false,width:900,height:475,defaults:{bodyStyle:"padding: 0px 2px 0px 0px;"},items:[{title:"Air",layout:"fit",frame:true,items:{xtype:"panel",layout:"form",listeners:{},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:110,layoutConfig:{columns:2},items:[{html:"Guest :",style:"text-decoration: underline; ",width:50},{xtype:"combo",width:30,name:"guestNo",width:30,store:[0,1,2,3,4,5,6,7,8,9,10],name:"G1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"combo",width:30,name:"adult",width:30,store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:250,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:4},items:[{html:"Package Price :",width:80},{xtype:"textfield",width:40},{width:10},{xtype:"textfield",width:80}]}]},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).items.itemAt(0).getValue();var d=this.items.itemAt(8).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(13).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"From City :"},{xtype:"combo",displayField:"name",valueField:"name",listWidth:150,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"components/"+rateUri+"/city1",method:"POST",identifier:"city",fields:["name","name"],autoLoad:false})},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; "},{},{},{html:"To :",style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; "},{xtype:"combo",width:120},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 150px; ",html:"Fair Type:"},{xtype:"combo",width:120},{},{style:"  padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"Date :"},{xtype:"datefield",width:120},{},{},{},{style:"  padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 20px; ",html:"Time :"},{xtype:"combo",width:120},{},{},{},{style:"  padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"Airline :"},{xtype:"combo",width:120},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 150px; ",html:"Status :"},{xtype:"textfield",width:120,name:"status"},{},{style:"  padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"Class :"},{xtype:"combo",width:120}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:100,items:[{xtype:"panel",columnWidth:0.55,height:100,items:[{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"AAA",width:450,height:100,autoScroll:true,itemSelector:"rule-item",items:[{xtype:"dataview",title:"Test",autoHeight:true,multiSelect:true,overItemCls:"x-view-over",itemSelector:"div.thumb-wrap",trackOver:true,emptyText:"No images to display",tpl:new Ext.XTemplate(['<br><div class="thumb-wrap"><table class="preHotels" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 60px; position:inherit; ">{date} </th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<td style="  ">OK{unreservedAvailable}</td>',"</tpl>","</tr>","<tr >",'<tpl for="list">','<td ><input type="checkbox" class="rule-item" id= "{date}"></td>',"</tpl>","</tr>","</table></div>"]),listeners:{containerclick:function(c,b,f,a,e,d){}}}]}]}]},{xtype:"panel",layout:"table",style:" padding-left: 250px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var l=document.getElementsByClassName("preHotels")[0].rows[2].getElementsByTagName("input");var f=document.getElementsByClassName("preHotels")[0].rows[2].getElementsByTagName("input").length;var a=[];var c="";var e=[];unSelectedDateArray=[],selectionOfDate=[];var k={},j=false,m=[];for(var d=0;d<l.length;d++){if(l[d].checked){a.push(l[d].id);c=c.concat(l[d].id).concat(",")}else{c=c.concat("$")}}var m=c.split("$").filter(Boolean);for(var d=0;d<m.length;d++){selectionOfDate.push(m[d].split(",").filter(Boolean))}var n=Ext.getCmp("preHotelGrid").getSelectionModel().getSelections()[0].data;var b="",h="",g={};selectionOfDate.forEach(function(p,o){for(var q=0;q<p.length;q++){if(q==0){b=new Date(p[0]);h=new Date(Date.parse(p[0])+p.length*86400000);n.inDate=b;n.outDate=h;g=JSON.stringify(n)}}e.push(JSON.parse(g))});Ext.getCmp("preHotelGrid").store.loadData(e);this.findParentByType("tabpanel").setActiveTab(2)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"avail",handler:function(){var b={};var c=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var e=Ext.getCmp("inDate").getValue();var a=Ext.getCmp("roomType").getValue();var d=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+this.findParentByType("awesomewindow").getData("rateURI")+"/availabilty",method:"POST",params:{offeringId:Ext.getCmp("preHotelGrid").getSelectionModel().getSelections()[0].get("dataURI"),roomType:a,inDate:e,dateDays:6,numberToReserve:1},success:function(f,g){var h=Ext.decode(f.responseText);Ext.getCmp("AAA").items.itemAt(0).tpl.overwrite(Ext.getCmp("AAA").body,h)},scope:this})}},{xtype:"button",text:"Cancel",id:"clear",style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("form").getForm();a.findField("roomType").reset();a.findField("hotelName").reset();a.findField("maxInRoom").reset();a.findField("accommodationRatingURI").reset();a.findField("basisURI").reset();a.findField("inDate").reset();a.findField("noOfRoom").reset();a.findField("outDate").reset();a.findField("night").reset();a.findField("packagePrice").reset();var b=[];Ext.getCmp("AAA").items.itemAt(0).tpl.overwrite(Ext.getCmp("AAA").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){}}]}]}},{title:"Pre Hotel",layout:"form",frame:true,items:[{xtype:"panel",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:110,layoutConfig:{columns:2},items:[{html:"Guest :",style:"text-decoration: underline; ",width:50},{xtype:"combo",width:30,name:"guestNo",width:30,store:[0,1,2,3,4,5,6,7,8,9,10],name:"G1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"combo",width:30,name:"adultNo",width:30,value:1,store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,id:"cg",listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",id:"total",width:80,listeners:{render:function(){},change:function(b,d,a){var c=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue()}}}]},{xtype:"panel",width:250,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:4},items:[{html:"Package Price :",width:80},{xtype:"textfield",width:40},{width:10},{xtype:"textfield",width:80}]}]},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationURI",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; ",html:"Room Type :"},{xtype:"combo",name:"inventoryTypeURI",mode:"local",id:"roomType",width:150,listWidth:165,triggerAction:"all",editable:false,displayField:"displayName",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/inventorytypes/collection",identifier:"accommodation/inventorytypes",fields:["name","displayName","dataURI"]})},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Hotel :"},{xtype:"combo",name:"hotelName",displayField:"name",valueField:"dataURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/accommodation",identifier:"hotels?postHotel=false",fields:["name","nameString","accommodationRatingURI"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"hotels?postHotel=false",fields:["name","nameString","accommodationRatingURI"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var a=this.findParentByType("awesomewindow").getDataURI("supplierURI");var c=this.ownerCt.items.itemAt(11);this.getStore().removeAll();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/accommodation?postHotel=false",this.getStore().load({})},select:function(d,a,b){var c=this.findParentByType("panel").findByType("datefield")[0];var e=this.ownerCt.items.itemAt(1);c.setValue(TDS.util.Format.dateFormatNew(a.data.inDate));this.findParentByType("panel").findByType("combo")[0].setValue("");this.findParentByType("panel").findByType("combo")[3].setValue("");this.findParentByType("panel").findByType("combo")[2].setValue(a.data.accommodationRatingURI)},beforerender:function(a){}}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Max In Room :"},{xtype:"textfield",name:"maxInRoom",width:163,readOnly:true,listeners:{}},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Rating :"},{xtype:"combo",id:"rating",name:"accommodationRatingURI",hideTrigger:true,readOnly:true,enableKeyEvents:false,mode:"local",fieldLabel:"Rating",width:100,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/ratings/collection",identifier:"accommodation/ratings",fields:["name","dataURI"]}),listeners:{}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Basis :"},{xtype:"combo",width:150,name:"basisURI",displayField:"name",valueField:"name",listWidth:135,mode:"local",selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/basis",identifier:"rateBasis",fields:["name","rateId","id","inventoryTypeURI"],reader:new Ext.data.CollectionReader({identifier:"rateBasis",fields:["name","rateId","id","inventoryTypeURI"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var c=this.findParentByType("panel").findByType("combo")[1].getValue();var a=this.findParentByType("panel").findByType("combo")[0].getValue();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/basis",this.getStore().load({params:{hotel:c,roomType:a}})},select:function(d,a,b){var c=this.findParentByType("awesomewindow").getData("rateURI")}}},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"In Date :"},{xtype:"datefield",width:83,format:"dMy",name:"inDate",id:"inDate",enableKeyEvents:true,showToday:false,menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var b=this.getValue();var a=this.findParentByType("panel").ownerCt.findByType("datefield")[1].getValue();var e=this.findParentByType("panel").ownerCt.findByType("textfield")[17];if((a-b)>=0){e.setValue((a-b)/86400000)}else{e.setValue("")}}},Ext.form.DateField.prototype.menuListeners)},{html:"No. of Rooms :",style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; "},{xtype:"combo",width:150,excludeSubmit:true,name:"noOfRoom",value:1,enableKeyEvents:true,minChars:1,enableKeyEvents:true,mode:"local",listWidth:140,editable:false,typeAhead:true,excludeFromSession:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"text",valueField:"text",store:new Ext.data.SimpleStore({fields:["text","text"],data:[["1","1"],["2","2"],["3","3"],["4","4"]]})},{},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 20px; padding-left: 20px; ",html:"Out Date :"},{fieldLabel:"Out Date :",xtype:"datefield",width:83,format:"dMy",name:"outDate",id:"out",readOnly:true,menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var a=this.getValue();var b=this.ownerCt.ownerCt.ownerCt.findByType("datefield")[0].getValue();var e=this.ownerCt.findByType("textfield")[10];if((a-b)>=0){e.setValue((a-b)/86400000)}else{e.setValue("")}}},Ext.form.DateField.prototype.menuListeners)},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Status:"},{xtype:"textfield",width:83,name:"status",readOnly:true},{},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 20px; padding-left: 20px; ",html:"Nights :"},{xtype:"textfield",name:"night",width:100}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:100,items:[{xtype:"panel",columnWidth:0.55,height:100,items:[{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"AAA",width:450,height:100,autoScroll:true,itemSelector:"rule-item",items:[{xtype:"dataview",title:"Test",autoHeight:true,multiSelect:true,overItemCls:"x-view-over",itemSelector:"div.thumb-wrap",trackOver:true,emptyText:"No images to display",tpl:new Ext.XTemplate(['<br><div class="thumb-wrap"><table class="preHotels" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 60px; position:inherit; ">{date} </th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<td style="  ">OK{unreservedAvailable}</td>',"</tpl>","</tr>","<tr >",'<tpl for="list">','<td ><input type="checkbox" class="rule-item" id= "{date}"></td>',"</tpl>","</tr>","</table></div>"]),listeners:{containerclick:function(c,b,f,a,e,d){}}}]}]}]},{xtype:"panel",layout:"table",style:" padding-left: 250px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var l=document.getElementsByClassName("preHotels")[0].rows[2].getElementsByTagName("input");var f=document.getElementsByClassName("preHotels")[0].rows[2].getElementsByTagName("input").length;var a=[];var c="";var e=[];unSelectedDateArray=[],selectionOfDate=[];var k={},j=false,m=[];for(var d=0;d<l.length;d++){if(l[d].checked){a.push(l[d].id);c=c.concat(l[d].id).concat(",")}else{c=c.concat("$")}}var m=c.split("$").filter(Boolean);for(var d=0;d<m.length;d++){selectionOfDate.push(m[d].split(",").filter(Boolean))}var n=Ext.getCmp("preHotelGrid").getSelectionModel().getSelections()[0].data;var b="",h="",g={};selectionOfDate.forEach(function(p,o){for(var q=0;q<p.length;q++){if(q==0){b=new Date(p[0]);h=new Date(Date.parse(p[0])+p.length*86400000);n.inDate=b;n.outDate=h;g=JSON.stringify(n)}}e.push(JSON.parse(g))});Ext.getCmp("preHotelGrid").store.loadData(e);this.findParentByType("tabpanel").setActiveTab(2)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"avail",handler:function(){var b={};var c=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var e=Ext.getCmp("inDate").getValue();var a=Ext.getCmp("roomType").getValue();var d=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+this.findParentByType("awesomewindow").getData("rateURI")+"/availabilty",method:"POST",params:{offeringId:Ext.getCmp("preHotelGrid").getSelectionModel().getSelections()[0].get("dataURI"),roomType:a,inDate:e,dateDays:6,numberToReserve:1},success:function(f,g){var h=Ext.decode(f.responseText);Ext.getCmp("AAA").items.itemAt(0).tpl.overwrite(Ext.getCmp("AAA").body,h)},scope:this})}},{xtype:"button",text:"Cancel",id:"clear",style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("form").getForm();a.findField("roomType").reset();a.findField("hotelName").reset();a.findField("maxInRoom").reset();a.findField("accommodationRatingURI").reset();a.findField("basisURI").reset();a.findField("inDate").reset();a.findField("noOfRoom").reset();a.findField("outDate").reset();a.findField("night").reset();a.findField("packagePrice").reset();var b=[];Ext.getCmp("AAA").items.itemAt(0).tpl.overwrite(Ext.getCmp("AAA").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){}}]}]}]},{title:"Post Hotel",layout:"form",frame:true,items:[{xtype:"panel",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:110,layoutConfig:{columns:2},items:[{html:"Guest :",style:"text-decoration: underline; ",width:50},{xtype:"combo",width:30,name:"guestNo",width:30,value:1,store:[0,1,2,3,4,5,6,7,8,9,10],name:"G1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"combo",width:30,name:"adultNo",width:30,value:1,store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc();var b=this.ownerCt.findParentByType("form").getForm().findField("maxInRoom").getValue();var a=this.ownerCt.ownerCt.findByType("textfield")[4].getValue();if(a>b){Ext.Msg.alert("Alert","Total Passenger  should not greater than "+b)}},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:250,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:4},items:[{html:"Package Price :",width:80},{xtype:"textfield",width:40},{width:10},{xtype:"textfield",width:80}]}]},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(15).items.itemAt(0).getValue();var d=this.items.itemAt(21).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(27).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationToString",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; ",html:"Room Type :"},{xtype:"combo",name:"inventoryTypeURI",mode:"local",id:"roomTypes",width:150,listWidth:165,triggerAction:"all",editable:false,displayField:"displayName",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/inventorytypes/collection",identifier:"accommodation/inventorytypes",fields:["name","displayName","dataURI"]})},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Hotel :"},{xtype:"combo",name:"hotelName",displayField:"name",valueField:"dataURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/accommodation",identifier:"hotels?postHotel=true",fields:["name","nameString","accommodationRatingURI"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"hotels?postHotel=true",fields:["name","nameString","accommodationRatingURI"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var a=this.findParentByType("awesomewindow").getDataURI("supplierURI");var c=this.ownerCt.items.itemAt(11);this.getStore().removeAll();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/accommodation?postHotel=true",this.getStore().load({})},select:function(d,a,b){var c=this.findParentByType("panel").findByType("datefield")[0];var e=this.ownerCt.items.itemAt(1);c.setValue(TDS.util.Format.dateFormatNew(a.data.inDate));this.findParentByType("panel").findByType("combo")[0].setValue("");this.findParentByType("panel").findByType("combo")[3].setValue("");this.findParentByType("panel").findByType("combo")[2].setValue(a.data.accommodationRatingURI)},beforerender:function(a){}}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Max In Room :"},{xtype:"textfield",name:"maxInRoom",width:163,readOnly:true,listeners:{}},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Rating :"},{xtype:"combo",id:"ratings",name:"accommodationRatingURI",hideTrigger:true,readOnly:true,enableKeyEvents:false,mode:"local",fieldLabel:"Rating",width:100,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/ratings/collection",identifier:"accommodation/ratings",fields:["name","dataURI"]}),listeners:{}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Basis :"},{xtype:"combo",width:150,name:"basisURI",displayField:"name",valueField:"name",listWidth:150,mode:"local",selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/basis",identifier:"rateBasis",fields:["name","rateId","id","inventoryTypeURI"],reader:new Ext.data.CollectionReader({identifier:"rateBasis",fields:["name","rateId","id","inventoryTypeURI"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var c=this.findParentByType("panel").findByType("combo")[1].getValue();var a=this.findParentByType("panel").findByType("combo")[0].getValue();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/basis",this.getStore().load({params:{hotel:c,roomType:a}})},select:function(d,a,b){var c=this.findParentByType("awesomewindow").getData("rateURI")}}},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"In Date :"},{xtype:"datefield",width:83,format:"dMy",name:"inDate",id:"inDates",enableKeyEvents:true,showToday:false,menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var b=this.getValue();var a=this.findParentByType("panel").ownerCt.findByType("datefield")[1].getValue();var e=this.findParentByType("panel").ownerCt.findByType("textfield")[17];if((a-b)>=0){e.setValue((a-b)/86400000)}else{e.setValue("")}}},Ext.form.DateField.prototype.menuListeners)},{html:"No. of Rooms :",style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; "},{xtype:"combo",width:150,excludeSubmit:true,name:"noOfRoom",value:1,enableKeyEvents:true,minChars:1,enableKeyEvents:true,mode:"local",listWidth:140,editable:false,typeAhead:true,excludeFromSession:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"text",valueField:"text",store:new Ext.data.SimpleStore({fields:["text","text"],data:[["1","1"],["2","2"],["3","3"],["4","4"]]})},{},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 20px; padding-left: 20px; ",html:"Out Date :"},{fieldLabel:"Out Date :",xtype:"datefield",width:83,format:"dMy",name:"outDate",readOnly:true,menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var a=this.getValue();var b=this.ownerCt.ownerCt.ownerCt.findByType("datefield")[0].getValue();var e=this.ownerCt.findByType("textfield")[10];if((a-b)>=0){e.setValue((a-b)/86400000)}else{e.setValue("")}}},Ext.form.DateField.prototype.menuListeners)},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Status:"},{xtype:"textfield",width:83,name:"status",readOnly:true},{},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 20px; padding-left: 20px; ",html:"Nights :"},{xtype:"textfield",name:"night",width:100}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:100,items:[{xtype:"panel",columnWidth:0.55,height:100,items:[{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"CCC",width:450,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="postHotels" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 60px; position:inherit; ">{date} </th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<td style="  ">OK{unreservedAvailable}</td>',"</tpl>","</tr>","<tr >",'<tpl for="list">','<td ><input type="checkbox" class=" x-form-checkbox x-form-field" id={date}></td>',"</tpl>","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 250px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"update",handler:function(){var l=document.getElementsByClassName("postHotels")[0].rows[2].getElementsByTagName("input");var f=document.getElementsByClassName("postHotels")[0].rows[2].getElementsByTagName("input").length;var a=[];var c="";var e=[];unSelectedDateArray=[],selectionOfDate=[];var k={},j=false,m=[];for(var d=0;d<l.length;d++){if(l[d].checked){a.push(l[d].id);c=c.concat(l[d].id).concat(",")}else{c=c.concat("$")}}var m=c.split("$").filter(Boolean);for(var d=0;d<m.length;d++){selectionOfDate.push(m[d].split(",").filter(Boolean))}var n=Ext.getCmp("postHotelGrid").getSelectionModel().getSelections()[0].data;var b="",h="",g={};selectionOfDate.forEach(function(p,o){for(var q=0;q<p.length;q++){if(q==0){b=new Date(p[0]);h=new Date(Date.parse(p[0])+p.length*86400000);n.inDate=b;n.outDate=h;g=JSON.stringify(n)}}e.push(JSON.parse(g))});Ext.getCmp("postHotelGrid").store.loadData(e);this.findParentByType("tabpanel").setActiveTab(2)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",handler:function(){var b={};var c=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var a=Ext.getCmp("roomTypes").getValue();var e=Ext.getCmp("inDates").getValue();var d=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+this.findParentByType("awesomewindow").getData("rateURI")+"/availabilty",method:"POST",params:{offeringId:Ext.getCmp("postHotelGrid").getSelectionModel().getSelections()[0].get("dataURI"),roomType:a,inDate:e,dateDays:6,numberToReserve:1},success:function(f,g){var h=Ext.decode(f.responseText);Ext.getCmp("CCC").tpl.overwrite(Ext.getCmp("CCC").body,h)},scope:this})}},{xtype:"button",text:"Cancel",style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("tabpanel").getActiveTab().findByType("combo");a[0].reset();a[1].reset();a[2].reset();a[3].reset();a[4].reset();var c=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");c[3].reset();c[9].reset();c[6].reset();c[8].reset();var b=[];Ext.getCmp("CCC").tpl.overwrite(Ext.getCmp("CCC").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){}}]}]}]},{title:"Day Tours",layout:"form",frame:true,items:[{xtype:"panel",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,id:"day",totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:110,layoutConfig:{columns:2},items:[{html:"Guest :",style:"text-decoration: underline; ",width:50},{xtype:"combo",width:30,name:"guestNo",width:30,store:[0,1,2,3,4,5,6,7,8,9,10],name:"G1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"combo",name:"adultNo",width:30,value:1,store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:250,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:4},items:[{html:"Package Price :",width:80},{xtype:"textfield",width:40},{width:10},{xtype:"textfield",width:80}]}]},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).items.itemAt(0).getValue();var d=this.items.itemAt(8).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(13).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationURI",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Dept Date :"},{xtype:"datefield",width:83,format:"dMy",name:"deptDate",id:"deptDate"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Type :"},{xtype:"combo",id:"rate",name:"rateClassURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,mode:"local",displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"rate/classes/collection",identifier:"rate/classes",fields:["name","dataURI"]}),listeners:{}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Time :"},{xtype:"textfield",width:99,name:"time",readOnly:true},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Tour Name :"},{xtype:"combo",name:"tourName",displayField:"name",valueField:"dataURI",id:"d",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/accommodation",identifier:"tours",fields:["name","nameString"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"tours",fields:["name","nameString"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var a=this.findParentByType("awesomewindow").getDataURI("supplierURI");var c=this.ownerCt.items.itemAt(11);this.getStore().removeAll();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/dayTour",this.getStore().load({})}}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Duration :"},{xtype:"numberfield",name:"totalPax",width:99},{border:false},{border:false},{border:false},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Status :"},{xtype:"textfield",name:"status",width:99}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:150,items:[{xtype:"panel",columnWidth:0.55,height:150,items:[{xtype:"panel",layout:"table",layoutConfig:{columns:2},items:[]},{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"EEE",width:500,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="dayTours" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 50px; position:inherit; ">{date}</th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<td style="  ">OK{unreservedAvailable}</td>',"</tpl>","</tr>","<tr >",'<tpl for="list">','<td ><input type="checkbox" class=" x-form-checkbox x-form-field" id= "{date}"></td>',"</tpl>","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 220px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var l=document.getElementsByClassName("dayTours")[0].rows[2].getElementsByTagName("input");var f=document.getElementsByClassName("dayTours")[0].rows[2].getElementsByTagName("input").length;var a=[];var c="";var e=[];unSelectedDateArray=[],selectionOfDate=[];var k={},j=false,m=[];for(var d=0;d<l.length;d++){if(l[d].checked){a.push(l[d].id);c=c.concat(l[d].id).concat(",")}else{c=c.concat("$")}}var m=c.split("$").filter(Boolean);for(var d=0;d<m.length;d++){selectionOfDate.push(m[d].split(",").filter(Boolean))}var n=Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections()[0].data;var b="",h="",g={};selectionOfDate.forEach(function(p,o){for(var q=0;q<p.length;q++){if(q==0){b=new Date(p[0]);h=new Date(Date.parse(p[0])+p.length*86400000);n.departureDate=b;g=JSON.stringify(n)}}e.push(JSON.parse(g))});Ext.getCmp("SIGHTGrid").store.loadData(e);this.findParentByType("tabpanel").setActiveTab(2)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"availss",handler:function(){var a={};var b=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var d=Ext.getCmp("deptDate").getValue();var c=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+this.findParentByType("awesomewindow").getData("rateURI")+"/availabilty/daytour",method:"POST",params:{offeringId:Ext.getCmp("d").getValue(),paxtype:Ext.getCmp("rate").getValue(),inDate:d,dateDays:6,numberToReserve:1},success:function(e,f){var g=Ext.decode(e.responseText);Ext.getCmp("EEE").tpl.overwrite(Ext.getCmp("EEE").body,g)},scope:this})}},{xtype:"button",text:"Cancel",style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("tabpanel").getActiveTab().findByType("combo");a[0].reset();a[1].reset();a[2].reset();a[3].reset();var c=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");c[5].reset();c[6].reset();c[7].reset();var b=[];Ext.getCmp("EEE").tpl.overwrite(Ext.getCmp("EEE").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){}}]}]}]},{title:"Services  ",layout:"form",frame:true,items:[{xtype:"panel",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:110,layoutConfig:{columns:2},items:[{html:"Guest :",style:"text-decoration: underline; ",width:50},{xtype:"combo",width:30,name:"guestNo",width:30,store:[0,1,2,3,4,5,6,7,8,9,10],name:"G1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"combo",name:"adultNo",width:30,value:1,store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:250,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:4},items:[{html:"Package Price :",width:80},{xtype:"textfield",width:40},{width:10},{xtype:"textfield",width:80}]}]},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).items.itemAt(0).getValue();var d=this.items.itemAt(8).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(13).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationURI",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Dept Date :"},{xtype:"datefield",width:83,format:"dMy",name:"deptDate",id:"deptDate"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Type :"},{xtype:"combo",name:"rateClassURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,mode:"local",displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"rate/classes/collection",identifier:"rate/classes",fields:["name","dataURI"]}),listeners:{}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Time :"},{xtype:"textfield",width:99,name:"time",readOnly:true},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Service :"},{xtype:"combo",name:"serviceName",displayField:"name",valueField:"dataURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/accommodation",identifier:"attraction",fields:["name","nameString","dataURI"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"attraction",fields:["name","nameString","dataURI"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var a=this.findParentByType("awesomewindow").getDataURI("supplierURI");var c=this.ownerCt.items.itemAt(11);this.getStore().removeAll();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/services",this.getStore().load({})}}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Duration :"},{xtype:"numberfield",name:"duration",width:99},{border:false},{border:false},{border:false},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Status :"},{xtype:"textfield",name:"status",width:99}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:150,items:[{xtype:"panel",columnWidth:0.55,height:150,items:[{xtype:"panel",layout:"table",layoutConfig:{columns:2},items:[]},{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"EEE",width:500,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="dayTours" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 50px; position:inherit; ">{date}</th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<td style="  ">OK{unreservedAvailable}</td>',"</tpl>","</tr>","<tr >",'<tpl for="list">','<td ><input type="checkbox" class=" x-form-checkbox x-form-field" id= "{date}"></td>',"</tpl>","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 220px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var l=document.getElementsByClassName("dayTours")[0].rows[2].getElementsByTagName("input");var f=document.getElementsByClassName("dayTours")[0].rows[2].getElementsByTagName("input").length;var a=[];var c="";var e=[];unSelectedDateArray=[],selectionOfDate=[];var k={},j=false,m=[];for(var d=0;d<l.length;d++){if(l[d].checked){a.push(l[d].id);c=c.concat(l[d].id).concat(",")}else{c=c.concat("$")}}var m=c.split("$").filter(Boolean);for(var d=0;d<m.length;d++){selectionOfDate.push(m[d].split(",").filter(Boolean))}var n=Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections()[0].data;var b="",h="",g={};selectionOfDate.forEach(function(p,o){for(var q=0;q<p.length;q++){if(q==0){b=new Date(p[0]);h=new Date(Date.parse(p[0])+p.length*86400000);n.departureDate=b;g=JSON.stringify(n)}}e.push(JSON.parse(g))});Ext.getCmp("SIGHTGrid").store.loadData(e);this.findParentByType("tabpanel").setActiveTab(2)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"availss",handler:function(){var a={};var b=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var d=Ext.getCmp("deptDate").getValue();var c=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+this.findParentByType("awesomewindow").getData("rateURI")+"/availabilty/daytour",method:"POST",params:{offeringId:Ext.getCmp("d").getValue(),paxtype:Ext.getCmp("rate").getValue(),inDate:d,dateDays:6,numberToReserve:1},success:function(e,f){var g=Ext.decode(e.responseText);Ext.getCmp("EEE").tpl.overwrite(Ext.getCmp("EEE").body,g)},scope:this})}},{xtype:"button",text:"Cancel",style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("tabpanel").getActiveTab().findByType("combo");a[0].reset();a[1].reset();a[2].reset();a[3].reset();var c=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");c[5].reset();c[6].reset();c[7].reset();var b=[];Ext.getCmp("EEE").tpl.overwrite(Ext.getCmp("EEE").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){}}]}]}]},{title:"Transfers",layout:"form",frame:true,items:[{xtype:"panel",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:110,layoutConfig:{columns:2},items:[{html:"Guest :",style:"text-decoration: underline; ",width:50},{xtype:"combo",width:30,name:"guestNo",width:30,store:[0,1,2,3,4,5,6,7,8,9,10],name:"G1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"combo",width:30,name:"adultNo",width:30,value:1,store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"combo",width:30,store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:250,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:4},items:[{html:"Package Price :",width:80},{xtype:"textfield",width:40},{width:10},{xtype:"textfield",width:80}]}]},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).items.itemAt(0).getValue();var d=this.items.itemAt(8).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(13).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationURI",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; ",html:"Date:"},{xtype:"datefield",width:120,format:"dMy",name:"deptDate",id:"deptDate3"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Mode :"},{xtype:"combo",width:120,id:"modeType",name:"transferModeTypeURI",mode:"local",triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/modetypes/collection",identifier:"transfer/modetypes",fields:["name","dataURI"]})},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Time  :"},{xtype:"textfield",width:99,name:"time"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"From :"},{xtype:"combo",name:"transferPlaceTypeFromURI",mode:"local",fieldLabel:"From*",width:120,listWidth:135,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/placetypes/collection",identifier:"transfer/placetypes",fields:["name","dataURI"]})},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Status :"},{xtype:"textfield",width:83,name:"status"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 70px; padding-left: 20px; ",html:"To :"},{xtype:"combo",name:"transferPlaceTypeToURI",mode:"local",fieldLabel:"To*",width:120,listWidth:135,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/placetypes/collection",identifier:"transfer/placetypes",fields:["name","dataURI"]})},{border:false},{},{border:false}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:100,items:[{xtype:"panel",columnWidth:0.55,height:100,items:[{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"iii",width:450,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="transfer" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 50px; position:inherit; ">{date}</th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<td style="  ">OK{unreservedAvailable}</td>',"</tpl>","</tr>","<tr >",'<tpl for="list">','<td ><input type="checkbox" class=" x-form-checkbox x-form-field" id= "{date}"></td>',"</tpl>","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 250px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var l=document.getElementsByClassName("transfer")[0].rows[2].getElementsByTagName("input");var f=document.getElementsByClassName("transfer")[0].rows[2].getElementsByTagName("input").length;var a=[];var c="";var e=[];unSelectedDateArray=[],selectionOfDate=[];var k={},j=false,m=[];for(var d=0;d<l.length;d++){if(l[d].checked){a.push(l[d].id);c=c.concat(l[d].id).concat(",")}else{c=c.concat("$")}}var m=c.split("$").filter(Boolean);for(var d=0;d<m.length;d++){selectionOfDate.push(m[d].split(",").filter(Boolean))}var n=Ext.getCmp("tranfergrid").getSelectionModel().getSelections()[0].data;var b="",h="",g={};selectionOfDate.forEach(function(p,o){for(var q=0;q<p.length;q++){if(q==0){b=new Date(p[0]);h=new Date(Date.parse(p[0])+p.length*86400000);n.departureDate=b;g=JSON.stringify(n)}}e.push(JSON.parse(g))});Ext.getCmp("tranfergrid").store.loadData(e);this.findParentByType("tabpanel").setActiveTab(2)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"availss",handler:function(){var a={};var b=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var d=Ext.getCmp("deptDate3").getValue();var c=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+this.findParentByType("awesomewindow").getData("rateURI")+"/availabilty/transfer",method:"POST",params:{offeringId:Ext.getCmp("tranfergrid").getSelectionModel().getSelections()[0].get("dataURI"),modeype:Ext.getCmp("modeType").getValue(),paxtype:Ext.getCmp("rate2").getValue(),inDate:d,dateDays:6,numberToReserve:1},success:function(e,f){var g=Ext.decode(e.responseText);Ext.getCmp("iii").tpl.overwrite(Ext.getCmp("iii").body,g)},scope:this})}},{xtype:"button",text:"Cancel",style:" padding-left: 50px;",handler:function(){var b=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");b[1].reset();b[2].reset();b[3].reset();b[4].reset();b[5].reset();b[6].reset();b[7].reset();b[8].reset();b[9].reset();var a=[];Ext.getCmp("iii").tpl.overwrite(Ext.getCmp("iii").body,a)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){}}]}]}]}]},{xtype:"button",text:"Price Summary",style:"padding-left:10px;",listeners:{click:function(){var a=this.findParentByType("awesomewindow").getData("stateRoomStore");var c=this.findParentByType("awesomewindow").getDataURI("pnr");var b=this.findParentByType("awesomewindow").getData("cruiseSelectedRecord");this.findParentByType("awesomewindow").hide();TDS.window.setWindow({title:"Cabin Pricing",interfaceURI:"pnr/offerings/cruise/cruisepricing.js",buttonOK:false,buttonCancel:"Close",data:{stateRoomStore:a,cruiseSelectedRecord:b},dataURI:{pnr:c,stateRoomStore:a,cruiseSelectedRecord:b},callback:{fn:function(e,f,d){if(e){}}}})}}}]}