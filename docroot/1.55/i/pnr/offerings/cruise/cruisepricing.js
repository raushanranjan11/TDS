{height:500,width:990,closable:true,resizable:false,border:false,xtype:'panel',modal:true,config:{packagePrice:""},listeners:{render:function(me){var stateRoomStore=this.findParentByType('awesomewindow').getData('stateRoomStore');this.config.packagePrice=stateRoomStore;}},items:[{xtype:'tabpanel',activeTab:0,layoutOnTabChange:true,modal:true,height:500,defaults:{},items:[{title:'Price',layout:'form',closable:false,frame:true,width:1000,height:400,items:[{xtype:'panel',height:50,style:'padding:10px;',layout:'table',layoutConfig:{columns:5},items:[{width:20},{html:'<font size="3"><b><u>Cruise Pricing</u></font></b>',style:'padding-left:220px;'},]},{xtype:'panel',height:500,border:true,layout:'table',layoutConfig:{columns:2},listeners:{},items:[{xtype:'panel',height:420,border:true,items:[{xtype:'tabpanel',border:true,height:415,width:700,modal:true,defaults:{},listeners:{tabchange:function(me,tab){var stateroomData=this.findParentByType('tabpanel').ownerCt.config.packagePrice;if(!(typeof(me.getActiveTab().findByType('label')[1])=='undefined')){var aa=me.getActiveTab().findByType('label')[1].text
if('#'==aa.substr(aa.length-1,aa.length)){Ext.getCmp('package').enable()}else{Ext.getCmp('package').disable()}}},beforeremove:function(me){var priceForStateroom=this.getActiveTab().findByType('label')[3].text;var aa=Ext.getCmp('html').text
var totalPrice=parseInt(aa.substr(4))
Ext.getCmp('html').setText('AUD '+(totalPrice-priceForStateroom));var activeTab=me.getActiveTab();var indexofTab=me.items.indexOf(activeTab);var rec=me.findParentByType('tabpanel').ownerCt.config.packagePrice.getAt(indexofTab);me.findParentByType('tabpanel').ownerCt.config.packagePrice.remove(rec,true);},remove:function(){Ext.Msg.alert('Status','Changes saved successfully.');},beforerender:function(tab){var stateroomData=[];var stateroomData=this.findParentByType('tabpanel').ownerCt.config.packagePrice;var stateRoomStore=this.findParentByType('awesomewindow').getData("stateRoomStore");var a=0;stateRoomStore.each(function(rec,i){tab.add({title:'Stateroom '+rec.data.room,id:'tab '+i,xtype:'panel',closable:false,autoScroll:true,layout:'form',height:420,width:650,style:'padding-left:40px;',config:{record:{},stateroom:rec.data,extraCollection:[],totalExtra:0},listeners:{render:function(){},tabchange:function(me,tab){}},items:[{xtype:'panel',width:550,height:30,border:true,style:'padding-left:200px;',listeners:{render:function(){this.add({xtype:'panel',width:450,height:30,autoScroll:true,style:'padding-top:10px;',border:true,items:[{xtype:'label',style:'font-size: 16px;font-weight: bold;',text:'Deal :'},{xtype:'label',id:'dealName'+i,style:'padding-left:5px;font-size: 16px;font-weight: bold;',listeners:{render:function(){this.setText(rec.data.deal);}}},{xtype:'label',text:'STR Total:',style:'padding-left:10px;font-weight: bold;font-size: 16px;'},{xtype:'label',text:'',width:200,id:'srtTotal',name:'totalprice',style:'padding-left:5px;font-weight: bold;font-size: 16px;',listeners:{render:function(){var me=this;}}},]});this.doLayout();}}},{id:'cc',tpl:new Ext.XTemplate(['<div style="height: 370px;'+'width:auto; overflow-y:auto;'+'margin-top: 8px;padding-left:20px;">','<table class="x-tds-dataview",style="width: 150%;">','<thead>','<tr>','<th style="padding-bottom: 2px;width: 180px;">Details</th>','<tpl for="paxcount">','<th style="width: 120px; padding-bottom: 2px;">Pax {.}</th>','</tpl>','</tr>','</thead>','<tr>','<td style="padding-bottom: 2px;width: 180px;">Cruise Only</td>','<tpl if="cruise">','<tpl for="paxperPrice" >','<td style="width: 120px; padding-bottom: 2px;"  id="cruiseOnly" class = "cruiseOnly"> AUD {.} </td>','</tpl>','</tpl>','<tpl elseif="!cruise">','<tpl for="paxperPrice" >','<td style="width: 100px; padding-bottom: 2px;">  </td>','</tpl>','</tpl>','</tr>','<tr>','<td style="padding-bottom: 2px;width: 180px;">Cruise Package</td>','<tpl if="cruisePackage">','<tpl for="paxperPrice" >','<td style="width: 100px; padding-bottom: 2px;"> AUD {.} </td>','</tpl>','</tpl>','<tpl elseif="!cruisePackage">','<tpl for="paxperPrice" >','<td style="width: 100px; padding-bottom: 2px;">  </td>','</tpl>','</tpl>','</tr>','<tr>','<td style="padding-bottom: 2px;width: 180px;">Air</td>','<tpl for="count">','<td style="width: 100px; padding-bottom: 2px;"> </td>','</tpl>','</tr>','<tpl for="extras">','<tr>','<tpl if="priceIsCredit;">','<td style="padding-bottom: 2px;width: 180px;">{name}</td>','<tpl for="parent.count" >','<td style="width: 100px; padding-bottom: 2px;">{parent.pricingPriceSell}.00(CR)<br></td> ','</tpl>','</tpl>','</tr>','</tpl>','<tpl for="extras">','<tr>','<tpl if="!priceIsCredit;">','<td style="padding-bottom: 2px;width: 180px;">{name}</td>','<tpl for="parent.count" >','<td style="width: 100px; padding-bottom: 2px;">{parent.pricingPriceSell}.00<br></td> ','</tpl> ','</tpl> ','</tr>','</tpl> ','<tr>','<td style="padding-bottom: 2px;width: 180px;">Totals</td>','<tpl for="count" >','<td style="width: 100px; padding-bottom: 2px;" id="totalSrt" class = "totalSrt" >AUD {parent.totalPrice} </td>','</tpl>','</tpl>','</tr>','</table>','</div>',]),listeners:{render:function(){var me=this;var extra=[];var flag=('#'==rec.data.deal.substr(rec.data.deal.length-1,rec.data.deal.length));var total=rec.data.totalPax;var totalPrice=0;var data={count:[],paxcount:[],paxperPrice:[],cruise:'',cruisePackage:'',extras:[],};var offeringURI=this.findParentByType('awesomewindow').getDataURI('offeringURI');Ext.Ajax.request({url:TDS.env.dataPath+offeringURI+'/extras/collections',method:'GET',enableSession:false,params:{},success:function(response,request){var ro=Ext.decode(response.responseText);var collection=ro[offeringURI+'/extras'];if(typeof collection=='undefined')
return;var sd=[];for(var i=0;i<collection.length;i++){ro[collection[i]].dataURI=collection[i];sd.push(ro[collection[i]]);}
data.extras=sd;}});var label=this.ownerCt.ownerCt.findByType('label');var flag=('#'==rec.data.deal.substr(rec.data.deal.length-1,rec.data.deal.length));var total=rec.data.totalPax;var totalPrice=0;var cruisePackagePrice=0;for(var i=1;i<=total;i++){data.paxcount.push(i);data.count.push(i);var price=(Number(rec.data.price));if(Number.isNaN(price)){var p=parseFloat(rec.data.price.substring(3,rec.data.price.length));data.paxperPrice.push((p / total).toFixed(2));data.cruise=!flag,data.cruisePackage=flag;cruisePackagePrice=(p/ total).toFixed(2)}else{data.paxperPrice.push((parseFloat(rec.data.price)/ total).toFixed(2));data.cruise=!flag,data.cruisePackage=flag;cruisePackagePrice=(parseFloat(rec.data.price)/ total).toFixed(2)}}
data.totalPax=total;var me=this;var discount=0;setTimeout(function(){data.extras.forEach(function(rec){if(rec.name=='Discount'){totalPrice-=(rec.pricingPriceSell)}else if(rec.name=='Future Cruise Credits'){totalPrice-=(rec.pricingPriceSell)}else{totalPrice+=(rec.pricingPriceSell)}});data.totalPax=total;data.totalPrice=(totalPrice+parseFloat(cruisePackagePrice)).toFixed(2);var totalvaluePrice=me.findParentByType('tabpanel').ownerCt.ownerCt.items.itemAt(1).findByType('label')[0].text;var p=0;if(typeof(totalvaluePrice)!="undefined"){p=parseFloat(totalvaluePrice.substring(3,totalvaluePrice.length));}else{totalvaluePrice=0;p=parseFloat(0);}
me.findParentByType('tabpanel').ownerCt.ownerCt.items.itemAt(1).findByType('label')[0].setText('AUD '+((totalPrice+p+parseFloat(cruisePackagePrice))*data.totalPax).toFixed(2));;me.findParentByType('tabpanel').findParentByType('tabpanel').findByType('button')[0].config.cruisePrice=cruisePackagePrice;me.tpl.overwrite(me.body,data);label[3].setText(' AUD '+(totalPrice+parseFloat(cruisePackagePrice)).toFixed(2));me.ownerCt.ownerCt.items.itemAt(0).config.totalExtra=totalPrice;tab.ownerCt.ownerCt.items.itemAt(1).findByType('button')[0].enable();},2000)}}}]}).show();tab.setActiveTab(0);tab.doLayout()
var tplconfig=tab.items.itemAt(i).items.itemAt(0);});},},},]},{xtype:'panel',height:400,width:350,items:[{xtype:'panel',height:60,width:320,layout:'table',layoutConfig:{columns:2},items:[{xtype:'panel',height:60,width:180,layout:'table',layoutConfig:{columns:1},items:[{html:'<font size="3"><b><u>Total Price</u></font></b>',style:'padding-left:40px;'},{xtype:'label',style:'padding-left:50px; font-size: large;',id:'html',listeners:{render:function(){}}},]},{xtype:'button',text:'Adjust',minWidth:80,disabled:true,id:'adjust',config:{cruisePrice:'0',discount:'0',commission:'0',priceAmount:'0',flag:false},listeners:{render:function(){var adjustmentMarkup=this.findParentByType('awesomewindow').getData("adjustmentMarkup");if(adjustmentMarkup!=''){this.config=adjustmentMarkup}},click:function(button){var disabled=button.config.flag;var winn=new Ext.Window({width:500,height:350,closeAction:'hide',title:'Price Adjust',modal:true,closable:true,items:[{xtype:'form',height:280,style:'padding:10px;',frame:true,layout:'auto',border:true,items:[{html:'<font size="3"><b><u>Price Adjust</u></font></b>',style:'padding-left:180px;'},{xtype:'panel',style:'padding-top:15px;',border:true,layout:'column',items:[{xtype:'panel',style:'padding-top:15px;',width:355,border:true,layout:'column',items:[{html:'<font size="2"><b>Total Price(Excluding Extra\'s)</font></b>',},{xtype:'label',style:'margin-left:90px; font-size: small;',text:'',id:'total',name:'totalprice',listeners:{render:function(){var pax=button.findParentByType('awesomewindow').getData("stateRoomStore").data.items[0].data.totalPax;if(!button.config.flag){this.setText('AUD '+button.config.cruisePrice*pax);}else{var totalCruisePrice=button.findParentByType("awesomewindow").getData("totalCruisePrice");var price=0;if(typeof(totalCruisePrice)=='undefined'){this.setText('AUD '+button.config.cruisePrice);}else{this.setText(totalCruisePrice);}}}}},]},{xtype:'panel',style:'float:right',border:false,layout:'auto',items:[{html:'<font size=".5"><b><u>Supplier\'s Comm</u></font></b>',},{html:'<font size="1"><b>(10.00 %)</font></b>',},]}]},{html:'<font size="2"><b><u>Markup</u></font></b>',style:'margin-bottom:5px;'},{xtype:'panel',style:'padding:2px;',border:false,layout:'table',id:'panel',layoutConfig:{columns:4},defaults:{style:'   top: 15px;'},calculateCommission:function(byPercentage){var form=this.findParentByType('form').getForm();var totalPriceExcluingExtra=this.ownerCt.findByType('label')[0].text;var pax=button.findParentByType('awesomewindow').getData("stateRoomStore").data.items[0].data.totalPax;var price=parseFloat(totalPriceExcluingExtra.substring(3,totalPriceExcluingExtra.length)/ pax);var totalPrice=parseFloat(totalPriceExcluingExtra.substring(3,totalPriceExcluingExtra.length));if(byPercentage){var discounts=0
if(form.findField('discount').getValue()==""){discounts=0;}else{discounts=form.findField('discount').getValue();}
var result=0;if(form.findField('priceAmount').getValue()==""){result=0;}else{result=parseFloat(form.findField('priceAmount').getValue());}
var perPaxAdjustment=(result-discounts)/ pax;this.ownerCt.findByType('label')[1].setText('AUD '+((result+totalPrice)-(form.findField('discount').getValue())).toFixed(2));button.ownerCt.findByType('label')[0].setText('AUD '+((result+totalPrice)-(form.findField('discount').getValue())).toFixed(2));Ext.getCmp('srtTotal').setText('AUD '+((result+totalPrice)-(form.findField('discount').getValue())).toFixed(2));var perPaxDiv=document.getElementsByClassName('cruiseOnly');for(var x=0;x<perPaxDiv.length;x++){perPaxDiv[x].innerHTML='AUD '+(price+perPaxAdjustment).toFixed(2);}
var perPaxDiv_srt=document.getElementsByClassName('totalSrt');for(var x=0;x<perPaxDiv_srt.length;x++){perPaxDiv_srt[x].innerHTML='AUD '+(price+perPaxAdjustment).toFixed(2);}
var profit=((10 / 100)*((totalPrice+result)-discounts));this.ownerCt.findByType('label')[2].setText('AUD '+((profit)).toFixed(2));}},calculatePercentCommission:function(amount){var totalPriceExcluingExtra=this.ownerCt.findByType('label')[0].text;var form=this.findParentByType('form').getForm();var totalPrice=parseFloat(totalPriceExcluingExtra.substring(3,totalPriceExcluingExtra.length));var pax=button.findParentByType('awesomewindow').getData("stateRoomStore").data.items[0].data.totalPax;var price=parseFloat(totalPriceExcluingExtra.substring(3,totalPriceExcluingExtra.length)/ pax);if(amount){var discounts=0
if(form.findField('discount').getValue()==""){discounts=0;}else{discounts=form.findField('discount').getValue();}
var result=parseFloat(form.findField('percent').getValue()*price)/ 100;var perPaxAdjustment=(result-discounts)/ pax;if(!isNaN(result))
form.findField('priceAmount').setValue((result).toFixed(2));this.ownerCt.findByType('label')[1].setText('AUD '+((result+totalPrice)-(form.findField('discount').getValue())).toFixed(2));button.ownerCt.findByType('label')[0].setText('AUD '+((result+totalPrice)-(form.findField('discount').getValue())).toFixed(2));Ext.getCmp('srtTotal').setText('AUD '+((result+totalPrice)-(form.findField('discount').getValue())).toFixed(2));var perPaxDiv=document.getElementsByClassName('cruiseOnly');for(var x=0;x<perPaxDiv.length;x++){perPaxDiv[x].innerHTML='AUD '+(price+perPaxAdjustment).toFixed(2);}
var perPaxDiv_srt=document.getElementsByClassName('totalSrt');for(var x=0;x<perPaxDiv_srt.length;x++){perPaxDiv_srt[x].innerHTML='AUD '+(price+perPaxAdjustment).toFixed(2);}
var profit=((10 / 100)*((totalPrice+result)-discounts));this.ownerCt.findByType('label')[2].setText('AUD '+((profit)).toFixed(2));}},items:[{xtype:'combo',width:90,name:'amount',enableKeyEvents:true,mode:'local',editable:false,width:100,typeAhead:true,excludeFromSession:true,triggerAction:'all',forceSelection:true,selectOnFocus:true,displayField:'name',valueField:'dataURI',value:'Amount',disabled:disabled,store:new Ext.data.SimpleStore({fields:['dataURI','name'],data:[['Amount','Amount'],['Percent','Percent']]}),listeners:{select:function(me,eOpts){if(me.getValue()=="Percent"){me.ownerCt.items.itemAt(1).enable();}else{me.ownerCt.items.itemAt(1).disable();me.ownerCt.items.itemAt(1).setValue();me.ownerCt.items.itemAt(3).setValue();}}}},{xtype:'numberfield',name:'percent',decimalPrecision:2,disabled:true,width:40,style:'margin-left: 25px;',enableKeyEvents:true,setValue:function(v){Ext.form.NumberField.superclass.setValue.call(this,this.fixPrecision(this.parseValue(v)));},fixPrecision:function(value){var nan=isNaN(value);if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){return nan?'':value;}
return parseFloat(value).toFixed(this.decimalPrecision);},listeners:{keyup:function(me,e){var p=this.ownerCt;p.calculatePercentCommission(true);},render:function(me){var priceCommission=button.findParentByType('awesomewindow').getData("priceCommission");this.setValue(priceCommission);var val=parseFloat(Ext.getCmp('adjust').config.commission);if(val>0){this.setValue(val)}}}},{html:'<font size="2"><b>%</font></b>',},{xtype:'numberfield',width:80,style:'margin-left:90px;',name:'priceAmount',enableKeyEvents:true,disabled:disabled,setValue:function(v){Ext.form.NumberField.superclass.setValue.call(this,this.fixPrecision(this.parseValue(v)));},fixPrecision:function(value){var nan=isNaN(value);if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){return nan?'':value;}
return parseFloat(value).toFixed(this.decimalPrecision);},listeners:{keyup:function(){var p=this.ownerCt;p.calculateCommission(true);},render:function(me){var val=parseFloat(Ext.getCmp('adjust').config.priceAmount);if(val>0){this.setValue(val)}}}},{html:'<font size="2"><b>Discount</font></b>',style:"margin-top:20px;",},{},{},{xtype:'numberfield',width:80,style:'margin-left:90px;',decimalPrecision:2,enableKeyEvents:true,name:'discount',disabled:disabled,setValue:function(v){Ext.form.NumberField.superclass.setValue.call(this,this.fixPrecision(this.parseValue(v)));},fixPrecision:function(value){var nan=isNaN(value);if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){return nan?'':value;}
return parseFloat(value).toFixed(this.decimalPrecision);},listeners:{render:function(me){var discount=parseFloat(button.findParentByType('awesomewindow').getData("discount"));this.setValue(discount);var val=parseFloat(Ext.getCmp('adjust').config.discount);if(val>0){this.setValue(val);}},keyup:function(){var p=this.ownerCt;p.calculateCommission(true);},}},]},{html:'<hr>',style:'padding-left:200px;',},{xtype:'panel',style:'padding-left:200px;',border:false,layout:'table',layoutConfig:{columns:4},items:[{html:'<font size="2"><b>New Total</font></b>',},{style:'padding-left:20px;font-size: small;',xtype:'label',text:'',name:'totalPriceWithMarkup',id:'totalp',listeners:{render:function(){var priceCommission=parseFloat(button.findParentByType('awesomewindow').getData("priceCommission"));var form=this.findParentByType('form').getForm();var totalPriceExcluingExtra=this.ownerCt.ownerCt.findByType('label')[0].text;var price=0;if(typeof(totalPriceExcluingExtra)!='undefined'){price=parseFloat(totalPriceExcluingExtra.substring(3,totalPriceExcluingExtra.length));}
if((button.findParentByType('awesomewindow').getData("adjustmentMarkup"))!=''){var adjustmentMarkup=(button.findParentByType('awesomewindow').getData("adjustmentMarkup"));var totalCruisePrice=button.findParentByType("awesomewindow").getData("totalCruisePrice");this.setText(totalCruisePrice);}else{this.ownerCt.ownerCt.findByType('label')[1].setText('AUD '+(price).toFixed(2));}}}}]},{html:'<hr>'},{xtype:'panel',border:false,style:'padding-left:150px;padding-top:5px;',items:[{html:'<font size="2"><b>Total Profit Amount</font></b>',},{style:'padding-top:5px;padding-left:35px;font-size: medium;',xtype:'label',text:'',name:'totalProfitWithMarkup',listeners:{render:function(){var totalPriceExcluingExtra=this.findParentByType('window').findByType('label')[0].text;var price=0;if(typeof(totalPriceExcluingExtra)!='undefined'){price=parseFloat(totalPriceExcluingExtra.substring(3,totalPriceExcluingExtra.length));}
var profit=(10 / 100)*price;this.setText('AUD '+(profit).toFixed(2));}}}]},]},{xtype:'panel',style:'float:right',border:false,frame:true,layout:'table',layoutConfig:{columns:5},items:[{xtype:'button',text:'Edit',handler:function(close){var form=this.findParentByType('window').findByType('form')[0].getForm();form.findField('priceAmount').enable();form.findField('discount').enable();form.findField('amount').enable();}},{border:false,width:5},{xtype:'button',text:'Save',id:'save',handler:function(close){var form=this.findParentByType('window').findByType('form')[0].getForm();var commission=form.findField('percent').getValue();var priceAmount=form.findField('priceAmount').getValue();var discount=form.findField('discount').getValue();button.config.commission=commission;button.config.priceAmount=priceAmount;button.config.discount=discount;var priceWithMarkup=this.findParentByType('window').findByType('label')[1].text;var price=parseFloat(priceWithMarkup.substring(3,priceWithMarkup.length));button.config.cruisePrice=price;button.config.flag=true;close.findParentByType('window').close();}},{border:false,width:5},{xtype:'button',text:'Close',handler:function(close){close.findParentByType('window').close();}}]},]}).show();}}}]},{xtype:'fieldset',height:110,width:225,layout:'auto',style:"margin-top: 10px;margin-left:25px;",items:[{width:200,tpl:new Ext.XTemplate(['<div style="height: 55px;overflow-x:hidden;    ">','<table style="width: 100%;">','<thead>','<tr>','<td style="padding-bottom: 2px;width: 180px;">Deposit  :</td> <td></td>','</tr>','<tr>','<td style="width: 100px; padding-bottom: 2px;">Deposit Due:</td><td></td>','</tr>','<tr>','<td style="width: 100px; padding-bottom: 2px;">Final Payments Due : </td><td></td>','</tr>','</thead>',]),listeners:{render:function(){this.tpl.overwrite(this.body,'');}}},{xtype:'button',minWidth:100,text:'Terms & Conditions',style:'margin-left:55px;margin-top:7px;',config:{tnc:''},listeners:{click:function(button){var b=new Ext.Window({height:150,width:400,closable:true,resizable:false,border:false,layout:"fit",modal:true,items:[{xtype:"panel",width:400,height:120,border:false,items:[{xtype:"htmleditor",name:"termsAndConditions",height:"auto",hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:true,enableLists:true,enableSourceEdit:false,enableFontSize:true,enableFont:false,enableColors:true,enableAlignments:true,disabled:true,listeners:{render:function(me){this.getToolbar().hide();this.setValue(button.config.tnc);}}}]}]}).show()}}}],listeners:{render:function(me){var p=this.findParentByType("awesomewindow");var offeringURI=p.getData('offeringURI')
Ext.Ajax.request({url:TDS.env.dataPath+offeringURI+'/termsAndCondition',method:'GET',enableSession:false,params:{},success:function(response,request){var ro=Ext.decode(response.responseText);me.findByType('button')[0].config.tnc=ro.termsAndConditions}})}}},{xtype:"panel",width:250,items:[{xtype:"fieldset",style:"margin-top: 20px;margin-left:25px;",layout:"table",layoutConfig:{columns:2},autoHeight:true,defaults:{colspan:2,xtype:"radio",name:"action",forceSubmit:true,hideLabel:true,},items:[{boxLabel:"Book ",cls:'x-test-style',inputValue:"book",labelStyle:'font-size:larger;',listeners:{render:function(){var boxLabel=Ext.DomQuery.selectNode('LABEL',this.getEl().dom.parentNode);boxLabel.style.fontWeight='bold';},check:function(me,checked){if(checked){Ext.getCmp('conttt').enable()}}}},{boxLabel:"Quote",inputValue:"quote",listeners:{render:function(){var boxLabel=Ext.DomQuery.selectNode('LABEL',this.getEl().dom.parentNode);boxLabel.style.fontWeight='bold';},check:function(me,checked){if(checked){Ext.getCmp('conttt').enable()}}}}]},]},{xtype:'panel',height:30,width:300,layout:'table',style:'padding-left:100px;',layoutConfig:{columns:3},items:[{xtype:'button',text:'Print',minWidth:100},]},{xtype:'panel',height:30,width:300,layout:'table',style:'padding-left:60px;',layoutConfig:{columns:3},items:[{xtype:'button',id:'package',text:'Package',minWidth:100,style:'padding-left:20px;',disabled:true,listeners:{click:function(){var cruiseSelectedRecord=this.findParentByType('awesomewindow').getData("cruiseSelectedRecord");var stateroomData=this.findParentByType('awesomewindow').getData("stateRoomStore");var pnr=this.findParentByType('awesomewindow').getDataURI("pnr");var p=this.findParentByType("awesomewindow");var offeringURI=p.getData('offeringURI')
var dateFrom=p.getData('dateFrom');var tabpanel=me.findParentByType('tabpanel').findByType('tabpanel')[0];var activeTab=tabpanel.getActiveTab();var activeTabIndex=tabpanel.items.indexOf(activeTab);var totalPrice=tabpanel.getActiveTab().findByType('label')[3].text;var title=tabpanel.getActiveTab().title;var rateGrid=this.findParentByType('awesomewindow').initialConfig.config.rategrid;this.findParentByType('awesomewindow').hide();TDS.window.setWindow({title:'Cruise Package',interfaceURI:'pnr/offerings/cruise/package.js',postDataURI:pnr+'/componentsbook/updatePackages',buttonOK:false,buttonCancel:false,config:{rategrid:rateGrid},dataURI:{pnr:pnr,},mergeData:true,data:{'stateRoomData':stateroomData,'stateRoom':stateroomData,"offeringURI":offeringURI,'dateFrom':dateFrom,'stateRoomStore':stateroomData,cruiseSelectedRecord:cruiseSelectedRecord,title:title,totalPrice:totalPrice,"rateURI":p.getData('rateURI'),},callback:{fn:function(s,data,responseData){if(s){}
scope:this}}});},render:function(me){setTimeout(function(){var aa=me.findParentByType('tabpanel').findByType('tabpanel')[0].getActiveTab().findByType('label')[1].text
if('#'==aa.substr(aa.length-1,aa.length)){Ext.getCmp('package').enable()}else{Ext.getCmp('package').disable()}},1000);}}},{xtype:'button',text:'FIT',minWidth:100,style:'padding-left:20px;',handler:function(){var cruiseSelectedRecord=this.findParentByType('awesomewindow').getData("cruiseSelectedRecord");var stateroomData=this.findParentByType('awesomewindow').getData("stateRoomStore");var pnr=this.findParentByType('awesomewindow').getDataURI("pnr");var p=this.findParentByType("awesomewindow");var offeringURI=p.getData('offeringURI')
var dateFrom=p.getData('dateFrom');var rateGrid=this.findParentByType('awesomewindow').initialConfig.config.rategrid
this.findParentByType('awesomewindow').hide();TDS.window.setWindow({title:'Cruise Package',interfaceURI:'pnr/offerings/cruise/additionCruise.js',buttonOK:"Save",config:{rategrid:rateGrid},dataURI:{pnr:pnr,},mergeData:true,data:{'stateRoomData':stateroomData,'stateRoom':stateroomData,"offeringURI":offeringURI,'dateFrom':dateFrom,'stateRoomStore':stateroomData,cruiseSelectedRecord:cruiseSelectedRecord,},callback:{fn:function(s,data,responseData){if(s){}
scope:this}}});}},]},{xtype:'panel',height:30,width:300,layout:'table',style:'padding-left:100px;',layoutConfig:{columns:3},items:[{xtype:'button',id:'conttt',text:'Continue',disabled:true,minWidth:100,listeners:{click:function(){var cruiseAdjustment=this.findParentByType('awesomewindow').findByType('button')[0].config
var passengerRange=this.findParentByType('awesomewindow').getData("passengerRange")
var pnr=this.findParentByType('awesomewindow').getDataURI("pnr");var p=this.findParentByType("awesomewindow");var offeringURI=p.getData('offeringURI');var dateFrom=p.getData('dateFrom');var cruiseSelectedRecord=this.findParentByType('awesomewindow').getDataURI("cruiseSelectedRecord");var stateroomData=this.findParentByType('awesomewindow').getData("stateRoomStore");var accommodationRecords=this.findParentByType('awesomewindow').getData("accommodationRecords");var transferRecords=this.findParentByType('awesomewindow').getData("transferRecords");var daytoursRecords=this.findParentByType('awesomewindow').getData("daytoursRecords");var accStore=this.findParentByType('awesomewindow').getData("accStore");var dayTourstore=this.findParentByType('awesomewindow').getData("dayTourstore");var transferStore=this.findParentByType('awesomewindow').getData("transferStore");var isCruisePackage=Ext.getCmp('package').disabled;var rateGrid=this.findParentByType('awesomewindow').initialConfig.config.rategrid;var adjustmentMarkup=this.findParentByType('awesomewindow').findByType('button')[0].config;this.findParentByType('awesomewindow').hide();var book=this.ownerCt.ownerCt.findByType('radio')[0].getValue();var totalCruisePrice=this.findParentByType('tabpanel').items.itemAt(0).findByType('label')[4].text;var totalExtra=this.findParentByType('tabpanel').findByType('tabpanel')[0].findByType('panel')[0].config.totalExtra;TDS.window.setWindow({title:'Pax Review',interfaceURI:'pnr/offerings/cruise/paxReview.js',postDataURI:pnr+'/componentsbook/cruisePackages',buttonOK:"Finished",config:{rategrid:rateGrid},dataURI:{pnr:pnr,offering:offeringURI,cruiseSelectedRecord:cruiseSelectedRecord},mergeData:true,data:{'stateRoomData':stateroomData,'stateRoomStore':stateroomData,"offeringURI":offeringURI,'dateFrom':dateFrom,cruiseSelectedRecord:cruiseSelectedRecord,'stateRoom':stateroomData,accommodationRecords:accommodationRecords,transferRecords:transferRecords,daytoursRecords:daytoursRecords,accStore:accStore,dayTourstore:dayTourstore,transferStore:transferStore,cruisePackagePrice:stateroomData.data.items[0].data.price,isCruisePackage:!isCruisePackage,bookQuote:book,totalCruisePrice:totalCruisePrice,adjustmentMarkup:adjustmentMarkup,totalExtra:totalExtra,passengerRange:passengerRange},params:{},callback:{fn:function(s,data,responseData){if(s){rateGrid.ownerCt.findParentByType('pnrpanel').focusView('pnrView','pnr');}
scope:this}}});}}},]},{xtype:'panel',style:'padding-left:80px;',border:true,items:[{xtype:'panel',border:true,items:[{xtype:'button',text:'Back To Category',minWidth:150,id:'back',listeners:{click:function(){var totalPrice=0
var p=this.findParentByType("awesomewindow");var offeringURI=p.getData('offeringURI')
var dateFrom=p.getData('dateFrom')
var pnr=this.findParentByType('awesomewindow').getDataURI("pnr");var cruiseSelectedRecord=this.findParentByType('awesomewindow').getData("cruiseSelectedRecord");var stateroomData=this.findParentByType('awesomewindow').getData("stateRoomStore");var rateGrid=this.findParentByType('awesomewindow').initialConfig.config.rategrid;this.findParentByType('awesomewindow').hide();TDS.window.setWindow({title:'Category Select',interfaceURI:'pnr/offerings/cruise/category.js',buttonOK:false,buttonCancel:'Close',config:{rategrid:rateGrid},dataURI:{pnr:pnr,offering:offeringURI,cruiseSelectedRecord:cruiseSelectedRecord,stateRoomStore:stateroomData},data:{offeringURI:offeringURI,cruiseSelectedRecord:cruiseSelectedRecord,stateRoomStore:stateroomData},params:{},callback:{fn:function(s,data,responseData){if(s){}}}});}}}]}]},],}],},],listeners:{}},{title:"Stateroom Select",autoScroll:true,width:1000,height:450,frame:true,items:[],},{title:"Stateroom Deck Plan",autoScroll:true,width:1000,height:450,frame:true,items:[],},{title:"Dinning",autoScroll:true,width:1000,height:450,frame:true,items:[],}]}]}
