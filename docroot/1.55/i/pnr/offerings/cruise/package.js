{height:480,width:1020,closable:true,resizable:false,border:false,xtype:"panel",modal:true,layout:"table",layoutConfig:{columns:2},beforeSubmit:function(i){var l=this.findParentByType("awesomewindow").getData("stateRoomStore");var b=this.findParentByType("awesomewindow").getDataURI("pnr");var d=this.findParentByType("awesomewindow").getData("offeringURI");var c=this.findParentByType("awesomewindow");var h=c.getData("dateFrom");var m=this.findParentByType("awesomewindow").getData("cruiseSelectedRecord");console.log(m);l.clearFilter();var n=Ext.getCmp("tranfergrid").getSelectionModel().getSelections();var e=Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections();var k=Ext.getCmp("preHotelGrid").getSelectionModel().getSelections();var a=Ext.getCmp("preHotelGrid").getStore();var j=Ext.getCmp("SIGHTGrid").getStore();var o=Ext.getCmp("tranfergrid").getStore();var g=this.findParentByType("awesomewindow").initialConfig.config.rategrid;this.findParentByType("awesomewindow").hide();TDS.window.setWindow({title:"Cabin Pricing",interfaceURI:"pnr/offerings/cruise/cruisepricing.js",buttonOK:false,buttonCancel:"Close",config:{rategrid:g},data:{offeringURI:d,stateRoomStore:l,stateRoomStore:l,cruiseSelectedRecord:m,dateFrom:h,accommodationRecords:k,transferRecords:n,daytoursRecords:e,accStore:a,dayTourstore:j,transferStore:o},dataURI:{pnr:b,offeringURI:d,cruiseSelectedRecord:m,dateFrom:h},callback:{fn:function(p,q,f){if(p){}}}});console.dir(i);return i},listeners:{render:function(a){}},items:[{xtype:"tabpanel",id:"tab",border:false,activeTab:0,layoutOnTabChange:true,deferredRender:false,width:900,height:500,defaults:{bodyStyle:"padding: 0px 2px 0px 0px;"},items:[{xtype:"panel",title:"Cruise Package",layout:"fit",frame:false,items:[{xtype:"panel",layout:"border",items:[{xtype:"panel",height:50,width:250,frame:true,border:false,region:"north",items:[{xtype:"panel",border:true,layout:"column",items:[{xtype:"panel",height:40,style:" padding-left:20px;padding-top:5px;",layout:"table",layoutConfig:{columns:3},border:true,items:[{html:"AA",border:false,style:"color:red;    font-size: medium;",width:100,listeners:{render:function(){var a=this.findParentByType("awesomewindow").getData("title");this.html="<b>"+a+"</b>"}}},{html:"<b>Package Total : ",style:"margin-left:500px;    font-size: medium;",border:false},{xtype:"label",style:"margin-left:10px;    font-size: medium;",text:"AU$ 0000.00",border:false,width:80,listeners:{render:function(){var a=this.findParentByType("awesomewindow").getData("totalPrice");this.setText("AU$ "+a)}}}]}]}]},{xtype:"panel",height:120,width:250,region:"center",border:false,frame:false,autoScroll:true,items:[{xtype:"panel",border:false,style:"padding-left:20px; padding-top:10px",autoHeight:true,layout:"column",items:[{xtype:"panel",width:150,border:false,items:[{html:"<b>ACCOMMODATION :</b>",border:false,style:" padding:5px"}]},{xtype:"grid",hideHeaders:true,autoHeight:true,border:false,store:new Ext.data.JsonStore({url:"",identifier:"",fields:["locationToString","name","inDate","outDate","roomType","dataURI","accommodationRatingURI","basis","rateUri","status","inventoryTypeURI","maximumOccupancy","packagePrice","isPreHotel","accommodationRate"]}),viewConfig:{forceFit:true},id:"preHotelGrid",sm:new Ext.grid.CheckboxSelectionModel({singleSelect:true}),clicksToEdit:1,cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel({singleSelect:true,dataIndex:"CheckBoxValue"}),{header:"Destination",width:250,fixed:true,dataIndex:"locationToString",renderer:function(e,d,a,f,c,b){return e+" -- "+a.get("name")}},{header:"In Date",width:90,fixed:true,dataIndex:"inDate",renderer:function(e,d,a,f,c,b){if(a.get("inDate")!=""){return"In : "+new Date(a.get("inDate")).format(TDS.env.dateFormatDisplay)}else{return""}}},{header:"Out Date",width:90,fixed:true,dataIndex:"outDate",renderer:function(e,d,a,f,c,b){if(a.get("outDate")!=""){return"Out : "+new Date(a.get("outDate")).format(TDS.env.dateFormatDisplay)}else{return""}}},{header:"Nights",width:50,fixed:true,dataIndex:"night",renderer:function(f,e,b,g,d,c){if(b.get("outDate")!=""&&b.get("inDate")!=""){console.log(b.get("outDate"));console.log(b.get("inDate"));console.log((b.get("outDate")-b.get("inDate")));var a=((new Date(b.get("outDate"))-new Date(b.get("inDate")))/86400000);return"Nts : "+a}else{return"Nts: 0"}}},{header:"Room Type",width:100,fixed:true,dataIndex:"roomType"},{header:"Room Type",dataIndex:"basis",width:120,fixed:true},{header:"Pax",dataIndex:"pax",width:150,renderer:function(g,f,b,h,d,c){var a=Ext.getCmp("preHotelGrid").findParentByType("awesomewindow").getData("stateRoomStore");var e=a.getAt(0).data;e.totalPax;return"Pax :"+e.totalPax}},{header:"Pre",dataIndex:"isPreHotel",renderer:function(e,d,a,f,c,b){if(a.get("isPreHotel")==true){return"(Pre)"}else{return"(Post)"}}}]),listeners:{render:function(){var a=this.findParentByType("awesomewindow").getData("offeringURI");var b=this.findParentByType("awesomewindow");var c=b.getData("dateFrom");console.log(c);Ext.Ajax.request({url:TDS.env.dataPath+this.findParentByType("awesomewindow").getData("offeringURI")+"/accommodations",method:"GET",params:{Ispost:"true",dateFrom:c,dateDays:6,numberToReserve:1},success:function(d,g){var f=Ext.decode(d.responseText);console.log(f);var j=f.preHotels;console.log(j);if(typeof j=="undefined"){return}var h=[];for(var e=0;e<j.length;e++){f[j[e]].dataURI=j[e];h.push(f[j[e]])}Ext.getCmp("preHotelGrid").getStore().loadData(h)}})}}}]},{xtype:"panel",border:false,autoHeight:true,layout:"column",style:"padding-left:20px; padding-top:10px",items:[{xtype:"panel",width:150,border:false,items:[{html:"<b>TRANSFER:</b>",border:false,style:" padding:5px"}]},{xtype:"grid",hideHeaders:true,autoHeight:true,border:false,height:25,store:new Ext.data.JsonStore({url:"",identifier:"",fields:["locationToString","name","inDate","departureDate","modeType","dataURI","rateClassUri","rateUri","status","packagePrice","transferModeTypeURI","accommodationRatingURI","toMode","fromMode","transferPlaceTypeFromURI","transferPlaceTypeToURI","isPre","accommodationRate"]}),viewConfig:{forceFit:true},id:"tranfergrid",sm:new Ext.grid.CheckboxSelectionModel({singleSelect:true}),clicksToEdit:1,cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel({singleSelect:true,dataIndex:"CheckBoxValue"}),{header:"Destination",width:150,fixed:true,dataIndex:"locationToString"},{header:"modeype",fixed:true,width:100,dataIndex:"modeType"},{header:"Out Date",width:90,fixed:true,dataIndex:"departureDate",renderer:function(e,d,a,f,c,b){if(a.get("departureDate")!=""){return new Date(a.get("departureDate")).format(TDS.env.dateFormatDisplay)}else{return""}}},{header:"Room Type",width:140,fixed:true,dataIndex:"fromMode",renderer:function(e,d,a,f,c,b){if(a.get("departureDate")!=""){return"From : "+e}else{return""}}},{header:"Room Type",width:220,fixed:true,dataIndex:"toMode",renderer:function(e,d,a,f,c,b){if(a.get("departureDate")!=""){return"To : "+e}else{return""}}},{header:"Pax",dataIndex:"pax",width:150,renderer:function(g,f,b,h,d,c){var a=Ext.getCmp("preHotelGrid").findParentByType("awesomewindow").getData("stateRoomStore");var e=a.getAt(0).data;e.totalPax;return"Pax :"+e.totalPax}},{header:"Pre",dataIndex:"isPre",renderer:function(e,d,a,f,c,b){if(a.get("isPre")==true){return"(Pre)"}else{return"(Post)"}}}]),listeners:{render:function(){var a=this.findParentByType("awesomewindow");var b=a.getData("dateFrom");Ext.Ajax.request({url:TDS.env.dataPath+this.findParentByType("awesomewindow").getData("offeringURI")+"/transfer",method:"GET",params:{dateFrom:b,dateDays:6,numberToReserve:1},success:function(c,f){var e=Ext.decode(c.responseText);var h=e.transfer;if(typeof h=="undefined"){return}var g=[];for(var d=0;d<h.length;d++){e[h[d]].dataURI=h[d];g.push(e[h[d]])}Ext.getCmp("tranfergrid").getStore().loadData(g)}})}}}]},{xtype:"panel",border:false,style:"padding-left:20px; padding-top:10px",autoHeight:true,layout:"column",items:[{xtype:"panel",width:150,border:false,items:[{html:"<b>DAY TOURS:</b>",border:false,style:" padding:5px"}]},{xtype:"grid",autoHeight:true,hideHeaders:true,border:false,height:25,store:new Ext.data.JsonStore({url:"",identifier:"",fields:["locationToString","name","inDate","departureDate","sightseeingTypeURI","dayTourType","dataURI","time","status","rateUri","rateClassUri","packagePrice","duration","departureTime","sightseeingTypeURI","isPre"]}),viewConfig:{forceFit:true},id:"SIGHTGrid",sm:new Ext.grid.CheckboxSelectionModel({singleSelect:true}),clicksToEdit:1,cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel({singleSelect:true,dataIndex:"CheckBoxValue"}),{header:"Destination",dataIndex:"locationToString",width:250,fixed:true,renderer:function(e,d,a,f,c,b){return e+" -- "+a.get("name")}},{header:"Depart Date",width:90,fixed:true,dataIndex:"departureDate",renderer:function(e,d,a,f,c,b){if(a.get("departureDate")!=""){return new Date(a.get("departureDate")).format(TDS.env.dateFormatDisplay)}else{return""}}},{header:"Out Date",width:140,fixed:true,dataIndex:"departureTime",renderer:function(e,d,a,f,c,b){return"Departs  "+a.get("departureTime")}},{header:"Duration",dataIndex:"duration",fixed:true,width:220,renderer:function(e,d,a,f,c,b){return"Duration  "+a.get("duration")+"  Hours"}},{header:"Pax",dataIndex:"pax",width:150,renderer:function(g,f,b,h,d,c){var a=Ext.getCmp("preHotelGrid").findParentByType("awesomewindow").getData("stateRoomStore");var e=a.getAt(0).data;e.totalPax;return"Pax :"+e.totalPax}},{header:"Pre",dataIndex:"isPre",renderer:function(e,d,a,f,c,b){if(a.get("isPre")==true){return"(Pre)"}else{return"(Post)"}}}]),listeners:{render:function(){var a=this.findParentByType("awesomewindow");var b=a.getData("dateFrom");Ext.Ajax.request({url:TDS.env.dataPath+this.findParentByType("awesomewindow").getData("offeringURI")+"/dayTours",method:"GET",params:{dateFrom:b,dateDays:6,numberToReserve:1},success:function(c,f){var e=Ext.decode(c.responseText);var h=e.sight;if(typeof h=="undefined"){return}var g=[];for(var d=0;d<h.length;d++){e[h[d]].dataURI=h[d];g.push(e[h[d]])}Ext.getCmp("SIGHTGrid").getStore().loadData(g)}})}}}]}]},{xtype:"panel",height:60,frame:true,border:false,region:"south",items:[{xtype:"panel",style:" padding-left:350px",layout:"table",layoutConfig:{columns:4},items:[{xtype:"button",id:"Modify",text:"Modify",minWidth:120,handler:function(){if(Ext.getCmp("preHotelGrid").getSelectionModel().getSelections().length>0){Ext.getCmp("tab").items.itemAt(2).setDisabled(false);Ext.getCmp("tab").setActiveTab(2);var c=Ext.getCmp("tab").items.itemAt(2).items.itemAt(0).items.itemAt(1).items;var e=Ext.getCmp("preHotelGrid").getSelectionModel().getSelections()[0].data;c.itemAt(1).setValue(e.locationToString);c.itemAt(11).setValue(e.accommodationRate);c.itemAt(6).setValue(e.name);c.itemAt(13).setValue(e.basis);c.itemAt(8).setValue(e.maximumOccupancy);c.itemAt(3).setValue(e.roomType);c.itemAt(16).setValue(TDS.util.Format.dateFormatNew(e.inDate));c.itemAt(21).setValue(TDS.util.Format.dateFormatNew(e.outDate));c.itemAt(23).setValue(e.status);var g=Math.round(Math.abs((new Date(e.inDate).getTime()-new Date(e.outDate).getTime())/(86400000)));c.itemAt(26).setValue(g);var a=Ext.getCmp("tab").items.itemAt(2).findByType("form")[0].getForm();var i=this.findParentByType("awesomewindow").getData("stateRoomStore");var k=this.findParentByType("awesomewindow").getData("title");var f=parseInt(k.substr(k.length-1,k.length));i.filter("room",f);var b=i.getAt(0).data;a.findField("stateroom").setValue(b.room);a.findField("adultNo").setValue(b.adult);a.findField("child").setValue(b.child);a.findField("infant").setValue(b.infant);a.findField("total").setValue(b.totalPax);var j=Ext.getCmp("tab").items.itemAt(2).findByType("label")[0];if(e.isPreHotel){j.setText("Pre Cruise")}else{j.setText("Post Cruise")}}else{if(Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections().length>0){Ext.getCmp("tab").items.itemAt(4).setDisabled(false);Ext.getCmp("tab").setActiveTab(4);var h=Ext.getCmp("tab").items.itemAt(4).items.itemAt(0).items.itemAt(1).items;var e=Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections()[0].data;h.itemAt(1).setValue(e.locationToString);h.itemAt(6).setValue(e.rateClassUri);h.itemAt(11).setValue(e.name);h.itemAt(3).setValue(TDS.util.Format.dateFormatNew(e.departureDate));h.itemAt(8).setValue(e.departureTime);h.itemAt(13).setValue(e.duration);var a=Ext.getCmp("tab").items.itemAt(4).findByType("form")[0].getForm();var i=this.findParentByType("awesomewindow").getData("stateRoomStore");var k=this.findParentByType("awesomewindow").getData("title");var f=parseInt(k.substr(k.length-1,k.length));i.filter("room",f);var b=i.getAt(0).data;a.findField("stateroom").setValue(b.room);a.findField("adultNo").setValue(b.adult);a.findField("child").setValue(b.child);a.findField("infant").setValue(b.infant);a.findField("total").setValue(b.totalPax);var j=Ext.getCmp("tab").items.itemAt(4).findByType("label")[0];if(e.isPre){j.setText("Pre Cruise")}else{j.setText("Post Cruise")}}else{if(Ext.getCmp("tranfergrid").getSelectionModel().getSelections().length>0){Ext.getCmp("tab").items.itemAt(3).setDisabled(false);Ext.getCmp("tab").setActiveTab(3);var d=Ext.getCmp("tab").items.itemAt(3).items.itemAt(0).items.itemAt(1).items;var e=Ext.getCmp("tranfergrid").getSelectionModel().getSelections()[0].data;d.itemAt(1).setValue(e.locationToString);d.itemAt(11).setValue(e.transferModeTypeURI);d.itemAt(6).setValue(e.transferPlaceTypeFromURI);d.itemAt(3).setValue(TDS.util.Format.dateFormatNew(e.departureDate));d.itemAt(8).setValue(e.transferPlaceTypeToURI);var a=Ext.getCmp("tab").items.itemAt(3).findByType("form")[0].getForm();var i=this.findParentByType("awesomewindow").getData("stateRoomStore");var k=this.findParentByType("awesomewindow").getData("title");var f=parseInt(k.substr(k.length-1,k.length));i.filter("room",f);var b=i.getAt(0).data;a.findField("stateroom").setValue(b.room);a.findField("adultNo").setValue(b.adult);a.findField("child").setValue(b.child);a.findField("infant").setValue(b.infant);a.findField("total").setValue(b.totalPax);var j=Ext.getCmp("tab").items.itemAt(3).findByType("label")[0];if(e.isPre){j.setText("Pre Cruise")}else{j.setText("Post Cruise")}}}}}}]}]}]}]},{title:"Air",layout:"form",frame:true},{title:"Accommodation",layout:"form",frame:true,items:[{xtype:"form",id:"neh",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:10},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:140,layoutConfig:{columns:2},items:[{html:"Stateroom :",style:"text-decoration: underline; ",width:65},{xtype:"textfield",width:30,name:"stateroom",readOnly:true}]},{xtype:"panel",width:150,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"textfield",width:30,name:"adultNo",readOnly:true}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:60},{xtype:"textfield",width:30,name:"child",readOnly:true}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"textfield",width:30,readOnly:true,name:"infant"}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:3},items:[{html:"Total :",width:50},{xtype:"textfield",width:80,name:"total",listeners:{render:function(){}}}]},{xtype:"panel",width:180,border:true,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{xtype:"label",width:150,style:"font-size: 20px;color:yellow;font-weight:bold;",name:"isPre"}]}],listeners:{render:function(){}}},{xtype:"panel",layout:"table",style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(15).items.itemAt(0).getValue();var d=this.items.itemAt(21).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(27).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationToString",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; ",html:"Room Type :"},{xtype:"combo",name:"inventoryTypeURI",mode:"local",id:"roomTypes",readOnly:true,hideTrigger:true,disableKeyFilter:true,width:150,typeAhead:true,triggerAction:"all",editable:false,listWidth:135,triggerAction:"all",editable:false,displayField:"displayName",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/inventorytypes/collection",identifier:"accommodation/inventorytypes",fields:["name","displayName","dataURI"]}),listeners:{beforehide:function(){return !(combo.view&&combo.view.isVisible())}}},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Hotel :"},{xtype:"combo",name:"hotelName",displayField:"name",valueField:"dataURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/accommodation",identifier:"hotels?postHotel=true",fields:["name","nameString","accommodationRatingURI"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"hotels?postHotel=true",fields:["name","nameString","accommodationRatingURI"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var a=this.findParentByType("awesomewindow").getDataURI("supplierURI");var c=this.ownerCt.items.itemAt(11);this.getStore().removeAll();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+"components/"+d+"/accommodation?postHotel=true",this.getStore().load({})},select:function(d,a,b){var c=this.findParentByType("panel").findByType("datefield")[0];var e=this.ownerCt.items.itemAt(1);c.setValue(TDS.util.Format.dateFormatNew(a.data.inDate));this.findParentByType("panel").findByType("combo")[0].setValue("");this.findParentByType("panel").findByType("combo")[3].setValue("");this.findParentByType("panel").findByType("combo")[2].setValue(a.data.accommodationRatingURI)},beforerender:function(a){}}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Max In Room :"},{xtype:"textfield",name:"maximumOccupancy",width:150,readOnly:true,listeners:{}},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Rating :"},{xtype:"textfield",id:"ratings",width:137,readOnly:true,name:"accommodationRatingURI"},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Basis :"},{xtype:"textfield",width:150,name:"basisURI"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"In Date :"},{xtype:"datefield",width:83,format:"dMy",name:"inDate",id:"inDates",enableKeyEvents:true,showToday:false,menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var b=this.getValue();var a=this.findParentByType("panel").ownerCt.findByType("datefield")[1].getValue();var e=this.ownerCt.findByType("textfield")[10];if((a-b)>=0){e.setValue((a-b)/86400000)}else{e.setValue("")}}},Ext.form.DateField.prototype.menuListeners)},{html:"No. of Rooms :",style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; "},{xtype:"combo",width:135,excludeSubmit:true,name:"noOfRoom",value:1,enableKeyEvents:true,minChars:1,enableKeyEvents:true,mode:"local",listWidth:140,editable:false,typeAhead:true,excludeFromSession:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"text",valueField:"text",store:new Ext.data.SimpleStore({fields:["text","text"],data:[["1","1"],["2","2"],["3","3"],["4","4"]]})},{},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 20px; padding-left: 20px; ",html:"Out Date :"},{fieldLabel:"Out Date :",xtype:"datefield",width:83,format:"dMy",name:"outDate",id:"out",readOnly:true,menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var a=this.getValue();var b=this.ownerCt.ownerCt.ownerCt.findByType("datefield")[0].getValue();var e=this.ownerCt.findByType("textfield")[10];if((a-b)>=0){e.setValue((a-b)/86400000)}else{e.setValue("")}}},Ext.form.DateField.prototype.menuListeners)},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Status:"},{xtype:"textfield",width:83,name:"status",readOnly:true},{},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 20px; padding-left: 20px; ",html:"Nights :"},{xtype:"textfield",name:"night",width:100}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:100,items:[{xtype:"panel",columnWidth:0.55,height:100,items:[{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"CCC",width:450,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="postHotels" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 60px; position:inherit; ">{date} </th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<tpl if="reservedAvailable &gt; 0">','<td style="text-align:center  ">AV</td>',"</tpl>",'<tpl elseif="reservedAvailable &lt; 0">','<td style="text-align:center  ">FS</td>',"</tpl>",'<tpl elseif="  reservedRequestable &lt; 0  &&  reservedAvailable ==  0  ">','<td style="text-align:center  ">RQ</td>',"</tpl>",'<tpl elseif="reservedAvailable ==  0  &&  reservedRequestable == 0 ">','<td style="text-align:center  ">NA</td>',"</tpl>","</tpl>","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 250px; padding-top: 20px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"update",handler:function(){var d="",a="",c={};var b=Ext.getCmp("preHotelGrid").getSelectionModel().getSelections();var e=Ext.getCmp("preHotelGrid").getStore().indexOf(b[0]);Ext.getCmp("preHotelGrid").getStore().getAt(e).set("inDate",new Date(Ext.getCmp("inDates").getValue()));Ext.getCmp("preHotelGrid").getStore().getAt(e).set("outDate",new Date(Ext.getCmp("out").getValue()));this.findParentByType("tabpanel").setActiveTab(0)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"avail",handler:function(){var c={};var e=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var a=Ext.getCmp("roomTypes").getValue();var h=Ext.getCmp("inDates").getValue();var d=this.findParentByType("awesomewindow");var b=d.getData("offeringURI");console.log("*************888");console.log(b);var g=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+b+"/availabilty",method:"POST",params:{offeringId:Ext.getCmp("preHotelGrid").getSelectionModel().getSelections()[0].get("dataURI"),roomType:a,inDate:h,dateDays:6,numberToReserve:1},success:function(f,i){var j=Ext.decode(f.responseText);Ext.getCmp("CCC").tpl.overwrite(Ext.getCmp("CCC").body,j)},scope:this})}},{xtype:"button",text:"Cancel",hidden:true,style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("tabpanel").getActiveTab().findByType("combo");a[0].reset();a[1].reset();a[2].reset();a[3].reset();a[4].reset();var c=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");c[3].reset();c[9].reset();c[6].reset();c[8].reset();var b=[];Ext.getCmp("CCC").tpl.overwrite(Ext.getCmp("CCC").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){var a=new Ext.Window({height:100,width:850,closable:true,resizable:false,border:false,layout:"fit",modal:true,items:[{}],listeners:{show:function(b){b.setPosition(175,175)}}}).show()}}]}]}]},{title:"Transfers",layout:"form",frame:true,items:[{xtype:"form",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:140,layoutConfig:{columns:2},items:[{html:"Stateroom :",style:"text-decoration: underline; ",width:65},{xtype:"textfield",name:"stateroom",listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()}}}]},{xtype:"panel",width:150,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"textfield",width:30,name:"adultNo",width:30,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:60},{xtype:"textfield",width:30,name:"child",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"textfield",width:30,readOnly:true,name:"infant",listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",name:"total",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:180,border:true,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{xtype:"label",width:150,name:"isPre",style:"font-size: 20px;color:yellow;font-weight:bold"}]}]},{xtype:"panel",layout:"table",style:" padding-top: 20px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).items.itemAt(0).getValue();var d=this.items.itemAt(8).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(13).setValue(b+d)},items:[{style:"padding-bottom: 20px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationURI",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; ",html:"Date:"},{xtype:"datefield",width:120,format:"dMy",name:"deptDate",id:"deptDate3"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"From :"},{xtype:"combo",name:"transferPlaceTypeFromURI",mode:"local",fieldLabel:"From*",width:120,listWidth:135,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/placetypes/collection",identifier:"transfer/placetypes",fields:["name","dataURI"]})},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 100px; ",html:"To :"},{xtype:"combo",name:"transferPlaceTypeToURI",mode:"local",fieldLabel:"To*",width:120,listWidth:135,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/placetypes/collection",identifier:"transfer/placetypes",fields:["name","dataURI"]})},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Mode :"},{xtype:"combo",width:120,listWidth:135,id:"modeType",name:"transferModeTypeURI",mode:"local",triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/modetypes/collection",identifier:"transfer/modetypes",fields:["name","dataURI"]})}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:100,items:[{xtype:"panel",columnWidth:0.55,height:100,items:[{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"iii",width:450,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="transfer" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 200px; position:inherit; ">{date}</th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<tpl if="reservedAvailable &gt; 0">','<td style="text-align:center  ">AV</td>',"</tpl>",'<tpl elseif="reservedAvailable &lt; 0">','<td style="text-align:center  ">FS</td>',"</tpl>",'<tpl elseif="  reservedRequestable &lt; 0  &&  reservedAvailable ==  0  ">','<td style="text-align:center  ">RQ</td>',"</tpl>",'<tpl elseif="reservedAvailable ==  0  &&  reservedRequestable == 0 ">','<td style="text-align:center  ">NA</td>',"</tpl>","</tpl>","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 250px; padding-top: 80px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var a=Ext.getCmp("tranfergrid").getSelectionModel().getSelections();var b=Ext.getCmp("tranfergrid").getStore().indexOf(a[0]);Ext.getCmp("tranfergrid").getStore().getAt(b).set("departureDate",new Date(Ext.getCmp("deptDate3").getValue()));this.findParentByType("tabpanel").setActiveTab(0)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"availss",handler:function(){var b={};var d=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var e=Ext.getCmp("deptDate3").getValue();var c=this.findParentByType("awesomewindow");var a=c.getData("offeringURI");Ext.Ajax.request({url:TDS.env.dataPath+"components/"+a+"/availabilty/transfer",method:"POST",params:{offeringId:Ext.getCmp("tranfergrid").getSelectionModel().getSelections()[0].get("dataURI"),modeype:Ext.getCmp("modeType").getValue(),paxtype:"rate/class/2",inDate:e,dateDays:6,numberToReserve:1},success:function(f,g){var h=Ext.decode(f.responseText);Ext.getCmp("iii").tpl.overwrite(Ext.getCmp("iii").body,h)},scope:this})}},{xtype:"button",text:"Cancel",hidden:true,style:" padding-left: 50px;",handler:function(){var b=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");b[1].reset();b[2].reset();b[3].reset();b[4].reset();b[5].reset();b[6].reset();b[7].reset();b[8].reset();b[9].reset();var a=[];Ext.getCmp("iii").tpl.overwrite(Ext.getCmp("iii").body,a)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){var a=new Ext.Window({height:100,width:850,closable:true,resizable:false,border:false,layout:"fit",modal:true,items:[{}],listeners:{show:function(b){b.setPosition(175,175)}}}).show()}}]}]}]},{title:"Day Tours",layout:"form",frame:true,items:[{xtype:"form",layout:"form",listeners:{render:function(a){}},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 20px; background-color:#ef9e58;!",layout:"table",layoutConfig:{columns:6},width:900,height:50,id:"day",totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).items.itemAt(1).getValue();var h=this.items.itemAt(2).items.itemAt(1).getValue();var g=this.items.itemAt(3).items.itemAt(1).getValue();var f=this.items.itemAt(0).items.itemAt(1).getValue();b=b?b:0;h=h?h:0;g=g?g:0;f=f?f:0;this.items.itemAt(4).items.itemAt(1).setValue(b+h+g+f)},items:[{xtype:"panel",style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",width:140,layoutConfig:{columns:2},items:[{html:"Stateroom :",style:"text-decoration: underline; ",width:65},{xtype:"textfield",width:30,name:"stateroom",readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()}}}]},{xtype:"panel",width:150,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Adult :",width:50},{xtype:"textfield",name:"adultNo",width:30,readOnly:true,listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Children :",width:60},{xtype:"textfield",width:30,readOnly:true,name:"child",listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:110,style:"padding-top:10px;padding-left:10px;padding-right: 5px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Infant :",width:50},{xtype:"textfield",width:30,readOnly:true,name:"infant",listeners:{select:function(){this.ownerCt.ownerCt.totalPaxPerRoomCalc()},render:function(){}}}]},{xtype:"panel",width:160,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{html:"Total :",width:50},{xtype:"textfield",name:"total",width:80,listeners:{render:function(){}}}]},{xtype:"panel",width:180,border:true,style:"padding-top:10px;padding-left:10px;padding-right: 20px;",layout:"table",layoutConfig:{columns:2},items:[{xtype:"label",style:"font-size: 20px;color:yellow;font-weight:bold;",width:150,name:"isPre"}]}]},{xtype:"panel",layout:"table",height:140,style:" padding-top: 10px;padding-right: 20px;padding-left: 20px; ",layoutConfig:{columns:5},totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).items.itemAt(0).getValue();var d=this.items.itemAt(8).items.itemAt(0).getValue();b=b?b:0;d=d?d:0;this.items.itemAt(13).setValue(b+d)},items:[{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px; ",html:"City :"},{xtype:"textfield",name:"locationURI",readOnly:true,width:137},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Dept Date :"},{xtype:"datefield",width:83,format:"dMy",name:"deptDate",id:"deptDate"},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Type :"},{xtype:"combo",id:"rate",name:"rateClassURI",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,mode:"local",displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"rate/classes/collection",identifier:"rate/classes",fields:["name","dataURI"]}),listeners:{}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Time :"},{xtype:"textfield",width:99,name:"time",readOnly:true},{border:false},{style:"padding-bottom: 10px;padding-top: 10px; padding-right: 25px; padding-left: 20px;  ",html:"Tour Name :"},{xtype:"combo",name:"tourName",displayField:"name",valueField:"dataURI",id:"d",listWidth:135,width:120,selectOnFocus:true,triggerAction:"all",enableKeyEvents:true,editable:false,typeAhead:true,lazyRender:true,store:new Ext.data.Store({url:TDS.env.dataPath+"components/accommodation",identifier:"tours",fields:["name","nameString"],autoLoad:false,reader:new Ext.data.CollectionReader({identifier:"tours",fields:["name","nameString"]})}),listeners:{beforequery:function(b){var d=this.findParentByType("awesomewindow").getData("rateURI");var a=this.findParentByType("awesomewindow").getDataURI("supplierURI");var c=this.ownerCt.items.itemAt(11);this.getStore().removeAll();this.getStore().proxy.conn.method="POST",this.getStore().proxy.conn.url=TDS.env.dataPath+this.findParentByType("awesomewindow").getData("offeringURI")+"/dayTour",this.getStore().load({})}}},{style:"padding-bottom: 10px;padding-top: 10px;padding-right: 25px; padding-left: 100px; ",html:"Duration :"},{xtype:"numberfield",name:"totalPax",width:99},{border:false}]},{xtype:"panel",layout:"column",style:" padding-right: 15px; padding-left: 20px; ",height:120,items:[{xtype:"panel",columnWidth:0.55,height:120,items:[{xtype:"panel",layout:"table",layoutConfig:{columns:2},items:[]},{},{xtype:"panel",style:"padding-top: 10px;padding-left: 50px;",id:"EEE",width:500,height:100,autoScroll:true,tpl:new Ext.XTemplate(['<br><table class="dayTours" border=1;>',"<thead>",'<tr style="background-color: #d0def0;">','<tpl for="list">','<th style="padding-bottom: 2px; width: 50px; position:inherit; ">{date}</th>',"</tpl>","</tr>","</thead>","<tr >",'<tpl for="list">','<tpl if="reservedAvailable &gt; 0">','<td style="text-align:center  ">AV</td>',"</tpl>",'<tpl elseif="reservedAvailable &lt; 0">','<td style="text-align:center  ">FS</td>',"</tpl>",'<tpl elseif="  reservedRequestable &lt; 0  &&  reservedAvailable ==  0  ">','<td style="text-align:center  ">RQ</td>',"</tpl>",'<tpl elseif="reservedAvailable ==  0  &&  reservedRequestable == 0 ">','<td style="text-align:center  ">NA</td>',"</tpl>","</tpl>","</tr>","<tr >","</tr>","</table>"])}]}]},{xtype:"panel",layout:"table",style:" padding-left: 220px; padding-top: 80px; ",border:true,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"button",text:"Amend",id:"updates",handler:function(){var a=Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections();var b=Ext.getCmp("SIGHTGrid").getStore().indexOf(a[0]);Ext.getCmp("SIGHTGrid").getStore().getAt(b).set("departureDate",new Date(Ext.getCmp("deptDate").getValue()));this.findParentByType("tabpanel").setActiveTab(0)}},{xtype:"button",text:"Availability",style:" padding-left: 50px;",id:"availss",handler:function(){var b={};var d=this.ownerCt.findParentByType("awesomewindow").aw;this.ownerCt.findParentByType("awesomewindow").getDataURI("offering");this.ownerCt.findParentByType("awesomewindow").getDataURI("pnr");var g=Ext.getCmp("deptDate").getValue();var c=this.findParentByType("awesomewindow");var a=c.getData("offeringURI");let list={};var e=Ext.Ajax.request({url:TDS.env.dataPath+"components/"+a+"/availabilty/daytour",method:"POST",params:{offeringId:Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections()[0].get("dataURI"),paxtype:Ext.getCmp("rate").getValue(),inDate:g,dateDays:6,numberToReserve:1},success:function(f,h){var i=Ext.decode(f.responseText);Ext.getCmp("EEE").tpl.overwrite(Ext.getCmp("EEE").body,i)},scope:this})}},{xtype:"button",text:"Cancel",hidden:true,style:" padding-left: 50px;",handler:function(){var a=this.findParentByType("tabpanel").getActiveTab().findByType("combo");a[0].reset();a[1].reset();a[2].reset();a[3].reset();var c=this.findParentByType("tabpanel").getActiveTab().findByType("textfield");c[5].reset();c[6].reset();c[7].reset();var b=[];Ext.getCmp("EEE").tpl.overwrite(Ext.getCmp("EEE").body,b)}},{xtype:"button",text:"Description",style:" padding-left: 50px;",handler:function(){var a=new Ext.Window({height:100,width:850,closable:true,resizable:false,border:false,layout:"fit",modal:true,items:[{}],listeners:{show:function(b){b.setPosition(175,175)}}}).show()}}]}]}]}],listeners:{render:function(){this.items.itemAt(2).setDisabled(true);this.items.itemAt(3).setDisabled(true);this.items.itemAt(4).setDisabled(true);this.items.itemAt(1).setDisabled(true)}}},{xtype:"button",text:"Price Summary",style:"padding-left:10px;",listeners:{click:function(){var j=this.findParentByType("awesomewindow").getData("stateRoomStore");var b=this.findParentByType("awesomewindow").getDataURI("pnr");var d=this.findParentByType("awesomewindow").getData("offeringURI");var c=this.findParentByType("awesomewindow");var g=c.getData("dateFrom");var k=this.findParentByType("awesomewindow").getData("cruiseSelectedRecord");console.log(k);j.clearFilter();var l=Ext.getCmp("tranfergrid").getSelectionModel().getSelections();var e=Ext.getCmp("SIGHTGrid").getSelectionModel().getSelections();var i=Ext.getCmp("preHotelGrid").getSelectionModel().getSelections();var a=Ext.getCmp("preHotelGrid").getStore();var h=Ext.getCmp("SIGHTGrid").getStore();var m=Ext.getCmp("tranfergrid").getStore();var f=this.findParentByType("awesomewindow").initialConfig.config.rategrid;console.log(l);console.log(e);this.findParentByType("awesomewindow").hide();TDS.window.setWindow({title:"Cabin Pricing",interfaceURI:"pnr/offerings/cruise/cruisepricing.js",buttonOK:false,buttonCancel:"Close",config:{rategrid:f},data:{offeringURI:d,stateRoomStore:j,stateRoomStore:j,cruiseSelectedRecord:k,dateFrom:g,accommodationRecords:i,transferRecords:l,daytoursRecords:e,accStore:a,dayTourstore:h,transferStore:m},dataURI:{pnr:b,offeringURI:d,cruiseSelectedRecord:k,dateFrom:g},callback:{fn:function(o,p,n){if(o){}}}})}}}]}