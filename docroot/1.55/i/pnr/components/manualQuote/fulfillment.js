{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 4px 19px 4px 4px;",autoScroll:true,getGrid:function(){return this.items.itemAt(0)},items:{xtype:"awesomegrid",searchURI:"",enableRowExpander:true,sessionExpandedRows:true,tbar:["->",{xtype:"redbutton",text:"Summary",cls:"x-button-green-tour",overCls:"x-button-green-over-tour",handler:function(){var c=this.ownerCt.ownerCt;var b=c.getSelections();if(b.length<=0){return}var d=b[0];d=d.data.PNRCode;var a=TDS.env.user.getSupplierURI();if(!a){return}Ext.Ajax.request({url:TDS.env.dataPath+a+"/summary?pnrCode="+d,method:"GET",disableCaching:false,callback:function(g,e,f){if(e){TDS.window.setWindow({title:"Price Summary for Manual Quotes.",data:{baseDataURI:f.responseText},interfaceURI:"summaryDisplay.js",buttonOK:false})}}})}}," ",{xtype:"redbutton",text:"Send Quotes",cls:"x-button-blue-tour",overCls:"x-button-blue-over-tour",handler:function(){var a=TDS.env.user.getSupplierURI();if(!a){return}TDS.window.setWindow({title:"Send Messages",message:"All the Edited Manual Quotes will be sent to the agencys, as Message.",destinationDataURI:a+"/sendMessageToAgency",buttonOK:"Submit"})}}," ",{xtype:"redbutton",text:"Voucher Issue",cls:"x-button-orange",overCls:"x-button-orange-over",disabled:true,handler:function(){var e=this.ownerCt.ownerCt;var c=e.getSelections();var b=c[0].data.dataURI;var f=this.getText();Ext.MessageBox.buttonText.yes="Cancel Voucher Issue";Ext.MessageBox.buttonText.no="OK";Ext.MessageBox.buttonText.cancel="Close";Ext.Msg.show({title:"Voucher issue",msg:"<b>Confirm voucher issue by Agent?</b>",buttons:Ext.Msg.YESNOCANCEL,fn:d,animEl:"elId",icon:Ext.MessageBox.QUESTION});function d(h,g,i){if(h=="yes"){Ext.Ajax.request({url:TDS.env.dataPath+""+b+"/archiveUnArchive",method:"PUT",headers:{"Content-Type":"application/json"},data:{voucher:false},disableCaching:false,callback:function(k,a,j){if(a){e.submitQuery(true)}},jsonData:{voucher:false},scope:this})}if(h=="no"){Ext.Ajax.request({url:TDS.env.dataPath+""+b+"/archiveUnArchive",method:"PUT",headers:{"Content-Type":"application/json"},data:{voucher:true},disableCaching:false,callback:function(k,a,j){if(a){e.submitQuery(true)}},jsonData:{voucher:true},scope:this})}if(h=="cancel"){}}}}," ",{xtype:"redbutton",text:"Archive",cls:"x-button-mediumblue",overCls:"x-button-mediumblue-over",disabled:true,handler:function(){var e=this.ownerCt.ownerCt;var c=e.getSelections();var b=c[0].data.dataURI;var f=this.getText();var d=!(e.topToolBar2.items.itemAt(23).checked);TDS.window.setWindow({title:f,message:"Are you sure you want to "+f+" ?",destinationDataURI:b+"/archiveUnArchive",data:{archived:d},callback:{fn:function(a){if(a){e.submitQuery(true)}},scope:e}})}}],tbar2:["Status: ",{xtype:"combo",name:"status",enableKeyEvents:true,lazyInit:false,width:100,mode:"local",forceSelection:true,typeAhead:true,minChars:1,queryDelay:10,triggerAction:"all",store:[["","All"],[TDS.data.componentStatus.STATUS_HELD,TDS.data.componentStatus.STATUS_HELD],[TDS.data.componentStatus.STATUS_CANCELLED,TDS.data.componentStatus.STATUS_CANCELLED],[TDS.data.componentStatus.STATUS_CANCEL_REQUESTED,TDS.data.componentStatus.STATUS_CANCEL_REQUESTED],[TDS.data.componentStatus.STATUS_CONFIRMED,TDS.data.componentStatus.STATUS_CONFIRMED],[TDS.data.componentStatus.STATUS_PART_CONFIRMED,TDS.data.componentStatus.STATUS_PART_CONFIRMED],[TDS.data.componentStatus.STATUS_REJECTED,TDS.data.componentStatus.STATUS_REJECTED],[TDS.data.componentStatus.STATUS_QUOTE,TDS.data.componentStatus.STATUS_MANUAL_QUOTE_DISPLAY],[TDS.data.componentStatus.STATUS_REQUESTED,TDS.data.componentStatus.STATUS_REQUESTED]]}," ","Type: ",{xtype:"combo",name:"componentType",enableKeyEvents:true,lazyInit:false,width:125,mode:"local",forceSelection:true,typeAhead:true,minChars:1,queryDelay:10,triggerAction:"all",store:[["","All"],[TDS.data.componentType.TYPE_ACCOMMODATION,TDS.data.componentType.TYPE_ACCOMMODATION],[TDS.data.componentType.TYPE_HOSTEL,TDS.data.componentType.TYPE_HOSTEL],[TDS.data.componentType.TYPE_TOUR,TDS.data.componentType.TYPE_TOUR],[TDS.data.componentType.TYPE_CAR,TDS.data.componentType.TYPE_CAR],[TDS.data.componentType.TYPE_RAIL,TDS.data.componentType.TYPE_RAIL],[TDS.data.componentType.TYPE_RAIL_PASS,TDS.data.componentType.TYPE_RAIL_PASS],[TDS.data.componentType.TYPE_AIR,TDS.data.componentType.TYPE_AIR],[TDS.data.componentType.TYPE_CRUISE,TDS.data.componentType.TYPE_CRUISE],[TDS.data.componentType.TYPE_ATTRACTION,TDS.data.componentType.TYPE_ATTRACTION_NEW],[TDS.data.componentType.TYPE_TRANSFER,TDS.data.componentType.TYPE_TRANSFER],[TDS.data.componentType.TYPE_SIGHTSEEING,TDS.data.componentType.TYPE_SIGHTSEEING_NEW]]}," ","Date from: ",{xtype:"datefield",name:"dateFromStart",enableKeyEvents:true,showToday:false,width:75,format:"dMy",defaultValue:new Date(),minValue:"01/01/06"}," ","to: ",{xtype:"datefield",name:"dateTill",enableKeyEvents:true,showToday:false,width:75,format:"dMy",minValue:"01/01/06"}," ","Location:",{xtype:"combo",name:"countryURI",emptyText:"Type a country...",excludeFromSession:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:100,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["dataURI","name","isoCode"]}),appendData:[{name:"",dataURI:""}]}," ",{xtype:"locationcombo",name:"locationURI",width:100,excludeFromSession:true,hideTrigger:false,listeners:{beforesearch:function(d){var c=this.ownerCt;var b=c.items.itemAt(13);var a=b.getValue().substring(b.getValue().lastIndexOf("/")+1);if(a==""){b.markInvalid("Please select a country.");return false}d.searchURI=TDS.env.dataPath+"country/"+a+"/locations/collection";d.searchIdentifier="country/"+a+"/locations"}}}," ","PNR code:",{xtype:"textfield",name:"pnrCode",enableKeyEvents:true,width:80}," ","Component name:",{xtype:"textfield",name:"componentName",enableKeyEvents:true,width:120}," ",{xtype:"checkbox",name:"archived",boxLabel:"Show only Archived",handler:function(){var a=this.ownerCt.ownerCt.topToolbar;a.items.itemAt(4).disable(true);if(this.checked){a.items.itemAt(4).setText("Recall")}else{a.items.itemAt(4).setText("Archive")}}}],store:new Ext.data.JsonStore({id:"dataURI",fields:["dataURI","agencyURI","offeringURI","quoteReferenceNumber","timeHeldUntil","description","type","voucherDate","supplierURI","name","dateFrom","dateTo","passengersTotal","status","createdDate","createdByUserFullNameString","updatedDate","updatedByUserFullNameString","supplierName","locationToString","locationFromString","airportToString","airportFromString","bookingReferenceNumber","pricingPriceCurrency","supplierParameters","pricingPriceSell","PNRCode","entryType","parameters","pricingPriceBaseSell","pricingPriceBaseCurrency","pricingPriceCommission","pricingPriceIsNett","duration","durationNights","extraNotes","startTime","finishTime","durationDays"],sortInfo:{field:"dateFrom",direction:"ASC"}}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Type",dataIndex:"type",width:100,fixed:true,renderer:function(a){if(a===TDS.data.componentType.TYPE_OWN){return"Own arrangement"}else{if(a===TDS.data.componentType.TYPE_MANUAL){return"Manual entry"}else{if(a===TDS.data.componentType.TYPE_SIGHTSEEING){return"Day Tour"}else{if(a===TDS.data.componentType.TYPE_ATTRACTION){return"Services"}}}}return a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}},{header:"PNR Code",dataIndex:"PNRCode"},{header:"Component",dataIndex:"name"},{header:"From",dataIndex:"locationFromString",renderer:function(c,b,a){if(a.get("type")===TDS.data.componentType.TYPE_AIR){return a.get("airportFromString")}return c}},{header:"Date",dataIndex:"dateFrom",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"To",dataIndex:"locationToString",renderer:function(c,b,a){if(a.get("type")===TDS.data.componentType.TYPE_AIR){return a.get("airportToString")}return c}},{header:"Date",dataIndex:"dateTo",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Duration",dataIndex:"duration"},{header:"Pax",dataIndex:"passengersTotal",width:40},{header:"Status",dataIndex:"status",width:100,renderer:function(c,b,a){var d=a.get("entryType");if(c=="Quote"&&d!="Manual Quote"){Ext.getCmp("has_quotes_id").setValue(true)}if(d=="Manual Quote"&&c=="Quote"){c+=" (M)"}else{if(d=="OA"){c="OA"}}return c}},{header:"Voucher",dataIndex:"voucherDate",width:100,renderer:function(d,b,a){var c=a.get("voucherDate");c=TDS.util.Format.dateSpecial(d,TDS.env.dateTimeFormatDisplay);if(c!=""){c=c.replace(" ","/");c='<font color="red">V-'+c+"</font>"}d=c;return d}}]),viewConfig:{forceFit:true},listeners:{sessioninit:function(){this.searchURI=TDS.env.dataPath+TDS.env.user.getSupplierURI()+"/components"},beforequery:function(){var a=this.getTopToolbar();a.items.itemAt(5).setDisabled(true)},render:function(){var c=this.getTopToolbar();this.getSelectionModel().on("rowselect",function(){;var d=this.getSelections()[0].data.status;if(d==TDS.data.componentStatus.STATUS_CONFIRMED){c.items.itemAt(5).setDisabled(false)}else{c.items.itemAt(5).setDisabled(true)}c.items.itemAt(7).setDisabled(false)},this);this.getSelectionModel().on("rowdeselect",function(){c.items.itemAt(5).setDisabled(true);c.items.itemAt(7).setDisabled(true)},this);var a=this.ownerCt.ownerCt;var b=a.getSession("focusRecord");if(typeof b!="undefined"){this.focusResult(b,false,true);TDS.session.setByPath("fulfillment",{focusRecord:""})}}},getRowInterface:function(a){var b=a.get("type");var c=a.get("entryType");if(c=="Manual Quote"){return"fulfillment/manualQuote/layout.js"}else{if(b===TDS.data.componentType.TYPE_ACCOMMODATION){return"fulfillment/accommodation/layout.js"}else{if(b===TDS.data.componentType.TYPE_TOUR){return"fulfillment/tour/layout.js"}else{if(b===TDS.data.componentType.TYPE_CRUISE){return"fulfillment/cruise/layout.js"}else{if(b===TDS.data.componentType.TYPE_HOSTEL){return"fulfillment/hostel/layout.js"}else{if(b===TDS.data.componentType.TYPE_CAR){return"fulfillment/car/layout.js"}else{if(b===TDS.data.componentType.TYPE_TRANSFER){return"fulfillment/transfer/layout.js"}else{if(b===TDS.data.componentType.TYPE_AIR){return"fulfillment/air/layout.js"}else{if(b===TDS.data.componentType.TYPE_RAIL){return"fulfillment/rail/layout.js"}else{if(b===TDS.data.componentType.TYPE_ATTRACTION){return"fulfillment/attraction/layout.js"}else{if(b===TDS.data.componentType.TYPE_SIGHTSEEING){return"fulfillment/sightseeing/layout.js"}}}}}}}}}}}return"fulfillment/generic/placeholder.js"}}}