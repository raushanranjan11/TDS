{xtype:"form",border:false,width:690,beforeSubmit:function(a){;var d=this.items.itemAt(0).items.itemAt(2).items.itemAt(1).items.itemAt(0).selModel.selections.items;var c=[];for(var b=0;b<d.length;b++){c.push(d[b].data.dataURI)}a.passengerURIs=c;return a},requireStores:[{dataURI:TDS.env.dataPath+"suppliers/collection/conciseLoadData",identifier:"suppliers",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"rate/basises/collection",identifier:"rate/basises",fields:["name","dataURI"]}],items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:510,width:690,items:[{title:"Quote Details",layout:"form",autoScroll:true,items:[{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,width:390,height:25,hideBorders:true,defaults:{listeners:{check:function(){if(this.getValue()){this.ownerCt.ownerCt.items.itemAt(2).hide(true);this.ownerCt.ownerCt.items.itemAt(3).hide(true);this.ownerCt.ownerCt.items.itemAt(4).hide(true);this.ownerCt.ownerCt.items.itemAt(5).hide(true);this.ownerCt.ownerCt.items.itemAt(3).disable(true);this.ownerCt.ownerCt.items.itemAt(4).disable(true);this.ownerCt.ownerCt.items.itemAt(5).disable(true);var a=this.ownerCt.ownerCt.items.itemAt(1).getValue();if(this.value=="MQ"){if(a==TDS.data.componentType.TYPE_ACCOMMODATION){this.ownerCt.ownerCt.items.itemAt(4).show(true);this.ownerCt.ownerCt.items.itemAt(4).enable(true);this.ownerCt.ownerCt.items.itemAt(5).show(true);this.ownerCt.ownerCt.items.itemAt(5).enable(true)}}if(this.value=="ME"){this.ownerCt.ownerCt.items.itemAt(3).show(true);this.ownerCt.ownerCt.items.itemAt(3).enable(true)}}}}},layoutConfig:{columns:5},items:[{width:120},{xtype:"radio",name:"MQ",width:90,checked:true,value:"MQ",boxLabel:"Manual Quote"},{width:90},{xtype:"radio",name:"MQ",value:"ME",width:90,boxLabel:"Manual Entry"}]},{xtype:"combo",fieldLabel:"&nbsp;&nbsp;&nbsp;Component",name:"type",style:"margin-left: 16px;",mode:"local",width:280,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"name",valueField:"dataURI",emptyText:"Component type",store:TDS.data.componentsList,listeners:{select:function(){this.ownerCt.items.itemAt(2).hide(true);this.ownerCt.items.itemAt(3).hide(true);this.ownerCt.items.itemAt(4).hide(true);this.ownerCt.items.itemAt(5).hide(true);this.ownerCt.items.itemAt(3).disable(true);this.ownerCt.items.itemAt(4).disable(true);this.ownerCt.items.itemAt(5).disable(true);if(this.getValue()==TDS.data.componentType.TYPE_ACCOMMODATION&&this.ownerCt.items.itemAt(0).items.itemAt(1).getValue()){this.ownerCt.items.itemAt(4).show(true);this.ownerCt.items.itemAt(4).enable(true);this.ownerCt.items.itemAt(5).show(true);this.ownerCt.items.itemAt(5).enable(true)}if(this.getValue()==TDS.data.componentType.TYPE_ACCOMMODATION&&!this.ownerCt.items.itemAt(0).items.itemAt(1).getValue()){this.ownerCt.items.itemAt(3).show(true);this.ownerCt.items.itemAt(3).enable(true)}},render:function(){var b=this.ownerCt.items;setTimeout(function(){b.itemAt(3).hide(true);b.itemAt(4).hide(true);b.itemAt(5).hide(true);b.itemAt(3).disable(true);b.itemAt(4).disable(true);b.itemAt(5).disable(true)},10)}}},{html:'<br><br><br><center><b><font size="2"  >To make a Manual Quotation or Manual Entry, <br>please select a component to enter the required data.</font></b></center>',border:false,width:450},{html:'<br><br><font size="2"><b>MANUAL ENTRY coming soon...</b></font>',width:450},{xtype:"fieldset",layout:"form",border:false,autoHeight:true,labelWidth:100,items:[{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,width:390,hideBorders:true,layoutConfig:{columns:5},items:[{html:"Start Country/City:",width:Ext.isIE?105:110},{xtype:"combo",name:"countryFromCode",emptyText:"Type a country...",excludeSubmit:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:120,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]}),appendData:[{name:"",dataURI:""}]},{xtype:"locationcombo",name:"locationFromURI",style:"margin-left: 2px;",listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(1);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,hideBorders:true,layoutConfig:{columns:5},items:[{html:"In Date:",width:Ext.isIE?105:110},{xtype:"datefield",name:"dateFrom",format:"dMy",width:125},{html:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nights:",width:85},{xtype:"omnicrementer",width:70}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,hideBorders:true,width:390,layoutConfig:{columns:5},items:[{html:"Out Date:",width:Ext.isIE?105:110},{xtype:"datefield",name:"dateTo",format:"dMy",width:125}]},{layout:"form",border:false,style:"padding: 0; margin:0; ",autoHeight:true,labelWidth:100,width:405,items:[{xtype:"panel",layout:"table",width:390,style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,hideBorders:true,totalPaxPerRoom:0,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).getValue();var e=this.items.itemAt(5).getValue();var d=this.items.itemAt(7).getValue();b=b?b:0;e=e?e:0;d=d?d:0;this.totalPaxPerRoom=b+e+d},layoutConfig:{columns:8},items:[{xtype:"checkbox",width:20},{html:"Room 1",width:90},{html:"Adults:",width:40},{xtype:"omnicrementer",name:"A1",width:55,editable:false,listeners:{trigger:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Child:",width:45},{xtype:"combo",store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var c=this.ownerCt.items.itemAt(9).items;var b=this.getValue();for(var a=0;a<5;a++){if(a<b){c.itemAt(a).show(true)}else{c.itemAt(a).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Infants:",width:53},{xtype:"combo",store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var c=this.ownerCt.items.itemAt(11).items;var b=this.getValue();for(var a=0;a<5;a++){if(a<b){c.itemAt(a).show(true)}else{c.itemAt(a).hide(true)}}}}},{html:" ",colspan:5,width:150},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"C11",width:30},{xtype:"numberfield",name:"C12",width:30},{xtype:"numberfield",name:"C13",width:30},{xtype:"numberfield",name:"C14",width:30},{xtype:"numberfield",name:"C15",width:30}]},{html:" ",width:53},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"I11",width:30},{xtype:"numberfield",name:"I12",width:30},{xtype:"numberfield",name:"I13",width:30},{xtype:"numberfield",name:"I14",width:30},{xtype:"numberfield",name:"I15",width:30}]}]}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-top: 2px;",border:false,hideBorders:false,layoutConfig:{columns:8},items:[{xtype:"button",text:"<b>+</b>",roomNo:1,handler:function(){this.roomNo+=1;var a=this.roomNo;if(a<=5){this.ownerCt.ownerCt.items.itemAt(3).add(new Ext.Panel({layout:"table",width:390,style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,name:a,totalPaxPerRoom:0,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).getValue();var e=this.items.itemAt(5).getValue();var d=this.items.itemAt(7).getValue();b=b?b:0;e=e?e:0;d=d?d:0;this.totalPaxPerRoom=b+e+d},hideBorders:true,layoutConfig:{columns:8},items:[{xtype:"checkbox",width:20},{html:"Room "+a,width:90},{html:"Adults:",width:40},{xtype:"omnicrementer",name:"A"+a,width:55,editable:false,listeners:{trigger:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Child:",width:45},{xtype:"combo",store:[0,1,2,3,4,5],name:"C"+a,triggerAction:"all",width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var d=this.ownerCt.items.itemAt(9).items;var c=this.getValue();for(var b=0;b<5;b++){if(b<c){d.itemAt(b).show(true)}else{d.itemAt(b).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Infants:",width:53},{xtype:"combo",store:[0,1,2,3,4,5],name:"I"+a,triggerAction:"all",width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var d=this.ownerCt.items.itemAt(11).items;var c=this.getValue();for(var b=0;b<5;b++){if(b<c){d.itemAt(b).show(true)}else{d.itemAt(b).hide(true)}}}}},{html:" ",colspan:5,width:150},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"C"+a+"1",width:30},{xtype:"numberfield",name:"C"+a+"2",width:30},{xtype:"numberfield",name:"C"+a+"3",width:30},{xtype:"numberfield",name:"C"+a+"4",width:30},{xtype:"numberfield",name:"C"+a+"5",width:30}]},{html:" ",width:53},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"I"+a+"1",width:30},{xtype:"numberfield",name:"I"+a+"2",width:30},{xtype:"numberfield",name:"I"+a+"3",width:30},{xtype:"numberfield",name:"I"+a+"4",width:30},{xtype:"numberfield",name:"I"+a+"5",width:30}]}]}));this.ownerCt.ownerCt.items.itemAt(3).doLayout()}}},{xtype:"button",text:"<b>-</b>",roomNo:1,handler:function(){var c=1;var e=this.ownerCt.ownerCt.items.itemAt(3).items;var f=this.ownerCt.ownerCt.items.itemAt(4).items.itemAt(0);if(f.roomNo>5){f.roomNo=5}for(var d=0;d<e.length;d++){if(e.itemAt(d).items.itemAt(0).checked){this.ownerCt.ownerCt.items.itemAt(3).remove(e.itemAt(d),true);f.roomNo-=1;d=-1}}for(var d=0;d<e.length;d++){if(e.itemAt(d).items.itemAt(0).checked||e.itemAt(d).hidden){e.itemAt(d).items.itemAt(0).checked=false}else{var b=e.itemAt(d).items.itemAt(1);e.itemAt(d).items.itemAt(1).el.dom.innerHTML="Room "+(c);c++}}}}]},{xtype:"numberfield",bodyStyle:"padding-top:20px",fieldLabel:"No Of Pax",width:90}]},{xtype:"fieldset",autoHeight:true,labelWidth:105,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.type;if(typeof d!="undefined"&&d==TDS.data.componentType.TYPE_ACCOMMODATION){this.enable(true);this.show(true)}}},items:[{xtype:"combo",name:"supplierURI",mode:"local",fieldLabel:"ARENA Supplier",width:280,triggerAction:"all",editable:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/conciseLoadData",identifier:"suppliers",fields:["name","dataURI"]})},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-top: 2px;",border:false,hideBorders:false,layoutConfig:{columns:4},items:[{html:"Property Type:",border:false,hideBorders:false,width:110},{xtype:"combo",fieldLabel:"Type",name:"typeClassCategory",mode:"local",width:190,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"name",valueField:"dataURI",emptyText:"Type",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/propertyclasstypes/collection",identifier:"accommodation/propertyclasstypes",fields:["name","displayName","dataURI"]})},{xtype:"combo",fieldLabel:"Rating",name:"rating",style:"margin-left: 10px;",mode:"local",width:80,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"name",valueField:"dataURI",emptyText:"Rating",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"accommodation/ratings/collection",identifier:"accommodation/ratings",fields:["name","dataURI"]})}]},{xtype:"textfield",fieldLabel:"Property Name",name:"name",width:280},{xtype:"textfield",fieldLabel:"Address",name:"address",width:280},{xtype:"textfield",fieldLabel:"City",name:"city",width:280},{xtype:"editorgrid",height:160,clicksToEdit:1,width:630,style:"padding: 0; margin-bottom: 6px;margin-top: 6px;",store:new Ext.data.CollectionStore({url:"",identifier:"",fields:["dataURI","roomNo","roomType","plan","rooms","price","extras","status","paxType"]}),viewConfig:{},getData:function(){var c=this.getStore().data;for(var b=0,e=[];b<c.length;b++){var a=c.items[b].data.mode;if(a!=""){e.push(c.items[b].data)}}return{data:e}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[{header:"Room No",dataIndex:"roomNo",width:55,editor:new Ext.form.NumberField({})},{header:"Room Type",dataIndex:"roomType",width:100,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",store:TDS.data.accommodationRoomTypeMQ})},{header:"A",dataIndex:"a",width:20,editor:new Ext.form.NumberField({listeners:{blur:function(){Ext.getCmp("addAccommodationRoomType").a+=this.getValue()}}})},{header:"C",dataIndex:"c",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){Ext.getCmp("addAccommodationRoomType").c+=this.getValue()}}})},{header:"I",dataIndex:"i",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){Ext.getCmp("addAccommodationRoomType").i+=this.getValue()}}})},{header:"Extras",dataIndex:"extras",width:250,height:70,editor:new Ext.ux.form.SuperBoxSelect({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",xtype:"superboxselect",store:TDS.data.accommodationExtraMQ}),renderer:function(c,e,a,f,d,b){e.attr='ext:qtip="'+c+'"';return c}},{header:"Plan",dataIndex:"plan",width:147,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"rate/basises/collection",identifier:"rate/basises",fields:["name","dataURI"]}),appendData:[{name:" ",dataURI:""}]})},{header:"Price",dataIndex:"price",hidden:true,width:60,fixed:true},{header:"Extras",dataIndex:"extras",hidden:true,width:60,fixed:true},{header:"Status",dataIndex:"status",hidden:true,width:60,fixed:true}],bbar:[{xtype:"button",text:"Add",id:"addAccommodationRoomType",roomNo:1,a:0,c:0,i:0,handler:function(){;var a=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(3).items.length;if(this.roomNo<=a){var b=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(3).items.itemAt((this.roomNo-1)).totalPaxPerRoom;if((this.a+this.c+this.i)>=b&&b!=0){this.roomNo+=1;this.a=0;this.c=0;this.i=0;var b=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(3).items.itemAt((this.roomNo-1)).totalPaxPerRoom}this.ownerCt.items.itemAt(3).td.innerHTML="Pax: "+(b-(this.a+this.c+this.i));if(this.roomNo<=a){var c=this.ownerCt.items.itemAt(1);c.enable();var e=this.ownerCt.ownerCt;var d=e.getStore();d.add([new d.recordType({roomNo:this.roomNo,roomType:"",plan:"",rooms:"",extras:" "})]);e.newRecordIndex=d.getCount()-1;e.startEditing(e.newRecordIndex,1)}}else{this.ownerCt.items.itemAt(3).td.innerHTML="Pax: 0"}}},{xtype:"button",text:"Cancel",disabled:true,handler:function(){;if(this.ownerCt.items.itemAt(0).roomNo>0){this.ownerCt.items.itemAt(0).roomNo-=1}var b=this.ownerCt.items.itemAt(0);b.enable();var c=this.ownerCt.ownerCt;var a=c.getStore().getAt(c.selModel.last);if(a==-1||typeof a.get("dataURI")!="undefined"){return}c.getStore().remove(a);if(c.getStore().length<=0){this.disable()}}},"->","Pax:0"]},{xtype:"textfield",fieldLabel:"Hotel Member No",name:"hotelMemberNo",width:280},{xtype:"textfield",fieldLabel:"Frequent Flyer No",name:"frequentFlyerNo",width:280}]}]},{title:"Additional Info",layout:"fit",items:{xtype:"textarea",name:"description",height:190,hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:true,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}},{title:"Passengers",items:[{xtype:"panel",border:false,style:"margin-bottom: 6px;",html:"<p>Please select the passengers for this booking below.</p>"},{xtype:"panel",border:false,layout:"fit",height:460,items:[{xtype:"editorgrid",store:new Ext.data.CollectionStore({url:"",identifier:"",fields:["type","code","nameFirst","nameLast","salutation","displayName","dateOfBirth","rateURI","paxAge"]}),viewConfig:{forceFit:true},getData:function(){var b=this.selModel.getSelections();var c=[];for(var a=0;a<b.length;a++){c[a]=b[a].get("dataURI")}return c},preselect:function(c,b){var a=[];this.getStore().each(function(d){if(a.length>=b){return false}if((!c||d.get("type")==c)&&d.get("nameFirst")&&d.get("nameLast")){a[a.length]=d}},this);if(a.length>0){this.getSelectionModel().selectRecords(a)}return a.length},validatePassenger:function(d,a,c,b){if(!b.get("nameFirst")&&!b.get("nameLast")){return false}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Type",dataIndex:"type",width:40,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"text",valueField:"text",triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Title",dataIndex:"salutation",width:40,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"First name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false})},{header:"Last name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false})},{header:"Age",dataIndex:"paxAge",width:40,renderer:function(c,b,a){if(c){return c}else{return TDS.util.Format.age(a.get("dateOfBirth"))}},editor:new Ext.form.NumberField({allowBlank:false})}],bbar:[{xtype:"button",text:"Add",handler:function(){var b=this.ownerCt.items.itemAt(1);var a=this.ownerCt.items.itemAt(2);a.enable();b.enable();this.disable();var d=this.ownerCt.ownerCt;var c=d.getStore();c.add([new c.recordType({type:"AD",nameFirst:"",nameLast:"",paxAge:""})]);d.newRecordIndex=c.getCount()-1;d.startEditing(d.newRecordIndex,2)}},{xtype:"button",text:"Cancel",disabled:true,handler:function(){var c=this.ownerCt.items.itemAt(0);var b=this.ownerCt.items.itemAt(2);c.enable();b.disable();var d=this.ownerCt.ownerCt;var a=d.getStore().getAt(d.newRecordIndex);if(a==-1||typeof a.get("dataURI")!="undefined"){return}d.getStore().remove(a);this.disable()}},{xtype:"button",text:"Save",disabled:true,handler:function(){var b=this.ownerCt.findParentByType("awesomewindow");var e=this.ownerCt.ownerCt;var d=this.ownerCt.items.itemAt(0);var c=this.ownerCt.items.itemAt(1);c.disable();this.disable();var a=e.getStore().getAt(e.newRecordIndex);if(a==-1||typeof a.get("dataURI")!="undefined"){return}Ext.Ajax.request({url:TDS.env.dataPath+b.aw.data.pnrDataURI+"/passengers",jsonData:a.data,method:"POST",callback:function(h,f,g){if(f){e.getStore().load();grid.getView().refresh();d.enable()}else{c.enable();this.enable()}},scope:this})}}],listeners:{beforeedit:function(a){},render:function(){var w=this.ownerCt.findParentByType("awesomewindow");this.getSelectionModel().on("beforerowselect",this.validatePassenger,this);with(this.store){reader.meta.identifier=w.aw.data.pnrDataURI+"/passengers";proxy.conn.url=TDS.env.dataPath+w.aw.data.pnrDataURI+"/passengers/concise";load()}}}}]}]}]}]}