{xtype:"form",border:false,width:690,beforeSubmit:function(b){;b.type="CRUISE";try{var c=Ext.getCmp("ID_TOTAL_PAX").getValue();var f=this.items.itemAt(0).items.itemAt(2).items.itemAt(1).items.itemAt(0).selModel.selections.items;if(f.length>c){Ext.Msg.alert("Alert","More than "+c+" passengers selected");return false}var a=this.ownerCt;if(typeof b.destination!="undefined"&&b.destination==""){Ext.getCmp("destination").markInvalid("Please select a Destinstion.");Ext.getCmp("destination").focus(true);throw"Please select a Country.";return false}if(typeof b.countryFromCode!="undefined"&&b.countryFromCode==""){Ext.getCmp("countryFromCode").markInvalid("Please select Dep Country.");Ext.getCmp("countryFromCode").focus(true);throw"Please select Dep Country.";return false}if(typeof b.dateFrom!="undefined"&&b.dateFrom==""){Ext.getCmp("dateFrom").markInvalid("Please select Dep Date.");Ext.getCmp("dateFrom").focus(true);throw"Please select Dep Date.";return false}if(typeof b.countryToCode!="undefined"&&b.countryToCode==""){Ext.getCmp("countryToCode").markInvalid("Please select Arr Country.");Ext.getCmp("countryToCode").focus(true);throw"Please select Arr Country.";return false}if(typeof b.duration!="undefined"&&b.duration==""){Ext.getCmp("duration").markInvalid("Please select Duration.");Ext.getCmp("duration").focus(true);throw"Please select Duration.";return false}if(typeof b.A1!="undefined"&&b.A1==""){Ext.getCmp("A1").markInvalid("Please select Adult.");Ext.getCmp("A1").focus(true);throw"Please select Adult.";return false}if(typeof b.supplierURI!="undefined"&&b.supplierURI==""){Ext.getCmp("supplierURI").markInvalid("Please select Supplier.");Ext.getCmp("supplierURI").focus(true);throw"Please select Supplier.";return false}}catch(j){this.items.itemAt(0).setActiveTab(0);a.showValidation(j);return false}var h=this.items.itemAt(0).items.itemAt(2).items.itemAt(1).items.itemAt(0).selModel.selections.items;var g=[];for(var d=0;d<h.length;d++){g.push(h[d].data.dataURI)}b.passengerURIs=g;b.mainRooms=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(6).getData();b.gridData=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(1).items.itemAt(7).getData();return b},beforeDataLoad:function(a){var b=a.countryFromCode;var c=TDS.util.firstWordCapital(a.type);if(b!=""){var d=Ext.getCmp("supplierURI").store;d.removeAll();d=TDS.data.getStore({reload:true,dataURI:TDS.env.dataPath+"suppliers/collection/byFilters?type="+c+"&countryURI="+b,identifier:"suppliers",fields:["name","displayName","dataURI","creditCardCharges"]});setTimeout(function(){Ext.getCmp("supplierURI").bindStore(d);Ext.getCmp("supplierURI").setRawValue(a.supplierName)},800)}return a},requireStores:[{dataURI:TDS.env.dataPath+"rate/basises/collection",identifier:"rate/basises",fields:["name","dataURI"]}],items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:510,width:690,items:[{title:"Quote Details",layout:"form",items:[{height:453,autoScroll:true,border:false,items:[{xtype:"fieldset",layout:"form",border:false,autoHeight:true,labelWidth:100,style:"padding: 0;  margin-top: 8px; ",defaults:{style:"padding: 0; margin-left: 140px;margin-top: 8px;margin-bottom: 4px;"},items:[{html:"",xtype:"label",listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.type;if(typeof d!="undefined"&&d){this.setText('<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><font size="2" color="#ff0000">Component:</font></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><font size="2"   >'+d+"S</font></b>",false)}}}},{xtype:"panel",layout:"table",border:false,hideBorders:true,width:390,layoutConfig:{columns:5},items:[{html:'Destination<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"combo",store:TDS.data.destination,name:"destination",fieldLabel:"Destination:",width:280,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text",enableKeyEvents:true,value:"",listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]},{xtype:"panel",layout:"table",border:false,width:394,hideBorders:true,layoutConfig:{columns:5},items:[{html:'Dep Country/City<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"combo",name:"countryFromCode",emptyText:"Type a country...",excludeSubmit:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:124,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]}),appendData:[{name:"",dataURI:""}],listeners:{select:function(){var a=this.getValue();var b=TDS.util.firstWordCapital(this.ownerCt.findParentByType("awesomewindow").aw.data.type);if(a!=""){var c=Ext.getCmp("supplierURI").store;c.removeAll();c=TDS.data.getStore({reload:true,dataURI:TDS.env.dataPath+"suppliers/collection/byFilters?type="+b+"&countryURI="+a,identifier:"suppliers",fields:["name","displayName","dataURI","creditCardCharges"]});setTimeout(function(){Ext.getCmp("supplierURI").bindStore(c)},500)}}}},{xtype:"locationcombo",name:"locationFromURI",style:"margin-left: 2px;",width:154,listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(1);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}}]},{xtype:"panel",layout:"table",border:false,hideBorders:true,layoutConfig:{columns:5},items:[{html:'Dep Date<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"datefield",name:"dateFrom",minValue:Ext.TimerMgr.getServerCalculatedDate().clearTime(),format:"dMy",width:125,menuListeners:Ext.applyIf({select:function(c,a){Ext.form.DateField.prototype.menuListeners.select.call(this,c,a);var b=this.getValue();b.setDate(b.getDate()+1);this.ownerCt.ownerCt.items.itemAt(3).items.itemAt(3).setMinValue(b)}},Ext.form.DateField.prototype.menuListeners)},{html:" &nbsp;&nbsp;&nbsp;&nbsp;To:",width:30},{xtype:"datefield",name:"dateTo",format:"dMy",width:125}]},{xtype:"panel",layout:"table",border:false,width:394,hideBorders:true,layoutConfig:{columns:5},items:[{html:'Arr Country/City<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"combo",name:"countryToCode",emptyText:"Type a country...",excludeSubmit:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:124,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]}),appendData:[{name:"",dataURI:""}]},{xtype:"locationcombo",name:"locationToURI",style:"margin-left: 2px;",width:154,listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(1);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}}]},{xtype:"panel",layout:"table",border:false,hideBorders:true,width:390,layoutConfig:{columns:5},items:[{html:'Duration<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"combo",name:"duration",mode:"local",width:125,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"name",valueField:"value",emptyText:"Duration",store:TDS.data.cruiseDuration,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]},{layout:"form",border:false,autoHeight:true,labelWidth:100,width:510,id:"roomsPaxId",getData:function(){var g=this.items;var f=g.length;var m=[];for(var h=0;h<f;h++){var d={};var e=[];var p=[];var o=g.itemAt(h).items.itemAt(3).getValue();var n=g.itemAt(h).items.itemAt(5).getValue();var k=g.itemAt(h).items.itemAt(7).getValue();var q=g.itemAt(h).items.itemAt(9).getValue();d.senior=q;d.adult=o;d.child=n;for(var b=0;b<n;b++){e.push(g.itemAt(h).items.itemAt(11).items.itemAt(b).getValue())}d.childAge=e;d.infant=k;for(var b=0;b<k;b++){p.push(g.itemAt(h).items.itemAt(13).items.itemAt(b).getValue())}d.infantAge=p;m.push(d)}return{data:m}},calculateTotalPax:function(){var h=0;var d=this.items.length;for(var e=0;e<d;e++){var b=this.items.itemAt(e).items.itemAt(3).getValue();var k=this.items.itemAt(e).items.itemAt(5).getValue();var f=this.items.itemAt(e).items.itemAt(7).getValue();var g=this.items.itemAt(e).items.itemAt(9).getValue();b=b?b:0;k=k?k:0;f=f?f:0;g=g?g:0;h+=(b+k+f+g)}this.ownerCt.items.itemAt(7).items.itemAt(4).setValue(h);Ext.getCmp("addCruiseCabinType").totalPassengers=h;Ext.getCmp("addCruiseCabinType").ownerCt.ownerCt.displayTotalPaxForAllocation();if(document.getElementById("DISPLAY_PAX_COUNT")){document.getElementById("DISPLAY_PAX_COUNT").innerHTML="Total of <b>"+h+" Passenger(s)</b> is been Added to this Manual Quote Booking."}},listeners:{render:function(){;var h=this.ownerCt.findParentByType("tabpanel");var l=this.ownerCt.findParentByType("awesomewindow");var k=l.aw.data;var m=k.type;var g=Ext.util.JSON.decode(k.parameters);var d=Ext.util.JSON.decode(g.mainRooms);if(typeof d!="undefined"){d=d.data}else{d=[]}this.ownerCt.items.itemAt(7).items.itemAt(0).roomNo=d.length;for(var e=1;e<d.length;e++){this.ownerCt.items.itemAt(7).items.itemAt(0).createRooms(e+1,false)}for(var c=0;c<d.length;c++){this.items.itemAt(c).items.itemAt(3).setValue(d[c].adult);this.items.itemAt(c).items.itemAt(5).setValue(d[c].child);var b=d[c].childAge;for(var e=0;e<b.length;e++){this.items.itemAt(c).items.itemAt(11).items.itemAt(e).show(true);this.items.itemAt(c).items.itemAt(11).items.itemAt(e).setValue(b[e])}this.items.itemAt(c).items.itemAt(7).setValue(d[c].infant);this.items.itemAt(c).items.itemAt(9).setValue(d[c].senior);var f=d[c].infantAge;for(var e=0;e<f.length;e++){this.items.itemAt(c).items.itemAt(13).items.itemAt(e).show(true);this.items.itemAt(c).items.itemAt(13).items.itemAt(e).setValue(f[e])}}}},items:[{xtype:"panel",layout:"table",width:510,style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,hideBorders:true,totalPaxPerRoom:0,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(3).getValue();var f=this.items.itemAt(5).getValue();var d=this.items.itemAt(7).getValue();var e=this.items.itemAt(9).getValue();b=b?b:0;f=f?f:0;d=d?d:0;e=e?e:0;this.totalPaxPerRoom=b+f+d+e;this.ownerCt.calculateTotalPax()},layoutConfig:{columns:10},items:[{xtype:"checkbox",readOnly:true,width:20},{html:"Stateroom 1",width:90},{html:'Adults<font color="red">*</font>:',width:48},{xtype:"combo",store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",triggerAction:"all",readOnly:true,width:42,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Child:",width:50},{xtype:"combo",store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var c=this.ownerCt.items.itemAt(11).items;var b=this.getValue();for(var a=0;a<5;a++){if(a<b){c.itemAt(a).show(true)}else{c.itemAt(a).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Infants:",width:55},{xtype:"combo",store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var c=this.ownerCt.items.itemAt(13).items;var b=this.getValue();for(var a=0;a<5;a++){if(a<b){c.itemAt(a).show(true)}else{c.itemAt(a).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Senior 55+:",width:70},{xtype:"combo",store:[0,1,2,3,4,5],name:"S1",border:true,triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" ",colspan:5,width:150},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"C11",width:30},{xtype:"numberfield",name:"C12",width:30},{xtype:"numberfield",name:"C13",width:30},{xtype:"numberfield",name:"C14",width:30},{xtype:"numberfield",name:"C15",width:30}]},{html:" ",width:53},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"I11",width:30},{xtype:"numberfield",name:"I12",width:30},{xtype:"numberfield",name:"I13",width:30},{xtype:"numberfield",name:"I14",width:30},{xtype:"numberfield",name:"I15",width:30}]}]}]},{xtype:"panel",layout:"table",border:false,hideBorders:false,layoutConfig:{columns:8},items:[{xtype:"button",text:"<b>+</b>",roomNo:1,createRooms:function(b,a){this.ownerCt.ownerCt.items.itemAt(6).add(new Ext.Panel({layout:"table",width:510,style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,name:b,totalPaxPerRoom:0,totalPaxPerRoomCalc:function(){var d=this.items.itemAt(3).getValue();var g=this.items.itemAt(5).getValue();var e=this.items.itemAt(7).getValue();var f=this.items.itemAt(9).getValue();d=d?d:0;g=g?g:0;e=e?e:0;f=f?f:0;this.totalPaxPerRoom=d+g+e+f;this.ownerCt.calculateTotalPax()},hideBorders:true,layoutConfig:{columns:10},items:[{xtype:"checkbox",width:20},{html:"Stateroom "+b,width:90},{html:'Adults<font color="red">*</font>:',width:48},{xtype:"combo",store:[0,1,2,3,4,5,6,7,8,9,10],name:"A"+b,triggerAction:"all",readOnly:true,width:42,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Child:",width:50},{xtype:"combo",store:[0,1,2,3,4,5],name:"C"+b,triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var e=this.ownerCt.items.itemAt(11).items;var d=this.getValue();for(var c=0;c<5;c++){if(c<d){e.itemAt(c).show(true)}else{e.itemAt(c).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Infants:",width:55},{xtype:"combo",store:[0,1,2,3,4,5],name:"I"+b,triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var e=this.ownerCt.items.itemAt(13).items;var d=this.getValue();for(var c=0;c<5;c++){if(c<d){e.itemAt(c).show(true)}else{e.itemAt(c).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Senior 55+:",width:70},{xtype:"combo",store:[0,1,2,3,4,5],name:"S1",border:true,triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" ",colspan:5,width:150},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"C"+b+"1",width:30},{xtype:"numberfield",name:"C"+b+"2",width:30},{xtype:"numberfield",name:"C"+b+"3",width:30},{xtype:"numberfield",name:"C"+b+"4",width:30},{xtype:"numberfield",name:"C"+b+"5",width:30}]},{html:" ",width:53},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"I"+b+"1",width:30},{xtype:"numberfield",name:"I"+b+"2",width:30},{xtype:"numberfield",name:"I"+b+"3",width:30},{xtype:"numberfield",name:"I"+b+"4",width:30},{xtype:"numberfield",name:"I"+b+"5",width:30}]}]}));if(a){this.ownerCt.ownerCt.items.itemAt(6).doLayout()}},handler:function(){this.roomNo+=1;var a=this.roomNo;if(a<=5){this.createRooms(a,true)}}},{xtype:"button",text:"<b>-</b>",roomNo:1,handler:function(){var c=1;var e=this.ownerCt.ownerCt.items.itemAt(6).items;var f=this.ownerCt.ownerCt.items.itemAt(7).items.itemAt(0);if(f.roomNo>5){f.roomNo=5}for(var d=0;d<e.length;d++){if(e.itemAt(d).items.itemAt(0).checked){this.ownerCt.ownerCt.items.itemAt(6).remove(e.itemAt(d),true);f.roomNo-=1;d=-1}}for(var d=0;d<e.length;d++){if(e.itemAt(d).items.itemAt(0).checked||e.itemAt(d).hidden){e.itemAt(d).items.itemAt(0).checked=false}else{var b=e.itemAt(d).items.itemAt(1);e.itemAt(d).items.itemAt(1).el.dom.innerHTML="Stateroom "+(c);c++}}this.ownerCt.ownerCt.items.itemAt(6).calculateTotalPax()}},{border:false,width:50},{border:false,html:"Total&nbsp;Pax:",width:50},{xtype:"numberfield",name:"totalPax",id:"ID_TOTAL_PAX",width:41,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]}]},{xtype:"fieldset",defaults:{style:"padding: 0; margin-left: 130px; "},autoHeight:true,labelWidth:105,items:[{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:4},items:[{html:'Supplier<font color="red">*</font>:',border:false,hideBorders:false,width:110},{xtype:"combo",name:"supplierURI",id:"supplierURI",mode:"local",width:280,triggerAction:"all",editable:true,displayField:"name",valueField:"dataURI",store:TDS.data.MQsupplierStore}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:2},items:[{html:"Cruise Line(s):",border:false,hideBorders:false,width:110},{xtype:"textfield",name:"cruiseLines",mode:"local",width:280,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:12},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}else{if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{xtype:"radio",name:"deckName",inputValue:"deck",boxlabel:"Deck"},{html:"&nbsp;Deck",width:40},{xtype:"radio",name:"deckName",inputValue:"name",boxlabel:"Name"},{html:"&nbsp;Name&nbsp;&nbsp;",width:45},{xtype:"combo",fieldLabel:"Type",name:"deckNameString",mode:"local",width:100,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"name",valueField:"name",store:TDS.data.cruiseDeck,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{html:"",width:25},{xtype:"textfield",width:152,name:"deckCount",listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{html:"",width:2},{xtype:"radio",name:"protStarboard",inputValue:"port",boxlabel:"Port"},{html:"&nbsp;Port",width:36},{xtype:"radio",name:"protStarboard",inputValue:"starboard",boxlabel:"Starboard"},{html:"&nbsp;Starboard",width:50}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:18},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}else{if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{html:"Obstruction:",border:false,hideBorders:false,width:70},{xtype:"radio",name:"obstruction",inputValue:"noObstruction",boxlabel:"No"},{html:"&nbsp;No",width:20},{xtype:"radio",name:"obstruction",inputValue:"yesObstruction",boxlabel:"Yes"},{html:"&nbsp;Yes",width:30},{html:"Accept Upgrade:",border:false,hideBorders:false,width:90},{xtype:"radio",name:"acceptUpgrade",inputValue:"noAcceptUpgrade",boxlabel:"No"},{html:"&nbsp;No",width:20},{xtype:"radio",name:"acceptUpgrade",inputValue:"yesAcceptUpgrade",boxlabel:"Yes"},{html:"&nbsp;Yes",width:40},{html:"Stateroom Guarantee:",border:false,hideBorders:false,width:115},{xtype:"radio",name:"stateroomGuarantee",inputValue:"noStateroomGuarantee",boxlabel:"No"},{html:"&nbsp;No",width:20},{xtype:"radio",name:"stateroomGuarantee",inputValue:"yesStateroomGuarantee",boxlabel:"Yes"},{html:"&nbsp;Yes",width:30}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:6},defaults:{border:false},items:[{width:275}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}else{if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{html:"Dinning Preference:",border:false,hideBorders:false,width:110},{xtype:"radio",name:"dinningPreference",inputValue:"1stSitting",boxlabel:"1st Sitting"},{html:"&nbsp;1st Sitting",width:85},{xtype:"radio",name:"dinningPreference",inputValue:"2ndSitting",boxlabel:"2nd Sitting"},{html:"&nbsp;2nd Sitting",width:85},{xtype:"radio",name:"dinningPreference",inputValue:"anytime",boxlabel:"anytime"},{html:"&nbsp;Any Time",width:80},{xtype:"radio",name:"dinningPreference",inputValue:"noPreference",boxlabel:"noPreference"},{html:"&nbsp;No Preference",width:90}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:11},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}else{if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{html:"Table Size:",border:false,hideBorders:false,width:110},{xtype:"radio",name:"tableSize",inputValue:"2",boxlabel:"2"},{html:"&nbsp;2",width:40},{xtype:"radio",name:"tableSize",inputValue:"4to6",boxlabel:"4 to 6"},{html:"&nbsp;4 to 6",width:60},{xtype:"radio",name:"tableSize",inputValue:"6to7",boxlabel:"6 to 7"},{html:"&nbsp;6 to 8",width:56},{xtype:"radio",name:"tableSize",inputValue:"8ormore",boxlabel:"8 or More"},{html:"&nbsp;8 or More",width:80},{xtype:"radio",name:"tableSize",inputValue:"noPreference",boxlabel:"noPreference"},{html:"&nbsp;No Preference",width:90}]},{xtype:"editorgrid",height:160,clicksToEdit:1,width:630,style:"padding: 0;margin-left: 10px; margin-bottom: 6px;margin-top: 6px;",store:new Ext.data.JsonStore({url:"",identifier:"",fields:["dataURI","cabinNo","a","c","i","s","cabin","stateRoomType","category","location","extras","roomNo"]}),viewConfig:{},getTotalPaxAdded:function(){;var k=this.getStore().data;var g=0;for(var e=0,l=[];e<k.length;e++){var b=k.items[e].data.a;var m=k.items[e].data.c;var f=k.items[e].data.i;var h=k.items[e].data.s;if(b!=""&&typeof b!="undefined"){g+=b}if(m!=""&&typeof m!="undefined"){g+=m}if(f!=""&&typeof f!="undefined"){g+=f}if(h!=""&&typeof h!="undefined"){g+=h}}return g},displayTotalPaxForAllocation:function(){this.roomCreate();var a=Ext.getCmp("addCruiseCabinType");var b=a.totalPassengers-this.getTotalPaxAdded();if(b<0){b=0}a.ownerCt.items.itemAt(3).td.innerHTML="Un-allocated Pax:&nbsp;&nbsp;"+b},validateTotalPax:function(f,e){var m=this;var o=Ext.getCmp("addCruiseCabinType").roomNo;var v=Ext.getCmp("roomsPaxId").items.itemAt(o-1).items;var n=v.itemAt(3).getValue();var l=v.itemAt(5).getValue();var h=v.itemAt(7).getValue();var b=v.itemAt(9).getValue();var q=m.getStore().data;var p=0;var u=0;var g=0;var k=0;var w=0;for(var y=0,A=[];y<q.length;y++){if(q.items[y].data.cabinNo==o){var C=q.items[y].data.a;var B=q.items[y].data.c;var z=q.items[y].data.i;var x=q.items[y].data.s;if(C!=""&&typeof C!="undefined"){u+=C}if(B!=""&&typeof B!="undefined"){g+=B}if(z!=""&&typeof z!="undefined"){k+=z}if(x!=""&&typeof x!="undefined"){w+=x}}}this.displayTotalPaxForAllocation();if(f=="a"&&u>n){Ext.Msg.alert("Alert","Enter Valid Adults.",function(){m.startEditing(m.newRecordIndex,1)});return false}if(f=="c"&&g>l){Ext.Msg.alert("Alert","Enter Valid Children.",function(){m.startEditing(m.newRecordIndex,2)});return false}if(f=="i"&&k>h){Ext.Msg.alert("Alert","Enter Valid Infants.",function(){m.startEditing(m.newRecordIndex,3)});return false}if(f=="s"&&w>b){Ext.Msg.alert("Alert","Enter Valid Infants.",function(){m.startEditing(m.newRecordIndex,4)});return false}return true},getNextRoomNo:function(){var Y=Ext.getCmp("addCruiseCabinType").roomNo;var ab=Ext.getCmp("roomsPaxId").items;var B=0;var R=0;var Z=0;var M=0;var A=0;var Q=0;var V=0;var L=0;var y=0;var P=0;var U=0;var K=0;var w=0;var O=0;var T=0;var J=0;var u=0;var N=0;var S=0;var I=0;for(var ac=0,af=[];ac<ab.length;ac++){var W=ab.itemAt(ac).items;var ah=W.itemAt(3).getValue();var ag=W.itemAt(5).getValue();var ad=W.itemAt(7).getValue();var l=W.itemAt(9).getValue();if(ac==0){if(ah!=""&&typeof ah!="undefined"){B=ah}if(ag!=""&&typeof ag!="undefined"){R=ag}if(ad!=""&&typeof ad!="undefined"){Z=ad}if(l!=""&&typeof l!="undefined"){M=l}}else{if(ac==1){if(ah!=""&&typeof ah!="undefined"){A=ah}if(ag!=""&&typeof ag!="undefined"){Q=ag}if(ad!=""&&typeof ad!="undefined"){V=ad}if(l!=""&&typeof l!="undefined"){L=l}}else{if(ac==2){if(ah!=""&&typeof ah!="undefined"){y=ah}if(ag!=""&&typeof ag!="undefined"){P=ag}if(ad!=""&&typeof ad!="undefined"){U=ad}if(l!=""&&typeof l!="undefined"){K=l}}else{if(ac==3){if(ah!=""&&typeof ah!="undefined"){w=ah}if(ag!=""&&typeof ag!="undefined"){O=ag}if(ad!=""&&typeof ad!="undefined"){T=ad}if(l!=""&&typeof l!="undefined"){J=l}}else{if(ac==4){if(ah!=""&&typeof ah!="undefined"){u=ah}if(ag!=""&&typeof ag!="undefined"){N=ag}if(ad!=""&&typeof ad!="undefined"){S=ad}if(l!=""&&typeof l!="undefined"){I=l}}}}}}}var aa=this.getStore().data;var X=0;var C=0;var h=0;var H=0;var p=0;var z=0;var g=0;var G=0;var o=0;var x=0;var f=0;var F=0;var n=0;var v=0;var e=0;var E=0;var m=0;var q=0;var b=0;var D=0;var k=0;for(var ac=0,af=[];ac<aa.length;ac++){var ah=aa.items[ac].data.a;var ag=aa.items[ac].data.c;var ad=aa.items[ac].data.i;var l=aa.items[ac].data.s;if(aa.items[ac].data.cabinNo==1){if(ah!=""&&typeof ah!="undefined"){C+=ah}if(ag!=""&&typeof ag!="undefined"){h+=ag}if(ad!=""&&typeof ad!="undefined"){H+=ad}if(l!=""&&typeof l!="undefined"){p+=l}}else{if(aa.items[ac].data.cabinNo==2){if(ah!=""&&typeof ah!="undefined"){z+=ah}if(ag!=""&&typeof ag!="undefined"){g+=ag}if(ad!=""&&typeof ad!="undefined"){G+=ad}if(l!=""&&typeof l!="undefined"){o+=l}}else{if(aa.items[ac].data.cabinNo==3){if(ah!=""&&typeof ah!="undefined"){x+=ah}if(ag!=""&&typeof ag!="undefined"){f+=ag}if(ad!=""&&typeof ad!="undefined"){F+=ad}if(l!=""&&typeof l!="undefined"){n+=l}}else{if(aa.items[ac].data.cabinNo==4){if(ah!=""&&typeof ah!="undefined"){v+=ah}if(ag!=""&&typeof ag!="undefined"){e+=ag}if(ad!=""&&typeof ad!="undefined"){E+=ad}if(l!=""&&typeof l!="undefined"){m+=l}}else{if(aa.items[ac].data.cabinNo==5){if(ah!=""&&typeof ah!="undefined"){q+=ah}if(ag!=""&&typeof ag!="undefined"){b+=ag}if(ad!=""&&typeof ad!="undefined"){D+=ad}if(l!=""&&typeof l!="undefined"){k+=l}}}}}}}var ae=Ext.getCmp("addCruiseCabinType");if(B>C||R>h||Z>H){ae.roomNo=1}else{if(A>z||Q>g||V>G){ae.roomNo=2}else{if(y>x||P>f||U>F){ae.roomNo=3}else{if(w>v||O>e||T>E){ae.roomNo=4}else{if(u>q||N>b||S>D){ae.roomNo=5}else{if(aa.length==0){ae.roomNo=1}}}}}}},roomCreate:function(){;var w=this;var n=this.getStore();var x=this.getStore().data;var b=[];var p=Ext.getCmp("addCruiseCabinType").roomNo;var o=Ext.getCmp("roomsPaxId").items.length;p=o;for(var m=1;m<=p;m++){var o=Ext.getCmp("roomsPaxId").items.itemAt(m-1).items;var l=o.itemAt(3).getValue();var k=o.itemAt(5).getValue();var h=o.itemAt(7).getValue();var u=o.itemAt(9).getValue();var f="";var d="";var e="";var q="";var j="";var c="";var t="";if(typeof n.data.items[m-1]!="undefined"){var a=n.data.items[m-1].data;t=a.cabinNo;f=a.cabin;d=a.roomType;e=a.stateRoomType;q=a.category;j=a.extras;c=a.location}b.push({cabinNo:t,roomType:d,a:l,c:k,i:h,s:u,stateRoomType:e,category:q,cabin:f,location:c,extras:j})}n.removeAll();for(var v=0;v<b.length;v++){n.add([new n.recordType(b[v])]);w.newRecordIndex=n.getCount()-1;w.startEditing(w.newRecordIndex,1)}w.getView().refresh()},getData:function(){var b=this.getStore().data;for(var a=0,c=[];a<b.length;a++){c.push(b.items[a].data)}return{data:c}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[{header:"No",dataIndex:"cabinNo",width:20,editor:new Ext.form.NumberField({})},{header:"A",dataIndex:"a",width:20},{header:"C",dataIndex:"c",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){var a=this;setTimeout(function(){var b=Ext.getCmp("addCruiseCabinType");if(!b.ownerCt.ownerCt.validateTotalPax("c",a)){if(this.getValue()!=""){b.c+=parseInt(this.getValue())}}},100)}}})},{header:"I",dataIndex:"i",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){var a=this;setTimeout(function(){var b=Ext.getCmp("addCruiseCabinType");if(!b.ownerCt.ownerCt.validateTotalPax("i",a)){if(this.getValue()!=""){b.i+=parseInt(this.getValue())}}},100)}}})},{header:"S",dataIndex:"s",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){var a=this;setTimeout(function(){var b=Ext.getCmp("addCruiseCabinType");if(!b.ownerCt.ownerCt.validateTotalPax("s",a)){if(a.getValue()!=""){b.a+=parseInt(a.getValue())}}},100)}}})},{header:"Cabin#",dataIndex:"cabin",width:60,editor:new Ext.form.TextField({})},{header:"Stateroom  Type",dataIndex:"stateRoomType",width:110,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",store:TDS.data.accommodationRoomTypeMQ})},{header:"Category",dataIndex:"category",width:110,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",store:TDS.data.accommodationRoomTypeMQ})},{header:"Location",dataIndex:"location",width:110,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",store:TDS.data.cruiseCategory})},{header:"Extras",dataIndex:"extras",width:115,height:70,editor:new Ext.ux.form.SuperBoxSelect({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",xtype:"superboxselect",store:TDS.data.accommodationExtraMQ}),renderer:function(c,e,a,f,d,b){if(c!=""){e.attr='ext:qtip="'+c+'"'}return c}},{header:"Price",dataIndex:"price",hidden:true,width:60,fixed:true},{header:"Status",dataIndex:"status",hidden:true,width:60,fixed:true}],bbar:[{xtype:"button",text:"Add",id:"addCruiseCabinType",hidden:true,roomNo:1,s:0,totalPassengers:0,totalPassengersAdded:0,a:0,c:0,i:0,handler:function(){var a=this;setTimeout(function(){if((a.totalPassengers-a.ownerCt.ownerCt.getTotalPaxAdded())>0){a.ownerCt.ownerCt.getNextRoomNo();a.ownerCt.ownerCt.displayTotalPaxForAllocation();var b=a.ownerCt.items.itemAt(1);b.enable();var d=a.ownerCt.ownerCt;var c=d.getStore();c.add([new c.recordType({cabinNo:a.roomNo,roomType:"",plan:"",rooms:"",extras:" "})]);d.newRecordIndex=c.getCount()-1;d.startEditing(d.newRecordIndex,1)}},100)}},{xtype:"button",text:"Cancel",disabled:true,hidden:true,handler:function(){;if(this.ownerCt.items.itemAt(0).roomNo>0){this.ownerCt.items.itemAt(0).roomNo-=1}var b=this.ownerCt.items.itemAt(0);b.enable();var c=this.ownerCt.ownerCt;var a=c.getStore().getAt(c.selModel.last);if(a==-1||typeof a.get("dataURI")!="undefined"){return}c.getStore().remove(a);if(c.getStore().length<=0){this.disable()}this.ownerCt.ownerCt.displayTotalPaxForAllocation()}},"->","Un-allocated Pax:&nbsp;&nbsp;0"],listeners:{render:function(){;this.getEl().swallowEvent(["columnmove","columnresize","headerclick","click","mouseout","rowclick","rowmousedown","rowblclick","cellblclick","sortchange","mouseup","mousedown"]);var h=this.ownerCt.findParentByType("tabpanel");var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.type;var e=Ext.util.JSON.decode(b.parameters);var f=Ext.util.JSON.decode(e.gridData);var g=f;if(typeof g=="undefined"){g=[]}if(typeof g.data!="undefined"){this.getStore().loadData(g.data);this.bottomToolbar.items.itemAt(0).roomNo=g.data.length}}}},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:11},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}else{if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{html:"Cruise Member No:",border:false,hideBorders:false,width:110},{xtype:"radio",name:"cruiseMemberNo",inputValue:"noCruiseMemberNo",boxlabel:"No",listeners:{check:function(){if(this.getValue()){this.ownerCt.items.itemAt(10).disable(true);this.ownerCt.items.itemAt(10).setValue("")}}}},{html:"&nbsp;No",width:50},{xtype:"radio",name:"cruiseMemberNo",inputValue:"yesCruiseMemberNo",boxlabel:"Yes",listeners:{check:function(){if(this.getValue()){this.ownerCt.items.itemAt(10).enable(true);this.ownerCt.items.itemAt(10).setValue("")}}}},{html:"&nbsp;yes",width:40},{html:"Adults:",width:40},{xtype:"combo",store:[0,1,2,3,4,5,6,7,8,9,10],name:"cruiseMemberAdultNo",triggerAction:"all",readOnly:true,width:42,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Child:",width:50},{xtype:"combo",store:[0,1,2,3,4,5],name:"cruiseMemberChildNo",triggerAction:"all",readOnly:true,width:40,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{width:20},{xtype:"numberfield",width:93,disabled:true,name:"cruiseMemberCount",listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]}]}]},{border:false,items:[{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:480},{xtype:"button",hidden:true,text:"Back"},{html:"&nbsp;",width:80},{xtype:"button",text:"Next",hidden:true,handler:function(){var a=this.ownerCt.ownerCt.ownerCt.ownerCt;a.setActiveTab(1)}},{html:"&nbsp; ",width:10}]}]}]},{title:"Additional Info",items:[{title:'<font color="#cc0000"><b></b></font> ',collapsedTitle:"rrr",collapsed:true,collapsible:true,enableCollapsedTitle:true,minHeight:200,highlightInterval:10000,height:200,border:true,items:[{xtype:"textarea",name:"description",height:150,width:685,hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:true,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false},{xtype:"button",text:"Edit Last Entry",handler:function(){;var f=this;var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var c=d.pnrinfoId;var g=d.pnrinfoText;var b=e.initialConfig.sourceDataURI;TDS.helpwindow.setWindow({title:"Additional Info",information:"Additional Info.",interfaceURI:"pnr/components/manualQuote/additionalInfo.js",destinationDataURI:b+"/additionalInfo/"+c,data:{pnrinfoText:g},buttonOK:"Submit",callback:{fn:function(k,i,j){;var a=j.conversations;var h=f.ownerCt.ownerCt.items.itemAt(1);h.el.dom.innerHTML=a},scope:this.ownerCt.ownerCt}})}}]},{html:"",height:445,width:685,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.conversations;this.html=d}}},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:500},{xtype:"button",text:"Back",hidden:true,handler:function(){var a=this.ownerCt.ownerCt.ownerCt;a.setActiveTab(0)}},{html:"&nbsp;",width:10},{xtype:"button",text:"Next",hidden:true,handler:function(){var b=this.ownerCt.ownerCt.ownerCt;var a=this.ownerCt.findParentByType("awesomewindow");a.buttons[0].enable(true);a.buttons[1].enable(true);b.setActiveTab(2)}},{html:"&nbsp; ",width:10}]}]},{title:"Passengers",items:[{xtype:"panel",border:false,style:"margin-bottom: 6px;",html:'<div id="DISPLAY_PAX_COUNT"></div>',listeners:{render:function(){var a=Ext.getCmp("ID_TOTAL_PAX").getValue();if(!a){a=0}if(document.getElementById("DISPLAY_PAX_COUNT")){document.getElementById("DISPLAY_PAX_COUNT").InnerHTML="Total "+a+" is been Added to this Manual Quote Booking."}else{this.html='<font size="2" >Total of <b>'+a+" Passenger(s)</b> is been Added to this Manual Quote Booking.</font>"}}}},{xtype:"panel",border:false,layout:"fit",height:430,items:[{xtype:"editorgrid",height:440,width:570,store:new Ext.data.CollectionStore({url:"",identifier:"",fields:["type","code","nameFirst","nameLast","salutation","displayName","dateOfBirth","rateURI","paxAge"]}),viewConfig:{forceFit:true},getData:function(){var b=this.selModel.getSelections();var c=[];for(var a=0;a<b.length;a++){c[a]=b[a].get("dataURI")}return c},preselect:function(c,b){var a=[];this.getStore().each(function(d){if(a.length>=b){return false}if((!c||d.get("type")==c)&&d.get("nameFirst")&&d.get("nameLast")){a[a.length]=d}},this);if(a.length>0){this.getSelectionModel().selectRecords(a)}return a.length},validatePassenger:function(d,a,c,b){if(!b.get("nameFirst")&&!b.get("nameLast")){return false}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Type",dataIndex:"type",width:40,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"text",valueField:"text",triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Last name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false})},{header:"First name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false})},{header:"Title",dataIndex:"salutation",width:40,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"Age",dataIndex:"paxAge",width:40,renderer:function(c,b,a){if(c){return c}else{return TDS.util.Format.age(a.get("dateOfBirth"))}},editor:new Ext.form.NumberField({allowBlank:false})}],listeners:{beforeedit:function(a){},render:function(){var grid=this;var w=this.ownerCt.findParentByType("awesomewindow");with(this.store){reader.meta.identifier=w.aw.data.pnrDataURI+"/passengers";proxy.conn.url=TDS.env.dataPath+w.aw.data.pnrDataURI+"/passengers/concise";load()}var dataURI=w.aw.sourceDataURI;Ext.Ajax.request({url:TDS.env.dataPath+dataURI+"/passengers/collection/concise",method:"GET",callback:function(o,s,r){;if(s){var ro=Ext.util.JSON.decode(r.responseText);var collection=ro[dataURI+"/passengers"];if(typeof collection=="undefined"){return}for(var i=0;i<collection.length;i++){var s=this.getStore().data;for(var j=0;j<s.length;j++){if(s.items[j].data.dataURI==collection[i]){grid.getSelectionModel().selectRow(j,true,false)}}}}},scope:this})}}}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 10px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:480},{xtype:"button",hidden:true,text:"next"},{html:"&nbsp;",width:80},{xtype:"button",text:"Back",hidden:true,handler:function(){var b=this.ownerCt.ownerCt.ownerCt;var a=this.ownerCt.findParentByType("awesomewindow");a.buttons[0].disable(true);a.buttons[1].disable(true);b.setActiveTab(1)}},{html:"&nbsp; ",width:10}]}]}]}]}