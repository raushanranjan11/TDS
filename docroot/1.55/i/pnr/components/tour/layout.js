{xtype:"panel",header:true,autoHeight:true,border:false,refreshGrid:function(){var b=this.ownerCt.findParentByType("awesomegrid");b.submitQuery(true)},items:{xtype:"tabpanel",border:false,activeTab:0,layoutOnTabChange:true,height:225,shared:{details:{}},setDetail:function(d,f){if(typeof d=="object"){for(var e in d){this.shared.details[e]=d[e]}}else{this.shared.details[d]=f}},getDetail:function(b){return this.shared.details[b]},items:[{title:"Details",items:{xtype:"panel",border:false,layout:"column",height:225,bodyStyle:"padding: 4px;",items:[{columnWidth:1,border:false,style:"padding: 0px; margin-right: 8px;",xtype:"ajaxpanel",hideBorders:true,height:300,interfaceURI:"pnr/components/tour/detail.js"},{width:150,xtype:"panel",autoHeight:true,border:false,bodyStyle:"padding: 4px;",defaults:{minWidth:100},invokeWindow:function(f,e){if(!e){e={}}var g=this.ownerCt.findParentByType("tabpanel");var h=g.ownerCt;Ext.apply(e,{title:"Amend",interfaceURI:"pnr/components/generic/edit.js",destinationDataURI:g.getDetail("dataURI"),sourceDataURI:g.getDetail("dataURI"),dataURI:{pnr:g.getDetail("pnrDataURI"),offering:g.getDetail("offeringURI"),component:g.getDetail("dataURI")},params:{status:f,rateList:g.getDetail("rateList"),priceCurrency:g.getDetail("pricingPriceCurrency"),displayStatus:g.getDetail("status")},callback:{fn:function(b){if(b){h.refreshGrid()}},scope:this}});TDS.window.setWindow(e)},listeners:{render:function(){var f=this.items.itemAt(0);var b=this.items.itemAt(1);var d=this.items.itemAt(2);var e=this.ownerCt.findParentByType("tabpanel");var c=e.getDetail("status");if(e.getDetail("offerMade")){b.enable(true)}if(c.toLowerCase()==TDS.data.componentStatus.STATUS_HELD.toLowerCase()){f.enable(true)}}},items:[{xtype:"button",text:"Confirm",config:{modetypes:""},disabled:true,handler:function(){var c=this;var d=this.ownerCt.findParentByType("tabpanel");var b=d.getDetail("status");if(!b){return}if(b.toLowerCase()==TDS.data.componentStatus.STATUS_HELD.toLowerCase()){Ext.Msg.show({title:"Confirm Booking?",msg:"Are you sure?",buttons:Ext.Msg.YESNO,animEl:"elId",icon:Ext.MessageBox.QUESTION,fn:function(e){if(e==="yes"){Ext.Ajax.request({url:TDS.env.dataPath+d.getDetail("dataURI"),jsonData:{status:TDS.data.componentStatus.STATUS_CONFIRMED},headers:{"Content-Type":"application/json"},method:"PUT",scope:this,callback:function(h,f,g){p.refreshGrid()}})}}})}},listeners:{render:function(){var b=this.findParentByType("ajaxpanel").rowRecordData.cruisePackage;if(b!=0){this.disable()}}}},{xtype:"button",config:{rateList:"",statusOffer:"",cPNRdataURI:""},text:"Offer",config:{modetypes:""},handler:function(c){var e=this.ownerCt.findParentByType("tabpanel");var d=e.ownerCt;var b=e.getDetail("dataURI");var c=this;;TDS.window.setWindow({title:"Description",interfaceURI:"pnr/components/generic/editTransfer.js",destinationDataURI:b,sourceDataURI:b,buttonOK:"Save",scope:c,dataURI:{pnr:e.getDetail("pnrDataURI"),offering:e.getDetail("offeringURI"),component:e.getDetail("dataURI"),componentName:e.getDetail("name")},params:{status:a,rateList:e.getDetail("rateList"),priceCurrency:e.getDetail("pricingPriceCurrency"),displayStatus:e.getDetail("status")},data:{rateRecords:this.config.rateList},callback:{fn:function(f){;if(f){d.refreshGrid()}},scope:this}})},listeners:{render:function(){var b=this.findParentByType("ajaxpanel").rowRecordData.cruisePackage;if(b!=0){this.disable()}}}},{xtype:"button",text:"Cancel",handler:function(c){var e=this.ownerCt.findParentByType("tabpanel");var d=e.ownerCt;var b=e.getDetail("status");e.getDetail("dataURI");if(!b){return}if(b.toLowerCase()==TDS.data.componentStatus.STATUS_REQUESTED.toLowerCase()){Ext.Msg.show({title:"Cancel Booking?",msg:"Are you sure?",buttons:Ext.Msg.YESNO,animEl:"elId",icon:Ext.MessageBox.QUESTION,fn:function(f){if(f==="yes"){Ext.Ajax.request({url:TDS.env.dataPath+e.getDetail("dataURI"),jsonData:{status:TDS.data.componentStatus.STATUS_CANCELLED},headers:{"Content-Type":"application/json"},method:"PUT",scope:this,callback:function(i,g,h){d.refreshGrid()}})}}})}else{Ext.Msg.show({title:"Cancel Booking?",msg:"Cancelling this booking may apply a cancellation fee,Are you sure?",buttons:Ext.Msg.YESNO,animEl:"elId",icon:Ext.MessageBox.QUESTION,fn:function(f){if(f==="yes"){Ext.Ajax.request({url:TDS.env.dataPath+e.getDetail("dataURI"),jsonData:{status:TDS.data.componentStatus.STATUS_CANCELLED},headers:{"Content-Type":"application/json"},method:"PUT",scope:this,callback:function(i,g,h){d.refreshGrid()}})}}})}}},{xtype:"button",text:"Note",handler:function(){var c=this.ownerCt.findParentByType("tabpanel");var d=c.getDetail("dataURI");TDS.window.setWindow({title:"Send a note",information:"Please enter your note below.",interfaceURI:"note.js",postDataURI:d+"/note",callback:{fn:function(b){},scope:this}})}},{xtype:"timerlabel",expire:function(){var b=this.ownerCt;b.items.itemAt(0).disable();b.items.itemAt(1).disable();this.setText("Expired.")},listeners:{render:function(){var i=this.ownerCt.findParentByType("tabpanel");var f=i.getDetail("dataURI");var g=i.getDetail("timeHeldUntil");if(!f||!g){this.hide();var j=Ext.TimerMgr.lookup(f);if(j){Ext.TimerMgr.stop(j)}return}var h=new Ext.Timer({id:f,expireTime:g});var j=Ext.TimerMgr.start(h);this.setTimer(j)},timerexpire:function(){this.expire()}}}]}]}},{title:"Extras",items:{xtype:"ajaxpanel",height:190,interfaceURI:"pnr/components/generic/extras.js"}},{title:"Terms and Conditions",items:{xtype:"ajaxpanel",height:190,interfaceURI:"pnr/components/generic/terms.js"}},{title:"Links",items:{xtype:"ajaxpanel",height:190,interfaceURI:"pnr/components/generic/links.js"}},{title:"Queues",items:{xtype:"ajaxpanel",height:190,interfaceURI:"pnr/components/generic/messages.js"}},{title:"Information",items:{xtype:"ajaxpanel",height:190,interfaceURI:"pnr/components/tour/information.js"}}]},listeners:{render:function(){var i=this.ownerCt;var f=this.ownerCt.ownerCt;var h=this.items.itemAt(0);var h=this.items.itemAt(0);h.setDetail(i.rowRecordData);h.setDetail("pnrDataURI",f.ownerCt.ownerCt.baseDataURI);h.setDetail("voucher",i.rowRecordData.voucher);var j=i.rowRecordData.supplierURI;if(j){var g=TDS.util.Format.displayResourceConciseName(j)}this.setTitle(i.rowRecordData.name+" ("+g+")")}}}