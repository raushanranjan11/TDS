{xtype:"panel",width:750,height:170,border:false,hideBorders:true,refreshGrid:function(){var a=this.ownerCt.findParentByType("tabpanel");a.ownerCt.refreshGrid()},getDataURI:function(){var a=this.ownerCt.findParentByType("tabpanel");return a.getDetail("offeringURI")},getPNRDataURI:function(){var a=this.ownerCt.findParentByType("tabpanel");return a.getDetail("pnrDataURI")},getDataBox:function(){return this.items.itemAt(0)},getTimerLabel:function(){return this.getTopToolbar().items.itemAt(0)},getRecheckButton:function(){return this.getTopToolbar().items.itemAt(1)},expireInterface:function(){this.getTimerLabel().hide();this.getRecheckButton().show();var a=this.getDataBox();a.store.removeAll();a.updateCalendarStatus()},submit:function(){var b=this.ownerCt.findParentByType("tabpanel");var a=this.getDataBox();a.lm.show();a.store.removeAll();a.updateCalendarStatus();Ext.Ajax.request({method:"GET",url:TDS.env.dataPath+this.getDataURI()+"/reservation",params:{pnrComponentURI:b.getDetail("dataURI")},callback:this.submitResponse,scope:this})},submitResponse:function(g,c,e){if(c){var f=Ext.decode(e.responseText);var b=this.getDataBox();b.store.loadData(f);b.updateCalendarStatus();b.lm.hide();var a=new Date().add(Date.SECOND,60).format(TDS.env.dateFormat);this.getTimerLabel().activate(a)}},tbar:[{xtype:"timerlabel",text:"Availability: Checking...",activate:function(b){var c=this.ownerCt.ownerCt;var a=Ext.TimerMgr.start(new Ext.Timer({id:c.getDataURI()+"/availability",useServerTime:false,expireTime:b,interval:1000}));this.setTimer(a)},reset:function(){var a=this.ownerCt.ownerCt;this.cancelTimer();this.setText("Availability: Checking...")},listeners:{timerexpire:function(a){var b=this.ownerCt.ownerCt;b.expireInterface();this.reset()},timerrefresh:function(a,b){this.setText("Availability: Valid for "+b)}}},{xtype:"button",text:"Availability: Expired, click to re-check.",hidden:true,handler:function(){var a=this.ownerCt.ownerCt;a.submit();this.hide();a.getTimerLabel().show()}}],items:[{xtype:"databox",listeners:{beforerender:function(){var a=this.ownerCt.findParentByType("tabpanel");this.firstDate=Date.parseDate(a.getDetail("dateFrom"),TDS.env.dateFormat)},render:function(){this.ownerCt.submit()},go:function(l,h,c){var e=this.getRecordByDate(c);var k=this.getDaysFromDate(c);if(e==-1){return}var a=this.ownerCt;var g=a.findParentByType("tabpanel");var f=g.getDetail("rate");var j=e.get("reservedAvailable");if(!j){j=e.get("reservedRequestable")}if(!j){return}var d={rateName:g.getDetail("rateName"),offeringName:g.getDetail("name"),numberToReserveRequested:j,priceCurrency:f.pricingPriceCurrency,priceSell:f.pricingPriceSell,daysAvailable:k.availableDays,daysRequestable:k.requestableDays};if(f.groupName){d.rateBasis=f.groupName}if(f.ratePerURI){d.ratePerURI=f.ratePerURI}if(f.rateOccupancyURI){d.rateOccupancyURI=f.rateOccupancyURI}if(f.rateOccupancyURI){d.rateOccupancyURI=f.rateOccupancyURI}var b=g.getDetail("type");var i="";if(b===TDS.data.componentType.TYPE_ACCOMMODATION){i="pnr/offerings/accommodation/go.js"}else{if(b===TDS.data.componentType.TYPE_TOUR){i="pnr/offerings/tour/go.js"}else{if(b===TDS.data.componentType.TYPE_CRUISE){i="pnr/offerings/cruise/go.js"}else{if(b===TDS.data.componentType.TYPE_HOSTEL){i="pnr/offerings/hostel/go.js"}else{if(b===TDS.data.componentType.TYPE_CAR){i="pnr/offerings/car/go.js"}else{if(b===TDS.data.componentType.TYPE_TRANSFER){i="pnr/offerings/transfer/go.js"}else{if(b===TDS.data.componentType.TYPE_AIR){i="pnr/offerings/air/go.js"}else{if(b===TDS.data.componentType.TYPE_RAIL){i="pnr/offerings/rail/go.js"}else{if(b===TDS.data.componentType.TYPE_ATTRACTION){i="pnr/offerings/attraction/go.js"}}}}}}}}}TDS.window.setWindow({title:"Booking",interfaceURI:i,postDataURI:a.getPNRDataURI()+"/components",mergeData:true,dataURI:{pnr:a.getPNRDataURI(),offering:a.getDataURI()},data:{dateFrom:c.format(TDS.env.dateFormat),offeringURI:g.getDetail("offeringURI"),rateURI:g.getDetail("rateURI")},params:d,callback:{fn:function(n,o,m){if(n){a.refreshGrid()}},scope:this}})}}}]}