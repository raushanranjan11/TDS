{xtype:"form",border:false,width:750,markDataDirtyOnLoad:true,beforeSubmit:function(e){var c=this;var d=e;var g=this.getFlightGrid().getSelectionModel().selections.items;var h=[],i={};for(var f=0;f<g.length;f++){h.push({dataURI:g[f].data.dataURI,rateURI:g[f].json.rateIds})}i.root=h;return e.root=i},beforeDataLoad:function(b,a){return b},getRateURI:function(){return this.ownerCt.getDataURI("rateOffering")},getTermsURI:function(){return this.ownerCt.getDataURI("terms")},getFlightGrid:function(){return this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0)},getPriceCurrency:function(){return this.ownerCt.getData("priceCurrency")},getPassGrid:function(){return this.items.itemAt(0).items.itemAt(1).items.itemAt(0).items.itemAt(0).items.itemAt(0)},getBaggageGrid:function(){return this.items.itemAt(0).items.itemAt(3).items.itemAt(0).items.itemAt(0).items.itemAt(0)},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:350,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Flights",items:[{xtype:"panel",layout:"table",frame:true,layoutConfig:{columns:1},labelWidth:110,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"panel",width:725,height:225,border:true,style:"padding: 2px;",items:[{xtype:"grid",alwaysUseCollection:true,width:725,height:170,border:false,store:new Ext.data.JsonStore({fields:["noOfSeats","rateId","travelDate","rateName","nameString","airportFromURI","airportFromString","airportToURI","airportToString","departure","stopOvers","expiryDate","dataURI","departureDate","arrivalDate","arrivalTime","departureTime","airportFrom","airportTo","bookStatus","adultRate","childRate","infantRate","adultNo","childNo","infantNo","offeringURI","dateFrom","restrictions","farePerFlight"]}),sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Flight Nos",dataIndex:"nameString",width:80,fixed:true},{header:"Class",dataIndex:"rateName"},{header:"From",dataIndex:"airportFromURI",sortable:true,renderer:function(a){return a.substring(a.lastIndexOf("/")+1)}},{header:"Date",dataIndex:"departureDate"},{header:"Time",dataIndex:"departureTime",sortable:true},{header:"To",dataIndex:"airportToURI",sortable:true,renderer:function(a){return a.substring(a.lastIndexOf("/")+1)}},{header:"Date",dataIndex:"arrivalDate",sortable:true},{header:"Time",dataIndex:"arrivalTime"},{header:"Stop",dataIndex:"stopOvers",sortable:true,renderer:function addTooltip(e,d,a,f,c,b){d.attr='ext:qtip="'+a.get("stopOversString")+'"';return e}},{header:"Seats",dataIndex:"noOfSeats"},{header:"Status",dataIndex:"bookStatus"}],viewConfig:{forceFit:true},listeners:{beforerender:function(){},celldblclick:function(f,h,d,g){;var b=f;var c=g;f.getSelectionModel().selectRow(h);var a=f.getSelectionModel().getSelections()[0].get("restrictions");if(d==2){new Ext.Window({height:250,width:350,border:false,layout:"fit",items:[{xtype:"panel",border:false,layout:"fit",width:320,height:375,autoScroll:true,items:[{html:"",style:"padding-left:20px;padding-top:10px;padding-buttom:20px;font-size: 12px;",autoScroll:true,border:false,listeners:{render:function(){this.html=a}}}]}]}).show()}},sessioninit:function(){},render:function(){var b={rateURI:this.findParentByType("form").getRateURI()};Ext.Ajax.request({url:TDS.env.dataPath+"search/air/rateOffering",method:"POST",jsonData:b,callback:function(j,c,e){if(c){var d=Ext.util.JSON.decode(e.responseText);var h=d["air/rateOffering/collection"];if(typeof h=="undefined"){return}var g=[];for(var a=0;a<h.length;a++){d[h[a]].dataURI=h[a];g.push(d[h[a]])}var f=this.store;f.loadData(g)}},scope:this})}}},{xtype:"panel",style:"padding: 0; margin-top: 25px; margin-bottom: 4px;",border:false,layout:"table",layoutConfig:{columns:9},defaults:{border:false},items:[{html:"",width:Ext.isIE?125:100},{xtype:"radio",name:"payBy",inputValue:false,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data},check:function(d,c){if(c){this.ownerCt.items.itemAt(3).setValue(false);var b=this.findParentByType("tabpanel").findByType("grid");var a=b[3];a.disable()}}}},{html:"Agency Credit",style:"padding: 0; margin-left: 1px; margin-right: 25px;"},{xtype:"radio",inputValue:true,name:"payBy",config:{windowData:""},listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data},check:function(f,g){if(g){;this.ownerCt.items.itemAt(1).setValue(false);var l=this.findParentByType("tabpanel").findByType("grid");var a=l[0].getSelectionModel().getSelections();var k=l[3].getSelectionModel().getSelections();var e=l[0].getSelectionModel().selections.items;var c=l[1].getSelectionModel().selections.items.length;var p=l[3].getSelectionModel().selections.items;var l=this.findParentByType("tabpanel").findByType("grid");var r=l[3];r.enable();var b=0;for(var o=0;o<e.length;o++){b=b+e[o].data.farePerFlight}var h=0;for(var o=0;o<p.length;o++){if(typeof p[o].data.baggagePrice!="undefined"&&p[o].data.baggagePrice!=""){var q=p[o].data.baggagePrice;if(q==1){h=h+35}else{if(q==2){h=h+70}}}}var n=7.7*c;var m=b+h+n;var d;var s=this;var i="<b>Total Fare:</b> AUD "+b.toFixed(2)+"<br><br> <b>CC Charges:</b> AUD "+n.toFixed(2)+"<br><br> <b>Baggage Price:</b> AUD "+h.toFixed(2)+"<br><br><b> Grand Total :</b> AUD "+m.toFixed(2);d=new Ext.Window({height:350,width:550,closable:true,border:false,layout:"fit",modal:true,items:[{xtype:"form",border:false,width:550,items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:300,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Credit Card Payment",layout:"fit",items:[{xtype:"panel",layout:"column",labelWidth:110,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"panel",width:"40%",height:255,border:true,style:"padding: 2px;",columnWidth:0.4,items:[{xtype:"panel",layout:"form",border:false,labelWidth:90,style:"padding: 20px;",defaults:{},items:[{html:" <b>Fare Details<b> ",style:"padding-bottom: 12px;",border:false},{html:i,border:false}]}]},{xtype:"panel",width:"60%",height:255,border:true,style:"padding: 2px;",columnWidth:0.6,items:[{xtype:"panel",layout:"form",border:false,labelWidth:90,style:"padding: 20px;",defaults:{},items:[{html:" <b>Please Provide Credit Card Information<b> ",style:"padding-bottom: 20px;",border:false},{xtype:"combo",allowBlank:false,name:"cardType",mode:"local",fieldLabel:"Card Type",width:140,triggerAction:"all",editable:false,displayField:"cardTyp",valueField:"cardType",store:new Ext.data.SimpleStore({storeId:"cardId",fields:["cardTyp","cardType"],data:[["AX","AX"],["VI","VI"],["CA","CA"],["DC","DC"],["DS","DS"],["JB","JB"]]})},{xtype:"textfield",allowBlank:false,name:"cardNumber",fieldLabel:"Card Number",bodyStyle:"padding: 2px 4px 2px 4px;",width:140},{xtype:"textfield",allowBlank:false,name:"securityCode",fieldLabel:"Security Code",bodyStyle:"padding: 2px 4px 2px 4px;",width:140},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;",border:false,hideBorders:true,layoutConfig:{columns:4},items:[{html:"Expiration Date:",width:95},{xtype:"combo",name:"mm",style:"margin-left: 2px;",mode:"local",width:55,triggerAction:"all",editable:false,displayField:"text",valueField:"description",emptyText:" ",store:TDS.data.months},{html:" ",width:Ext.isIE?12:12},{xtype:"combo",name:"yy",style:"margin-left: 2px;",mode:"local",width:54,triggerAction:"all",editable:false,displayField:"text",valueField:"description",emptyText:" ",store:TDS.data.years}]},{xtype:"textfield",allowBlank:false,name:"cardHolderName",fieldLabel:"Name on Card",bodyStyle:"padding: 2px 4px 2px 4px;",width:140}]}]}]}]}]}]}],buttons:[{text:"Submit",handler:function(){var j=this.ownerCt.items.itemAt(0).getForm();if(j.isValid()){var t=j.getValues();s.config.windowData=t;this.ownerCt.hide()}}},{text:"Close",handler:function(){this.ownerCt.hide()}}]}).show()}}}},{html:"Credit Card Payment",style:"padding: 0; margin-left: 1px; margin-right: 25px;"},{xtype:"radio",name:"book",width:16,inputValue:false},{html:"Book",style:"padding: 0; margin-left: 1px; margin-right: 25px;",width:Ext.isIE?43:45},{xtype:"radio",name:"book",width:16,inputValue:true,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data}}},{html:"Quote",style:"padding: 0; margin-left: 1px; margin-right:25px;",width:Ext.isIE?38:40}]}]}]},{xtype:"panel",layout:"table",border:false,style:"padding: 20px;",layoutConfig:{columns:8},defaults:{border:false},items:[{xtype:"button",text:"Seat Allocation",hidden:true},{width:160},{xtype:"hidden",name:"credit",itemId:"credit"},{xtype:"formredbutton",text:"Submit",cls:"x-button-orange",overCls:"x-button-orange-over",handler:function(){;var L=this.ownerCt.ownerCt.items.itemAt(0).items.itemAt(0).items.itemAt(1).items.itemAt(3).initialConfig.config.windowData;var U=this.ownerCt.ownerCt.items.itemAt(0).items.itemAt(0).items.itemAt(1).items.itemAt(1).getValue();var R=this.ownerCt.ownerCt.items.itemAt(0).items.itemAt(0).items.itemAt(1).items.itemAt(3).getValue();var h=this.findParentByType("awesomewindow").getPostDataURI();var T=this.findParentByType("form").getPassGrid().getSelectionModel().selections.items;var n=this.findParentByType("form").getBaggageGrid().getSelectionModel().selections.items;var M=this.findParentByType("form").getPriceCurrency();var b=this.findParentByType("form").getFlightGrid();var a=this.findParentByType("form").getFlightGrid().getSelectionModel().selections.items;var u="";if(U){u="agencyCredit"}if(R){u="creditcard"}var F=new Date();var p=L.cardType;var E=L.cardNumber;var w=L.securityCode;var i=L.mm;var e=L.yy;var q=L.cardHolderName;var y=[],d=[];for(var Q=0;Q<T.length;Q++){d.push(T[Q].data.dataURI)}var G=[];for(var A=0;A<n.length;A++){G.push({paxId:n[A].data.paxId,baggagePrice:n[A].data.baggagePrice,offeringId:n[A].data.offeringId,segment:n[A].data.segment,segment1:n[A].data.segment1,segment2:n[A].data.segment2})}var o={};var D=[];for(var S=0;S<a.length;S++){var f={};var r=a[S].data.offeringURI;var B=a[S].data.dateFrom;var J=a[S].data.adultRate;var W=a[S].data.adultRate;var C=a[S].data.childRate;var z=a[S].data.infantRate;var N=a[S].data.noOfSeats;var g=a[S].data.adultNo;var s=a[S].data.childNo;var K=a[S].data.infantNo;var I=d.length;var l=[],x=[],t=[],c=[];if(typeof W!="undefined"&&W!=""){l.push(W);t.push({rateURI:a[S].data.adultRate,noOfPass:a[S].data.adultNo+""})}if(typeof C!="undefined"&&C!=""){l.push(C);t.push({rateURI:a[S].data.childRate,noOfPass:a[S].data.childNo+""})}if(typeof z!="undefined"&&z!=""){l.push(z);t.push({rateURI:a[S].data.infantRate,noOfPass:a[S].data.infantNo+""})}if(typeof g!="undefined"&&g!=0){x.push(a[S].data.adultNo+"")}if(typeof s!="undefined"&&s!=0){x.push(a[S].data.childNo+"")}if(typeof K!="undefined"&&K!=0){x.push(a[S].data.infantNo+"")}for(var O=0;O<T.length;O++){var v=T[O].data.type;if(v=="AD"){c.push({rateURI:a[S].data.adultRate,passengerURI:T[O].data.dataURI})}if(v=="CH"){c.push({rateURI:a[S].data.childRate,passengerURI:T[O].data.dataURI})}if(v=="IN"){c.push({rateURI:a[S].data.infantRate,passengerURI:T[O].data.dataURI})}}var F=new Date();f.rateMultipleSelectedRateURI=l;f.passengers=d;f.noOfSeats=N;f.passengerLength=I;f.adultNo=g;f.childNo=s;f.infantNo=K;f.inventoryAmount=N;f.noOfPer=x;f.offeringURI=r;f.noOfPerPerRate=t;f.passengerURIs=c;f.dateFrom=B;f.rateURI=J;f.duration=1;f.cardType=p;f.cardNumber=E;f.securityCode=w;f.cardExpMM=i;f.cardExpYY=e;f.cardHolderName=q;f.payBy=u;f.selctedBaggs=G;D.push(f)}o=D;var V=[];var H=b.getStore().data;H.each(function(k,j){V.push(k.data)});var P=new Ext.LoadMask(this.findParentByType("awesomewindow").el,{msg:""});P.show();Ext.Ajax.request({url:TDS.env.dataPath+h+"/air?action=book&componentFrom=AIR&currency="+M,jsonData:o,method:"POST",callback:function(j,k,X){;if(X.status==200){var m={rateURI:this.findParentByType("form").getRateURI()};Ext.Ajax.request({url:TDS.env.dataPath+"search/air/rateOffering",method:"POST",jsonData:m,callback:function(af,Z,ab){if(Z){;var aa=Ext.util.JSON.decode(ab.responseText);var ae=aa["air/rateOffering/collection"];if(typeof ae=="undefined"){return}var ad=[];for(var Y=0;Y<ae.length;Y++){aa[ae[Y]].dataURI=ae[Y];ad.push(aa[ae[Y]])}var ac=b.getStore();ac.loadData(ad);b.getView().refresh()}},scope:this});P.hide();this.ownerCt.close()}else{P.hide()}},scope:this})}},{width:60},{xtype:"button",text:"Remove",handler:function(){;var b=this.findParentByType("form").getFlightGrid().getSelectionModel().selections.items[0];if(!(b.data.bookStatus=="Confirmed")){this.findParentByType("form").getFlightGrid().getStore().remove(b)}}},{width:60},{xtype:"button",text:"More Flights",handler:function(){;this.findParentByType("awesomewindow").hide()}}]}]},{title:"Passenger",items:[{xtype:"panel",layout:"table",frame:true,layoutConfig:{columns:1},labelWidth:110,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"panel",width:725,height:255,border:true,style:"padding: 2px;",items:[{xtype:"editorgrid",alwaysUseCollection:true,singleSelect:true,width:725,height:170,border:false,store:new Ext.data.CollectionStore({url:"",identifier:"",fields:["type","code","nameFirst","nameLast","salutation","displayName","dateOfBirth","paxAge","gender"]}),sm:new Ext.grid.CheckboxSelectionModel({}),columns:[new Ext.grid.CheckboxSelectionModel({}),{header:"Type",dataIndex:"type",width:40,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"text",valueField:"text",triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Last Name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false})},{header:"First Name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false})},{header:"Title",dataIndex:"salutation",editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"Gender",dataIndex:"gender",editor:new Ext.form.TextField({allowBlank:false})},{header:"DOB",dataIndex:"dateOfBirth",editor:new Ext.form.DateField({allowBlank:false}),renderer:function(e,c,b){;if(typeof e!="undefined"){if(typeof e!="string"){var a=new Date();a.setTime(Ext.TimerMgr.getServerCalculatedTime());var d=Math.floor((a.getTime()-e.getTime())/(365.25*24*60*60*1000));b.set("paxAge",((d&&d>0)?d:""));return Ext.util.Format.date(e,TDS.env.dateBirthdayFormatDisplay)}else{if(b.get("paxAge")){var d=TDS.util.Format.age(e);b.set("paxAge",((d&&d>0)?d:""))}return TDS.util.Format.dateSpecial(e,TDS.env.dateBirthdayFormatDisplay)}}return TDS.util.Format.dateSpecial(e,TDS.env.dateBirthdayFormatDisplay)}},{header:"Age",dataIndex:"paxAge",editor:new Ext.form.NumberField({allowBlank:false}),renderer:function(e,c,b){if(e){return e}else{if(typeof b.get("dateOfBirth")!="undefined"){if(typeof b.get("dateOfBirth")!="string"){var a=new Date();a.setTime(Ext.TimerMgr.getServerCalculatedTime());var d=Math.floor((a.getTime()-b.get("dateOfBirth").getTime())/(365.25*24*60*60*1000));return((d&&d>0)?d:"")}else{var d=TDS.util.Format.age(b.get("dateOfBirth"));return((d&&d>0)?d:"")}}return""}}},{header:"Seat No",dataIndex:"seat",editor:new Ext.form.TextField({allowBlank:false})},{header:"Xtra",dataIndex:"xtra",editor:new Ext.form.TextField({allowBlank:false})}],viewConfig:{forceFit:true},bbar:[{xtype:"button",text:"Add",handler:function(){var b=this.ownerCt.items.itemAt(1);var a=this.ownerCt.items.itemAt(2);a.enable();b.enable();this.disable();var d=this.ownerCt.ownerCt;var c=d.getStore();c.add([new c.recordType({type:"AD",nameFirst:"",nameLast:""})]);d.newRecordIndex=c.getCount()-1;d.startEditing(d.newRecordIndex,1);d.getSelectionModel().selectRow(d.newRecordIndex)}},{xtype:"button",text:"Cancel",disabled:true,handler:function(){var c=this.ownerCt.items.itemAt(0);var b=this.ownerCt.items.itemAt(2);c.enable();b.disable();var d=this.ownerCt.ownerCt;var a=d.getStore().getAt(d.newRecordIndex);if(a==-1||typeof a.get("dataURI")!="undefined"){return}d.getStore().remove(a);this.disable()}},{xtype:"button",text:"Save",disabled:true,handler:function(){var b=this.ownerCt.findParentByType("awesomewindow");var f=this.ownerCt.ownerCt;var e=this.ownerCt.items.itemAt(0);var d=this.ownerCt.items.itemAt(1);d.disable();this.disable();var a=f.getStore().getAt(f.newRecordIndex);var i=f.getSelectionModel().getSelections();var c="",h="";if(i.length==1){if(typeof i[0].get("dataURI")!="undefined"){c="PUT",h=TDS.env.dataPath+i[0].get("dataURI")}else{c="POST",h=TDS.env.dataPath+b.getDataURI("pnr")+"/passengers"}}Ext.Ajax.request({url:h,jsonData:i[0].data,method:c,callback:function(k,g,j){if(g){f.getStore().load();e.enable()}else{d.enable();this.enable()}},scope:this})}},{xtype:"button",text:"Addional Info",handler:function(h){var c=this.ownerCt.findParentByType("awesomewindow");var f=this.ownerCt.ownerCt;var b=f.getStore().getAt(f.newRecordIndex);var a="";var d=this.ownerCt.ownerCt.getSelectionModel().selections;if(d.length==1){a=d.items[0].get("dataURI")}TDS.innerWindow.setWindow({height:300,width:200,autoDestroy:false,title:"Passenger Profile",interfaceURI:"pnr/passenger/passengerDetails.js",sourceDataURI:a,destinationDataURI:a,closeAction:"hide",buttonOK:"Submit",callback:{fn:function(g,i,e){},scope:this}})}}],listeners:{beforerender:function(){},sessioninit:function(){},render:function(){var w=this.ownerCt.findParentByType("awesomewindow");with(this.store){reader.meta.identifier=w.getDataURI("pnr")+"/passengers";proxy.conn.url=TDS.env.dataPath+w.getDataURI("pnr")+"/passengers/concise";load()}},afteredit:function(a){if(this.getSelectionModel().getSelections()[0].dirty){this.getBottomToolbar().items.itemAt(2).enable()}}}},{xtype:"panel",style:"padding: 0; margin-top: 25px; margin-bottom: 4px;",border:false,layout:"table",layoutConfig:{columns:5},defaults:{border:false},items:[{html:"",width:Ext.isIE?125:200},{xtype:"checkbox",name:"book",inputValue:false,hidden:true,listeners:{render:function(){}}},{html:"Extra Leg Room",style:"padding: 0; margin-left: 1px; margin-right: 25px;",width:Ext.isIE?43:125,hidden:true},{xtype:"checkbox",name:"quote",inputValue:true,hidden:true,listeners:{render:function(){}}},{html:"Priority Check In",style:"padding: 0; margin-left: 1px; margin-right:25px;",width:Ext.isIE?38:120,hidden:true},{html:"",width:Ext.isIE?125:200},{},{html:" ",width:Ext.isIE?43:125},{xtype:"checkbox",name:"bording",inputValue:true,hidden:true,listeners:{render:function(){}}},{html:"Priority Boarding",style:"padding: 0; margin-left: 1px; margin-right:25px;",width:Ext.isIE?38:120,hidden:true}]}]}]}]},{title:"Seats",layout:"fit",items:[{xtype:"panel",layout:"column",labelWidth:110,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"panel",width:"25%",height:255,border:true,style:"padding: 2px;",columnWidth:0.3,items:[{xtype:"grid",border:false,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,viewConfig:{forceFit:true},height:150,sm:new Ext.grid.CheckboxSelectionModel(),store:new Ext.data.JsonStore({url:"",id:"id",fields:["nameFirst","dataURI"]}),columns:[{header:"",width:55,id:"check",dataIndex:"chk",editable:false,width:20,fixed:true,renderer:function(f,c,b,e,g,d){var a=b.get("dataURI");return'<input type="radio" id = "rd'+a+'" name="parentRate" /><input type="hidden" name="existingParentId" id="existingParentId" value="">'}},{header:"Passenger",dataIndex:"nameFirst"},{header:"Flight",dataIndex:"flight"},{header:"Seat No",dataIndex:"seatNo"}]}]},{xtype:"panel",width:"75%",height:255,border:true,style:"padding: 2px;",columnWidth:0.7,items:[{html:"<center>Not Yet Available</center>",style:"padding: 120px;",border:false}]}]}]},{title:"Baggage",layout:"fit",items:[{xtype:"panel",layout:"column",labelWidth:110,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"panel",width:"100%",height:305,border:true,style:"padding: 2px;",columnWidth:0.55,items:[{xtype:"editorgrid",border:false,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,viewConfig:{forceFit:true},height:250,sm:new Ext.grid.CheckboxSelectionModel(),store:new Ext.data.JsonStore({url:"",fields:["nameFirst","dataURI","paxId","offeringId","nameString","segment1","segment2","segment","baggagePrice"]}),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Passenger",dataIndex:"nameFirst"},{header:"Flight",dataIndex:"nameString"},{header:"Baggage",dataIndex:"baggagePrice",editor:new Ext.form.ComboBox({store:new Ext.data.SimpleStore({storeId:"baggageStore",fields:["name","value"],data:[[1,1],[2,2]]}),mode:"local",triggerAction:"all",typeAhead:true,displayField:"name",valueField:"value",value:"1"})}]}]}]}]}],listeners:{tabchange:function(X,P,G,L){if(X.getActiveTab().title=="Seats"){;var M=this.ownerCt.items.itemAt(0).items.itemAt(2).items.itemAt(0).items.itemAt(0).items.itemAt(0).getStore();var O=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0).getSelectionModel().selections.items.length;var A=this.items.itemAt(1).items.itemAt(0).items.itemAt(0).items.itemAt(0).getSelectionModel().selections.items.length;var s=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0);var H=s.getSelectionModel().selections;var n=[],W=[],z=[],x=[],E=[],h=[];H.each(function(k,j){h.push({offeringId:k.data.offeringURI,adultRate:k.data.adultRate,childRate:k.data.childRate,infantRate:k.data.infantRate,rateName:k.data.rateName})});var B=this.items.itemAt(1).items.itemAt(0).items.itemAt(0).items.itemAt(0).getSelectionModel().selections;var v=[];B.each(function(k,j){v.push(k.id)});var F={};F.offeringData=h;F.selectedPaxId=v;var V=this.findParentByType("awesomewindow").initialConfig.dataURI.pnr;Ext.Ajax.request({url:TDS.env.dataPath+V+"/componentsbook/air/seats",jsonData:F,method:"POST",callback:function(ab,k,Y){if(k){;var m=Ext.util.JSON.decode(Y.responseText);var aa=m.seatSelection;if(typeof aa=="undefined"){return}var Z=[];for(var j=0;j<aa.length;j++){m[aa[j]].dataURI=aa[j];Z.push(m[aa[j]])}M.loadData(Z);this.getView().refresh()}},scope:this})}if(X.getActiveTab().title=="Baggage"){;var g=this.findParentByType("awesomewindow").getPostDataURI();var U=this.findParentByType("form").getPassGrid().getSelectionModel().selections.items;var N=this.findParentByType("form").getPriceCurrency();var b=this.findParentByType("form").getFlightGrid();var a=this.findParentByType("form").getFlightGrid().getSelectionModel().selections.items;var w=[],d=[];for(var S=0;S<U.length;S++){d.push(U[S].data.dataURI)}var o={};var C=[];for(var T=0;T<a.length;T++){var e={};var p=a[T].data.offeringURI;var y=a[T].data.dateFrom;var J=a[T].data.adultRate;var W=a[T].data.adultRate;var z=a[T].data.childRate;var x=a[T].data.infantRate;var Q=a[T].data.noOfSeats;var f=a[T].data.adultNo;var q=a[T].data.childNo;var K=a[T].data.infantNo;var I=d.length;var i=[],u=[],r=[],c=[];if(typeof W!="undefined"&&W!=""){i.push(W);r.push({rateURI:a[T].data.adultRate,noOfPass:a[T].data.adultNo+""})}if(typeof z!="undefined"&&z!=""){i.push(z);r.push({rateURI:a[T].data.childRate,noOfPass:a[T].data.adultNo+""})}if(typeof x!="undefined"&&x!=""){i.push(x);r.push({rateURI:a[T].data.infantRate,noOfPass:a[T].data.adultNo+""})}if(typeof f!="undefined"&&f!=0){u.push(a[T].data.adultNo+"")}if(typeof q!="undefined"&&q!=0){u.push(a[T].data.childNo+"")}if(typeof K!="undefined"&&K!=0){u.push(a[T].data.infantNo+"")}for(var R=0;R<U.length;R++){var t=U[R].data.type;if(t=="AD"){c.push({rateURI:a[T].data.adultRate,passengerURI:U[R].data.dataURI})}if(t=="CH"){c.push({rateURI:a[T].data.childRate,passengerURI:U[R].data.dataURI})}if(t=="IN"){c.push({rateURI:a[T].data.infantRate,passengerURI:U[R].data.dataURI})}}var D=new Date();e.rateMultipleSelectedRateURI=i;e.passengers=d;e.noOfSeats=Q;e.passengerLength=I;e.adultNo=f;e.childNo=q;e.infantNo=K;e.inventoryAmount=Q;e.noOfPer=u;e.offeringURI=p;e.noOfPerPerRate=r;e.passengerURIs=c;e.dateFrom=y;e.rateURI=J;e.duration=1;C.push(e)}o=C;var l=this.ownerCt.items.itemAt(0).items.itemAt(3).items.itemAt(0).items.itemAt(0).items.itemAt(0).getStore();var V=this.findParentByType("awesomewindow").initialConfig.dataURI.pnr;Ext.Ajax.request({url:TDS.env.dataPath+g+"/airQuote",jsonData:o,method:"POST",callback:function(ab,k,Y){if(k){;var m=Ext.util.JSON.decode(Y.responseText);var aa=m.baggaeSelection;if(typeof aa=="undefined"){return}var Z=[];for(var j=0;j<aa.length;j++){m[aa[j]].dataURI=aa[j];Z.push(m[aa[j]])}l.loadData(Z);this.getView().refresh()}},scope:this})}},titlechange:function(b,a){}}}]}