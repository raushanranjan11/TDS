{requireStores:[{dataURI:TDS.env.dataPath+"air/extracategories/collection",identifier:"air/extracategories",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"rate/classes/collection",identifier:"rate/classes",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"rate/pers/collection",identifier:"rate/pers",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"rate/occupancies/collection",identifier:"rate/occupancies",fields:["name","dataURI"]}],xtype:"panel",height:140,border:false,frame:false,layout:"column",getDetailsPanel:function(){return this.items.itemAt(0)},getPassengersPanel:function(){return this.items.itemAt(1)},hasDetailsInventory:false,hasDetailsOffering:false,isDetailsReady:function(){if(this.hasDetailsInventory&&this.hasDetailsOffering){return true}return false},items:[{tbar:[{xtype:"button",text:"Edit TTL",handler:function(){var e=this.ownerCt.findParentByType("tabpanel");var d=e.ownerCt;var c=e.getDetail("dataURI");var a=e.getDetail("paybyDate");var b=e.getDetail("depositDescription");TDS.window.setWindow({title:"Description",information:"Please enter description.",interfaceURI:"pnr/components/accommodation/editPayby.js",destinationDataURI:c+"/updatePayBYDates",data:{paybyDate:a,depositDescription:b},callback:{fn:function(f){d.refreshGrid()}}})}},"->",{xtype:"button",buttonAlign:"right",text:"Additinonal Info",handler:function(){TDS.window.setWindow({title:"Air PNR",interfaceURI:"pnr/components/cruise/cruiseDetail.js"})}},{xtype:"button",buttonAlign:"left",disabled:true,text:"Download Voucher",handler:function(){var e=this.ownerCt.findParentByType("tabpanel");var d=e.ownerCt;var c="/voucher/";var a=e.getDetail("dataURI");if(!a){return}var b=TDS.env.currentDomain;Ext.Ajax.request({url:TDS.env.dataPath+a+"/voucher",jsonData:{currentDomain:b},method:"PUT",scope:this,callback:function(i,g,h){c=c+h.responseText+".rtf";var f=window.open(c,"Information Priview","height=500,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes");f.focus()}})}}],columnWidth:0.58,xtype:"panel",autoScroll:true,border:true,tpl:new Ext.XTemplate("<html>",'<div style="height:150px; overflow-y: scroll;">','<table border="0" width="100%">','<tr> <td width="10%"><span style="font-size:12px"><b>RLOC:</b></span></td><td width="15%"><font color="red"><span style="font-size:12px"> <b>{pnrCode}&nbsp;&nbsp;</span></font></td><td width="11%" > </font></td>','<td  width="8%"><span style="font-size:12px"><b>TTL:</b></span></td><td  width="28%"><div id="ttlDate#{divDataUri}"><span style="font-size:12px">{paybyDate}&nbsp;{depositDescription}</span></div></td>',"<td></td>","</tr>","</table>",'<table class="x-tds-dataview" style="width: 100%;" border=1 cellpadding = 1 cellspacing=0  >','<tr style="background-color: #d0def0;" >','<th style="padding: 2px; width: 25%;">Flight No</th>','<th style="padding: 2px; width: 16%;">Class</th>','<th style="padding: 2px; width: 18%;">From</th>','<th style="padding: 2px; width: 15%;">Date</th>','<th style="padding: 2px; width: 18%;">Time</th>','<th style="padding: 2px; width: 18%;">To</th>','<th style="padding: 2px; width: 18%;">Date</th>','<th style="padding: 2px; width: 18%;">Time</th>','<th style="padding: 2px; width: 18%;">Stop</th>','<th style="padding: 2px; width: 18%;">Seats</th>','<th style="padding: 2px; width: 18%;">Status</th>',"</tr>","<tr>","<td>{name}</td>","<td>{nameString}</td>","<td>{airportFromIataString}</td>","<td>{indate}</td>","<td>{departureTime}</td>","<td>{airportToIataString}</td>","<td>{outdate}</td>","<td>{arrivalTime}</td>","<td>{stopOvers}</td>","<td>{passengersTotal}</td>","<td>{status}</td>","</tr>","</table>",'<table class="x-tds-dataview" style="width: 100%;" border=1 cellpadding = 1 cellspacing=0  >','<tr style="background-color: #C0D9D9;">','<th style="padding: 2px; width: 14%;">Tour Price</th>','<th style="padding: 2px; width: 16%;">Extras</th>','<th style="padding: 2px; width: 16%;">Total Price (Gross)</th>','<th style="padding: 2px; width: 10%;">Markup Included</th>','<th style="padding: 2px; width: 7%;">Comm%</th>',"</tr>","<tr>","<td>{priceCurrency}&nbsp;{stayPrice}</td>","<td>{priceCurrency}&nbsp;{extraTotal} {extrsGrossFlag}</td>","<td>{priceCurrency}&nbsp;{total}</td>","<td><b>{priceCurrency}&nbsp;{markup}</td>","<td>{priceCommission}</td>","</tr>","</table>","</div>",'<div><table style="width: 100%;"><tr><td>{createdString}</td></tr></table></div>',"</html>")},{columnWidth:0.42,xtype:"panel",border:false,tpl:new Ext.XTemplate(["<html>","<body>",'<tpl for="." >',"<tpl if=\"values.chkboxCount == '0'\">",'<form name="extraform#{dataURI}" id="extraform#{dataURI}" action="" method="post">',"</tpl>","</tpl>",'<div style="padding: 2px;height:134px; overflow-y:auto">','<table style="width: 100%;" border="0" cellspacing="0">','<tr style="background-color: #d0def0;">','<th style="padding: 2px; width: 2%;"></th>','<th style="padding: 2px; width: 32%;">Passenger</th>','<th style="padding: 2px; width: 15%;">Type</th>','<th style="padding: 2px; width: 10%;">Gender</th>','<th style="padding: 2px; width: 15%;">DOB</th>','<th style="padding: 2px; width: 10%;">Age</th>','<th style="padding: 2px; width: 16%;">Status</th>',"</tr>",'<tpl for=".">',"<tr>",'<td style="padding: 2px; width: 2%;">','<input type="checkbox" name="checkField#{dataURI}" id="checkField#{countryURI}#{dataURI}#{pncid}" value ={countryURI}>','<input type="textbox"  hidden="true" name="countryURI" value={countryURI}>','<input type="textbox"  hidden="true" name="dataURI" value={dataURI}></td>','<input type="textbox"  hidden="true" name="chkboxCount" value={chkboxCount}>',"</td>",'<td style="padding-left:8px; width: 38%;">{displayName}</td>','<td style="padding: 2px; width: 15%;">{code}</td>','<td style="padding: 2px; width: 10%;">{[TDS.util.Format.gender(values.gender)]}</td>','<td style="padding: 2px; width: 15%;">{[TDS.util.Format.dateSpecial(values.dateOfBirth, TDS.env.dateBirthdayFormatDisplay)]}</td>','<td style="padding: 2px; width: 10%;">{[TDS.util.Format.age(values.dateOfBirth)]}</td>','<td style="padding: 2px; width: 10%;">{status}</td>',"</tr>","</tpl>","</table>","</div>","</form>","</body>","</html>"])}],listeners:{render:function(){this.initInventory();this.initOffering();this.initPassengers()}},initInventory:function(){var f=this.ownerCt.findParentByType("tabpanel");var d=f.getDetail("dataURI");var c=f.getDetail("depositDescription");var b=f.getDetail("paybyDate");var a=TDS.util.Format.dateSpecial(b,TDS.env.dateFormatDisplay);var e=d;Ext.Ajax.request({url:TDS.env.dataPath+d+"/inventories/collection",method:"GET",callback:function(ad,Y,aa){if(Y){try{var S=Ext.decode(aa.responseText)}catch(aq){}if(S){var au=this.ownerCt.findParentByType("tabpanel");var F=0,T,ag=[];var R=0;var X=0;var am=S["component/inventory/collection"];var m=am[d+"/inventories"];var ac=S["component/rate/collection/"];var g=ac["component/rate/collection/list"];au.setDetail("rateList",g);var Z=new Array();Z=d.split("/");var I="";this.rateData=[];var D="";var t="";var aw=m.length/g.length;var ah=[];var L="";var an=[];var E=0;if(m.length>0){for(var ak=0;ak<m.length;ak++){var at=am[m[ak]];var ao=at.componentPaybyDate;ag[ag.length]=TDS.util.Format.dateSpecial(at.componentPaybyDate,TDS.env.dateFormatDisplay);L=at.pricingPriceCurrency;if(an.indexOf(at.rateId)==-1){an[ak]=at.rateId;ah[E]=TDS.util.Price.calculateFixedGrossNettPrice({pricingPriceCurrency:at.pricingPriceCurrency,pricingPriceSell:at.pricingPriceSell,pricingPriceCommission:at.pricingPriceCommission,pricingPriceIsNett:at.pricingPriceIsNett});ah[E].rateId=at.rateId;ah[E].quantity=at.quantity;E++}}var W="";var U="";var P=0;var aj=0;var p=0;var w=0;var A=0;var h=0;var k="";if(g.length>0){;var O=0;var u=at.quantity;for(var ak=0;ak<g.length;ak++){var M=ac[g[ak]];U=M.nameString;var G=M.rateTypeURI;G=TDS.util.Format.displayResourceName(G);aj=M.extraTotal;I=ac[g[ak]].tempBookedDate;var B="";var C=null;var l="";for(var ai=0;ai<ah.length;ai++){if(ah[ai].rateId==g[ak].substring(g[ak].lastIndexOf("/")+1,g[ak].length)){C=ah[ai]}var q=this.ownerCt.ownerCt.findParentByType("ajaxpanel");var av=TDS.util.Format.dateSpecial(q.rowRecordData.dateFrom,TDS.env.dateFormatDisplay);var ab=TDS.util.Format.dateSpecial(q.rowRecordData.dateTo,TDS.env.dateFormatDisplay);var N=q.rowRecordData.status;var y=q.rowRecordData.description;var x=q.rowRecordData.supplierURI;var ar=q.rowRecordData.name;var K=q.rowRecordData.passengersTotal;if(true){C=ah[ai];Z[1]=q.rowRecordData.bookingReferenceNumber;D=q.rowRecordData.externalPNRCode;t="Confirm No:"}}if(!C.priceIsNett){l=C.priceCommissionPercentage}else{B=C.priceCommission;R+=(m.length*C.priceCommission)}var H=((m.length/an.length)*C.priceSell);P+=((m.length/an.length)*C.priceSell);var ap=C.priceSell;ap=ap+B;p+=ap;var J=B/C.quantity;if(x==TDS.util.Defaults.hotusaSupplier){P=C.priceSell;p=P;R=B;if(C.priceIsNett){l=C.priceCommissionPercentage}}W+="<tr>";if(x==TDS.util.Defaults.hotusaSupplier){W+="<td >"+M.hotusaRoomType+"</td>"}else{W+="<td >"+TDS.util.Format.displayResourceName(M.inventoryTypeURI)+"</td>"}W+="<td>"+M.nameString+"</td>";W+="<td>"+C.quantity+"</td>",W+="<td>"+TDS.util.Price.formatPrice(C.priceSell+J,C.priceCurrency)+"</td>",W+="<td>"+N+"</td>",W+="</tr>";k=(q.rowRecordData.pricingPriceIsNett?"Nett":"Gross")}p=p*aw;P+=R;P+=aj}if(ag.length>0){var v=ag[0]}else{var v=ag}if(x==TDS.util.Defaults.hotusaSupplier){var Q=new Date();Q.setDate(Q.getDate()+14);var z=Ext.util.Format.date(Q,TDS.env.dateFormat);var af=new Date(z);var ae=new Date(at.componentPaybyDate);if(af<ae){var al=ae.setDate(ae.getDate()-14);var V=new Date(al);var n=Ext.util.Format.date(V,TDS.env.dateFormatDisplay);v=n}else{var al=new Date();var n=Ext.util.Format.date(al,TDS.env.dateFormatDisplay);v=n}}au.setDetail("pricingPriceCurrency",L);this.inventoryData={rateBody:W,nameString:U,stayPrice:p.toFixed(2),priceCommission:l,name:ar,passengersTotal:K,netorgross:k,indate:av,outdate:ab,status:N,description:y,dataURI:d,divDataUri:e,numberOfNights:aw,dates:v,depositDescription:c,paybyDate:a,markup:R.toFixed(2),pnrCode:Z[1],externalPNRCode:D,externalPNRCodeName:t,bookeddateDis:I,total:P.toFixed(2),extraTotal:aj.toFixed(2),priceCurrency:L};this.hasDetailsInventory=true;if(this.isDetailsReady()){this.displayDetails()}}}}},scope:this})},initOffering:function(){;var b=this.ownerCt.findParentByType("tabpanel");var a=b.getDetail("offeringURI");Ext.Ajax.request({url:TDS.env.dataPath+a,method:"GET",callback:function(h,c,f){if(c){try{var d=Ext.decode(f.responseText)}catch(g){}if(d){this.offeringData={airportFromString:d.airportFromString,departureTime:d.departureTime,airportToString:d.airportToString,arrivalTime:d.arrivalTime,duration:d.duration,aircraft:d.aircraft,stopOvers:d.stopOvers,stopOversString:d.stopOversString,airportFromIataString:d.airportFromIataString,airportToIataString:d.airportToIataString};this.hasDetailsOffering=true;if(this.isDetailsReady()){this.displayDetails()}}}},scope:this})},initPassengers:function(){var c=this.ownerCt.findParentByType("tabpanel");var b=c.getDetail("dataURI");var a=c.getDetail("status");if(a=="Cancelled"){a="XX"}else{a="OK"}Ext.Ajax.request({url:TDS.env.dataPath+b+"/passengers/collection/concise",method:"GET",callback:function(f,n,d){if(n){try{var h=Ext.decode(d.responseText)}catch(j){}if(h){this.passengerData=[];var k=h[b+"/passengers"];for(var g=0;g<k.length;g++){var l="enabled";if(k.length>=2){l="enabled"}else{l="disabled"}var m=k[g].split("/");passengerId=m[3];h[k[g]].countryURI=passengerId;h[k[g]].dataURI=b;h[k[g]].chkboxCount=g;h[k[g]].pncid=k[g];h[k[g]].chkrequired=l;h[k[g]].status=a;this.passengerData[g]=h[k[g]]}this.displayPassengers()}}},scope:this})},displayPassengers:function(){this.getPassengersPanel().tpl.overwrite(this.getPassengersPanel().body,this.passengerData)},displayDetails:function(){var d=this.ownerCt.findParentByType("tabpanel");var g=Date.parseDate(d.getDetail("createdDate"),TDS.env.dateFormat);var i=Date.parseDate(d.getDetail("updatedDate"),TDS.env.dateFormat);var a=this.findParentByType("awesomegrid").findParentByType("pnrpanel").ownerCt.ownerCt.dataObj.pnrFrom;var h=!Ext.isEmpty(a)?"Created by Mobile on ":"Created on ";var b=h+g.format(TDS.env.dateTimeFormatDisplay)+" by "+d.getDetail("createdByUserFullNameString")+", modified on "+i.format(TDS.env.dateTimeFormatDisplay)+(d.getDetail("createdByUserFullNameString")==d.getDetail("updatedByUserFullNameString")?"":" by "+d.getDetail("updatedByUserFullNameString"))+".";var e=TDS.util.Price.calculateFixedGrossNettPrice({pricingPriceCurrency:d.getDetail("pricingPriceCurrency"),pricingPriceSell:d.getDetail("pricingPriceSell"),pricingPriceCommission:d.getDetail("pricingPriceCommission"),pricingPriceIsNett:d.getDetail("pricingPriceIsNett")});var f=this.inventoryData.Ggrosstemp;var c=this.inventoryData.price;this.getDetailsPanel().tpl.overwrite(this.getDetailsPanel().body,Ext.apply({priceCurrency:e.priceCurrency,markup:e.priceCommission.toFixed(2),createdString:b,total:(parseFloat(c)+e.priceCommission+parseFloat(f)).toFixed(2)},this.inventoryData,this.offeringData))}}