{xtype:"form",border:false,width:690,beforeSubmit:function(b){;b.type="RAIL";try{var a=this.ownerCt;if(typeof b.countryFromCode!="undefined"&&b.countryFromCode==""){Ext.getCmp("countryFromCode").markInvalid("Please select a Country.");Ext.getCmp("countryFromCode").focus(true);throw"Please select a Country.";return false}if(typeof b.dateFrom!="undefined"&&b.dateFrom==""){Ext.getCmp("dateFrom").markInvalid("Please select In Date.");Ext.getCmp("dateFrom").focus(true);throw"Please select In Date.";return false}if(typeof b.startTimeHrs!="undefined"&&b.startTimeHrs==""||b.startTimeMin!="undefined"&&b.dateFrom==""){Ext.getCmp("startTimeHrs").markInvalid("Please select Time.");Ext.getCmp("startTimeHrs").focus(true);throw"Please select Time.";return false}if(typeof b.countryToCode!="undefined"&&b.countryToCode==""){Ext.getCmp("countryToCode").markInvalid("Please select Arr Country.");Ext.getCmp("countryToCode").focus(true);throw"Please select Arr Country.";return false}if(typeof b.class!="undefined"&&b.class==""){Ext.getCmp("class").markInvalid("Please select Class.");Ext.getCmp("class").focus(true);throw"Please select Class.";return false}if(typeof b.A1!="undefined"&&b.A1==""){Ext.getCmp("A1").markInvalid("Please select Adult.");Ext.getCmp("A1").focus(true);throw"Please select Adult.";return false}}catch(g){this.items.itemAt(0).setActiveTab(0);a.showValidation(g);return false}var f=this.items.itemAt(0).items.itemAt(2).items.itemAt(1).items.itemAt(0).selModel.selections.items;var d=[];for(var c=0;c<f.length;c++){d.push(f[c].data.dataURI)}b.passengerURIs=d;b.mainRooms=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(5).getData();b.gridData1=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(1).items.itemAt(0).getData();b.gridData=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(2).items.itemAt(3).getData();b.extrasWithPricing=this.items.itemAt(0).items.itemAt(3).items.itemAt(0).items.itemAt(0).getData();b.roomTypesWithPrice=this.items.itemAt(0).items.itemAt(0).items.itemAt(0).items.itemAt(3).items.itemAt(0).getData();return b},beforeDataLoad:function(a){var b=a.countryFromCode;var c=TDS.util.firstWordCapital(a.type);if(b!=""){var d=Ext.getCmp("supplierURI").store;d.removeAll();d=TDS.data.getStore({reload:true,dataURI:TDS.env.dataPath+"suppliers/collection/byFilters?type="+c+"&countryURI="+b,identifier:"suppliers",fields:["name","displayName","dataURI","creditCardCharges"]});setTimeout(function(){Ext.getCmp("supplierURI").bindStore(d);Ext.getCmp("supplierURI").setRawValue(a.supplierName)},800)}return a},requireStores:[{dataURI:TDS.env.dataPath+"rate/basises/collection",identifier:"rate/basises",fields:["name","dataURI"]}],items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:510,width:690,items:[{title:"Quote Details",layout:"form",items:[{height:453,autoScroll:true,border:false,items:[{xtype:"fieldset",layout:"form",border:false,autoHeight:true,labelWidth:100,style:"padding: 0;  margin-top: 8px; ",defaults:{style:"padding: 0; margin-left: 70px;margin-top: 8px;margin-bottom: 4px;"},items:[{html:"",xtype:"label",listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.type;if(typeof d!="undefined"&&d){this.setText('<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><font size="2" color="#ff0000">Component:</font></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><font size="2"   >'+d+"</font></b>",false)}}}},{xtype:"panel",layout:"table",border:false,width:530,hideBorders:true,layoutConfig:{columns:5},items:[{html:'Dep Country/City<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"combo",name:"countryFromCode",id:"countryFromCode",emptyText:"Type a country...",excludeSubmit:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:124,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]}),appendData:[{name:"",dataURI:""}],listeners:{select:function(){var a=this.getValue();var b=TDS.util.firstWordCapital(this.ownerCt.findParentByType("awesomewindow").aw.data.type);if(a!=""){var c=Ext.getCmp("supplierURI").store;c.removeAll();c=TDS.data.getStore({reload:true,dataURI:TDS.env.dataPath+"suppliers/collection/byFilters?type="+b+"&countryURI="+a,identifier:"suppliers",fields:["name","displayName","dataURI","creditCardCharges"]});setTimeout(function(){Ext.getCmp("supplierURI").bindStore(c)},500)}}}},{xtype:"locationcombo",name:"locationFromURI",style:"margin-left: 2px;",width:154,listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(1);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}},{width:10},{xtype:"textfield",name:"departStationAriport",width:130,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]},{xtype:"panel",layout:"table",border:false,hideBorders:true,listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="radio"){if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},layoutConfig:{columns:13},items:[{html:'Dep Date<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"datefield",name:"dateFrom",id:"dateFrom",minValue:Ext.TimerMgr.getServerCalculatedDate().clearTime(),format:"dMy",width:125},{width:20},{html:'Time<font color="red">*</font>:',width:30},{xtype:"combo",fieldLabel:"Time",name:"startTimeHrs",id:"startTimeHrs",style:"margin-left: 2px;",mode:"local",width:50,triggerAction:"all",editable:false,displayField:"numeric",valueField:"numeric",emptyText:"HH",store:TDS.data.hours,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{xtype:"combo",fieldLabel:"Time",name:"startTimeMin",id:"startTimeMin",style:"margin-left: 2px;",mode:"local",width:50,triggerAction:"all",editable:false,displayField:"numeric",valueField:"numeric",emptyText:"mm",store:TDS.data.minutes,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{width:15},{xtype:"radio",name:"depStationAriportRadio",width:13,inputValue:"Station",boxlabel:"No"},{html:"&nbsp;Station",width:63},{xtype:"radio",name:"depStationAriportRadio",width:13,inputValue:"AirPort",boxlabel:"Yes"},{html:"&nbsp;AirPort",width:60}]},{xtype:"panel",layout:"table",border:false,width:530,hideBorders:true,layoutConfig:{columns:5},items:[{html:'Arr Country/City<font color="red">*</font>:',width:Ext.isIE?105:110},{xtype:"combo",name:"countryToCode",id:"countryToCode",emptyText:"Type a country...",excludeSubmit:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:124,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]}),appendData:[{name:"",dataURI:""}]},{xtype:"locationcombo",name:"locationToURI",style:"margin-left: 2px;",width:154,listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(1);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}},{width:10},{xtype:"textfield",name:"arrStationAriport",width:130,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]},{xtype:"panel",layout:"table",border:false,hideBorders:true,listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="radio"){if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},width:530,layoutConfig:{columns:12},items:[{html:"Train No:",width:Ext.isIE?105:110},{xtype:"textfield",name:"trainNo",width:125,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{html:' &nbsp;&nbsp;&nbsp;Class<font color="red">*</font>:',width:45},{xtype:"combo",name:"class",id:"class",mode:"local",width:110,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"name",valueField:"name",emptyText:"",store:TDS.data.railClasses,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{width:10},{xtype:"radio",name:"arrStationAriportRadio",width:13,inputValue:"Station",boxlabel:"No"},{html:"&nbsp;Station",width:63},{xtype:"radio",name:"arrStationAriportRadio",width:13,inputValue:"AirPort",boxlabel:"Yes"},{html:"&nbsp;AirPort",width:60}]},{layout:"form",border:false,autoHeight:true,labelWidth:100,width:530,getData:function(){var g=this.items;var f=g.length;var m=[];for(var h=0;h<f;h++){var d={};var e=[];var p=[];var o=g.itemAt(h).items.itemAt(1).getValue();var n=g.itemAt(h).items.itemAt(3).getValue();var k=g.itemAt(h).items.itemAt(5).getValue();d.adult=o;d.child=n;for(var b=0;b<n;b++){e.push(g.itemAt(h).items.itemAt(10).items.itemAt(b).getValue())}d.childAge=e;d.infant=k;for(var b=0;b<k;b++){p.push(g.itemAt(h).items.itemAt(12).items.itemAt(b).getValue())}d.infantAge=p;m.push(d)}return{data:m}},calculateTotalPax:function(){var m=0;var n=this.items.length;for(var d=0;d<n;d++){var l=this.items.itemAt(d).items.itemAt(1).getValue();var h=this.items.itemAt(d).items.itemAt(3).getValue();var e=this.items.itemAt(d).items.itemAt(5).getValue();l=l?l:0;h=h?h:0;e=e?e:0;m+=(l+h+e)}var k=this.ownerCt.items.itemAt(6).items.itemAt(0).items.itemAt(1).getValue();var b=this.ownerCt.items.itemAt(6).items.itemAt(0).items.itemAt(3).getValue();var f=this.ownerCt.items.itemAt(6).items.itemAt(0).items.itemAt(5).getValue();var g=this.ownerCt.items.itemAt(7).items.itemAt(1).getValue();k=k?k:0;b=b?b:0;f=f?f:0;g=g?g:0;m+=(k+b+f+g);this.items.itemAt(0).items.itemAt(8).setValue(m);Ext.getCmp("addRails").ownerCt.items.itemAt(3).td.innerHTML="Un-allocated Pax:&nbsp;&nbsp;"+((m>0)?m:0);if(document.getElementById("DISPLAY_PAX_COUNT")){document.getElementById("DISPLAY_PAX_COUNT").innerHTML="Total of <b>"+m+" Passenger(s)</b> is been Added to this Manual Quote Booking."}},listeners:{render:function(){;var h=this.ownerCt.findParentByType("tabpanel");var l=this.ownerCt.findParentByType("awesomewindow");var k=l.aw.data;var m=k.type;var g=Ext.util.JSON.decode(k.parameters);var e=Ext.util.JSON.decode(g.mainRooms);if(typeof e!="undefined"){e=e.data}else{e=[]}for(var c=0;c<e.length;c++){this.items.itemAt(c).items.itemAt(1).setValue(e[c].adult);this.items.itemAt(c).items.itemAt(3).setValue(e[c].child);var b=e[c].childAge;for(var d=0;d<b.length;d++){this.items.itemAt(c).items.itemAt(10).items.itemAt(d).show(true);this.items.itemAt(c).items.itemAt(10).items.itemAt(d).setValue(b[d])}this.items.itemAt(c).items.itemAt(5).setValue(e[c].infant);var f=e[c].infantAge;for(var d=0;d<f.length;d++){this.items.itemAt(c).items.itemAt(12).items.itemAt(d).show(true);this.items.itemAt(c).items.itemAt(12).items.itemAt(d).setValue(f[d])}}}},items:[{xtype:"panel",layout:"table",width:530,style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,hideBorders:true,totalPaxPerRoom:0,totalPaxPerRoomCalc:function(){var b=this.items.itemAt(1).getValue();var e=this.items.itemAt(3).getValue();var d=this.items.itemAt(5).getValue();b=b?b:0;e=e?e:0;d=d?d:0;this.totalPaxPerRoom=b+e+d;this.ownerCt.calculateTotalPax()},layoutConfig:{columns:9},items:[{html:'Adults<font color="red">*</font>:',width:110},{xtype:"combo",store:[0,1,2,3,4,5,6,7,8,9,10],name:"A1",id:"A1",triggerAction:"all",readOnly:true,width:42,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc()}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Child:",width:50},{xtype:"combo",store:[0,1,2,3,4,5],name:"C1",triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var c=this.ownerCt.items.itemAt(10).items;var b=this.getValue();for(var a=0;a<5;a++){if(a<b){c.itemAt(a).show(true)}else{c.itemAt(a).hide(true)}}}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Infants:",width:63},{xtype:"combo",store:[0,1,2,3,4,5],name:"I1",triggerAction:"all",readOnly:true,width:40,listeners:{select:function(){this.ownerCt.totalPaxPerRoomCalc();var c=this.ownerCt.items.itemAt(12).items;var b=this.getValue();for(var a=0;a<5;a++){if(a<b){c.itemAt(a).show(true)}else{c.itemAt(a).hide(true)}}}}},{width:40},{html:"Total Pax:&nbsp;&nbsp;",width:80},{xtype:"numberfield",name:"totalPax",id:"ID_TOTAL_PAX",width:50,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{html:" ",colspan:3,width:150},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"C11",width:30},{xtype:"numberfield",name:"C12",width:30},{xtype:"numberfield",name:"C13",width:30},{xtype:"numberfield",name:"C14",width:30},{xtype:"numberfield",name:"C15",width:30}]},{html:" ",width:53},{xtype:"panel",width:45,defaults:{hidden:true},items:[{xtype:"numberfield",name:"I11",width:30},{xtype:"numberfield",name:"I12",width:30},{xtype:"numberfield",name:"I13",width:30},{xtype:"numberfield",name:"I14",width:30},{xtype:"numberfield",name:"I15",width:30}]}]}]},{layout:"form",border:false,autoHeight:true,labelWidth:100,width:530,items:[{xtype:"panel",layout:"table",width:530,style:"padding: 0; margin-bottom: 4px;margin-top: 8px;",border:false,hideBorders:true,layoutConfig:{columns:9},items:[{html:"Consession:",width:110},{xtype:"combo",store:[0,1,2,3,4,5],name:"consession",triggerAction:"all",readOnly:true,width:42,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)},select:function(){this.ownerCt.ownerCt.ownerCt.items.itemAt(5).items.itemAt(0).totalPaxPerRoomCalc()}}},{html:" &nbsp;&nbsp;&nbsp;&nbsp;Youth:",width:50},{xtype:"combo",store:[0,1,2,3,4,5],name:"youth",triggerAction:"all",readOnly:true,width:40,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)},select:function(){this.ownerCt.ownerCt.ownerCt.items.itemAt(5).items.itemAt(0).totalPaxPerRoomCalc()}}},{html:"&nbsp;&nbsp;&nbsp;&nbsp;Senior:",width:68},{xtype:"combo",store:[0,1,2,3,4,5],name:"senior",triggerAction:"all",readOnly:true,width:40,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)},select:function(){this.ownerCt.ownerCt.ownerCt.items.itemAt(5).items.itemAt(0).totalPaxPerRoomCalc()}}}]}]},{xtype:"panel",layout:"table",border:false,width:530,hideBorders:true,layoutConfig:{columns:8},items:[{html:"Pensioner:",width:110},{xtype:"combo",store:[0,1,2,3,4,5],name:"pensioner",triggerAction:"all",readOnly:true,width:42,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)},select:function(){this.ownerCt.ownerCt.items.itemAt(5).items.itemAt(0).totalPaxPerRoomCalc()}}},{width:193},{xtype:"button",text:"Age Rules",handler:function(){TDS.helpwindow.setWindow({buttonOK:false,winToRight:true,displayCenter:true,modal:true,title:"Rail Age Rules",data:{description:'<font size="2" color="#660000"><b>Passenger Age Requirements for Ticketing</b></font><br><br>Adults: ages 26 to 59<br><br>  Senior<font color="red">*</font>: ages 60 and over<br><br>  Youth<font color="red">*</font>: ages 25 and under.<br><br>  Children<font color="red">*</font>: ages vary per country and per product. Below you will find a list of examples.  Please check the specific sales conditions of the fares you select to ensure age requirements are met.<br><br>  Infants: aged under 4 or 6 yrs, depending on country of travel. Please note that infants travel for free provided they share a seat/sleeping berth with a paying passenger.  <br>  <br>  <font color="red">*</font>If there are Senior, Youth or Child fares available for you reuested journey, you will automatically be offered the adult fare.<br><br>  <font size="2" color="#660000"><b>Child Ages</b></font><br>  Cross border Tickets: 4-11<br><br>  Domestic tickets in:<br>  <table>  <tr>	<td width=400px>Austria</td>	<td width=200px>6-15</td>	<td width=200px></td>	<td width=400px>Italy</td>	<td width=200px>4-11</td>  </tr>  <tr>	<td>Belgium</td>	<td>6-11</td>	<td></td>	<td>Luxemborg</td>	<td>6-11</td> </tr>  <tr>	<td>Bulgaria</td>	<td>6-11</td>	<td></td>	<td>Macedonia</td>	<td>4-11</td>  </tr>  <tr>	<td>Croatia</td>	<td>4-11</td>	<td></td>	<td>Netherlands</td>	<td>4-11</td>  </tr>  <tr>	<td>Denmark</td>	<td>6-15</td>	<td></td>	<td>Norway</td>	<td>4-15</td>  </tr>  <tr>	<td>Czech Rupublic</td>	<td>6-11</td>	<td></td>	<td>Poland</td>	<td>4-11</td>  </tr>  <tr>	<td>Ex-Yugoslavia</td>	<td>4-11</td>	<td></td>	<td>Portugal</td>	<td>4-11</td>  </tr>  <tr>	<td>Finland</td>	<td>6-16</td>	<td></td>	<td>Republic of reland</td>	<td>4-15</td>  </tr>  <tr>	<td>France</td>	<td>4-11</td>	<td></td>	<td>Romania</td>	<td>4-11</td> </tr>  <tr>	<td>Germany</td>	<td>4-14</td>	<td></td>	<td>Slovakia</td>	<td>6-11</td>  </tr>  <tr>	<td>Greece</td>	<td>4-11</td>	<td></td>	<td>Slovenia</td>	<td>6-11</td>  </tr>  <tr>	<td>Hungary</td>	<td>6-13</td>	<td></td>	<td>Spain</td>	<td>4-11</td>  </tr>  <tr>	<td></td>	<td></td>	<td></td>	<td>Switezerland</td>	<td>6-15</td>  </tr>  </table>',pageSection:" "},interfaceURI:"help/preview.js"})}},{width:10},{xtype:"panel",layout:"table",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{xtype:"button",text:"Save",handler:function(){var c=this.ownerCt.ownerCt.ownerCt.items.itemAt(1).items.itemAt(2);var d=this.ownerCt.ownerCt.ownerCt.items.itemAt(1).items.itemAt(4);var e=this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(1);var o=this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(4);var m=this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(5);var q=this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(7);var h=this.ownerCt.ownerCt.ownerCt.items.itemAt(3).items.itemAt(2);var f=this.ownerCt.ownerCt.ownerCt.items.itemAt(3).items.itemAt(4);var b=this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(1);var n=this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(3);var a=this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(5);var l=this.ownerCt.ownerCt.ownerCt.items.itemAt(5).items.itemAt(0).items.itemAt(8);d=d.getValue()?(d.getValue()):(q.checked?"(Station)":" (Airport)");var k=q.checked?"(Station)":" (Airport)";if(d!=k){d=d+k}f=f.getValue()?(f.getValue()):(a.checked?"(Station)":" (Airport)");var i=a.checked?"(Station)":" (Airport)";if(d!=i){f=f+i}var j=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(1).items.itemAt(0);var p=j.getStore();p.removeAll();p.add([new p.recordType({no:(p.data.length+1),trainNo:b.getValue(),departs:c.getRawValue()+" "+d,arrives:h.getRawValue()+" "+f,date:e.getRawValue(),deptimeHr:o.getValue(),deptimeMin:m.getValue(),cls:n.getValue(),noOfPax:l.getValue()})])}},{html:"&nbsp;",width:10},{xtype:"button",text:"Clear",clearFields:function(){this.ownerCt.ownerCt.ownerCt.items.itemAt(1).items.itemAt(1).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(1).items.itemAt(2).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(1).items.itemAt(4).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(1).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(4).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(5).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(7).setValue(true);this.ownerCt.ownerCt.ownerCt.items.itemAt(2).items.itemAt(9).setValue(false);this.ownerCt.ownerCt.ownerCt.items.itemAt(3).items.itemAt(1).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(3).items.itemAt(2).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(3).items.itemAt(4).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(1).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(3).setValue("");this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(5).setValue(true);this.ownerCt.ownerCt.ownerCt.items.itemAt(4).items.itemAt(7).setValue(false)},handler:function(){this.clearFields()}},{html:"&nbsp; ",width:10}]}]}]},{xtype:"fieldset",defaults:{style:"padding: 0; margin-left: 130px; "},autoHeight:true,labelWidth:105,items:[{xtype:"editorgrid",height:120,clicksToEdit:1,width:630,style:"padding: 0;margin-left: 10px; margin-bottom: 6px;margin-top: 6px;",store:new Ext.data.JsonStore({url:"",identifier:"",fields:["dataURI","no","trainNo","departs","arrives","date","deptimeHr","deptimeMin","cls","status","noOfPax"]}),viewConfig:{},getData:function(){var c=this.getStore().data;for(var b=0,e=[];b<c.length;b++){var a=c.items[b].data.mode;if(a!=""){e.push(c.items[b].data)}}return{data:e}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:" ",dataIndex:"no",width:20,fixed:true},{header:"Train No",dataIndex:"trainNo",width:50,fixed:true},{header:"Departs",dataIndex:"departs",width:150},{header:"Arrives",dataIndex:"arrives",width:150},{header:"Class",dataIndex:"cls",width:100},{header:"Date",dataIndex:"date",width:60},{header:"Time",dataIndex:"deptimeHr",width:50,renderer:function(c,e,a,f,d,b){if(a.get("deptimeHr")&&a.get("deptimeMin")){return a.get("deptimeHr")+a.get("deptimeMin")}else{if(a.get("deptimeMin")){return"00"+a.get("deptimeMin")}else{return a.get("deptimeHr")+"00"}}}}],bbar:["->",{xtype:"button",text:"Cancel",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore().getAt(b.selModel.last);if(a==-1||typeof a.get("dataURI")!="undefined"){return}b.getStore().remove(a);if(b.getStore().length<=0){this.disable()}}}],listeners:{render:function(){;this.getEl().swallowEvent(["columnmove","columnresize","headerclick","click","mouseout","rowclick","rowmousedown","rowblclick","cellblclick","sortchange","mouseup","mousedown"]);var h=this.ownerCt.findParentByType("tabpanel");var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.type;var e=Ext.util.JSON.decode(b.parameters);var f=Ext.util.JSON.decode(e.gridData1);var g=f;if(typeof g=="undefined"){g=[]}if(typeof g.data!="undefined"){this.getStore().loadData(g.data)}}}}]},{xtype:"fieldset",defaults:{style:"margin-bottom:5px;  margin-left: 60px; "},autoHeight:true,hidden:true,labelWidth:105,items:[{xtype:"panel",layout:"table",border:false,hideBorders:false,layoutConfig:{columns:4},items:[{html:'Supplier<font color="red">*</font>:',border:false,hideBorders:false,width:110},{xtype:"combo",name:"supplierURI",id:"supplierURI",mode:"local",width:280,triggerAction:"all",editable:true,displayField:"name",valueField:"dataURI",store:TDS.data.MQsupplierStore}]},{xtype:"panel",layout:"table",border:false,hideBorders:false,layoutConfig:{columns:5},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="radio"){if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{html:"Preferred Fare Type:",border:false,hideBorders:false,width:110},{xtype:"radio",name:"preferredFareType",inputValue:"Cheapest",boxlabel:"No"},{html:"&nbsp;Cheapest",width:90},{xtype:"radio",name:"preferredFareType",inputValue:"Flexible",boxlabel:"Yes"},{html:"&nbsp;Flexible",width:40}]},{xtype:"panel",layout:"table",border:false,hideBorders:false,layoutConfig:{columns:10},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}}}}},items:[{html:"Preferred Travel Type:",border:false,hideBorders:false,width:110},{xtype:"checkbox",name:"stop",width:15},{html:"&nbsp;Non Stop",width:90},{xtype:"checkbox",name:"express",width:15},{html:"&nbsp;Express",width:90},{xtype:"checkbox",name:"pointToPoint",width:15},{html:"&nbsp;Point to Point",width:100},{xtype:"checkbox",name:"multiSectors",width:15},{html:"&nbsp;Multi Sectors",width:70}]},{xtype:"editorgrid",height:160,clicksToEdit:1,hidden:true,width:630,style:"padding: 0;margin-left: 10px; margin-bottom: 6px;margin-top: 6px;",store:new Ext.data.JsonStore({url:"",identifier:"",fields:["dataURI","no","a","c","i","co","y","s","preference","optionService","cls","extras"]}),viewConfig:{},getData:function(){var c=this.getStore().data;for(var b=0,e=[];b<c.length;b++){var a=c.items[b].data.mode;if(a!=""){e.push(c.items[b].data)}}return{data:e}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[{header:"No",dataIndex:"no",width:25,editor:new Ext.form.NumberField({})},{header:"A",dataIndex:"a",width:20,editor:new Ext.form.NumberField({listeners:{blur:function(){Ext.getCmp("addRails").a+=this.getValue()}}})},{header:"C",dataIndex:"c",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){Ext.getCmp("addRails").c+=this.getValue()}}})},{header:"I",dataIndex:"i",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){Ext.getCmp("addRails").i+=this.getValue()}}})},{header:"Co",dataIndex:"co",width:20,editor:new Ext.form.NumberField({listeners:{blur:function(){Ext.getCmp("addRails").a+=this.getValue()}}})},{header:"Y",dataIndex:"y",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){Ext.getCmp("addRails").c+=this.getValue()}}})},{header:"S",dataIndex:"s",width:20,editor:new Ext.form.NumberField({minValue:0,maxValue:5,listeners:{blur:function(){Ext.getCmp("addRails").i+=this.getValue()}}})},{header:"Preferences",dataIndex:"preference",width:125,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:" ",store:TDS.data.accommodationPreference})},{header:"Option Services",dataIndex:"optionService",width:95,editor:new Ext.ux.form.SuperBoxSelect({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",xtype:"superboxselect",store:TDS.data.accommodationOptionalServices})},{header:"Class",dataIndex:"cls",width:65,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:" ",store:TDS.data.railClasses})},{header:"Extras",dataIndex:"extras",width:175,height:70,editor:new Ext.ux.form.SuperBoxSelect({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name",emptyText:"Type",xtype:"superboxselect",store:TDS.data.accommodationExtras}),renderer:function(c,e,a,f,d,b){if(c!=""){e.attr='ext:qtip="'+c+'"'}return c}},{header:"Status",dataIndex:"status",hidden:true,width:60,fixed:true}],bbar:[{xtype:"button",text:"Add",id:"addRails",roomNo:1,a:0,c:0,i:0,handler:function(){;var e=this.ownerCt.ownerCt;var d=e.getStore();if(d.data.length==0){this.a=0;this.c=0;this.i=0;this.roomNo=1}var a=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(0).items.itemAt(5).items.length;if(this.roomNo<=a){var b=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(0).items.itemAt(5).items.itemAt((this.roomNo-1)).totalPaxPerRoom;if((this.a+this.c+this.i)>=b&&b!=0||((this.a+this.c+this.i)==0&&d.data.length!=0)){this.roomNo+=1;this.a=0;this.c=0;this.i=0;if((this.roomNo-1)>=a){b=0}else{b=this.ownerCt.ownerCt.ownerCt.ownerCt.items.itemAt(0).items.itemAt(5).items.itemAt((this.roomNo-1)).totalPaxPerRoom}}this.ownerCt.items.itemAt(3).td.innerHTML="Un-allocated Pax: "+(b-(this.a+this.c+this.i));if(this.roomNo<=a){var c=this.ownerCt.items.itemAt(1);c.enable();var e=this.ownerCt.ownerCt;var d=e.getStore();d.add([new d.recordType({no:this.roomNo,preference:"",optionService:"",cls:"",roomType:"",rooms:"",extras:" "})]);e.newRecordIndex=d.getCount()-1;e.startEditing(e.newRecordIndex,1)}}else{this.ownerCt.items.itemAt(3).td.innerHTML="Un-allocated Pax:&nbsp;&nbsp; 0"}}},{xtype:"button",text:"Cancel",disabled:true,handler:function(){;if(this.ownerCt.items.itemAt(0).roomNo>0){this.ownerCt.items.itemAt(0).roomNo-=1}var b=this.ownerCt.items.itemAt(0);b.enable();var c=this.ownerCt.ownerCt;var a=c.getStore().getAt(c.selModel.last);if(a==-1||typeof a.get("dataURI")!="undefined"){return}c.getStore().remove(a);if(c.getStore().length<=0){this.disable()}}},"->","Un-allocated Pax:&nbsp;&nbsp;0"],listeners:{render:function(){;this.getEl().swallowEvent(["columnmove","columnresize","headerclick","click","mouseout","rowclick","rowmousedown","rowblclick","cellblclick","sortchange","mouseup","mousedown"]);var h=this.ownerCt.findParentByType("tabpanel");var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.type;var e=Ext.util.JSON.decode(b.parameters);var f=Ext.util.JSON.decode(e.gridData);var g=f;if(typeof g=="undefined"){g=[]}if(typeof g.data!="undefined"){this.getStore().loadData(g.data)}}}},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 120px;margin-top: 4px;margin-bottom: 5px;",border:false,hideBorders:false,layoutConfig:{columns:7},defaults:{border:false},listeners:{render:function(){;var d=this.ownerCt.findParentByType("awesomewindow");var c=d.aw.data;var g=c.type;var h=Ext.util.JSON.decode(c.parameters);var e=this.items;for(var f=1;f<=e.length;f++){var b=e.itemAt(f);if(typeof b!="undefined"&&typeof b.name!="undefined"){if(b.xtype=="checkbox"){b.setValue(h[b.name])}else{if(b.inputValue+""==h[b.name]){b.setValue(true)}}}}}},items:[{html:"&nbsp;&nbsp;Rail Pass Holder:",border:false,hideBorders:false,width:110},{xtype:"radio",name:"railPassHolder",inputValue:"No",listeners:{check:function(){if(this.getValue()){this.ownerCt.items.itemAt(6).disable(true);this.ownerCt.items.itemAt(6).setValue("")}}}},{html:"&nbsp;No",width:50},{xtype:"radio",name:"railPassHolder",boxlabel:"Yes",inputValue:"Yes",listeners:{check:function(){if(this.getValue()){this.ownerCt.items.itemAt(6).enable(true);this.ownerCt.items.itemAt(6).setValue("")}}}},{html:"&nbsp;Yes",width:40},{width:20},{xtype:"numberfield",width:145,disabled:true,name:"railPassHolderMembersCount",listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]},{xtype:"textfield",style:"margin-bottom:5px;  margin-left: 120px; ",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pass&nbsp;Name",name:"name",width:280},{xtype:"textfield",style:"margin-bottom:5px;  margin-left: 120px; ",fieldLabel:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pass&nbsp;Duration",name:"duration",width:280}]},{xtype:"fieldset",defaults:{style:"padding: 0; margin-left: 10px; "},autoHeight:true,labelWidth:105,calculateTotalPrice:function(){;var b=this;var i=0;var f=b.items.itemAt(1).items.itemAt(4).getValue();var e=b.items.itemAt(2).items.itemAt(6).getValue();var d=b.items.itemAt(2).items.itemAt(2).getValue();var g=b.items.itemAt(3).items.itemAt(6);var a=b.items.itemAt(3).items.itemAt(2);if(e!="undefined"&&e!=""){}else{}var c=b.items.itemAt(4).items.itemAt(1).getValue();var k=b.items.itemAt(4).items.itemAt(4).getValue();var l=b.items.itemAt(4).items.itemAt(4);var j=b.items.itemAt(5).items.itemAt(4);var h=b.items.itemAt(5).items.itemAt(1).getValue();if(f=="true"){g.setValue("");a.setValue("")}else{l.setValue("")}return},items:[{xtype:"editorgrid",id:"passGrid",height:120,width:630,clicksToEdit:1,store:new Ext.data.JsonStore({url:"",identifier:"",fields:["priceSell","pricingPriceCurrency","roomType","status","paxType"]}),viewConfig:{forceFit:true},getPricingTotal:function(){var a=this;setTimeout(function(){var c=a.getStore().data;var e=0;for(var b=0;b<c.length;b++){if(c.items[b].data.priceBaseSell!=null&&c.items[b].data.priceBaseSell!=""){e+=parseFloat(c.items[b].data.priceBaseSell)}}},100)},getData:function(){var b=this.getStore().data;for(var a=0,c=[];a<b.length;a++){c.push(b.items[a].data)}return{data:c}},preselect:function(c,b){var a=[];this.getStore().each(function(d){if(a.length>=b){return false}if((!c||d.get("type")==c)&&d.get("nameFirst")&&d.get("nameLast")){a[a.length]=d}},this);if(a.length>0){this.getSelectionModel().selectRecords(a)}return a.length},validatePassenger:function(d,a,c,b){if(!b.get("nameFirst")&&!b.get("nameLast")){return false}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Pax Type",dataIndex:"paxType",width:80,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"text",valueField:"text",triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Passengers",dataIndex:"passengersTotal",width:80,fixed:true,editor:new Ext.form.TextField({})},{header:"DOB",dataIndex:"dob",width:90,fixed:true,editor:new Ext.form.TextField({})},{header:"Age",dataIndex:"age",width:50,fixed:true,editor:new Ext.form.TextField({})},{header:"Curr",dataIndex:"pricingPriceCurrency",width:50,fixed:true,editor:new Ext.form.TextField({})},{header:"Price Per Person",dataIndex:"priceSell",width:100,fixed:true,editor:new Ext.form.NumberField({}),renderer:TDS.util.Price.conversionPriceRenderer},{header:"Status",dataIndex:"status",width:60,fixed:true,editor:new Ext.form.ComboBox({store:[["OK","OK"],["RQ","RQ"],["WL","WL"],["XX","XX"]],editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})}],bbar:[{xtype:"button",text:"Add",handler:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var e=this.ownerCt.ownerCt;var d=e.getStore();d.add([new d.recordType({roomType:"",pricingPriceCurrency:b.pricingPriceCurrency,priceSell:"",status:"QT"})]);e.startEditing(d.getCount()-1,1)}},{xtype:"button",text:"Remove",handler:function(){var b=this.ownerCt.ownerCt,a;while(a=b.selModel.getSelected()){b.store.remove(a)}}}],listeners:{render:function(){;var b=this;var j=this.ownerCt.findParentByType("awesomewindow");var h=j.aw.data;var f=Ext.util.JSON.decode(h.parameters);if(typeof f!="undefined"&&typeof f.roomTypesWithPrice!="undefined"&&f.roomTypesWithPrice!=""){var d=Ext.util.JSON.decode(f.roomTypesWithPrice);var g=d;if(typeof g=="undefined"){g=[]}if(typeof g.data!="undefined"){this.getStore().loadData(g.data)}}else{var c=Ext.util.JSON.decode(h.parameters);var d=Ext.util.JSON.decode(c.gridData);var g=[];if(typeof g=="undefined"){g=[]}if(typeof d.data!="undefined"){for(var e=0;e<d.data.length;e++){if(g.indexOf(d.data[e].roomType)==-1){var k=this.getStore();k.add([new k.recordType({roomType:d.data[e].roomType,pricingPriceCurrency:h.pricingPriceCurrency,priceSell:"",status:"QT"})])}}}}}}},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:4},items:[{html:"Supplier:",border:false,hideBorders:false,width:100},{xtype:"textfield",name:"supplierName",mode:"local",width:290}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:5},items:[{html:"Booking Ref:",border:false,hideBorders:false,width:100},{xtype:"textfield",name:"bookingReferenceNumber",mode:"local",width:95,triggerAction:"all",editable:true},{width:20,border:false},{html:"Gross/Net:",border:false,hideBorders:false,width:80},{xtype:"combo",name:"pricingPriceIsNett",mode:"local",width:95,triggerAction:"all",editable:true,store:[["false","Gross"],["true","Nett"]],listeners:{select:function(){;var d=this.ownerCt.ownerCt;var a=this.ownerCt.ownerCt.items.itemAt(3).items.itemAt(4);if(this.getValue()=="true"){var c=this.ownerCt.ownerCt.items.itemAt(2).items.itemAt(2);var b=this.ownerCt.ownerCt.items.itemAt(2).items.itemAt(6);c.disable(true);c.setValue("");b.disable(true);b.setValue("");var a=this.ownerCt.ownerCt.items.itemAt(3).items.itemAt(4);a.enable().focus(false,10);this.ownerCt.ownerCt.calculateTotalPrice()}else{var a=this.ownerCt.ownerCt.items.itemAt(3).items.itemAt(4);a.disable(true);a.setValue("");var c=this.ownerCt.ownerCt.items.itemAt(2).items.itemAt(2);var b=this.ownerCt.ownerCt.items.itemAt(2).items.itemAt(6);this.ownerCt.ownerCt.calculateTotalPrice()}}}}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:7},items:[{xtype:"radio",name:"gross",checked:true,width:20,boxlabel:"No",inputValue:"priceCommission",listeners:{check:function(){;var c=this.ownerCt.ownerCt;var c=this.ownerCt.ownerCt.items.itemAt(1).items.itemAt(4).getValue();var b=this.ownerCt.ownerCt.items.itemAt(2).items.itemAt(2);var a=this.ownerCt.ownerCt.items.itemAt(2).items.itemAt(6);if(this.getValue()&&c!="true"){b.enable();a.disable(true);a.setValue("")}else{if(!this.getValue()&&c!="true"){b.disable(true);b.setValue("");a.enable();this.ownerCt.ownerCt.calculateTotalPrice()}}}}},{html:"Commision %",border:false,hideBorders:false,width:80},{xtype:"textfield",name:"pricingPriceCommission",mode:"local",width:95,triggerAction:"all",editable:true,listeners:{render:function(){;var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var g=d.pricingPriceCommission;var f=d.pricingPriceIsNett;if(f){var c=this;setTimeout(function(){c.setValue("")},500)}}}},{width:20,border:false},{xtype:"radio",name:"gross",width:20,boxlabel:"No",inputValue:"priceCommission"},{html:"Commision $",border:false,hideBorders:false,width:60},{xtype:"textfield",name:"priceCommission$",mode:"local",width:95,triggerAction:"all",editable:true}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:5},items:[{html:"Markdown",border:false,hideBorders:false,width:100},{xtype:"textfield",name:"markdown",mode:"local",width:95,triggerAction:"all",editable:true,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}},{width:20,border:false},{html:"",border:false,hideBorders:false,width:80,xtype:"label",listeners:{render:function(){;var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var d=b.pricingPriceCurrency;if(typeof d!="undefined"&&d){this.setText("Markup "+d+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ",false)}}}},{xtype:"textfield",name:"pricingPriceCommission",mode:"local",width:95,triggerAction:"all",editable:true,listeners:{render:function(){;var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var g=d.pricingPriceCommission;var f=d.pricingPriceIsNett;if(!f){var c=this;setTimeout(function(){c.setValue("")},500)}}}}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 130px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:2},items:[{html:"Details:",border:false,hideBorders:false,width:100},{xtype:"textarea",name:"details",mode:"local",hieght:40,width:290,triggerAction:"all",editable:true,listeners:{render:function(){var e=this.ownerCt.findParentByType("awesomewindow");var d=e.aw.data;var f=d.type;var g=Ext.util.JSON.decode(d.parameters);var c=this;setTimeout(function(){c.setValue(g[c.name])},500)}}}]}]}]},{border:false,items:[{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:480},{xtype:"button",hidden:true,text:"Back"},{html:"&nbsp;",width:80},{xtype:"button",text:"Next",handler:function(){var j=this.ownerCt.findParentByType("awesomewindow");var i=Ext.getCmp("countryFromCode").getValue();var c=Ext.getCmp("dateFrom").getValue();var h=Ext.getCmp("startTimeHrs").getValue();var g=Ext.getCmp("class").getValue();var f=Ext.getCmp("countryToCode").getValue();var b=Ext.getCmp("A1").getValue();try{if(typeof i=="undefined"||i==""){Ext.getCmp("countryFromCode").markInvalid("Please select a Country.");Ext.getCmp("countryFromCode").focus(true);throw"Please select a Country.";return false}if(typeof c=="undefined"||c==""){Ext.getCmp("dateFrom").markInvalid("Please select In Date.");Ext.getCmp("dateFrom").focus(true);throw"Please select In Date.";return false}if(typeof h=="undefined"||h==""||typeof startTimeMin=="undefined"||c==""){Ext.getCmp("startTimeHrs").markInvalid("Please select Time.");Ext.getCmp("startTimeHrs").focus(true);throw"Please select In Date.";return false}if(typeof f=="undefined"||f==""){Ext.getCmp("countryToCode").markInvalid("Please select Arr Country.");Ext.getCmp("countryToCode").focus(true);throw"Please select Arr Country.";return false}if(typeof g=="undefined"||g==""){Ext.getCmp("class").markInvalid("Please select Class.");Ext.getCmp("class").focus(true);throw"Please select Class.";return false}if(typeof b=="undefined"||b==""){Ext.getCmp("A1").markInvalid("Please select Adult.");Ext.getCmp("A1").focus(true);throw"Please select Adult.";return false}}catch(d){j.showValidation(d);return false}var a=this.ownerCt.ownerCt.ownerCt.ownerCt;a.setActiveTab(1)}},{html:"&nbsp; ",width:10}]}]}]},{title:"Additional Info",items:[{xtype:"textarea",name:"description",height:455,width:685,hideLabel:true,border:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:true,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:500},{xtype:"button",text:"Back",handler:function(){var a=this.ownerCt.ownerCt.ownerCt;a.setActiveTab(0)}},{html:"&nbsp;",width:10},{xtype:"button",text:"Next",handler:function(){var a=this.ownerCt.ownerCt.ownerCt;a.setActiveTab(2)}},{html:"&nbsp; ",width:10}]}]},{title:"Passengers",items:[{xtype:"panel",border:false,style:"margin-bottom: 6px;",html:'<div id="DISPLAY_PAX_COUNT"></div>',listeners:{render:function(){var a=Ext.getCmp("ID_TOTAL_PAX").getValue();if(!a){a=0}if(document.getElementById("DISPLAY_PAX_COUNT")){document.getElementById("DISPLAY_PAX_COUNT").InnerHTML="Total "+a+" is been Added to this Manual Quote Booking."}else{this.html='<font size="2" >Total of <b>'+a+" Passenger(s)</b> is been Added to this Manual Quote Booking.</font>"}}}},{xtype:"panel",border:false,layout:"fit",height:430,items:[{xtype:"editorgrid",height:440,width:570,store:new Ext.data.CollectionStore({url:"",identifier:"",fields:["type","code","nameFirst","nameLast","salutation","displayName","dateOfBirth","rateURI","paxAge"]}),viewConfig:{forceFit:true},getData:function(){var b=this.selModel.getSelections();var c=[];for(var a=0;a<b.length;a++){c[a]=b[a].get("dataURI")}return c},preselect:function(c,b){var a=[];this.getStore().each(function(d){if(a.length>=b){return false}if((!c||d.get("type")==c)&&d.get("nameFirst")&&d.get("nameLast")){a[a.length]=d}},this);if(a.length>0){this.getSelectionModel().selectRecords(a)}return a.length},validatePassenger:function(d,a,c,b){if(!b.get("nameFirst")&&!b.get("nameLast")){return false}},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Type",dataIndex:"type",width:40,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",displayField:"text",valueField:"text",triggerAction:"all",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Last name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false})},{header:"First name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false})},{header:"Title",dataIndex:"salutation",width:40,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"Age",dataIndex:"paxAge",width:40,renderer:function(c,b,a){if(c){return c}else{return TDS.util.Format.age(a.get("dateOfBirth"))}},editor:new Ext.form.NumberField({allowBlank:false})}],listeners:{beforeedit:function(a){},render:function(){var grid=this;var w=this.ownerCt.findParentByType("awesomewindow");with(this.store){reader.meta.identifier=w.aw.data.pnrDataURI+"/passengers";proxy.conn.url=TDS.env.dataPath+w.aw.data.pnrDataURI+"/passengers/concise";load()}var dataURI=w.aw.sourceDataURI;Ext.Ajax.request({url:TDS.env.dataPath+dataURI+"/passengers/collection/concise",method:"GET",callback:function(o,s,r){;if(s){var ro=Ext.util.JSON.decode(r.responseText);var collection=ro[dataURI+"/passengers"];if(typeof collection=="undefined"){return}for(var i=0;i<collection.length;i++){var s=this.getStore().data;for(var j=0;j<s.length;j++){if(s.items[j].data.dataURI==collection[i]){grid.getSelectionModel().selectRow(j,true,false)}}}}},scope:this})}}}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 4px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:500},{xtype:"button",text:"Back",handler:function(){var a=this.ownerCt.ownerCt.ownerCt;a.setActiveTab(1)}},{html:"&nbsp;",width:10},{xtype:"button",text:"Next",handler:function(){var b=this.ownerCt.ownerCt.ownerCt;var a=this.ownerCt.findParentByType("awesomewindow");a.buttons[0].enable(true);a.buttons[1].enable(true);b.setActiveTab(3)}},{html:"&nbsp; ",width:10}]}]},{title:"Extras",items:[{xtype:"panel",border:false,layout:"fit",height:450,items:[{xtype:"editorgrid",id:"extraGrid",clicksToEdit:1,height:440,width:370,store:new Ext.data.JsonStore({url:"",identifier:"",fields:["priceSell","priceCurrency","priceSell","priceCurrency","roomType","taxSell","taxSell","extras","status"]}),viewConfig:{},getData:function(){var b=this.getStore().data;for(var a=0,c=[];a<b.length;a++){c.push(b.items[a].data)}return{data:c}},getPricingTotal:function(){var a=this;setTimeout(function(){;var e=a.getStore().data;var f=0;var b="";for(var c=0;c<e.length;c++){b=e.items[c].data.pricingPriceCurrency;if(e.items[c].data.priceSell!=null&&e.items[c].data.priceSell!=""){f+=parseFloat(e.items[c].data.priceSell)}if(e.items[c].data.taxSell!=null&&e.items[c].data.taxSell!=""){f+=parseFloat(e.items[c].data.taxSell)}}a.ownerCt.ownerCt.items.itemAt(1).setValue(f.toFixed(2));a.bottomToolbar.items.itemAt(3).td.innerHTML="<b>Total Net Price: "+TDS.util.Price.formatPrice(f,b)+"</b>"},100)},sm:new Ext.grid.CheckboxSelectionModel(),columns:[new Ext.grid.CheckboxSelectionModel(),{header:"Room Type",dataIndex:"roomType",width:130,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.tourRoomTypeMQ,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"value"})},{header:"Extras",dataIndex:"extras",width:190,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.accommodationExtraMQ,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"name",valueField:"name"})},{header:"Curr",dataIndex:"pricingPriceCurrency",width:50,fixed:true},{header:"Net Price",dataIndex:"priceSell",width:100,fixed:true,editor:new Ext.form.NumberField({listeners:{blur:function(){Ext.getCmp("extraGrid").getPricingTotal()}}}),renderer:TDS.util.Price.conversionPriceRenderer},{header:"Tax",dataIndex:"taxSell",width:100,fixed:true,editor:new Ext.form.NumberField({listeners:{blur:function(){Ext.getCmp("extraGrid").getPricingTotal()}}}),renderer:TDS.util.Price.conversionPriceRenderer},{header:"Status",dataIndex:"status",width:60,fixed:true,editor:new Ext.form.ComboBox({store:[["NA","NA"],["QT","QT"],["OK","OK"]],editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})}],bbar:[{xtype:"button",text:"Add",handler:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;var e=this.ownerCt.ownerCt;var d=e.getStore();d.add([new d.recordType({roomType:"",pricingPriceCurrency:b.pricingPriceCurrency,taxSell:"",taxSell:"",priceSell:"",priceSell:"",extras:"",status:"QT"})]);e.startEditing(d.getCount()-1,2)}},{xtype:"button",text:"Remove",handler:function(){var b=this.ownerCt.ownerCt,a;while(a=b.selModel.getSelected()){b.store.remove(a)}}},"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",""],listeners:{render:function(){;var b=this;var o=this.ownerCt.findParentByType("awesomewindow");var v=o.aw.data;var u=0;var h="";var n=Ext.util.JSON.decode(v.parameters);if(typeof n!="undefined"&&typeof n.extrasWithPricing!="undefined"&&n.extrasWithPricing!=""){var k={};var x=Ext.util.JSON.decode(v.parameters);var t=Ext.util.JSON.decode(x.gridData).data;var f=Ext.util.JSON.decode(n.extrasWithPricing).data;for(var r=0;r<f.length;r++){var m=f[r].roomType;h=f[r].pricingPriceCurrency;if(f[r].priceSell!=null&&f[r].priceSell!=""){u+=parseFloat(f[r].priceSell)}if(f[r].taxSell!=null&&f[r].taxSell!=""){u+=parseFloat(f[r].taxSell)}if(typeof k[m]=="undefined"){k[m]=[]}k[m].push(f[r].extras)}this.bottomToolbar.items.itemAt(3).td.innerHTML="<b>Total Net Price: "+TDS.util.Price.formatPrice(u,h)+"</b>";this.ownerCt.ownerCt.items.itemAt(1).setValue(u);this.getStore().loadData(f);for(var r=0;r<t.length;r++){var e=t[r].roomType;var l=t[r].extras;l=l.split(",");var c=k[e];for(var q=0;q<l.length;q++){var g=l[q];if(g!=" "){var p=this.getStore();if(c.indexOf(g)==-1){p.add([new p.recordType({roomType:e,taxSell:"",pricingPriceCurrency:v.pricingPriceCurrency,priceSell:"",priceSell:"",extras:g,taxSell:"",status:"QT"})])}}}}}else{var x=Ext.util.JSON.decode(v.parameters);var t=Ext.util.JSON.decode(x.gridData).data;for(var r=0;r<t.length;r++){var e=t[r].roomType;var l=t[r].extras;l=l.split(",");for(var q=0;q<l.length;q++){var g=l[q];if(g!=" "){var p=this.getStore();p.add([new p.recordType({roomType:t[r].roomType,taxSell:"",pricingPriceCurrency:v.pricingPriceCurrency,priceSell:"",priceSell:"",taxSell:"",extras:g,status:"QT"})])}}}}}}}]},{xtype:"numberfield",hidden:true,name:"extrasAmount",width:123},{xtype:"panel",layout:"table",style:"padding: 0; margin-left: 10px;margin-top: 10px;margin-bottom: 2px;",border:false,hideBorders:false,layoutConfig:{columns:9},defaults:{border:false},items:[{html:"&nbsp;",width:480},{xtype:"button",hidden:true,text:"next"},{html:"&nbsp;",width:80},{xtype:"button",text:"Back",handler:function(){var b=this.ownerCt.ownerCt.ownerCt;var a=this.ownerCt.findParentByType("awesomewindow");a.buttons[0].disable(true);a.buttons[1].disable(true);b.setActiveTab(2)}},{html:"&nbsp; ",width:10}]}]}]}]}