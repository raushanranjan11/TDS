{xtype:"panel",bodyStyle:"padding: 0px;",border:false,requireStores:[{dataURI:TDS.env.dataPath+"accommodation/ratings/collection",identifier:"accommodation/ratings",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"accommodation/propertyclasstypes/collection",identifier:"accommodation/propertyclasstypes",fields:["name","displayName","dataURI"]}],width:750,items:[{xtype:"panel",border:false,height:525,width:750,layout:"form",autoScroll:false,items:[{border:false,html:'<br><center><u><b><font size="3">PRICE SUMMARY</font></b></u></center><br>'},{xtype:"label",border:false},{border:false},{xtype:"grid",enableRowExpander:false,sessionExpandedRows:false,height:372,border:true,autoScroll:true,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,updateGridData:function(i){var j=this;var k=j.getSelections();var l=k[0].data.dataURI;var a=this.findParentByType("awesomewindow");var h=a.aw.data.dataURI;Ext.Ajax.request({url:TDS.env.dataPath+l+"/acceptReject?accept="+i,method:"GET",callback:function(c,b,d){},scope:this})},bbar:["&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",'<div style =  " font-weight: 600; padding-right:50px;"><font size="2"></font> </div>',"->",""],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["dataURI",,"PNRCode","agencyURI","airportFromIataString","airportFromString","airportFromURI","airportToIataString","airportToString","airportToURI","archived","countryFromCode","countryToCode","createdById","createdByURI","createdByUserFullNameString","createdDate","dataURI","dateFrom","dateTo","entryType","ledger","locationFromString","locationFromURI","locationToString","locationToURI","manualQuoteCanBeConfirmed","manualQuoteLastUpdatedBySupplier","name","offeringURI","parameters","passengerNameRecordURI","passengersTotal","paxDescriptionShortString","pricingPriceBaseCurrency","pricingPriceBaseModifier","pricingPriceBaseSell","pricingPriceCommission","pricingPriceCurrency","pricingPriceIsNett","displayTotalPrice","status","supplierName","supplierURI","transactionPaidAmount","transactionPaidExtraAmount","type","updatedById","updatedByURI","updatedByUserFullNameString","updatedDate","displayMarkup","displayTotalNettPrice","exRateHoldTillDate","lockHoldDate"]}),sm:new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:""}),columns:[new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:""}),{header:"Date",dataIndex:"dateTo",sortable:true,width:60,fixed:true,renderer:function(h,e,f){var g=TDS.util.Format.dateSpecial(f.get("dateTo"),TDS.env.dateFormatDisplay);return g}},{header:"Supplier",dataIndex:"supplierName",width:50,sortable:true},{header:"Component",dataIndex:"name",width:100},{header:"Nett",dataIndex:"displayTotalNettPrice",width:90,fixed:true,renderer:function(j,k,h,i,l,g){return TDS.util.Price.formatPrice(h.get("displayTotalNettPrice"),h.get("pricingPriceCurrency"))}},{header:"Markup",dataIndex:"displayMarkup",width:90,fixed:true,renderer:function(j,k,h,i,l,g){if(j){return TDS.util.Price.formatPrice(j,h.get("pricingPriceCurrency"))}else{return""}}},{header:"Total Price",dataIndex:"displayTotalPrice",width:90,fixed:true,renderer:function(j,k,h,i,l,g){return TDS.util.Price.formatPrice(h.get("displayTotalPrice"),h.get("pricingPriceCurrency"))}},{header:"Status",dataIndex:"status",width:60,fixed:true,renderer:function(h,e,f){var g=f.get("entryType");if(h=="Quote"&&g!="Manual Quote"){Ext.getCmp("has_quotes_id").setValue(true)}if(g=="Manual Quote"&&h=="Quote"){h+=" (M)"}else{if(g=="OA"){h="OA"}}return h}},{header:"",hidden:true,dataIndex:"exRateHoldTillDate",width:110,fixed:true,renderer:function(k,m,i,j,n,h){var l=document.getElementById("holdDateDivId");if(k&&i.get("lockHoldDate")&&i.get("status")=="Confirmed"){l.innerHTML='<u><b>Exchange Rates</b></u>: <input type="image" height=20px; src="images/lock.png">&nbsp;&nbsp;<b>'+TDS.util.Format.dateSpecial(k,TDS.env.dateTimeFormatDisplay)+"</b>"}else{if(k&&i.get("status")=="Confirmed"){l.innerHTML='<u><b>Exchange Rates</b></u>: <input type="image" height=20px; src="images/unlock.png">'}else{return""}}}}],viewConfig:{forceFit:true},sdAll:[],sdConfirmed:[],listeners:{rowdblclick:function(n,l){var k=this.ownerCt.findParentByType("awesomewindow");k.hide();var n=this;var o=this.getStore().getAt(l);var g=o.get("dataURI");var p="pnr/"+o.get("PNRCode");TDS.session.setByPath(p,{view:"pnrView",option:"pnr",focusRecord:g});if(TDS.workArea.isTabReady("pnr.js",p)){var r=TDS.workArea.getTab("pnr.js",p);var m=r.items.itemAt(0).items.itemAt(0);var q=m.getPassengerNameRecordPanel();if(q.isViewRendered("pnr")){q.focusView("pnrView","pnr");var n=q.getView().findByType("awesomegrid")[0];n.focusResult(g,false,true)}else{q.focusView("pnrView","pnr")}}},render:function(){this.getEl().swallowEvent(["columnmove","columnresize","headerclick","click","mouseout","rowclick","rowmousedown","rowblclick","cellblclick","sortchange","mouseup","mousedown"]);var g=this.ownerCt.findParentByType("ajaxpanel");var e=this.findParentByType("awesomewindow");var f=e.aw.data.dataURI;var h=e.aw.data.summaryFor;Ext.Ajax.request({url:TDS.env.dataPath+f+"/summaryForPNR?summaryFor="+h,method:"GET",callback:function(s,B,y){if(B){var c=Ext.util.JSON.decode(y.responseText);var d=c[f+"/summaryForPNR"];if(typeof d=="undefined"){return}var E=[];var r=0;var b=0;var F=0;var a=0;var o=0;var C=0;var D="";for(var i=0;i<d.length;i++){c[d[i]].dataURI=d[i];if(c[d[i]].displayTotalPrice){r+=c[d[i]].displayTotalPrice}if(c[d[i]].displayMarkup){F+=c[d[i]].displayMarkup}D=c[d[i]].pricingPriceCurrency;E.push(c[d[i]]);if(c[d[i]].status=="Confirmed"){this.sdConfirmed.push(c[d[i]]);if(c[d[i]].displayTotalPrice){a+=c[d[i]].displayTotalPrice}if(c[d[i]].displayMarkup){C+=c[d[i]].displayMarkup}}}this.sdAll=E;var z=this;var A=z.store;A.loadData(E);this.bottomToolbar.items.itemAt(3).td.innerHTML='<table border=0 width=470><tr><td width=190 align=right><font size="2" ><b>Totals:</b></font></td><td width=125 align=right><font size="2" ><b> '+TDS.util.Price.formatPrice((r-F),D)+'</b></font></td><td width=115 align=right><font size="2" ><b> '+TDS.util.Price.formatPrice(F,D)+'</b></font></td><td width=100 align=right><font size="2" ><b> '+TDS.util.Price.formatPrice(r,D)+"</b></font></td></tr></table>"}},scope:this})}}},{xtype:"numberfield",id:"qwe1",value:0,hidden:true,fieldLabel:"Total"},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;margin-right: 23px;",border:false,hidden:true,layoutConfig:{columns:2},items:[{xtype:"label",width:330,style:" margin-right: 375px;",html:' <font color="#cc0000"><b>Total Net Price:</b></font> '},{xtype:"textfield",id:"qwe2",width:90,fieldLabel:"Total"}]},{height:210,width:528,border:false,xtype:"label",html:'<div id="mq_details_div" width=  100%; style="border: 1px solid #ccc;"> </div>'}],bbar:[{xtype:"button",text:"Hide",handler:function(){var b=this.ownerCt.ownerCt.findByType("grid")[0];b.store.loadData(b.sdConfirmed);this.ownerCt.items.itemAt(7).show();this.ownerCt.items.itemAt(6).hide();return}},{xtype:"button",text:"Show All",handler:function(){var b=this.ownerCt.ownerCt.findByType("grid")[0];b.store.loadData(b.sdAll);this.ownerCt.items.itemAt(6).show();this.ownerCt.items.itemAt(7).hide();return}},{xtype:"button",hidden:true,text:"Hold Rates",handler:function(){var c=this.ownerCt.findParentByType("awesomewindow");var d=c.aw.data.dataURI;TDS.helpwindow.setWindow({title:"Hold Exchange Rates",message:"Are you sure you want to Hold all current Exchange Rates ?",destinationDataURI:d+"/holdRates",buttonOK:"Submit",displayCenter:true,buttonCancel:"Cancel",showCancelButton:true,callback:{fn:function(a){},scope:this.ownerCt.ownerCt}})}},{xtype:"button",text:"Supplier Summary",handler:function(){var r="";var o=this.ownerCt.ownerCt.findByType("grid")[0].store;var a=[];var q={};var e="";for(var s=0;s<o.data.length;s++){if(a.indexOf(o.data.items[s].data.supplierName)==-1){a.push(o.data.items[s].data.supplierName);q[o.data.items[s].data.supplierName]={};q[o.data.items[s].data.supplierName].total=0;q[o.data.items[s].data.supplierName].markup=0}if(o.data.items[s].data.displayTotalPrice){q[o.data.items[s].data.supplierName].total+=o.data.items[s].data.displayTotalPrice}if(o.data.items[s].data.displayMarkup){q[o.data.items[s].data.supplierName].markup+=o.data.items[s].data.displayMarkup}if(o.data.items[s].data.displayTotalNettPrice){q[o.data.items[s].data.supplierName].displayTotalNettPrice+=o.data.items[s].data.displayTotalNettPrice}e=o.data.items[s].data.pricingPriceCurrency}var u=0;var t=0;var i=0;for(var s=0;s<a.length;s++){i+=q[a[s]].total;t+=q[a[s]].markup;u+=q[a[s]].displayTotalNettPrice;r+="<tr>";r+='<td height="20" align="left"><b>'+a[s]+"</b></td>";r+='<td align="right"> <b>'+TDS.util.Price.formatPrice(q[a[s]].displayTotalNettPrice,e)+"</b></td>";r+='<td align="right"> <b> '+TDS.util.Price.formatPrice(q[a[s]].markup,e)+"</b></td>";r+='<td align="right"> <b>'+TDS.util.Price.formatPrice(q[a[s]].total,e)+"</b></td>";r+="</tr>"}var v='<table valign=bottom  border=0 style="width: 100%;" cellpadding = 0 cellspacing=0  >';v+="<tr><hr></tr>";v+="<tr>";v+='<td align="right" style=" width: 40%;" > <b>Totals:&nbsp;&nbsp;&nbsp;&nbsp;</b></td>';v+='<td align="right" style=" width: 20%;"> <b>'+TDS.util.Price.formatPrice(u,e)+"&nbsp;&nbsp;</b></td>";v+='<td align="right" style=" width: 20%;"> <b>'+TDS.util.Price.formatPrice(t,e)+"&nbsp;&nbsp;</b></td>";v+='<td align="right" style=" width: 20%;"> <b>'+TDS.util.Price.formatPrice(i,e)+"&nbsp;&nbsp;</b></td>";v+="</tr>";v+="</table>";var p='<table   style=" border-collapse: collapse;border: 1px solid #000000; width: 100%; " border=1 cellpadding = 1 cellspacing=0  ><tr style="background-color: #d0def0;"><th style=" width: 40%; height:20px;">Supplier</th><th style=" width: 20%;">Nett</th><th style=" width: 20%;">Markup</th><th style=" width: 20%;">Total Gross</th></tr>'+r+"</table>";p+="<br>";p+=v;TDS.helpwindow.setWindow({buttonOK:false,winToRight:true,displayCenter:true,modal:true,title:"Supplier Summary",data:{description:p,pageSection:'<font size="2">Supplier Summary</font>'},interfaceURI:"pnr/components/generic/supplierSummaryDisplay.js"})}},"->"," "]}],listeners:{render:function(){var f=this.items.itemAt(0);var e=this.findParentByType("awesomewindow");var d=e.aw.data.pnrNo;f.items.itemAt(1).html='<table ><tr><td width=600px>&nbsp;&nbsp;<font size="3"><b>PNR No: '+d+'</b> </font></td><td> <div id="holdDateDivId"></div></td></tr><tr><td width=600px>&nbsp;&nbsp;<font size="3"><b>No. of Passengers :    '+5+'</b> </font></td><td> <div id="holdDateDivId"></div></td></tr></table><br><br>'}}}