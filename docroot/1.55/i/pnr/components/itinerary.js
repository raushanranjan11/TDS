{xtype:"panel",bodyStyle:"padding: 8px;",layout:"form",autoScroll:true,items:[{xtype:"combo",name:"id",fieldLabel:"Passnger Name",emptyText:"ALL",excludeSubmit:true,enableKeyEvents:true,mode:"local",width:195,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"displayName",valueField:"dataURI",store:new Ext.data.SimpleStore({storeId:"commonStore",fields:["displayName","dataURI"],data:[]}),appendData:[{displayName:"",dataURI:""}],listeners:{render:function(){;var d=this.ownerCt.findParentByType("ajaxpanel");var a=d.baseDataURI;if(!a){return}var c=this;this.store.removeAll();var b=TDS.data.getStore({dataURI:TDS.env.dataPath+a+"/passengers/collection",identifier:a+"/passengers",fields:["displayName","dataURI"]});setTimeout(function(){c.bindStore(b)},1000)}}},{xtype:"combo",fieldLabel:"Display format",name:"itineraryDisplayType",mode:"local",width:195,triggerAction:"all",editable:false,excludeFromSession:true,displayField:"description",valueField:"value",value:0,store:TDS.data.itineraryDisplay},{border:false,style:"padding: 8px 0;",html:"<p>The PNR itinerary is available to download as a rich text format (RTF) document.</p>"},{xtype:"panel",border:false,layout:"column",items:[{xtype:"panel",columnWidth:0.34,border:false,items:{xtype:"button",align:"left",text:"Download PNR itinerary",handler:function(){var d=this.ownerCt.findParentByType("ajaxpanel");var c=d.baseDataURI;if(!c){return}var g=this.ownerCt.ownerCt.ownerCt.items.itemAt(0).getValue();var a=this.ownerCt.ownerCt.ownerCt.items.itemAt(1).getValue();var g=g.split("passenger/");var j=null;for(var e=0;e<g.length;e++){j=g[1]}var f=TDS.env.currentDomain;var h="/GraphicsImg/voucher/";var b="";if(typeof g!="undefined"&&g!=""){b=TDS.env.dataPath+c+"/itinerary?itineraryDisplayType="+a+"&passengerId="+j}else{b=TDS.env.dataPath+c+"/itinerary?itineraryDisplayType="+a}Ext.Ajax.request({url:b,jsonData:{currentDomain:f},method:"PUT",scope:this,callback:function(n,k,m){var l=Ext.decode(m.responseText);fileName=l.fileName;filepathh=l.filepath;h=h+fileName+".rtf";var i=window.open(h,"Information Priview","height=500,width=800,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=yes,menubar=no,location=no,directories=no,status=yes");i.focus()}})}}},{xtype:"panel",columnWidth:0.66,border:false,items:{xtype:"button",style:"width:3600px",text:"&nbsp;&nbsp;Send PNR Itinerary&nbsp;&nbsp;",handler:function(){;var r=this.ownerCt.ownerCt.ownerCt;var z=r.items.itemAt(0).getValue();var j=r.items.itemAt(1).getValue();var z=z.split("passenger/");var g=null;for(var x=0;x<z.length;x++){g=z[1]}var b="";var C="";var u="";var a=r.items.itemAt(4);var l=a.items.itemAt(3);var c=l.getValue();if(c==""){Ext.Msg.alert("","Send To empty, enter Send To and retry.",function(){l.focus()});return}else{c=c.replace(",",";");c=c.replace(" ","")}var t=a.items.itemAt(6);var y=t.getValue();if(y==""){Ext.Msg.alert("","Message subject empty, enter message subject and retry.",function(){t.focus()});return}else{y=y.replace("&"," ")}var d=a.items.itemAt(7);var B=d.getValue();if(B==""){Ext.Msg.alert("","Message body empty, enter message body and retry.",function(){d.focus()});return}else{B=B.replace("&nbsp;"," ");B=B.replace("&"," ")}var q=a.items.itemAt(4);var v=a.items.itemAt(4).getValue();v=v.replace(",",";");v=v.replace(" ","");var A=document.getElementById("attachmentFileUpLoad").files[0];var f=document.getElementById("attachmentFileUpLoad").value;f=f.substring(f.lastIndexOf("\\")+1);var s=this.ownerCt.findParentByType("ajaxpanel");var e="";if(typeof z!="undefined"&&z!=""){e=TDS.env.dataPath+s.baseDataURI+"/itinerary?itineraryDisplayType="+j+"&passengerId="+g}else{e=TDS.env.dataPath+s.baseDataURI+"/itinerary?itineraryDisplayType="+j}var o=TDS.env.currentDomain;r.el.mask("","x-mask-loading");Ext.Ajax.request({url:e,jsonData:{currentDomain:o},method:"PUT",scope:this,callback:function(E,i,D){if(i){var p=Ext.decode(D.responseText);C=p.fileName;filepathh=p.filepath;C=C+".rtf";u="Arena Documention <arena.doc@tdsworld.com>";h()}else{r.el.unmask();Ext.Msg.alert("","Mail sending faild try later..")}}});function h(){var i=new FormData();i.append("attachment",A);var p=new XMLHttpRequest();p.upload.addEventListener("progress",m,false);p.addEventListener("load",w,false);p.addEventListener("error",k,false);p.addEventListener("abort",n,false);p.open("POST",TDS.env.dataPath+"sendMailWithItineraryAttachment?&filepathh="+filepathh+"&fileName="+C+"&messageBodyString="+B+"&messageSubjectString="+y+"&from="+u+"&to="+c+"&ccTo="+v+"&attachedFileName="+f);p.send(i);p.onreadystatechange=function(){if(p.readyState==4){var D=p.getAllResponseHeaders();var E=p.responseText;Ext.Msg.alert("",E,function(){if(E=="Mail sent successfully."){q.setValue("");d.setValue("");t.setValue("");l.setValue("");document.getElementById("attachmentFileUpLoad").value="";document.getElementById("attachmentFileUpLoad").files[0]=null}});r.el.unmask()}}}function m(i){}function w(i){}function k(i){Ext.Msg.alert("","There was an error attempting to upload the file.")}function n(i){Ext.Msg.alert("","The upload has been canceled by the user or the browser dropped the connection.")}}}}]},{xtype:"panel",layout:"form",height:400,width:(document.body.clientWidth*0.45),border:false,defaults:{lableWidth:300},items:[{html:"&nbsp;",height:5,border:false},{html:"&nbsp;",height:5,border:false},{html:"&nbsp;",height:5,border:false},{xtype:"textfield",allowBlank:false,name:"to",fieldLabel:"Send To",anchor:"95%"},{xtype:"textfield",name:"ccTo",fieldLabel:"CC To",anchor:"95%"},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;",border:false,hideBorders:true,layoutConfig:{columns:4},items:[{xtype:"label",width:300,text:"Attachment:"},{html:'<form action="attachmentFileUpLoad" enctype="multipart/form-data" method="post"><table border= 0 with=100%><td width= 5% >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td width= 95%><input  width=100% name="attachmentFileUpLoad" id="attachmentFileUpLoad"type="file"  /></td></table></form>',width:270},{xtype:"button",text:"Remove attachment",handler:function(){document.getElementById("attachmentFileUpLoad").value="";document.getElementById("attachmentFileUpLoad").files[0]=null}}]},{xtype:"textfield",allowBlank:false,name:"subject",fieldLabel:"Subject",anchor:"95%"},{xtype:"htmleditor",name:"description",allowBlank:false,hideLabel:true,labelSeparator:"",enableLinks:true,enableLists:true,enableSourceEdit:false,enableFontSize:true,enableFont:true,enableColors:true,enableAlignments:true,height:200,width:(document.body.clientWidth*0.43)}]}]}