{xtype:"panel",height:100,border:false,bodyStyle:"padding: 8px;",items:{xtype:"panel",height:80,bodyStyle:"padding: 1px;",tpl:new Ext.XTemplate('<div style="height: 78px; overflow: auto;">','<table class="x-tds-listview" cellspacing="0">','<tr class="x-tds-listview-header">','<th class="first"></th>','<th style="width: 110px;">Gross</th>','<th style="width: 110px;">Comm %</th>','<th style="width: 110px;">Comm Amount</th>','<th style="width: 110px;">Nett</th>',"</tr>",'<tpl for=".">',"<tr>",'<td class="first">{[values.quantity ? values.quantity + "x " : ""]}</td><!-- {name}-->',"<td>{grossAmountString}</td>","<td>{commissionPercentage}</td><!-- passengersTotal-->","<td>{commissionAmountString}</td>","<td>{nettAmountString}</td>","</tr>","</tpl>","</table>","</div>"),isReady:function(){if(this.pnrComponentData&&this.pnrComponentExtraData){return true}return false},pnrComponentData:false,initPnrComponent:function(a){Ext.Ajax.request({url:TDS.env.dataPath+a,method:"GET",callback:function(g,b,d){if(b){try{var c=Ext.decode(d.responseText)}catch(f){}if(c){this.pnrComponentData=c}}if(this.isReady()){this.displayPnrComponentFinancials()}},scope:this})},pnrComponentExtraData:false,initPnrComponentExtras:function(a){Ext.Ajax.request({url:TDS.env.dataPath+a+"/extras/collection",method:"GET",callback:function(c,m,b){if(m){try{var j=Ext.decode(b.responseText)}catch(k){}if(j){var g=[],l=j[a+"/extras"];for(var h=0;h<l.length;h++){var d=l[h];var f=j[j[d]["extraURI"]];g[g.length]=Ext.apply(j[d],{name:f.name})}this.pnrComponentExtraData=g}if(this.isReady()){this.displayPnrComponentFinancials()}}},scope:this})},preparePnrComponentData:function(){var c=[];var a=this.pnrComponentData.pricingPriceCurrency;c[c.length]=this.processPriceData(this.pnrComponentData);for(var b=0;b<this.pnrComponentExtraData.length;b++){c[c.length]=this.processPriceData(this.pnrComponentExtraData[b])}return c},processPriceData:function(a){var b={name:a.name,quantity:a.quantity,grossAmount:a.pricingPriceSell,nettAmount:a.pricingPriceSell,commissionAmount:a.pricingPriceCommission,commissionPercentage:0};if(a.pricingPriceIsNett){b.grossAmount+=a.pricingPriceCommission}else{b.nettAmount-=a.pricingPriceCommission}b.commissionPercentage=Math.round((b.commissionAmount/b.grossAmount)*100);b.grossAmountString=TDS.util.Price.formatPrice(b.grossAmount,a.pricingPriceCurrency);b.nettAmountString=TDS.util.Price.formatPrice(b.nettAmount,a.pricingPriceCurrency);b.commissionAmountString=TDS.util.Price.formatPrice(b.commissionAmount,a.pricingPriceCurrency);return b},displayPnrComponentFinancials:function(){this.el.unmask();var a=this.preparePnrComponentData();this.tpl.overwrite(this.body,a)},listeners:{render:function(){this.el.mask("","x-mask-loading");var b=this.ownerCt.findParentByType("ajaxpanel");var a=b.rowRecordData.dataURI;if(!a){return}this.initPnrComponent(a);this.initPnrComponentExtras(a)}}}}