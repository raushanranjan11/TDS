{xtype:"panel",layout:"column",bodyStyle:"padding: 6px 4px 6px 4px;",border:false,defaults:{border:false,hideBorders:true},items:[{columnWidth:1,defaults:{border:false,hideBorders:true},items:[{xtype:"panel",layout:"column",defaults:{columnWidth:0.5,border:false,hideBorders:true},width:500,items:[{columnWidth:0.5,style:"padding: 2px 4px 2px 4px;",items:{xtype:"form",defaults:{width:120},items:{xtype:"combo",border:false,fieldLabel:"Primary location",name:"primaryLocation",mode:"local",forceSelection:true,typeAhead:true,minChars:1,queryDelay:10,valueNotFoundText:"...",triggerAction:"all",emptyText:"...",displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:"d/locations.js",identifier:"locations",fields:["name"]})}}},{columnWidth:0.5,style:"padding: 2px 4px 2px 4px;",items:{xtype:"form",defaults:{width:120},items:{xtype:"combo",border:false,fieldLabel:"Primary passenger",name:"primaryPassenger",mode:"local",forceSelection:true,typeAhead:true,minChars:1,queryDelay:10,valueNotFoundText:"...",triggerAction:"all",emptyText:"...",displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:"d/locations.js",identifier:"locations",fields:["name"]})}}}]},{xtype:"panel",style:"padding: 2px 4px 2px 4px;",items:{xtype:"calendar",length:5}},{xtype:"panel",style:"padding: 2px 4px 2px 4px;",items:{listeners:{render:function(){this.html="<p>Created yesterday 2.30pm by John Smith, modified today 4.50pm"+("John Smith"=="John Smith"?"":" by John Smith")+".</p>"}}}}]},{width:302,items:{xtype:"panel",layout:"column",width:302,defaults:{border:false,hideBorders:true},items:[{width:210,layout:"fit",style:"padding: 2px 4px 2px 4px;",items:{xtype:"editorgrid",hideHeaders:true,height:70,delay:2000,dt:new Ext.util.DelayedTask(),store:new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:""}),reader:new Ext.data.CollectionReader({identifier:"",fields:[{name:"code"},{name:"nameFirst"},{name:"nameLast"}]})}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{dataIndex:"code",width:40,fixed:true,editor:new Ext.form.ComboBox({triggerAction:"all",store:["AD","CN","CH","IN"]})},{dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false})},{dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false})}]),viewConfig:{forceFit:true},getPassengers:function(){this.getStore().reader.meta.identifier=this.destinationDataURI;this.getStore().proxy.conn.url=TDS.env.dataPath+this.destinationDataURI+"/concise";this.getStore().load()},submit:function(){this.dt.cancel();this.dt.delay(this.delay,this.submitUpdate,this)},submitUpdate:function(){var c=this.getStore().getModifiedRecords();for(var d=0;d<c.length;d++){var b=c[d];var a=b.get("dataURI");var e=b.getChanges();if(a&&e){if(e.code){e.type=e.code;delete e.code}Ext.Ajax.request({url:TDS.env.dataPath+a,method:"PUT",jsonData:e,record:b,callback:function(i,f,h){if(f&&i.record){var g=Ext.decode(h.responseText);if(i.record.get("code")!=g.code){i.record.set("code",g.code)}i.record.commit()}},scope:this})}}},listeners:{render:function(b){var a=this.ownerCt.findParentByType("ajaxpanel");this.destinationDataURI=a.ownerCt.getDataURI()+"/passengers";this.getPassengers()},afteredit:function(a){this.submit()}}}},{xtype:"panel",layout:"form",width:76,style:"padding: 2px 4px 2px 4px;",getGrid:function(){return this.ownerCt.items.itemAt(0).items.itemAt(0)},items:[{xtype:"button",text:"Add",style:"padding-bottom: 2px;",minWidth:60,handler:function(a,c){var b=this.ownerCt.getGrid();TDS.window.setWindow({title:"Create passenger",interfaceURI:"pnr/passenger/create.js",postDataURI:b.destinationDataURI,buttonOK:"Submit",callback:{fn:function(d){if(d){b.getPassengers()}},scope:b}})}},{xtype:"button",text:"Details",style:"padding-bottom: 2px;",minWidth:60,handler:function(b,f){var d=this.ownerCt.getGrid();var c=d.selModel.getSelected();if(!c){return}var a=c.get("dataURI");TDS.window.setWindow({title:"Edit passenger",interfaceURI:"pnr/passenger/edit.js",sourceDataURI:a,destinationDataURI:a,buttonOK:"Submit",callback:{fn:function(e){if(e){d.getPassengers()}},scope:d}})}},{xtype:"button",text:"Remove",style:"padding-bottom: 2px;",minWidth:60,handler:function(a,d){var c=this.ownerCt.getGrid();var b;while(b=c.selModel.getSelected()){c.store.remove(b)}}}]}]}}]}