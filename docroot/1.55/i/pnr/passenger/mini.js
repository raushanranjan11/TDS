{xtype:"panel",border:false,width:700,trackResetOnLoad:true,beforeSubmit:function(b){var d=this.items.itemAt(0).items.itemAt(0).items.itemAt(0);var e=[];var f=d.getStore().data.items;var a=d.getStore().data.length;for(var c=0;c<a;c++){e[c]=f[c].data}b.passengers=e;return b},items:{xtype:"tabpanel",border:false,activeTab:0,height:300,items:[{title:"Passengers",bodyStyle:"padding: 8px;",layout:"fit",items:{xtype:"editorgrid",store:new Ext.data.JsonStore({fields:["type","salutation","nameFirst","nameLast","departureDate","phoneNumber1","emailAddress"]}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Type",dataIndex:"type",width:90,fixed:true,editor:new Ext.form.ComboBox({editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text",tpl:'<tpl for="."><div class="x-combo-list-item">{text}, <span style="font-style: italic; font-size: 10px; color: #999;">{description}</span></div></tpl>',store:TDS.data.passengerType})},{header:"Family name",dataIndex:"nameLast",editor:new Ext.form.TextField({allowBlank:false}),renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"First name",dataIndex:"nameFirst",editor:new Ext.form.TextField({allowBlank:false}),renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"Title",dataIndex:"salutation",width:90,fixed:true,editor:new Ext.form.ComboBox({store:TDS.data.salutations,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text"})},{header:"Mobile no.",dataIndex:"phoneNumber1",editor:new Ext.form.TextField({allowBlank:false})},{header:"email",dataIndex:"emailAddress",editor:new Ext.form.TextField({allowBlank:false})},{header:"Departure Date",dataIndex:"departuresDate",editor:new Ext.form.DateField({allowBlank:false})}]),viewConfig:{forceFit:true},bbar:[{xtype:"button",text:"Add",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({type:"AD",salutation:"",nameFirst:"",nameLast:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",handler:function(){var b=this.ownerCt.ownerCt,a;while(a=b.selModel.getSelected()){b.store.remove(a)}}}],getData:function(){var a=this.getStore();if(a.getCount()==0){return false}var b=[];a.each(function(c){b.push({method:"POST",destinationDataURI:this.destinationDataURI,data:{type:c.data.type,salutation:c.data.salutation,nameFirst:c.data.nameFirst,nameLast:c.data.nameLast}})},this);return{data:b}},listeners:{render:function(){;var a=this.ownerCt.findParentByType("awesomewindow");a.buttons[0].enable(true);this.destinationDataURI=TDS.env.dataPath+a.aw.baseDataURI+"/passengers"}}}},{title:"Recall Passengers",width:700,layout:"form",autoScroll:true,items:{xtype:"awesomegrid",alwaysUseCollection:true,width:676,tbar:["Family Name:"," ",{xtype:"textfield",name:"firstName",enableKeyEvents:true,excludeFromSession:true,width:80}," "," ","Phone No:"," ",{xtype:"textfield",name:"phoneNo",enableKeyEvents:true,excludeFromSession:true,width:80}," "," ","Email Id:"," ",{xtype:"textfield",name:"email",enableKeyEvents:true,excludeFromSession:true,width:80}," ","Show only Hidden",{xtype:"checkbox",name:"recallArchived",handler:function(){var a=this.ownerCt;var b=this.ownerCt.ownerCt.getSelections();if(this.checked){a.items.itemAt(19).setText("Restore");a.items.itemAt(17).disable(true)}else{a.items.itemAt(19).setText("Hide");a.items.itemAt(17).disable(true)}}},"->",{xtype:"redbutton",disabled:true,text:"Add",handler:function(){;var f=this.findParentByType("awesomewindow");f.buttons[0].enable(true);var j=this;var d=this.ownerCt.ownerCt;var l=d.getSelections();var e=d.findParentByType("tabpanel");var i=e.items.itemAt(0).items.itemAt(0);var h=i.getStore();if(h.getCount()>0){h.each(function(a){if(l[0].data.dataURI==a.data.dataURI){Ext.Msg.alert("Alert","Allreday Passenger added.");return false}else{k()}})}else{k()}function k(){for(var a=0;a<l.length;a++){h.add([new h.recordType({type:l[a].data.type,salutation:l[a].data.salutation,nameFirst:l[a].data.nameFirst,nameLast:l[a].data.nameLast,dataURI:l[a].data.dataURI})])}i.startEditing(h.getCount()-1,0);j.disable(true);e.setActiveTab(0)}}}," ",{xtype:"button",disabled:true,text:"Hide",handler:function(){;var u=this;var j=this.ownerCt;var d=!(j.items.itemAt(15).checked);var l=this.getText();var s=this.findParentByType("awesomewindow");var e=s.initialConfig.baseDataURI;var q=this.ownerCt.ownerCt;var p=q.getSelections();var s=q.findParentByType("tabpanel");var m=s.items.itemAt(0).items.itemAt(0);this.disable(true);;var n=p;var h=e;var r={};var f=new Array();for(var k=0;k<n.length;k++){f[k]=n[k].data.dataURI}r.passengerURIs=f;Ext.Msg.show({title:"Alert",msg:"Are you sure, want to "+l+" the passenger?",buttons:Ext.Msg.YESNO,fn:o,animEl:"elId",icon:Ext.MessageBox.QUESTION});function o(a){if(a=="yes"){Ext.Ajax.request({url:TDS.env.dataPath+h+"/recallArchived/"+d,method:"PUT",jsonData:r,callback:function(v,b,i){if(b){try{var c=u.ownerCt.ownerCt;c.submitQuery(true)}catch(t){}}}})}}}}],store:new Ext.data.JsonStore({url:"",id:"dataURI",fields:["type","salutation","nameFirst","nameLast","emailAddress","phoneNumber1","dataURI"]}),sm:new Ext.grid.CheckboxSelectionModel(),cm:new Ext.grid.ColumnModel([new Ext.grid.CheckboxSelectionModel(),{header:"Type",dataIndex:"type",width:100},{header:"Family name",dataIndex:"nameLast",width:100,renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"First name",dataIndex:"nameFirst",width:100,renderer:function(a,c,b){return a.substr(0,1).toUpperCase()+a.substr(1)}},{header:"Title",dataIndex:"salutation",width:100},{header:"Phone no",dataIndex:"phoneNumber1",width:100},{header:"Email Id",dataIndex:"emailAddress",width:100}]),viewConfig:{forceFit:true},listeners:{beforerender:function(){this.getStore().removeAll()},sessioninit:function(){var b=this.findParentByType("awesomewindow");var c=b.initialConfig.baseDataURI;this.searchURI=TDS.env.dataPath+c+"/AgencyPassengers"},render:function(){this.getSelectionModel().on("rowselect",function(){var a=this.items.itemAt(15).checked;if(!a){this.items.itemAt(17).setDisabled(false)}this.items.itemAt(19).setDisabled(false)},this.getTopToolbar());this.getSelectionModel().on("rowdeselect",function(){this.items.itemAt(17).setDisabled(true);this.items.itemAt(19).setDisabled(true)},this.getTopToolbar());this.getStore().removeAll()}}},listeners:{render:function(){;var a=this.ownerCt.findParentByType("awesomewindow");a.buttons[0].disable(true);var b=this.findParentByType("tabpanel")}}}],listeners:{tabchange:function(c,b){var a=this.ownerCt.findParentByType("awesomewindow");if(b.title=="Passengers"){a.buttons[0].enable(true)}else{a.buttons[0].disable(true)}}}}}