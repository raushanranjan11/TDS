{xtype:"form",border:false,width:750,trackResetOnLoad:true,beforeDataLoad:function(b,a){return b},getPassengerTab1:function(){return this.items.itemAt(0)},getPassengerDocumentsGrid:function(){return this.getPassengerTab1().items.itemAt(0).items.itemAt(0).items.itemAt(1)},getPassengerSsrGrid:function(){return this.getPassengerTab1().items.itemAt(1).items.itemAt(0)},getPassengerMemberShipGrid:function(){return this.getPassengerTab1().items.itemAt(2).items.itemAt(0).items.itemAt(0).items.itemAt(0)},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:425,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Documentation",items:{xtype:"panel",layout:"form",labelWidth:80,border:false,style:"padding: 2px;",items:[{xtype:"editorgrid",height:165,closeAction:"hide",loadMask:{msg:""},style:"padding-bottom: 12px;",viewConfig:{forceFit:true},store:new Ext.data.CollectionStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["dataURI","typeURI","value","extraInfo1"]}),getData:function(){var j=this.getStore().getModifiedRecords();var g=this.ownerCt.ownerCt.findParentByType("awesomewindow");var f=g.getConfigValue("sourceDataURI");var l=f.split("/")[1];for(var h=0,k=[];h<j.length;h++){var e=j[h].get("dataURI");e=e?e.replace("pnr","pnr/"+l):null;k.push({method:e?"PUT":"POST",destinationDataURI:e?TDS.env.dataPath+e:this.baseDataURI,data:{typeURI:j[h].get("typeURI"),value:j[h].get("value"),extraInfo1:j[h].get("extraInfo1")}})}return{data:k}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{dataIndex:"typeURI",header:"ID Type",renderer:TDS.util.Format.displayResourceNameRenderer(),editor:new Ext.form.ComboBox({mode:"local",triggerAction:"all",editable:false,displayField:"displayName",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"passenger/documenttypes/collection",identifier:"passenger/documenttypes",fields:["name","displayName","dataURI"]})})},{dataIndex:"value",header:"Number",editor:new Ext.form.TextField({allowBlank:false})},{dataIndex:"extraInfo1",header:"Notes",editor:new Ext.form.TextField({allowBlank:false})}]),bbar:[{xtype:"button",text:"Add",tooltip:"Click here to add a new document",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({typeURI:"",value:"",extraInfo1:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",tooltip:"Select a document and click here to remove",handler:function(){var i=this.ownerCt.ownerCt;var h=i.selModel.getSelected();if(!h){return}i.loadMask.show();if(h.get("dataURI")){var f=this.ownerCt.ownerCt.findParentByType("awesomewindow");var e=f.getConfigValue("sourceDataURI");var j=e.split("/")[1];var d=h.get("dataURI");d=d?d.replace("pnr","pnr/"+j):null;Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+d,callback:function(c,a,b){i.loadMask.hide();if(a){i.store.remove(h);return}}})}else{i.loadMask.hide();i.store.remove(h)}}}],listeners:{render:function(){var w=this.ownerCt.findParentByType("awesomewindow");if(w){w.registerItem(this.id);var dataURI=w.getConfigValue("sourceDataURI")+"/documents";var collectionDataURI=TDS.env.dataPath+dataURI+"/collection";this.baseDataURI=TDS.env.dataPath+dataURI;with(this.store){reader.meta.identifier=dataURI;proxy.conn.url=collectionDataURI;load()}}}}},{xtype:"textfield",name:"nationalityCountry",fieldLabel:"Nationality",width:150},{layout:"table",layoutConfig:{columns:5},labelWidth:110,border:false,defaults:{border:false},style:"padding: 2px;",items:[{html:"Country of Birth:",width:Ext.isIE?80:83},{xtype:"combo",width:150,name:"ppCountryOfBirthURI",fieldLabel:"Country of Birth",hideTrigger:false,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection/custom",identifier:"countries",fields:["name","dataURI"]})},{html:" ",width:Ext.isIE?10:13},{html:"Location:",width:Ext.isIE?80:83},{xtype:"combo",width:200,name:"documentationLocation",fieldLabel:"Location",editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text",store:TDS.data.documentLocation}]},{layout:"table",defaults:{border:false},layoutConfig:{columns:5},labelWidth:110,border:false,style:"padding: 2px;",items:[{html:"Passport No:",width:Ext.isIE?80:83},{xtype:"textfield",name:"ppNo",fieldLabel:"Passport No",width:150},{html:" ",width:Ext.isIE?10:13},{html:"Notes:",width:Ext.isIE?80:83},{xtype:"textfield",name:"ppNotes",fieldLabel:"Notes",width:200}]},{layout:"table",defaults:{border:false},layoutConfig:{columns:5},labelWidth:110,border:false,style:"padding: 2px;",items:[{html:"Date of Issue:",width:Ext.isIE?80:83},{xtype:"datefield",name:"ppIssuedDate",fieldLabel:"Date of issue",format:"dMy",maxValue:new Date(),width:80},{html:" ",width:Ext.isIE?80:83},{html:"Date of Expiry:",width:Ext.isIE?80:83},{xtype:"datefield",name:"ppExpiryDate",fieldLabel:"Date of Expiry",format:"dMy",minValue:new Date(),width:80}]}]}},{title:"SSR",bodyStyle:"padding: 2px;",items:[{xtype:"editorgrid",style:"padding: 2px;",height:160,loadMask:{msg:""},viewConfig:{forceFit:true},store:new Ext.data.CollectionStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["dataURI","ssr"]}),getData:function(){var j=this.getStore().getModifiedRecords();var g=this.ownerCt.ownerCt.findParentByType("awesomewindow");var f=g.getConfigValue("sourceDataURI");var l=f.split("/")[1];for(var h=0,k=[];h<j.length;h++){var e=j[h].get("dataURI");e=e?e.replace("pnr","pnr/"+l):null;k.push({method:e?"PUT":"POST",destinationDataURI:e?TDS.env.dataPath+e:this.baseDataURI,data:{ssr:j[h].get("ssr")}})}return{data:k}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{dataIndex:"ssr",header:"Special Service Request",editor:new Ext.form.ComboBox({getValue:function(){return(this.getRawValue())},mode:"local",triggerAction:"all",forceSelection:false,validateOnBlur:false,displayField:"value",valueField:"text",store:TDS.data.passengerSpecialServiceRequests,tpl:'<tpl for="."><div class="x-combo-list-item">{text}</div></tpl>'})}]),bbar:[{xtype:"button",text:"Add",tooltip:"Click here to add a new special service request",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({ssr:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",tooltip:"Select a special service request and click here to remove",handler:function(){var i=this.ownerCt.ownerCt;var h=i.selModel.getSelected();if(!h){return}i.loadMask.show();if(h.get("dataURI")){var f=this.ownerCt.ownerCt.findParentByType("awesomewindow");var e=f.getConfigValue("sourceDataURI");var j=e.split("/")[1];var d=h.get("dataURI");d=d?d.replace("pnr","pnr/"+j):null;Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+d,callback:function(c,a,b){i.loadMask.hide();if(a){i.store.remove(h);return}}})}else{i.loadMask.hide();i.store.remove(h)}}}],listeners:{render:function(){var w=this.ownerCt.findParentByType("awesomewindow");if(w){w.registerItem(this.id);var dataURI=w.getConfigValue("sourceDataURI")+"/ssrs";var collectionDataURI=TDS.env.dataPath+dataURI+"/collection";this.baseDataURI=TDS.env.dataPath+dataURI;with(this.store){reader.meta.identifier=dataURI;proxy.conn.url=collectionDataURI;load()}}}}},{xtype:"textarea",height:230,width:736,emptyText:"Enter SSR free form Text..",name:"ssrNotes"}]},{title:"Memberships",items:{xtype:"panel",layout:"table",layoutConfig:{columns:1},labelWidth:160,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"panel",layout:"fit",border:true,autoScroll:true,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"editableGrid",alwaysUseCollection:true,width:720,height:120,border:false,getData:function(){var j=this.getStore().getModifiedRecords();var g=this.ownerCt.ownerCt.findParentByType("awesomewindow");var f=g.getConfigValue("sourceDataURI");var l=f.split("/")[1];for(var h=0,k=[];h<j.length;h++){var e=j[h].get("dataURI");e=e?e.replace("pnr","pnr/"+l):null;k.push({method:e?"PUT":"POST",destinationDataURI:e?TDS.env.dataPath+e:this.baseDataURI,data:{cardNumber:j[h].get("cardNumber"),club:j[h].get("club"),expiryDate:j[h].get("expiryDate"),supplierNames:j[h].get("supplierNames"),supplierName:j[h].get("supplierName"),serviceType:j[h].get("serviceType"),password:j[h].get("password"),pin:j[h].get("pin")}})}return{data:k}},tbar:[" "," ",{xtype:"combo",name:"supplierNames",emptyText:"Suppliers",hidden:true,minChars:1,enableKeyEvents:true,mode:"local",width:150,typeAhead:true,excludeFromSession:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"airline/collection",identifier:"airline",fields:["name","dataURI"]}),appendData:[{name:"",dataURI:""}]}],store:new Ext.data.CollectionStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["serviceType","club","password","pin","cardNumber","supplierName","supplierURI","PassengerURI","expiryDate","dataURI"]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{header:"Passenger Name",dataIndex:"passengerName",hidden:true,width:150,renderer:TDS.util.Format.displayResourceConciseNameRenderer(),editor:new Ext.form.TextField({allowBlank:false})},{header:"Supplier",dataIndex:"supplierName",width:150,renderer:TDS.util.Format.displayResourceConciseNameRenderer(),editor:new Ext.form.TextField({allowBlank:false})},{header:"Club",dataIndex:"club",width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:"Membership No",dataIndex:"cardNumber",width:100,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Password",dataIndex:"password",width:80,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Pin",dataIndex:"pin",width:50,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Card No",dataIndex:"cardNumber",width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:"Type",dataIndex:"serviceType",width:100,editor:new Ext.form.TextField({allowBlank:false})},{header:"Expiry Date",dataIndex:"expiryDate",width:100,renderer:function(c,b,a){var d=TDS.util.Format.dateSpecial(a.get("expiryDate"),TDS.env.dateFormatDisplay);return d},editor:new Ext.form.DateField({format:"dMy",allowBlank:false})}]),viewConfig:{forceFit:true},listeners:{beforerender:function(){},render:function(){var w=this.ownerCt.findParentByType("awesomewindow");if(w){w.registerItem(this.id);var dataURI=w.getConfigValue("sourceDataURI")+"/passengerMemberships";var collectionDataURI=TDS.env.dataPath+dataURI+"/collection";this.baseDataURI=TDS.env.dataPath+dataURI;with(this.store){reader.meta.identifier=dataURI;proxy.conn.url=collectionDataURI;load()}}}}}]},{xtype:"panel",layout:"table",border:false,width:500,height:300,style:"padding-top: 15px;",layoutConfig:{columns:2},items:[{width:250,height:300,border:false,layout:"form",defaultType:"textfield",labelWidth:80,items:[{xtype:"combo",name:"supplier",emptyText:"Suppliers",excludeSubmit:true,minChars:1,enableKeyEvents:true,mode:"local",width:150,typeAhead:true,fieldLabel:"Supplier",triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"airline/collection",identifier:"airline",fields:["name","dataURI"]})},{name:"club",fieldLabel:"Club",width:150},{name:"cardNumber",fieldLabel:"Membership No",width:150},{name:"serviceType",fieldLabel:"Type",width:150},{xtype:"datefield",name:"expiryDate",format:"dMy",fieldLabel:"Expiry Date",width:70},{fieldLabel:"Password",inputType:"password",width:150},{fieldLabel:"Pin",inputType:"password",width:150}]},{xtype:"panel",border:false,layout:"form",width:250,height:300,labelWidth:20,defaults:{minWidth:60},items:[{xtype:"textfield",fieldLabel:"<b>Or",labelSeparator:"",emptyText:"Enter the supplier Name",border:false,width:200},{html:"",border:false,height:30},{xtype:"formredbutton",text:"Save",style:"margin-left: 20px;",handler:function(){var n=this.ownerCt.findParentByType("awesomewindow");var d=n.initialConfig.sourceDataURI;var m={};var p=this.ownerCt.ownerCt.items.itemAt(0).items;var i=this.ownerCt.ownerCt.items.itemAt(1).items;var q=p.itemAt(0);var o=i.itemAt(0);var j=p.itemAt(1);var c=p.itemAt(2);var k=p.itemAt(3);var h=p.itemAt(4);var b=p.itemAt(5);var a=p.itemAt(6);m.cardNumber=c.getValue();m.club=j.getValue();m.expiryDate=h.getValue();m.supplierNames=q.getValue();m.supplierName=o.getValue();m.serviceType=k.getValue();m.password=b.getValue();m.pin=a.getValue();var e=q.getRawValue()?q.getRawValue():o.getValue();if((m.cardNumber!=null&&m.cardNumber!="")&&(m.club!=null&&m.club!="")&&(m.expiryDate!=null&&m.expiryDate!="")&&(m.serviceType!=null&&m.serviceType!="")&&(m.password!=null&&m.password!="")&&(m.pin!=null&&m.pin!="")&&(e!=null&&e!="")){var f=this.ownerCt.ownerCt.ownerCt.items.itemAt(0).items.itemAt(0);var l=f.getStore();Ext.Ajax.request({url:TDS.env.dataPath+d+"/passengerMembership",method:"POST",disableCaching:false,jsonData:m,callback:function(v,g,t){if(g){var u=t.responseText;l.add([new l.recordType({cardNumber:c.getValue(),club:j.getValue(),expiryDate:h.getValue(),supplierName:q.getRawValue()?q.getRawValue():o.getValue(),serviceType:k.getValue(),dataURI:u,password:b.getValue(),pin:a.getValue()})]);q.setValue("");o.setValue("");j.setValue("");c.setValue("");k.setValue("");h.setValue("");b.setValue("");a.setValue("");f.loadMask.hide()}}})}}},{html:"",border:false,height:10},{xtype:"button",style:"margin-left: 20px;",text:"Remove",tooltip:"Select a Membership and click here to remove",handler:function(){var i=this.ownerCt.ownerCt.ownerCt.items.itemAt(0);var h=i.selModel.getSelected();if(!h){return}i.loadMask.show();if(h.get("dataURI")){var f=this.ownerCt.ownerCt.findParentByType("awesomewindow");var e=f.getConfigValue("sourceDataURI");var j=e.split("/")[1];var d=h.get("dataURI");d=d?d.replace("pnr","pnr/"+j):null;Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+d,callback:function(c,a,b){i.loadMask.hide();if(a){i.store.remove(h);return}}})}else{i.loadMask.hide();i.store.remove(h)}}}]}]}]}}]}]}