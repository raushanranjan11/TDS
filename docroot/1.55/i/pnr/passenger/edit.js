{xtype:"form",border:false,width:670,trackResetOnLoad:true,items:{xtype:"tabpanel",border:false,defaults:{border:false},activeTab:0,layoutOnTabChange:true,height:340,items:[{title:"Details",items:{xtype:"panel",layout:"form",labelWidth:110,border:false,style:"padding: 8px;",defaultType:"textfield",items:[{xtype:"combo",store:TDS.data.salutations,name:"salutation",fieldLabel:"Salutation",width:90,editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text",value:"...",listeners:{select:function(){var a=this.getValue();if(a=="Mr"){this.ownerCt.items.itemAt(4).setValue(true);this.ownerCt.items.itemAt(5).setValue(false)}else{if(a=="Mrs"||a=="Ms"||a=="Miss"){this.ownerCt.items.itemAt(4).setValue(false);this.ownerCt.items.itemAt(5).setValue(true)}}}}},{name:"nameLast",fieldLabel:"Family name",width:200,style:"text-transform:capitalize"},{name:"namePreferred",fieldLabel:"Middle name",width:200,style:"text-transform:capitalize"},{name:"nameFirst",fieldLabel:"Given name",width:200,style:"text-transform:capitalize"},{xtype:"datefield",name:"dateOfBirth",fieldLabel:"Date of birth",showToday:false,width:90,format:TDS.env.dateBirthdayFormatDisplay,minValue:"01/01/1901",emptyText:"dd/mm/YYYY",listeners:{blur:function(){if(this.getRawValue()==""){this.ownerCt.items.itemAt(4).getEl().dom.removeAttribute("readOnly")}}},menuListeners:Ext.applyIf({select:function(d,c){Ext.form.DateField.prototype.menuListeners.select.call(this,d,c);var a=new Date();a.setTime(Ext.TimerMgr.getServerCalculatedTime());var b=Math.floor((a.getTime()-c.getTime())/(365.25*24*60*60*1000));this.ownerCt.items.itemAt(5).setValue(b);this.ownerCt.items.itemAt(5).getEl().dom.setAttribute("readOnly",true)}},Ext.form.DateField.prototype.menuListeners)},{xtype:"numberfield",name:"paxAge",fieldLabel:"Age",width:70},{xtype:"radio",name:"gender",fieldLabel:"Gender",forceSubmit:true,boxLabel:"Male",inputValue:"M",checked:true},{xtype:"radio",name:"gender",boxLabel:"Female",labelSeparator:"",inputValue:"F"},{xtype:"checkbox",disabled:true,name:"registeredForMobile",fieldLabel:"Registered for Mobile",labelSeparator:""}]}},{title:"Address",items:{xtype:"panel",layout:"form",labelWidth:110,border:false,style:"padding: 8px;",defaultType:"textfield",items:[{name:"addressLine1",fieldLabel:"Address",width:200},{name:"addressLine2",labelSeparator:"",width:200},{name:"locality",fieldLabel:"Locality",width:200},{name:"state",fieldLabel:"State",width:100},{name:"postcode",fieldLabel:"Postcode",width:50},{xtype:"combo",name:"countryURI",fieldLabel:"Country",emptyText:"Type a country...",minChars:1,enableKeyEvents:true,hideTrigger:true,mode:"local",width:160,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection/custom",identifier:"countries",fields:["name","dataURI"]})}]}},{title:"Contact",items:{xtype:"panel",layout:"form",labelWidth:110,border:false,style:"padding: 8px;",defaultType:"textfield",items:[{name:"phoneNumber1",fieldLabel:"Telephone Home",width:100},{name:"phoneNumber3",fieldLabel:"Telephone Work",width:100},{name:"skypeAddress",fieldLabel:"Skype",width:250},{name:"phoneNumber2",fieldLabel:"Mobile",width:100},{name:"fax",fieldLabel:"Fax",width:100},{name:"emailAddress",fieldLabel:"Email",width:250},{name:"emailAddress2",fieldLabel:"Email 2",width:250}]}},{title:"Documentation",items:{xtype:"panel",layout:"form",labelWidth:80,border:false,style:"padding: 2px;",items:[{xtype:"editorgrid",height:165,style:"padding-bottom: 12px;",loadMask:{msg:""},viewConfig:{forceFit:true},store:new Ext.data.CollectionStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["dataURI","typeURI","value","extraInfo1","countryOfBirth","dateOfIssue","dateOfExpiry"]}),getData:function(){var j=this.getStore().getModifiedRecords();var g=this.ownerCt.ownerCt.findParentByType("awesomewindow");var f=g.getConfigValue("sourceDataURI");var l=f.split("/")[1];for(var h=0,k=[];h<j.length;h++){var e=j[h].get("dataURI");e=e?e.replace("pnr","pnr/"+l):null;k.push({method:e?"PUT":"POST",destinationDataURI:e?TDS.env.dataPath+e:this.baseDataURI,data:{typeURI:j[h].get("typeURI"),value:j[h].get("value"),extraInfo1:j[h].get("extraInfo1")}})}return{data:k}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{dataIndex:"typeURI",header:"ID Type",renderer:TDS.util.Format.displayResourceNameRenderer(),editor:new Ext.form.ComboBox({mode:"local",triggerAction:"all",editable:false,displayField:"displayName",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"passenger/documenttypes/collection",identifier:"passenger/documenttypes",fields:["name","displayName","dataURI"]})})},{dataIndex:"value",header:"Number",editor:new Ext.form.TextField({allowBlank:false})},{dataIndex:"extraInfo1",header:"Notes",editor:new Ext.form.TextField({allowBlank:false})}]),bbar:[{xtype:"button",text:"Add",tooltip:"Click here to add a new document",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({typeURI:"",value:"",extraInfo1:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",tooltip:"Select a document and click here to remove",handler:function(){var i=this.ownerCt.ownerCt;var h=i.selModel.getSelected();if(!h){return}i.loadMask.show();if(h.get("dataURI")){var f=this.ownerCt.ownerCt.findParentByType("awesomewindow");var e=f.getConfigValue("sourceDataURI");var j=e.split("/")[1];var d=h.get("dataURI");d=d?d.replace("pnr","pnr/"+j):null;Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+d,callback:function(c,a,b){i.loadMask.hide();if(a){i.store.remove(h);return}}})}else{i.loadMask.hide();i.store.remove(h)}}}],listeners:{render:function(){var w=this.ownerCt.findParentByType("awesomewindow");if(w){w.registerItem(this.id);var dataURI=w.getConfigValue("sourceDataURI")+"/documents";var collectionDataURI=TDS.env.dataPath+dataURI+"/collection";this.baseDataURI=TDS.env.dataPath+dataURI;with(this.store){reader.meta.identifier=dataURI;proxy.conn.url=collectionDataURI;load()}}}}},{xtype:"textfield",name:"nationalityCountry",fieldLabel:"Nationality",width:150},{layout:"table",layoutConfig:{columns:5},labelWidth:110,border:false,defaults:{border:false},style:"padding: 2px;",items:[{html:"Country of Birth:",width:Ext.isIE?80:83},{xtype:"combo",width:150,name:"ppCountryOfBirthURI",fieldLabel:"Country of Birth",hideTrigger:false,mode:"local",typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection/custom",identifier:"countries",fields:["name","dataURI"]})},{html:" ",width:Ext.isIE?10:13},{html:"Location:",width:Ext.isIE?80:83},{xtype:"combo",width:200,name:"documentationLocation",fieldLabel:"Location",editable:false,forceSelection:true,mode:"local",triggerAction:"all",displayField:"text",valueField:"text",store:TDS.data.documentLocation}]},{layout:"table",defaults:{border:false},layoutConfig:{columns:5},labelWidth:110,border:false,style:"padding: 2px;",items:[{html:"Passport No:",width:Ext.isIE?80:83},{xtype:"textfield",name:"ppNo",fieldLabel:"Passport No",width:150},{html:" ",width:Ext.isIE?10:13},{html:"Notes:",width:Ext.isIE?80:83},{xtype:"textfield",name:"ppNotes",fieldLabel:"Notes",width:200}]},{layout:"table",defaults:{border:false},layoutConfig:{columns:5},labelWidth:110,border:false,style:"padding: 2px;",items:[{html:"Date of Issue:",width:Ext.isIE?80:83},{xtype:"datefield",name:"ppIssuedDate",fieldLabel:"Date of issue",format:"dMy",maxValue:new Date(),width:80},{html:" ",width:Ext.isIE?80:83},{html:"Date of Expiry:",width:Ext.isIE?80:83},{xtype:"datefield",name:"ppExpiryDate",fieldLabel:"Date of Expiry",format:"dMy",minValue:new Date(),width:80}]}]}},{title:"SSR",bodyStyle:"padding: 2px;",items:[{xtype:"editorgrid",style:"padding: 2px;",height:160,loadMask:{msg:""},viewConfig:{forceFit:true},store:new Ext.data.CollectionStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["dataURI","ssr"]}),getData:function(){var j=this.getStore().getModifiedRecords();var g=this.ownerCt.ownerCt.findParentByType("awesomewindow");var f=g.getConfigValue("sourceDataURI");var l=f.split("/")[1];for(var h=0,k=[];h<j.length;h++){var e=j[h].get("dataURI");e=e?e.replace("pnr","pnr/"+l):null;k.push({method:e?"PUT":"POST",destinationDataURI:e?TDS.env.dataPath+e:this.baseDataURI,data:{ssr:j[h].get("ssr")}})}return{data:k}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{dataIndex:"ssr",header:"Special Service Request",editor:new Ext.form.ComboBox({getValue:function(){return(this.getRawValue())},mode:"local",triggerAction:"all",forceSelection:false,validateOnBlur:false,displayField:"value",valueField:"text",store:TDS.data.passengerSpecialServiceRequests,tpl:'<tpl for="."><div class="x-combo-list-item">{text}</div></tpl>'})}]),bbar:[{xtype:"button",text:"Add",tooltip:"Click here to add a new special service request",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({ssr:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",tooltip:"Select a special service request and click here to remove",handler:function(){var i=this.ownerCt.ownerCt;var h=i.selModel.getSelected();if(!h){return}i.loadMask.show();if(h.get("dataURI")){var f=this.ownerCt.ownerCt.findParentByType("awesomewindow");var e=f.getConfigValue("sourceDataURI");var j=e.split("/")[1];var d=h.get("dataURI");d=d?d.replace("pnr","pnr/"+j):null;Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+d,callback:function(c,a,b){i.loadMask.hide();if(a){i.store.remove(h);return}}})}else{i.loadMask.hide();i.store.remove(h)}}}],listeners:{render:function(){var w=this.ownerCt.findParentByType("awesomewindow");if(w){w.registerItem(this.id);var dataURI=w.getConfigValue("sourceDataURI")+"/ssrs";var collectionDataURI=TDS.env.dataPath+dataURI+"/collection";this.baseDataURI=TDS.env.dataPath+dataURI;with(this.store){reader.meta.identifier=dataURI;proxy.conn.url=collectionDataURI;load()}}}}},{xtype:"textarea",height:110,width:590,emptyText:"Enter SSR free form Text..",name:"ssrNotes"}]},{title:"Memberships",layout:"fit",items:{xtype:"panel",layout:"table",layoutConfig:{columns:1},labelWidth:110,border:false,style:"padding: 2px;",defaultType:"textfield",items:[{xtype:"editorgrid",style:"padding: 2px;",height:120,width:660,loadMask:{msg:""},viewConfig:{forceFit:true},store:new Ext.data.CollectionStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["serviceType","club","password","pin","cardNumber","supplierName","supplierURI","PassengerURI","expiryDate","dataURI"]}),getData:function(){var j=this.getStore().getModifiedRecords();var g=this.ownerCt.ownerCt.findParentByType("awesomewindow");var f=g.getConfigValue("sourceDataURI");var l=f.split("/")[1];for(var h=0,k=[];h<j.length;h++){var e=j[h].get("dataURI");e=e?e.replace("pnr","pnr/"+l):null;k.push({method:e?"PUT":"POST",destinationDataURI:e?TDS.env.dataPath+e:this.baseDataURI,data:{cardNumber:j[h].get("cardNumber"),club:j[h].get("club"),expiryDate:j[h].get("expiryDate"),supplierDataURI:j[h].get("supplierDataURI"),supplierName:j[h].get("supplierName"),serviceType:j[h].get("serviceType"),password:j[h].get("password"),pin:j[h].get("pin")}})}return{data:k}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{header:"Supplier",dataIndex:"supplierName",width:100,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Club",dataIndex:"club",width:100,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Membership No",dataIndex:"cardNumber",width:100,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Password",dataIndex:"password",width:100,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Pin",dataIndex:"pin",width:50,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Type",dataIndex:"serviceType",width:100,fixed:true,editor:new Ext.form.TextField({allowBlank:false})},{header:"Expiry Date",dataIndex:"expiryDate",width:70,fixed:true,editor:new Ext.form.DateField({format:"dMy",allowBlank:false}),renderer:function(c,b,a){var d=TDS.util.Format.dateSpecial(a.get("expiryDate"),TDS.env.dateFormatDisplay);return d}}]),listeners:{render:function(){var w=this.ownerCt.findParentByType("awesomewindow");if(w){w.registerItem(this.id);var dataURI=w.getConfigValue("sourceDataURI")+"/passengerMemberships";var collectionDataURI=TDS.env.dataPath+dataURI+"/collection";this.baseDataURI=TDS.env.dataPath+dataURI;with(this.store){reader.meta.identifier=dataURI;proxy.conn.url=collectionDataURI;load()}}}}},{xtype:"panel",layout:"table",border:false,width:500,height:300,style:"padding: 7px;",layoutConfig:{columns:2},items:[{width:250,height:300,border:false,layout:"form",defaultType:"textfield",labelWidth:80,items:[{xtype:"combo",name:"supplier",emptyText:"Suppliers",excludeSubmit:true,minChars:1,enableKeyEvents:true,mode:"local",width:150,typeAhead:true,fieldLabel:"Supplier",triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"suppliers/collection/concise",identifier:"suppliers",fields:["name","dataURI"]})},{name:"club",fieldLabel:"Club",width:150},{name:"cardNumber",fieldLabel:"Membership No",width:150},{name:"serviceType",fieldLabel:"Type",width:150},{xtype:"datefield",name:"expiryDate",format:"dMy",fieldLabel:"Expiry Date",width:70},{fieldLabel:"Password",inputType:"password",width:150},{fieldLabel:"Pin",inputType:"password",width:150}]},{xtype:"panel",border:false,layout:"form",width:250,height:300,labelWidth:20,defaults:{minWidth:60},items:[{xtype:"textfield",fieldLabel:"<b>Or",labelSeparator:"",emptyText:"Enter the supplier Name",border:false,width:200},{html:"",border:false,height:30},{xtype:"formredbutton",text:"Save",style:"margin-left: 20px;",handler:function(){var n=this.ownerCt.findParentByType("awesomewindow");var d=n.initialConfig.destinationDataURI;var m={};var q=this.ownerCt.ownerCt.items.itemAt(0).items;var i=this.ownerCt.ownerCt.items.itemAt(1).items;var o=q.itemAt(0);var p=i.itemAt(0);var j=q.itemAt(1);var c=q.itemAt(2);var k=q.itemAt(3);var h=q.itemAt(4);var b=q.itemAt(5);var a=q.itemAt(6);m.cardNumber=c.getValue();m.club=j.getValue();m.expiryDate=h.getValue();m.supplierDataURI=o.getValue();m.supplierName=p.getValue();m.serviceType=k.getValue();m.password=b.getValue();m.pin=a.getValue();var e=o.getRawValue()?o.getRawValue():p.getValue();if((m.cardNumber!=null&&m.cardNumber!="")&&(m.club!=null&&m.club!="")&&(m.expiryDate!=null&&m.expiryDate!="")&&(m.serviceType!=null&&m.serviceType!="")&&(m.password!=null&&m.password!="")&&(m.pin!=null&&m.pin!="")&&(e!=null&&e!="")){var f=this.ownerCt.ownerCt.ownerCt.items.itemAt(0);var l=f.getStore();f.loadMask.show();Ext.Ajax.request({url:TDS.env.dataPath+d+"/passengerMembership",method:"POST",disableCaching:false,jsonData:m,callback:function(v,g,t){if(g){var u=t.responseText;l.add([new l.recordType({cardNumber:c.getValue(),club:j.getValue(),expiryDate:h.getValue(),supplierName:o.getRawValue()?o.getRawValue():p.getValue(),serviceType:k.getValue(),dataURI:u,password:b.getValue(),pin:a.getValue()})]);o.setValue("");p.setValue("");j.setValue("");c.setValue("");k.setValue("");h.setValue("");b.setValue("");a.setValue("");f.loadMask.hide()}}})}}},{html:"",border:false,height:10},{xtype:"button",style:"margin-left: 20px;",text:"Remove",tooltip:"Select a Membership and click here to remove",handler:function(){var i=this.ownerCt.ownerCt.ownerCt.items.itemAt(0);var h=i.selModel.getSelected();if(!h){return}i.loadMask.show();if(h.get("dataURI")){var f=this.ownerCt.ownerCt.findParentByType("awesomewindow");var e=f.getConfigValue("sourceDataURI");var j=e.split("/")[1];var d=h.get("dataURI");d=d?d.replace("pnr","pnr/"+j):null;Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+d,callback:function(c,a,b){i.loadMask.hide();if(a){i.store.remove(h);return}}})}else{i.loadMask.hide();i.store.remove(h)}}}]}]}]}}]},listeners:{render:function(){TDS.data.getStore({dataURI:TDS.env.dataPath+"passenger/documenttypes/collection",identifier:"passenger/documenttypes",fields:["name","displayName","dataURI"]})}}}