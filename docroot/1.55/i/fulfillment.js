{xtype:"panel",layout:"fit",border:false,bodyStyle:"padding: 4px 19px 4px 4px;",autoScroll:true,getGrid:function(){return this.items.itemAt(0)},items:{xtype:"awesomegrid",id:"fullfillmentId",searchURI:"",enableRowExpander:true,sessionExpandedRows:true,tbar:["->",{xtype:"redbutton",text:"Payments",cls:"x-button-dodgerblue",overCls:"x-button-dodgerblue-over",handler:function(){var b=TDS.env.user.getSupplierURI();TDS.workArea.openFulfillmentPaymentTab("Payment Report","fulfillment/payment.js",b,TDS.env.sessionPath+"users")}}," ",{xtype:"redbutton",text:"Summary",cls:"x-button-green-tour",overCls:"x-button-green-over-tour",handler:function(){var h=this.ownerCt.ownerCt;var e=h.getSelections();if(e.length<=0){return}var g=e[0];g=g.data.PNRCode;var f=TDS.env.user.getSupplierURI();if(!f){return}Ext.Ajax.request({url:TDS.env.dataPath+f+"/summary?pnrCode="+g,method:"GET",disableCaching:false,callback:function(a,c,b){if(c){TDS.window.setWindow({title:"Price Summary for Manual Quotes.",data:{baseDataURI:b.responseText},interfaceURI:"summaryDisplay.js",buttonOK:false})}}})}}," ",{xtype:"redbutton",text:"Send Quotes",cls:"x-button-blue-tour",overCls:"x-button-blue-over-tour",handler:function(){var b=TDS.env.user.getSupplierURI();if(!b){return}TDS.window.setWindow({title:"Send Messages",message:"All the Edited Manual Quotes will be sent to the agencys, as Message.",destinationDataURI:b+"/sendMessageToAgency",buttonOK:"Submit"})}}," ",{xtype:"redbutton",text:"Voucher Issue",cls:"x-button-orange",overCls:"x-button-orange-over",disabled:true,handler:function(){var h=this.ownerCt.ownerCt;var j=h.getSelections();var a=j[0].data.dataURI;var g=this.getText();Ext.MessageBox.buttonText.yes="Cancel Voucher Issue";Ext.MessageBox.buttonText.no="OK";Ext.MessageBox.buttonText.cancel="Close";Ext.Msg.show({title:"Voucher issue",msg:"<b>Confirm voucher issue by Agent?</b>",buttons:Ext.Msg.YESNOCANCEL,fn:i,animEl:"elId",icon:Ext.MessageBox.QUESTION});function i(c,d,b){if(c=="yes"){Ext.Ajax.request({url:TDS.env.dataPath+""+a+"/archiveUnArchive",method:"PUT",headers:{"Content-Type":"application/json"},data:{voucher:false},disableCaching:false,callback:function(f,e,l){if(e){h.submitQuery(true)}},jsonData:{voucher:false},scope:this})}if(c=="no"){Ext.Ajax.request({url:TDS.env.dataPath+""+a+"/archiveUnArchive",method:"PUT",headers:{"Content-Type":"application/json"},data:{voucher:true},disableCaching:false,callback:function(f,e,l){if(e){h.submitQuery(true)}},jsonData:{voucher:true},scope:this})}if(c=="cancel"){}}}}," ",{xtype:"redbutton",text:"Archive",cls:"x-button-mediumblue",overCls:"x-button-mediumblue-over",disabled:true,handler:function(){var h=this.ownerCt.ownerCt;var j=h.getSelections();var a=j[0].data.dataURI;var g=this.getText();var i=!(h.topToolBar2.items.itemAt(23).checked);TDS.window.setWindow({title:g,message:"Are you sure you want to "+g+" ?",destinationDataURI:a+"/archiveUnArchive",data:{archived:i},callback:{fn:function(b){if(b){h.submitQuery(true)}},scope:h}})}}],tbar2:["Status: ",{xtype:"combo",name:"status",enableKeyEvents:true,lazyInit:false,width:100,mode:"local",forceSelection:true,typeAhead:true,minChars:1,queryDelay:10,triggerAction:"all",store:[["","All"],[TDS.data.componentStatus.STATUS_HELD,TDS.data.componentStatus.STATUS_HELD],[TDS.data.componentStatus.STATUS_CANCELLED,TDS.data.componentStatus.STATUS_CANCELLED],[TDS.data.componentStatus.STATUS_CANCEL_REQUESTED,TDS.data.componentStatus.STATUS_CANCEL_REQUESTED],[TDS.data.componentStatus.STATUS_CONFIRMED,TDS.data.componentStatus.STATUS_CONFIRMED],[TDS.data.componentStatus.STATUS_PART_CONFIRMED,TDS.data.componentStatus.STATUS_PART_CONFIRMED],[TDS.data.componentStatus.STATUS_REJECTED,TDS.data.componentStatus.STATUS_REJECTED],[TDS.data.componentStatus.STATUS_QUOTE,TDS.data.componentStatus.STATUS_MANUAL_QUOTE_DISPLAY],[TDS.data.componentStatus.STATUS_REQUESTED,TDS.data.componentStatus.STATUS_REQUESTED],[TDS.data.componentStatus.STATUS_GUARANTEE,TDS.data.componentStatus.STATUS_GUARANTEE]]}," ","Type: ",{xtype:"combo",name:"componentType",enableKeyEvents:true,lazyInit:false,width:125,mode:"local",forceSelection:true,typeAhead:true,minChars:1,queryDelay:10,triggerAction:"all",store:[["","All"],[TDS.data.componentType.TYPE_ACCOMMODATION,TDS.data.componentType.TYPE_ACCOMMODATION],[TDS.data.componentType.TYPE_HOSTEL,TDS.data.componentType.TYPE_HOSTEL],[TDS.data.componentType.TYPE_TOUR,TDS.data.componentType.TYPE_TOUR],[TDS.data.componentType.TYPE_CAR,TDS.data.componentType.TYPE_CAR],[TDS.data.componentType.TYPE_RAIL,TDS.data.componentType.TYPE_RAIL],[TDS.data.componentType.TYPE_RAIL_PASS,TDS.data.componentType.TYPE_RAIL_PASS],[TDS.data.componentType.TYPE_AIR,TDS.data.componentType.TYPE_AIR],[TDS.data.componentType.TYPE_CRUISE,TDS.data.componentType.TYPE_CRUISE],[TDS.data.componentType.TYPE_ATTRACTION,TDS.data.componentType.TYPE_ATTRACTION_NEW],[TDS.data.componentType.TYPE_TRANSFER,TDS.data.componentType.TYPE_TRANSFER],[TDS.data.componentType.TYPE_SIGHTSEEING,TDS.data.componentType.TYPE_SIGHTSEEING_NEW]]}," ","Date from: ",{xtype:"datefield",name:"dateFromStart",enableKeyEvents:true,showToday:false,width:75,format:"dMy",defaultValue:new Date(),minValue:"01/01/06"}," ","to: ",{xtype:"datefield",name:"dateTill",enableKeyEvents:true,showToday:false,width:75,format:"dMy",minValue:"01/01/06"}," ","Location:",{xtype:"combo",name:"countryURI",emptyText:"Type a country...",excludeFromSession:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:100,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["dataURI","name","isoCode"]}),appendData:[{name:"",dataURI:""}]}," ",{xtype:"locationcombo",name:"locationURI",width:100,excludeFromSession:true,hideTrigger:false,listeners:{beforesearch:function(g){var h=this.ownerCt;var e=h.items.itemAt(13);var f=e.getValue().substring(e.getValue().lastIndexOf("/")+1);if(f==""){e.markInvalid("Please select a country.");return false}g.searchURI=TDS.env.dataPath+"country/"+f+"/locations/collection";g.searchIdentifier="country/"+f+"/locations"}}}," ","PNR code:",{xtype:"textfield",name:"pnrCode",enableKeyEvents:true,width:80}," ","Component name:",{xtype:"textfield",name:"componentName",enableKeyEvents:true,width:120}," ",{xtype:"checkbox",name:"archived",boxLabel:"Show only Archived",handler:function(){var b=this.ownerCt.ownerCt.topToolbar;b.items.itemAt(9).disable(true);if(this.checked){b.items.itemAt(9).setText("Recall")}else{b.items.itemAt(9).setText("Archive")}}}],store:new Ext.data.JsonStore({id:"dataURI",fields:["dataURI","agencyURI","offeringURI","quoteReferenceNumber","timeHeldUntil","description","type","voucherDate","supplierURI","name","dateFrom","dateTo","passengersTotal","status","createdDate","createdByUserFullNameString","updatedDate","updatedByUserFullNameString","supplierName","locationToString","locationFromString","airportToString","airportFromString","bookingReferenceNumber","pricingPriceCurrency","supplierParameters","pricingPriceSell","PNRCode","entryType","parameters","pricingPriceBaseSell","pricingPriceBaseCurrency","pricingPriceCommission","pricingPriceIsNett","duration","durationNights","extraNotes","startTime","finishTime","durationDays","packagePrice","cruisePackage","cruisePackagePrice","offerMade"],sortInfo:{field:"dateFrom",direction:"ASC"}}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:"Type",dataIndex:"type",width:100,fixed:true,renderer:function(b){if(b===TDS.data.componentType.TYPE_OWN){return"Own arrangement"}else{if(b===TDS.data.componentType.TYPE_MANUAL){return"Manual entry"}else{if(b===TDS.data.componentType.TYPE_SIGHTSEEING){return"Day Tour"}else{if(b===TDS.data.componentType.TYPE_ATTRACTION){return"Services"}}}}return b.substring(0,1).toUpperCase()+b.substring(1).toLowerCase()}},{header:"PNR Code",dataIndex:"PNRCode"},{header:"Component",dataIndex:"name"},{header:"From",dataIndex:"locationFromString",renderer:function(f,d,e){if(e.get("type")===TDS.data.componentType.TYPE_AIR){return e.get("airportFromString")}return f}},{header:"Date",dataIndex:"dateFrom",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"To",dataIndex:"locationToString",renderer:function(f,d,e){if(e.get("type")===TDS.data.componentType.TYPE_AIR){return e.get("airportToString")}return f}},{header:"Date",dataIndex:"dateTo",sortable:true,renderer:TDS.util.Format.dateSpecialRenderer(TDS.env.dateTimeFormatDisplay)},{header:"Duration",dataIndex:"duration"},{header:"Pax",dataIndex:"passengersTotal",width:40},{header:"Status",dataIndex:"status",width:100,renderer:function(h,e,f){var g=f.get("entryType");if(h=="Quote"&&g!="Manual Quote"){Ext.getCmp("has_quotes_id").setValue(true)}if(g=="Manual Quote"&&h=="Quote"){h+=" (M)"}else{if(g=="OA"){h="OA"}}return h}},{header:"Voucher",dataIndex:"voucherDate",width:100,renderer:function(g,e,f){var h=f.get("voucherDate");h=TDS.util.Format.dateSpecial(g,TDS.env.dateTimeFormatDisplay);if(h!=""){h=h.replace(" ","/");h='<font color="red">V-'+h+"</font>"}g=h;return g}},{header:"Offer Made",dataIndex:"offerMade",width:100,renderer:function(c,b,a){if(a.get("offerMade")){return'<input type="password" name="" style="border:#FFFFFF; display:compact; font:Verdana; font-weight: bold; background: none; div {text-align: lert; }; color:#ff0000" disabled value = "a">'}else{return""}}}]),viewConfig:{forceFit:true},listeners:{sessioninit:function(){this.searchURI=TDS.env.dataPath+TDS.env.user.getSupplierURI()+"/components"},beforequery:function(){var b=this.getTopToolbar();b.items.itemAt(7).setDisabled(true)},render:function(){var f=this.getTopToolbar();this.getSelectionModel().on("rowselect",function(){var a=this.getSelections()[0].data.status;if(a==TDS.data.componentStatus.STATUS_CONFIRMED){f.items.itemAt(7).setDisabled(false)}else{f.items.itemAt(7).setDisabled(true)}f.items.itemAt(9).setDisabled(false)},this);this.getSelectionModel().on("rowdeselect",function(){f.items.itemAt(7).setDisabled(true);f.items.itemAt(9).setDisabled(true)},this);var e=this.ownerCt.ownerCt;var d=e.getSession("focusRecord");if(typeof d!="undefined"){this.focusResult(d,false,true);TDS.session.setByPath("fulfillment",{focusRecord:""})}}},getRowInterface:function(e){var d=e.get("type");var f=e.get("entryType");if(f=="Manual Quote"){TDS.data.currentPNRComponentType=d;return"fulfillment/manualQuote/layout.js"}else{if(d===TDS.data.componentType.TYPE_ACCOMMODATION){return"fulfillment/accommodation/layout.js"}else{if(d===TDS.data.componentType.TYPE_TOUR){return"fulfillment/tour/layout.js"}else{if(d===TDS.data.componentType.TYPE_CRUISE){return"fulfillment/cruise/layout.js"}else{if(d===TDS.data.componentType.TYPE_HOSTEL){return"fulfillment/hostel/layout.js"}else{if(d===TDS.data.componentType.TYPE_CAR){return"fulfillment/car/layout.js"}else{if(d===TDS.data.componentType.TYPE_TRANSFER){return"fulfillment/transfer/layout.js"}else{if(d===TDS.data.componentType.TYPE_AIR){return"fulfillment/air/layout.js"}else{if(d===TDS.data.componentType.TYPE_RAIL){return"fulfillment/rail/layout.js"}else{if(d===TDS.data.componentType.TYPE_ATTRACTION){return"fulfillment/attraction/layout.js"}else{if(d===TDS.data.componentType.TYPE_SIGHTSEEING){return"fulfillment/sightseeing/layout.js"}}}}}}}}}}}return"fulfillment/generic/placeholder.js"}}}