{xtype:"form",border:false,width:550,beforeSubmit:function(a){var d=[];var c=this.items.itemAt(0).items.itemAt(4).items.itemAt(0).store.data.items;for(var b=0;b<c.length;b++){d[b]=c[b].data}a.hrefs=d;return a},fieldMap:{transferModeType:"transferModeTypeURI",transferPlaceTypeFrom:"transferPlaceTypeFromURI",transferPlaceTypeTo:"transferPlaceTypeToURI"},items:[{xtype:"tabpanel",activeTab:0,layoutOnTabChange:true,height:340,width:670,defaults:{bodyStyle:"padding: 6px 4px 6px 4px;"},items:[{title:"Details",items:[{xtype:"panel",layout:"form",border:false,labelWidth:80,defaults:{style:"padding: 2px 4px 2px 4px;"},items:[{xtype:"textfield",name:"name",fieldLabel:"Name*",bodyStyle:"padding: 2px 4px 2px 4px;",width:185},{xtype:"textfield",name:"codeSupplier",fieldLabel:"Supplier code",bodyStyle:"padding: 2px 4px 2px 4px;",width:120},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;",border:false,hideBorders:true,layoutConfig:{columns:4},items:[{html:"Advertised rate:",width:Ext.isIE?88:85},{xtype:"textfield",allowBlank:false,name:"rackRatePriceSell",fieldLabel:"Advertised rate",name:"rackRatePriceSell",width:60},{html:" ",width:Ext.isIE?12:12},{xtype:"combo",forceSubmit:true,name:"pricingPriceIsNett",mode:"local",width:60,triggerAction:"all",editable:false,value:"false",store:[["false","Gross"],["true","Nett"]]}]},{xtype:"panel",layout:"table",style:"padding: 0; margin-bottom: 4px;",border:false,hideBorders:true,layoutConfig:{columns:3},items:[{html:"Location:",width:Ext.isIE?88:85},{xtype:"combo",name:"countryTo",emptyText:"Type a country...",excludeSubmit:true,tpl:TDS.util.Templates.ComboNoLabel,minChars:1,enableKeyEvents:true,mode:"local",width:120,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"isoCode",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","isoCode"]}),appendData:[{name:"",dataURI:""}]},{xtype:"locationcombo",name:"locationToURI",style:"margin-left: 2px;",listeners:{beforesearch:function(c){var b=this.ownerCt;var a=b.items.itemAt(1);if(a.getValue()==""){a.markInvalid("Please select a country.");return false}c.searchURI=TDS.env.dataPath+"country/"+a.getValue()+"/locations/collection";c.searchIdentifier="country/"+a.getValue()+"/locations"}}}]},{xtype:"combo",name:"transferModeTypeURI",mode:"local",fieldLabel:"Mode type*",width:120,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/modetypes/collection",identifier:"transfer/modetypes",fields:["name","dataURI"]})},{xtype:"combo",name:"transferPlaceTypeFromURI",mode:"local",fieldLabel:"From*",width:120,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/placetypes/collection",identifier:"transfer/placetypes",fields:["name","dataURI"]})},{xtype:"combo",name:"transferPlaceTypeToURI",mode:"local",fieldLabel:"To*",width:120,triggerAction:"all",editable:false,displayField:"name",valueField:"dataURI",tpl:TDS.util.Templates.ComboNoLabel,store:TDS.data.getStore({dataURI:TDS.env.dataPath+"transfer/placetypes/collection",identifier:"transfer/placetypes",fields:["name","dataURI"]})},{html:"<hr>",border:false},{xtype:"panel",layout:"table",style:" padding-left: 34px; padding-top:20px; ",border:false,hideBorders:true,layoutConfig:{columns:8},items:[{style:" padding-right: 25px; padding-left: 25px; ",xtype:"checkbox",name:"componentlink",checked:false,listeners:{check:function(b,a){if(a){b.ownerCt.items.items[2].enable();b.ownerCt.items.items[4].enable();b.ownerCt.items.items[6].enable()}else{b.ownerCt.items.items[2].disable();b.ownerCt.items.items[4].disable();b.ownerCt.items.items[6].disable()}},render:function(a){if(!a.checked){a.ownerCt.items.items[2].disable();a.ownerCt.items.items[4].disable();a.ownerCt.items.items[6].disable()}}}},{html:"Link",style:" padding-right: 10px; padding-left: 10px; "},{xtype:"combo",allowBlank:false,name:"componentLinked",mode:"local",triggerAction:"all",displayField:"displayData",valueField:"valueData",width:100,store:new Ext.data.JsonStore({fields:["valueData","displayData"],data:[{valueData:"CRUISE",displayData:"CRUISE"},{valueData:"Virgin",displayData:"Virgin"}]}),listeners:{select:function(){if(this.getValue()=="Virgin"){this.findParentByType("form").getForm().findField("departureDate").setValue("");this.findParentByType("form").getForm().findField("cruiseCode").setValue("");this.findParentByType("form").getForm().findField("isLinkActive").setValue(false);this.findParentByType("form").getForm().findField("departureLinked").setValue("");this.findParentByType("form").getForm().findField("departureDate").hide();this.findParentByType("form").getForm().findField("cruiseCode").hide();this.findParentByType("form").getForm().findField("isLinkActive").hide();this.findParentByType("form").getForm().findField("departureLinked").hide();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(8).items.itemAt(6).hide();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(8).items.itemAt(3).hide();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(9).items.itemAt(0).hide();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(9).items.itemAt(1).hide();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(10).items.itemAt(0).hide();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(10).items.itemAt(1).hide()}else{this.findParentByType("form").getForm().findField("departureDate").show();this.findParentByType("form").getForm().findField("cruiseCode").show();this.findParentByType("form").getForm().findField("isLinkActive").show();this.findParentByType("form").getForm().findField("departureLinked").show();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(8).items.itemAt(6).show();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(8).items.itemAt(3).show();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(9).items.itemAt(0).show();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(9).items.itemAt(1).show();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(10).items.itemAt(0).show();this.findParentByType("tabpanel").items.itemAt(0).items.itemAt(0).items.itemAt(10).items.itemAt(1).show()}}}},{html:"Departure Id",style:" padding-right: 10px; padding-left: 10px; "},{xtype:"textfield",name:"departureLinked",width:80},{width:10},{html:"Cruise No",style:" padding-right: 5px; padding-left: 10px; "},{xtype:"textfield",name:"cruiseCode",width:100}]},{xtype:"panel",layout:"table",style:" padding-left: 34px;padding-top:5px; ",border:false,hideBorders:true,layoutConfig:{columns:8},items:[{style:" padding-right: 20px; padding-left: 30px; ",xtype:"checkbox",name:"isLinkActive",checked:false,listeners:{check:function(b,a){}}},{html:"Link Publish Only",style:" padding-right: 10px;padding-left: 10px; "},{xtype:"combo",allowBlank:false,name:"deals",mode:"local",width:140,triggerAction:"all",editable:false,displayField:"name",valueField:"value",store:TDS.data.dealss,tpl:'<tpl for="."><div class="x-combo-list-item" >{name}  ({value})</div></tpl>'},{html:"Deals",style:" padding-right: 10px;padding-left: 10px; "},{width:80},{xtype:"combo",width:80,name:"choice",mode:"local",width:100,triggerAction:"all",editable:false,displayField:"name",valueField:"value",store:TDS.data.choice}]},{xtype:"panel",layout:"table",style:" padding-left: 25px; padding-top: 5px;",border:false,hideBorders:true,layoutConfig:{columns:6},items:[{html:"Departure Date ",style:" padding-left: 10px; padding-right: 10px;"},{xtype:"datefield",width:80,format:"dMy",name:"departureDate"},{width:100},{xtype:"radio",name:"isPre",boxLabel:"Pre ",inputValue:true,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(b.isPre)}}},{width:50},{xtype:"radio",name:"isPre",boxLabel:"Post ",inputValue:false,listeners:{render:function(){var c=this.ownerCt.findParentByType("awesomewindow");var b=c.aw.data;this.setValue(!b.isPre)}}}]}]}]},{title:"Description",layout:"form",items:{xtype:"htmleditor",name:"description",height:200,hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}},{title:"Notes",layout:"form",items:{xtype:"htmleditor",name:"notes",height:200,hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}},{title:"Localisation",layout:"form",items:[{html:"<p>Name:</p>",style:"margin-bottom: 2px;",border:false},{xtype:"textfield",name:"nameLocale",hideLabel:true,labelSeparator:"",anchor:"100%"},{html:"<p>Description:</p>",style:"margin-bottom: 2px;",border:false},{xtype:"htmleditor",name:"descriptionLocale",height:"auto",hideLabel:true,labelSeparator:"",anchor:"100%",enableLinks:false,enableLists:false,enableSourceEdit:false,enableFontSize:false,enableFont:false,enableColors:false,enableAlignments:false}]},{title:"Links",layout:"fit",items:{xtype:"editorgrid",loadMask:{msg:""},viewConfig:{forceFit:true},store:new Ext.data.JsonStore({url:"",pruneModifiedRecords:true,fields:["dataURI","href","description"]}),getData:function(){var c=this.getStore().getModifiedRecords();for(var b=0,e=[];b<c.length;b++){var a=c[b].get("dataURI");e.push({method:a?"PUT":"POST",destinationDataURI:a?TDS.env.dataPath+a:this.baseDataURI,data:{href:c[b].get("href"),description:c[b].get("description")}})}return{data:e}},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{header:"URL",dataIndex:"href",editor:new Ext.form.TextField({allowBlank:false})},{header:"Description",dataIndex:"description",editor:new Ext.form.TextField({allowBlank:false})}]),bbar:[{xtype:"button",text:"Add",tooltip:"Click here to add a new link",handler:function(){var b=this.ownerCt.ownerCt;var a=b.getStore();a.add([new a.recordType({href:"",description:""})]);b.startEditing(a.getCount()-1,0)}},{xtype:"button",text:"Remove",tooltip:"Select a link and click here to remove",handler:function(){var b=this.ownerCt.ownerCt;b.loadMask.show();var a=b.selModel.getSelected();if(a.get("dataURI")){Ext.Ajax.request({method:"DELETE",url:TDS.env.dataPath+a.get("dataURI"),callback:function(e,c,d){b.loadMask.hide();if(c){b.store.remove(a);return}}})}else{b.loadMask.hide();b.store.remove(a)}}}],removeLink:function(){},listeners:{beforerender:function(){var a=this.ownerCt.findParentByType("awesomewindow");if(a){var d=this.ownerCt.ownerCt.ownerCt.ownerCt.initialConfig.sourceDataURI;d+="/hrefs";var c=TDS.env.dataPath+d+"/collection";Ext.Ajax.request({url:c,method:"GET",callback:function b(m,f,h){var g=Ext.util.JSON.decode(h.responseText);var l=g[d];if(typeof l=="undefined"){return}var k=[];for(var e=0;e<l.length;e++){g[l[e]].dataURI=l[e];k.push(g[l[e]])}var j=this.store;j.loadData(k)},scope:this})}}}}}],listeners:{tabchange:function(f,c){var d=this;var b=f.getActiveTab();if(f.items.indexOf(b)==0){if(this.findParentByType("awesomewindow").getData("componentLinked")=="Virgin"){this.findParentByType("form").getForm().findField("departureDate").hide();this.findParentByType("form").getForm().findField("cruiseCode").hide();this.findParentByType("form").getForm().findField("isLinkActive").hide();this.findParentByType("form").getForm().findField("departureLinked").hide();this.items.itemAt(0).items.itemAt(0).items.itemAt(8).items.itemAt(6).hide();this.items.itemAt(0).items.itemAt(0).items.itemAt(8).items.itemAt(3).hide();this.items.itemAt(0).items.itemAt(0).items.itemAt(9).items.itemAt(0).hide();this.items.itemAt(0).items.itemAt(0).items.itemAt(9).items.itemAt(1).hide();this.items.itemAt(0).items.itemAt(0).items.itemAt(10).items.itemAt(0).hide();this.items.itemAt(0).items.itemAt(0).items.itemAt(10).items.itemAt(1).hide()}}}}}]}