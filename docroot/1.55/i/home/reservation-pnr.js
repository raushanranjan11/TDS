{xtype:'panel',autoScroll:true,border:true,items:{xtype:'awesomegrid',searchURI:TDS.env.dataPath+'pnrs',sessionURI:TDS.env.sessionPath+'pnrs',border:false,pinnable:true,tbar:['->',{xtype:'button',text:'Assign External Agency',disabled:true,hidden:true,handler:function(){var grid=this.ownerCt.ownerCt;var a=grid.getSelections();var pnr=a[0].data.dataURI;TDS.window.setWindow({title:'Select Agency',information:'Search and select the agency against this PNR',interfaceURI:'home/externalAgency/selectExternalAgency.js',destinationDataURI:pnr,buttonOK:'Submit',callback:{fn:function(s){if(s)grid.submitQuery(true);},scope:grid}});},listeners:{render:function(){if(TDS.env.user.isArenaOne())this.show();}}},' ',{xtype:'button',text:'Booking Fee',handler:function(){TDS.window.setWindow({title:'Booking Fees',interfaceURI:'bookingFee/bookingFee.js',requiredData:[{}],callback:{fn:function(s){},}});},listeners:{render:function(){if(!TDS.env.user.agencyGroupAdmin){this.hide();}}}},' ',{xtype:'redbutton',text:'Cruise Search',handler:function(){Ext.Ajax.request({url:TDS.env.dataPath+'pnr/newcode',method:'GET',disableCaching:false,callback:function(o,s,r){if(s){var pnrCode=r.responseText;if(typeof pnrCode=='string'&&pnrCode.length==6){var dataURI='pnr/'+pnrCode;var interfaceURI='cruisePnr.js';var tabTitle=dataURI;console.log(tabTitle);var sessionURI=dataURI;TDS.workArea.openTab(tabTitle,interfaceURI,dataURI,sessionURI,'group/RESERVATION');TDS.window.setWindow({title:'Cruise Search',interfaceURI:'pnr/offerings/cruise/searchCruise.js',dataURI:{},data:{},buttonOK:false,buttonCancel:'Close',params:{},callback:{fn:function(s,data,responseData){if(s){}
scope:this}},listeners:{render:function(){}}});}}}});}},' ',{xtype:'redbutton',text:'Create PNR',handler:function(){Ext.Ajax.request({url:TDS.env.dataPath+'pnr/newcode',method:'GET',disableCaching:false,callback:function(o,s,r){if(s){var pnrCode=r.responseText;if(typeof pnrCode=='string'&&pnrCode.length==6){var dataURI='pnr/'+pnrCode;TDS.window.setWindow({title:'New PNR',interfaceURI:'pnr/passenger/mini.js',baseDataURI:dataURI,postDataURI:dataURI+'/passengers/createPNR',buttonOK:'Submit',helpTitel:'Creat New PNR Help',helpId:'14',callback:{fn:function(o,s,r){var name='';if(s){if(s.passengers.length>0){var nameFirst=s.passengers[0].nameFirst;var nameLast=s.passengers[0].nameLast;var salutation=s.passengers[0].salutation;if(nameLast.length>0)
name+=nameLast+' ';if(nameFirst.length>0)
name+=nameFirst.charAt(0);if(salutation.length>0)
name+=salutation;var tabTitle=dataURI+name;if(name!=''){name=' ('+name.toUpperCase()+')';}
var sessionURI=dataURI;TDS.workArea.openTab(tabTitle,'pnr.js',dataURI,sessionURI);}}},scope:this}});}}}});}},' ',{xtype:'button',text:'Archive PNR',disabled:true,handler:function(){var grid=this.ownerCt.ownerCt;var a=grid.getSelections();var pnr=a[0].data.dataURI;var header=this.getText();var archiveOrUnarchive=!(grid.topToolBar2.items.itemAt(12).checked);if(TDS.env.user.hasGroupPermission('ADMINISTRATION')){var pnrArray=[];this.ownerCt.ownerCt.getSelectionModel().getSelections().forEach(function(rec){pnrArray.push(rec.id);});TDS.window.setWindow({title:header,message:'Are you sure you want to '+header+' "'+pnrArray.toString()+'" ?',destinationDataURI:'pnr/archive?archiveOrUnarchive='+archiveOrUnarchive,data:{archived:archiveOrUnarchive,pnrArray:pnrArray},callback:{fn:function(s){if(s)grid.submitQuery(true);},scope:grid}});}else{TDS.window.setWindow({title:header,message:'Are you sure you want to '+header+' "'+pnr+'" ?',destinationDataURI:pnr+'/archive?archiveOrUnarchive='+archiveOrUnarchive,data:{archived:true},callback:{fn:function(s){if(s)grid.submitQuery(true);},scope:grid}});}}},],tbar2:['PNR code:',{xtype:'textfield',name:'codeLike',enableKeyEvents:true,width:80},' ','Primary PAX:',{xtype:'textfield',name:'primaryPassengerNameLike',emptyText:'e.g. SMITH JMR or SMITH',enableKeyEvents:true,width:160},' ','Any PAX:',{xtype:'textfield',name:'anyPassengerNameLike',emptyText:'e.g. JOHN SMITH or JOHN',enableKeyEvents:true,width:160},' ','Date of travel:',{xtype:'datefield',name:'dateFrom',enableKeyEvents:true,width:80,format:TDS.env.dateFormatDisplay,minValue:'01/01/06',showToday:false},' ',{xtype:'checkbox',name:'showUnArchivedOnly',handler:function(){var tb=this.ownerCt.ownerCt.topToolbar;tb.items.itemAt(9).disable(true);this.ownerCt.ownerCt.topToolBar2.items.items[15].disable(true);if(this.checked){tb.items.itemAt(9).setText("Restore PNR");}
else
{tb.items.itemAt(9).setText("Archive PNR");}}},'Show only Archived',' ',{xtype:'button',name:'delete',text:'Delete',disabled:true,handler:function(me1){var g=this.ownerCt.ownerCt;var r=g.selModel.getSelected();if(!r)return;var dataURI=r.get('dataURI');var header=this.getText();if(!dataURI)return;Ext.Msg.show({title:'Alert',msg:'Are you sure you want to '+header,buttons:Ext.Msg.YESNO,fn:processResult,animEl:'elId',icon:Ext.MessageBox.QUESTION});function processResult(a,b,c){var me=this;if(a=='yes'){if(TDS.env.user.hasGroupPermission('ADMINISTRATION')){var pnrArray=[];me1.ownerCt.ownerCt.getSelectionModel().getSelections().forEach(function(rec){pnrArray.push(rec.id);});console.log(pnrArray);Ext.Ajax.request({url:TDS.env.dataPath+'pnr/deleteMultiple',jsonData:{pnrArray:pnrArray},method:'PUT',headers:{'Content-Type':'application/json'},callback:function(){g.submitQuery(true);},scope:me,disableCaching:true});}else{Ext.Ajax.request({url:TDS.env.dataPath+dataURI,method:'DELETE',callback:function(){g.submitQuery(true);},scope:me,disableCaching:true});}}}}}],store:new Ext.data.JsonStore({url:'',id:'dataURI',fields:['dataURI','code','primaryPassengerName','commissionableUserFullNameString','dateFrom','dateTo','pinned','pnrFrom','agencyExternalNameString','createdDate']}),sm:new Ext.grid.RowSelectionModel(),cm:new Ext.grid.ColumnModel([{header:'PNR code',width:40,dataIndex:'dataURI',renderer:function(v){return v.substring(4);}},{header:'Mobile',width:60,fixed:true,dataIndex:'pnrFrom',renderer:function(v,metaData,record)
{if(record.get('pnrFrom')!=''&&record.get('pnrFrom')!=null)
return'<input type="image" src="images/tabicon.png">';else return'';}},{header:'Primary PAX',dataIndex:'primaryPassengerName',width:200,fixed:true},{header:'Date of travel',dataIndex:'dateFrom',renderer:function(value,metaData,record){var v='',dateFrom=record.get('dateFrom'),dateTo=record.get('dateTo');if(dateFrom)v=Date.parseDate(dateFrom,TDS.env.dateFormat).format(TDS.env.dateFormatDisplay);if(dateFrom&&dateTo)v+=' to ';if(dateTo)v+=Date.parseDate(dateTo,TDS.env.dateFormat).format(TDS.env.dateFormatDisplay);;return v;}},{header:'Consultant',dataIndex:'commissionableUserFullNameString',width:80},{header:'Date Created',dataIndex:'createdDate',width:80,renderer:function(value,metadata,record,rowIndex,colIndex,store){var dateFrom=TDS.util.Format.dateSpecial(record.get('createdDate'),TDS.env.dateDayFormatDisplay);return dateFrom;}},{header:'External Agent',dataIndex:'agencyExternalNameString',width:80,hidden:!TDS.env.user.isArenaOne()}]),viewConfig:{enableTabScroll:true,forceFit:true},id:'11',listeners:{toolbarinit:function(){this.appendQueryParams={agencyURI:TDS.env.user.getAgencyURI()};},rowdblclick:function(g,rowIndex,e){var record=this.getStore().getAt(rowIndex);var name='';if(record.get('primaryPassengerName')!=null&&record.get('primaryPassengerName')!='')
name=" ("+record.get('primaryPassengerName')+")";var tabTitle=record.get('dataURI')+name;console.log(tabTitle);var interfaceURI='pnr.js';var dataURI=record.get('dataURI');var sessionURI=dataURI;TDS.workArea.openTab(tabTitle,interfaceURI,dataURI,sessionURI,'group/RESERVATION');},render:function(){this.getSelectionModel().on('rowselect',function(){this.items.itemAt(9).setDisabled(false);var toolbar=this.ownerCt.topToolBar2;var archive=toolbar.items.items[12].checked;if(archive){toolbar.items.items[15].setDisabled(false);}},this.getTopToolbar());this.getSelectionModel().on('rowdeselect',function(){this.items.itemAt(9).setDisabled(true);},this.getTopToolbar());}}}}