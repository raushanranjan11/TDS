{xtype:"form",layout:Ext.isIE?"fit":"",border:false,bodyStyle:"padding: 8px;",autoScroll:true,getDataURI:function(){return this.getAgencyDataURI()?this.getAgencyDataURI()+"/customers":undefined},getAgencyDataURI:function(){if(TDS.env.user.hasGroupPermission("ADMINISTRATION")){var a=this.items.itemAt(0).getTopToolbar();var b=a.items.itemAt(1);if(b.getValue()){return b.getValue()}}else{if(TDS.env.user.isAgencyUser()){return TDS.env.user.getAgencyURI()}}},getSessionURI:function(){return this.ownerCt.sessionURI},getSessionValue:function(a){return this.ownerCt.sessionObj[a]},requireStores:[{dataURI:TDS.env.dataPath+"countries/collection",identifier:"countries",fields:["name","dataURI"]},{dataURI:TDS.env.dataPath+"agencies/collection",identifier:"agencies",fields:["name","dataURI"]}],items:{xtype:"editableGrid",autoSubmit:true,alwaysUseCollection:true,pinnable:true,callBeforeSearch:false,enableRowExpander:false,iconCls:"icon-grid",id:"mobile",tbar:[{xtype:"tbspecialtext",text:"Agency: ",hidden:false},{xtype:"combo",hidden:false,name:"agencyName",mode:"local",minChars:1,width:160,enableKeyEvents:true,mode:"local",typeAhead:true,forceSelection:true,selectOnFocus:true,triggerAction:"all",displayField:"name",valueField:"name",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"agencies/collection",identifier:"agencies",fields:["name","dataURI"]}),appendData:[{dataURI:"",name:"All"}],listeners:{blur:function(){var a=this.getRawValue();if(a==""){this.valueField=""}}}},{xtype:"tbspecialtext",text:"Country: ",hidden:false},{xtype:"clearablecombo",name:"countryURI",fieldLabel:"Country",emptyText:"Type a country...",minChars:1,enableKeyEvents:true,mode:"local",width:160,typeAhead:true,triggerAction:"all",forceSelection:true,selectOnFocus:true,displayField:"name",valueField:"dataURI",store:TDS.data.getStore({dataURI:TDS.env.dataPath+"countries/collection/custom",identifier:"countries",fields:["name","dataURI"]}),appendData:[{dataURI:"",name:"All"}]},{xtype:"tbspecialtext",text:"City: ",hidden:false},{xtype:"textfield",hidden:false,name:"cityName",enableKeyEvents:true},{xtype:"tbspecialtext",text:"Month: ",hidden:false},{xtype:"combo",hidden:false,name:"month",mode:"local",width:160,triggerAction:"all",displayField:"month",valueField:"id",forceSelection:true,store:new Ext.data.JsonStore({autoLoad:true,fields:[{name:"id",type:"int"},{name:"month",type:"string"}],data:[{id:0,month:"January"},{id:1,month:"February"},{id:2,month:"March"},{id:3,month:"April"},{id:4,month:"May"},{id:5,month:"June"},{id:6,month:"July"},{id:7,month:"August"},{id:8,month:"September"},{id:9,month:"October"},{id:10,month:"November"},{id:11,month:"December"}]}),listeners:{blur:function(){var a=this.getRawValue();if(a==""){this.valueField=""}}}},{xtype:"tbspecialtext",text:"Year: ",hidden:false},{xtype:"combo",hidden:false,name:"year",mode:"local",width:160,triggerAction:"all",displayField:"year",valueField:"year",store:new Ext.data.SimpleStore({fields:["year"],expandData:true,data:["2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023","2024","2025","2026","2027","2028","2029","2030"]}),listeners:{blur:function(){var a=this.getRawValue();if(a==""){this.valueField=null}}}}," ",{xtype:"checkbox",hidden:false,checked:true,name:"owing",enableKeyEvents:true},{xtype:"tbspecialtext",text:"Show Margin Owing : ",hidden:false}," ","->",{xtype:"button",text:"Pay",id:"payId",handler:function(){var e=this.ownerCt.ownerCt;var d=e.selModel.getSelected();var c=this.ownerCt.findParentByType("ajaxpanel");var a=d.get("dataURI");var b=e.getStore();if(b.getModifiedRecords()[0].get("owingAmount")==0){console.log("hhhhhhhhh")}if(!d){return}TDS.window.setWindow({title:"Payments",information:"Are You sure want to pay.",postDataURI:"agency/"+a+"/transactions",buttonOK:"Submit",data:b.getModifiedRecords()[0].data,requiredData:[],callback:{fn:function(f){if(f){e.submitQuery(true)}},scope:e}})}}],clicksToEdit:1,store:new Ext.data.JsonStore({url:"",identifier:"",pruneModifiedRecords:true,fields:["dataURI","agentName","agencyURI","agentId","agencyArenaCode","country","city","currency","amountPaids","bankTransfer","method","PNRCode","owingAmount","pnr","createdDates","fees"]}),sm:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:new Ext.grid.ColumnModel([{header:"PNR",dataIndex:"pnr",width:64},{header:"Agency",dataIndex:"agentName",width:64},{header:"ID",dataIndex:"agencyArenaCode"},{header:"Country",dataIndex:"country"},{header:"City",dataIndex:"city",width:60},{header:"Currency",dataIndex:"currency",width:30},{header:"Margin Owing",dataIndex:"owingAmount",width:60,renderer:function(c,b,a){return c!=""?parseFloat(a.get("owingAmount")).toFixed(2):""}},{header:"Fees",dataIndex:"fees",editor:new Ext.form.NumberField({listeners:{blur:function(d,c,a){var b=Ext.getCmp("mobile").getSelectionModel().getSelected();if(!this.getValue()==""){b.set("amountPaids",b.get("owingAmount")-this.getValue());b.set("owingAmount","0.00")}}}}),renderer:function(c,b,a){return c!=""?parseFloat(a.get("fees")).toFixed(2):""}},{header:"Amount Paid",dataIndex:"amountPaids",editor:new Ext.form.NumberField({decimalPrecision:2}),renderer:function(c,b,a){return c!=""?parseFloat(a.get("amountPaids")).toFixed(2):""}},{header:"Date Paid",dataIndex:"createdDates",sortable:true,width:80,editor:new Ext.form.DateField({}),renderer:Ext.util.Format.dateRenderer("d-m-Y")},{header:"Method",dataIndex:"method",sortable:true,width:80,editor:new Ext.form.ComboBox({store:[["Bank Transfer","Bank Transfer"],["Bank Transfer","Bank Transfer"]],mode:"local",triggerAction:"all",typeAhead:true,displayField:"methodDisplay",valueField:"methodValue"})}]),viewConfig:{forceFit:true},listeners:{sessioninit:function(){;var b=this.ownerCt.findParentByType("ajaxpanel");var a=b.dataURI;this.searchURI=TDS.env.dataPath+a+"agency/mobile"},beforerender:function(){},render:function(){},rowdblclick:function(d,j,f){var b=this.ownerCt;var c=d.getStore().getAt(j);if(!c){return}var a=c.get("dataURI");var h=c.get("pnr");console.log(h);var i=c.get("agentId");TDS.window.setWindow({title:"Mobile Commission Payment",data:{agencyURI:"agency/"+i,pnr:h},interfaceURI:"mobile/mobieCommision.js",buttonOK:false})}}}}